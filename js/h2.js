/*!
 * h2.js beta v0.4
 * (c) 2020-2020 eqxiu
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).h2=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?a(e):t}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=o(e);if(t){var s=o(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return l(this,n)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(n):s.value}})(e,t,n||e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,s=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw o}}return n}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function p(e,t){return Object.prototype.toString.call(e).toLowerCase()==="[object ".concat(t,"]")}var g={isObject:function(e){return p(e,"object")},isArray:function(e){return p(e,"array")},isString:function(e){return p(e,"string")},isFunction:function(e){return p(e,"function")},isSupportWebp:!![].map&&0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp"),isWin:["Win32","Windows"].includes(navigator.platform),isWin64:new RegExp(/win64/).test(navigator.userAgent.toLowerCase()),isMac:["Mac68K","MacPPC","Macintosh","MacIntel"].includes(navigator.platform),isChrome:/Chrome/.test(navigator.userAgent),isFirefox:/Firefox/.test(navigator.userAgent),isSafari:/Safari/.test(navigator.userAgent),isEdge:/Edge/.test(navigator.userAgent),isBlob:function(e){return p(e,"blob")},getRandom:function(e,t){var n=t-e+1;return Math.floor(Math.random()*n+e)},getChromeVersion:function(){return Number(/Chrome\/(\d+)/.exec(navigator.userAgent)[1])},blobToDataURL:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}},f="[custom error]",y="[custom debug]",x="[custom info]",b="[custom warn]";var w={error:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).error.apply(e,[f].concat(n)),["pro"].includes(Vue.env.name)},debug:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).debug.apply(e,[y].concat(n))},info:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).info.apply(e,[x].concat(n))},warn:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).warn.apply(e,[b].concat(n))}};var k={css:function(e,t){if(g.isString(e)){if(null==t)return this.style[e];this.style[e]=t}else g.isObject(e)?Object.assign(this.style,e):w.error("css方法的参数不符合要求");return this},attr:function(e,t){if(g.isString(e)){if(null==t)return this.getAttribute(e);this.setAttribute(e,t)}else if(g.isObject(e))for(var n in e)this.setAttribute(n,e[n]);else w.error("attr方法的参数不符合要求");return this},removeAttr:function(e){if(g.isString(e))this.removeAttribute(e);else if(g.isArray(e)){var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=m(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){a=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw o}}}}(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.removeAttribute(i)}}catch(e){n.e(e)}finally{n.f()}}else w.error("removeAttr方法的参数不符合要求");return this},trigger:function(e){var t=document.createEvent("MouseEvents");return t.initMouseEvent(e,!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(t),this},clone:function(){var e=document.createElement("div");return e.innerHTML=this.outerHTML,e.children[0]},remove:function(){this.parentElement&&this.parentElement.removeChild(this)}};function S(e,t){var n=e.x,i=e.y,s=e.x+e.width,o=e.y+e.height,r=t.x,a=t.y,l=t.x+t.width,c=t.y+t.height;return!(n>l||r>s||i>c||a>o)}function E(e,t){var n=!1;return!n&&(n=C(e,{x:t.x,y:t.y})),n||(n=C(e,{x:t.x+t.width,y:t.y})),n||(n=C(e,{x:t.x+t.width,y:t.y+t.height})),n||(n=C(e,{x:t.x,y:t.y+t.height})),n}function C(e,t){var n=t.x,i=t.y,s=e.x+e.width/2,o=e.y+e.height/2,r=-e.rotate*Math.PI/180,a=(n-s)*Math.cos(r)-(i-o)*Math.sin(r)+s,l=(n-s)*Math.sin(r)+(i-o)*Math.cos(r)+o;return a>=e.x&&a<=e.x+e.width&&l>=e.y&&l<=e.y+e.height}function B(e,t){var n=!1,i=0;if(e.rotate>0&&e.rotate<90){i=e.rotate;var s=Math.sin(Math.PI/180*i),o=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.height*s,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.width*s});if(!n)n=$(t,{x:e.x1+e.width*o,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.height*o})}else if(e.rotate>90&&e.rotate<180){i=180-e.rotate;var r=Math.sin(Math.PI/180*i),a=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.height*a});if(!n)n=$(t,{x:e.x1+e.height*r,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.width*r});if(!n)n=$(t,{x:e.x1+e.width*a,y:e.y1})}else if(e.rotate>180&&e.rotate<270){i=e.rotate-180;var l=Math.sin(Math.PI/180*i),c=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.width*l,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.height*l});if(!n)n=$(t,{x:e.x1+e.height*c,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.width*c})}else if(e.rotate>270&&e.rotate<360){i=360-e.rotate;var u=Math.sin(Math.PI/180*i),d=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1,y:e.y1+e.width*u});if(!n)n=$(t,{x:e.x1+e.width*d,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.height*d});if(!n)n=$(t,{x:e.x1+e.height*u,y:e.y1+e.height1})}return n}function $(e,t){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}function _(e){var t,n,i,s,o,r,a,l,c=0;if(e.rotate>0&&e.rotate<90){c=e.rotate;var u=Math.sin(Math.PI/180*c),d=Math.cos(Math.PI/180*c);t=e.x1+e.height*u,n=e.y1,i=e.x1+e.width1,s=e.y1+e.width*u,o=e.x1+e.width*d,r=e.y1+e.height1,a=e.x1,l=e.y1+e.height*d}else if(e.rotate>90&&e.rotate<180){c=180-e.rotate;var h=Math.sin(Math.PI/180*c),m=Math.cos(Math.PI/180*c);t=e.x1+e.width1,n=e.y1+e.height*m,i=e.x1+e.height*h,s=e.y1+e.height1,o=e.x1,r=e.y1+e.width*h,a=e.x1+e.width*m,l=e.y1}else if(e.rotate>180&&e.rotate<270){c=e.rotate-180;var v=Math.sin(Math.PI/180*c),p=Math.cos(Math.PI/180*c);t=e.x1+e.width*p,n=e.y1+e.height1,i=e.x1,s=e.y1+e.height*p,o=e.x1+e.height*v,r=e.y1,a=e.x1+e.width1,l=e.y1+e.width*v}else if(e.rotate>270&&e.rotate<360){c=360-e.rotate;var g=Math.sin(Math.PI/180*c),f=Math.cos(Math.PI/180*c);t=e.x1,n=e.y1+e.width*g,i=e.x1+e.width*f,s=e.y1,o=e.x1+e.width1,r=e.y1+e.height*f,a=e.x1+e.height*g,l=e.y1+e.height1}return{lt:{x:t,y:n},rt:{x:i,y:s},rb:{x:o,y:r},lb:{x:a,y:l}}}function R(e){return{lt:{x:e.x,y:e.y},rt:{x:e.x+e.width,y:e.y},rb:{x:e.x+e.width,y:e.y+e.height},lb:{x:e.x,y:e.y+e.height}}}function V(e,t){var n=_(e),i=R(t),s={A:n.lt,B:n.rt},o={A:n.rt,B:n.rb},r={A:n.lb,B:n.rb},a={A:n.lt,B:n.lb},l={A:i.lt,B:i.rt},c={A:i.rt,B:i.rb},u={A:i.lb,B:i.rb},d={A:i.lt,B:i.lb};return!!J(s,l)||(!!J(s,c)||(!!J(s,u)||(!!J(s,d)||(!!J(o,l)||(!!J(o,c)||(!!J(o,u)||(!!J(o,d)||(!!J(r,l)||(!!J(r,c)||(!!J(r,u)||(!!J(r,d)||(!!J(a,l)||(!!J(a,c)||(!!J(a,u)||!!J(a,d)))))))))))))))}function J(e,t){return Math.min(e.A.x,e.B.x)<=Math.max(t.A.x,t.B.x)&&Math.min(t.A.y,t.B.y)<=Math.max(e.A.y,e.B.y)&&Math.min(t.A.x,t.B.x)<=Math.max(e.A.x,e.B.x)&&Math.min(e.A.y,e.B.y)<=Math.max(t.A.y,t.B.y)&&(n=(t.A.x-e.A.x)*(e.B.y-e.A.y)-(e.B.x-e.A.x)*(t.A.y-e.A.y),i=(t.B.x-e.A.x)*(e.B.y-e.A.y)-(e.B.x-e.A.x)*(t.B.y-e.A.y),s=(e.A.x-t.A.x)*(t.B.y-t.A.y)-(t.B.x-t.A.x)*(e.A.y-t.A.y),o=(e.B.x-t.A.x)*(t.B.y-t.A.y)-(t.B.x-t.A.x)*(e.B.y-t.A.y),n*i<=1e-8&&s*o<=1e-8);var n,i,s,o}Object.assign(HTMLElement.prototype,k),Object.assign(SVGElement.prototype,k),Object.assign(HTMLDocument.prototype,k);var F={rectIsOverlap:function(e,t){if(0===e.rotate||180===e.rotate)return S(e,t);if(90===e.rotate||270===e.rotate){var n={x:e.x+e.width/2,y:e.y+e.height/2};return S({x:n.x-e.height/2,y:n.y-e.width/2,width:e.height,height:e.width},t)}return E(e,t)||B(e,t)||V(e,t)},calcRectIsOverlay:S,calcSelectBoxVertexInRect:E,calcPointInRotateRect:C,calcRectVertexInSelectBox:B,calcPointInRect:$,getPointPositionRotateWithCenterPoint:function(e,t,n){var i=Math.sin(n/180*Math.PI),s=Math.cos(n/180*Math.PI);return{x:(e.x-t.x)*s-(e.y-t.y)*i+t.x,y:(e.x-t.x)*i+(e.y-t.y)*s+t.y}},getRotateRectVertex:_,calcRectLineHaveIntersectionPoint:V,judgeIntersect:J,getVertex:function(e){return 0===e.rotate?R(e):_(e)},calcFootOfPerpendicular:function(e,t,n){var i=e.x-t.x,s=e.y-t.y;if(Math.abs(i)<1e-8&&Math.abs(s)<1e-8)return e;var o=(n.x-e.x)*(e.x-t.x)+(n.y-e.y)*(e.y-t.y);return o/=i*i+s*s,{x:e.x+o*i,y:e.y+o*s}},calcHypotenuseLength:function(e,t){return Math.round(Math.sqrt(Math.pow(Math.abs(e),2)+Math.pow(Math.abs(t),2)))}};var L={rgb2hex:function(e,t){var n=e.r,i=e.g,s=e.b,o=function(e){return("0"+Number(e).toString(16)).slice(-2)},r="#".concat(o(n)).concat(o(i)).concat(o(s));return t?r.toUpperCase():r},hex2rgba:function(e){var t=function(e){return parseInt(e,16)||0};return{r:t((e=e.slice(1)).slice(0,2)),g:t(e.slice(2,4)),b:t(e.slice(4,6)),a:1}},rgb2rgba:function(e){return"string"==typeof e?(e=(/rgba?\((.*?)\)/.exec(e)||["","0,0,0,1"])[1].split(","),{r:Number(e[0])||0,g:Number(e[1])||0,b:Number(e[2])||0,a:Number(e[3]?e[3]:1)}):e},rgb2hsv:function(e){var t=e.r,n=e.g,i=e.b;t/=255,n/=255,i/=255;var s=Math.max(t,n,i),o=Math.min(t,n,i),r=s-o,a=0;return s===o?a=0:s===t?a=n>=i?60*(n-i)/r:60*(n-i)/r+360:s===n?a=60*(i-t)/r+120:s===i&&(a=60*(t-n)/r+240),{h:a=Math.floor(a),s:parseFloat((0===s?0:1-o/s).toFixed(2)),v:parseFloat(s.toFixed(2))}}};function H(e,t,n,i,s,o,r,a,l,c){"boolean"!=typeof r&&(l=a,a=r,r=!1);const u="function"==typeof n?n.options:n;let d;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,s&&(u.functional=!0)),i&&(u._scopeId=i),o?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=d):t&&(d=r?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),d)if(u.functional){const e=u.render;u.render=function(t,n){return d.call(n),e(t,n)}}else{const e=u.beforeCreate;u.beforeCreate=e?[].concat(e,d):[d]}return n}const z={props:{model:{type:Object,default:null},modelKey:{type:String,default:""},modelKeyType:{type:String,default:""},min:{type:Number,default:-9999},max:{type:Number,default:9999},unit:{type:String,default:"px"},unitView:{type:String,default:"px"},step:{type:Number,default:1},reverse:{type:Boolean,default:!1}},computed:{value:function(){return this.model2view(this.model[this.modelKey])},drawingBoard:function(){return Vue.store.state.scene.drawingBoard}},mounted:function(){var e=this,t=this.step,n=this.$refs.input;n.addEventListener("mousedown",(function(n){var i=n.pageX,s=parseInt(n.target.value),o=function(n){var o=n.pageX-i,r=s+o*t;e.setValue(r)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)}))})),n.addEventListener("input",(function(t){var n=parseInt(t.target.value)||0;e.setValue(n)})),n.addEventListener("blur",(function(e){Vue.operatRecord.addRecord()}))},methods:{view2model:function(e){return"transform"===this.modelKey?e="rotateZ(".concat(e,"deg)"):["shadow","stroke","shake","dropShadow"].includes(this.modelKey)?e=Object.assign(this.model[this.modelKey],i({},this.modelKeyType,e)):"cube"===this.modelKey?e=[Object.assign(this.model[this.modelKey][0],i({},this.modelKeyType,e))]:"%"===this.unitView&&(e=this.reverse?Number((1-e/100).toFixed(2)):Number((e/100).toFixed(2))),e},model2view:function(e){return"..."===e||("transform"===this.modelKey?e=/rotateZ?\((.*)deg\)/.exec(e)[1]:["shadow","stroke","shake","dropShadow"].includes(this.modelKey)?e&&(e=e[this.modelKeyType]):e="cube"===this.modelKey&&"size"===this.modelKeyType?e?e[0][this.modelKeyType]:"":"%"===this.unitView?this.reverse?parseInt(100-100*e):parseInt(100*e):parseInt(e)),e},setValue:function(e){isNaN(e)&&(e=0);var t=this.min,n=this.max;e<t?e=t:e>n&&(e=n);var i=this.view2model(e);this.model[this.modelKey]=i,this.$refs.input.value=this.model2view(i)}}};var P=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-base-input hint--top hint--rounded",attrs:{"data-hint":"左右拖动改变大小"}},[t("input",{ref:"input",attrs:{type:"text"},domProps:{value:this.value}}),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:this.unitView,expression:"unitView"}],staticClass:"unit"},[this._v("\n        "+this._s(this.unitView)+"\n    ")])])};P._withStripped=!0;const M=H({render:P,staticRenderFns:[]},void 0,z,void 0,!1,void 0,!1,void 0,void 0,void 0);const I={props:{model:{type:Object,default:null},modelKey:{type:String,default:""},modelKeyType:{type:String,default:""},showBorder:{type:Boolean,default:!1},isMuti:{type:Boolean,default:!1}},data:function(){return{clientHeight:document.documentElement.clientHeight||document.body.clientHeight}},computed:{backgroundColor:function(){if("..."===this.model[this.modelKey])return"#ffffff";var e="";switch(this.modelKey){case"shake":case"gradient":e=this.model[this.modelKey]?this.model[this.modelKey].colors[this.modelKeyType]:"#ffffff";break;case"shadow":case"stroke":e=this.model[this.modelKey]?this.model[this.modelKey].color:"#ffffff";break;case"cube":e=this.model[this.modelKey]?this.model[this.modelKey][0].color:"#ffffff";break;case"dropShadow":e=this.model[this.modelKey]?this.model[this.modelKey].color:"rgba(0,0,0,0.2)";break;default:e=this.model[this.modelKey]}return e}},methods:{showColorPanel:function(e){document.addEventListener("mousedown",this.hideColorPanel);var t="",n="";switch(this.modelKey){case"dropShadow":case"shadow":case"stroke":t=this.model[this.modelKey],n=this.modelKeyType;break;case"gradient":case"shake":t=this.model[this.modelKey].colors,n=this.modelKeyType;break;case"cube":t=this.model[this.modelKey][0],n="color";break;default:t=this.model,n=this.modelKey}var i=this.clientHeight-338,s=e.pageY;s>=i&&(s=i),this.colorPicker.open(t,n,{right:"184px",top:s+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(this.colorPicker.close(),document.removeEventListener("mousedown",this.hideColorPanel),Vue.operatRecord.addRecord())}}};var T=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-setting-color",on:{mousedown:function(e){e.stopPropagation()},click:this.showColorPanel}},[t("div",{staticClass:"color",class:[{border:this.showBorder}],style:[{backgroundColor:this.backgroundColor}]})])};T._withStripped=!0;const O=H({render:T,staticRenderFns:[]},void 0,I,void 0,!1,void 0,!1,void 0,void 0,void 0);Vue.component("BaseInput",M),Vue.component("SettingColor",O);const A={props:{color:{type:String,default:"#ff00ff"},suckerCanvas:{type:null,default:null},suckerArea:{type:Array,default:function(){return[]}},colorsDefault:{type:Array,default:function(){return["#000000","#FFFFFF","#FF1900","#F47365","#FFB243","#FFE623","#6EFF2A","#1BC7B1","#00BEFF","#2E81FF","#5D61FF","#FF89CF","#FC3CAD","#BF3DCE","#8E00A7","#6600A4"]}},colorsHistoryKey:{type:String,default:"h2-color-history"},suckerEnabled:{type:Boolean,default:!0}},data:function(){return{slideSaturationStyle:{},slideHueStyle:{},slideAlphaStyle:{},hueWidth:15,hueHeight:152,alphaSize:5,selectedColorHeight:30,isOpenSucker:!1,suckerPreview:null,isSucking:!1,imgAlphaBase64:"",modelRgba:"",modelHex:"",r:0,g:0,b:0,a:1,h:0,s:0,v:0,colorsHistory:JSON.parse(localStorage.getItem(this.colorsHistoryKey))||[],colorSelected:""}},computed:{totalWidth:function(){return this.hueHeight+2*(this.hueWidth+8)},rgba:function(){var e=this;return{r:this.r,g:this.g,b:this.b,a:this.a,toRgbString:function(){return"rgb(".concat([e.r,e.g,e.b].join(","),")")},toRgbaStringShort:function(){return"".concat([e.r,e.g,e.b,e.a].join(","))},toRgbaString:function(){return"rgba(".concat(e.rgba.toRgbaStringShort(),")")},toHexString:function(){return e.rgb2hex(e.rgba,!0)}}},hsv:function(){return{h:this.h,s:this.s,v:this.v}}},watch:{rgba:function(e){this.$emit("change",e)},suckerCanvas:function(e){this.isSucking=!1,this.suckColor(e)}},created:function(){this.setColorValue(this.color),this.setColorPos(),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.imgAlphaBase64=this.createAlphaSquare(this.alphaSize).toDataURL()},mounted:function(){this.renderHue(this.$refs.canvasHue,this.hueWidth,this.hueHeight),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.renderColor(this.$refs.canvasColor,this.totalWidth-this.selectedColorHeight,this.selectedColorHeight,this.alphaSize)},destroyed:function(){this.setcolorsHistory(this.colorSelected)},methods:{keydownHandler:function(e){27===e.keyCode&&(this.isOpenSucker=!this.isOpenSucker,this.isSucking=!1,this.$emit("openSucker",this.isOpenSucker),document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("mousemove",this.mousemoveHandler),document.removeEventListener("mouseup",this.mousemoveHandler),this.suckerPreview&&(document.body.removeChild(this.suckerPreview),this.suckerPreview=null),this.bindSuckerMaskClickEvent())},mousemoveHandler:function(e){var t=e.pageX,n=e.pageY,i=this.suckerCanvas.getBoundingClientRect(),s=i.top,o=i.left,r=i.width,a=i.height,l=e.pageX-o,c=e.pageY-s,u=d(this.suckerCanvas.getContext("2d").getImageData(Math.min(l,r-1),Math.min(c,a-1),1,1).data,4),h=u[0],m=u[1],v=u[2],p=u[3];p=parseFloat((p/255).toFixed(2));var g=this.suckerPreview.style;Object.assign(g,{position:"absolute",left:e.pageX+20+"px",top:e.pageY-36+"px",width:"24px",height:"24px",borderRadius:"50%",border:"2px solid #fff",boxShadow:"0 0 8px 0 rgba(0, 0, 0, 0.16)",background:"rgba(".concat([h,m,v,p].join(","),")"),zIndex:95});var f=document.getElementById("suckerMaskId");t>=this.suckerArea[0]&&n>=this.suckerArea[1]&&t<=this.suckerArea[2]&&n<=this.suckerArea[3]?(g.display="",null!==f&&f.css({pointerEvents:"none"})):(g.display="none",null!==f&&f.css({pointerEvents:"auto"}))},openSucker:function(){this.keydownHandler({keyCode:27}),this.isOpenSucker&&(this.isSucking=!0,document.addEventListener("keydown",this.keydownHandler))},inputColor:function(e){this.setColorValue(e.target.value)&&(this.setColorPos(),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.colorSelected=this.rgba.toRgbaString())},setcolorsHistory:function(e){if(e){var t=this.colorsHistory,n=t.indexOf(e);n>=0&&t.splice(n,1),t.length>=8&&(t.length=7),t.unshift(e),this.colorsHistory=t,localStorage.setItem(this.colorsHistoryKey,JSON.stringify(t))}},setColorValue:function(e){var t={r:0,g:0,b:0,a:1};if(new RegExp(/^((2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?(0\.\d{1,2}|1|0)$/).test(e)&&(e="rgb("+e+")"),/^#([0-9a-fA-F]{6})$/.test(e))t=this.hex2rgba(e);else if(/rgb/.test(e))t=this.rgb2rgba(e);else{if("[object Object]"!==Object.prototype.toString.call(e))return!1;t=e}var n=t,i=n.r,s=n.g,o=n.b,r=n.a;this.r=i,this.g=s,this.b=o,this.a=r||0===r?r:1;var a=this.rgb2hsv(this.rgba),l=a.h,c=a.s,u=a.v;return this.h=l,this.s=c,this.v=u,!0},setColorPos:function(){this.slideSaturationStyle={left:this.s*this.hueHeight-5+"px",top:(1-this.v)*this.hueHeight-5+"px"},this.slideHueStyle={top:(1-this.h/360)*this.hueHeight-2+"px"},this.slideAlphaStyle={top:this.a*this.hueHeight-2+"px"}},selectColor:function(e){this.setColorValue(e),this.setColorPos(),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.colorSelected=this.rgba.toRgbaString()},selectSaturation:function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),e.target===this.$refs.canvasSaturation){var n=this.$refs.saturation.getBoundingClientRect(),i=n.top,s=n.left,o=e.target.getContext("2d"),r=function(e){var n=e.pageX-s,r=e.pageY-i;n<0&&(n=0),r<0&&(r=0),n>t.hueHeight&&(n=t.hueHeight),r>t.hueHeight&&(r=t.hueHeight),t.slideSaturationStyle={left:n-5+"px",top:r-5+"px"};var a=d(o.getImageData(Math.min(n,t.hueHeight-1),Math.min(r,t.hueHeight-1),1,1).data,3),l=a[0],c=a[1],u=a[2];t.setColorValue({r:l,g:c,b:u}),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort()};r(e);document.addEventListener("mousemove",r),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e),t.colorSelected=t.rgba.toRgbaString()}))}},selectHue:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.$refs.hue.getBoundingClientRect().top,i=e.target.getContext("2d"),s=function(e){var s=e.pageY-n;s<0&&(s=0),s>t.hueHeight&&(s=t.hueHeight),t.slideHueStyle={top:s-2+"px"},t.slideSaturationStyle={left:t.hueHeight-5+"px",top:"-5px"};var o=d(i.getImageData(0,Math.min(s,t.hueHeight-1),1,1).data,3),r=o[0],a=o[1],l=o[2];t.setColorValue({r:r,g:a,b:l}),t.renderSaturation(t.$refs.canvasSaturation,t.rgba.toRgbString(),t.hueHeight),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()};s(e);document.addEventListener("mousemove",s),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e)}))},selectAlpha:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.$refs.alpha.getBoundingClientRect().top,i=function(e){var i=e.pageY-n;i<0&&(i=0),i>t.hueHeight&&(i=t.hueHeight),t.slideAlphaStyle={top:i-2+"px"},t.a=parseFloat((i/t.hueHeight).toFixed(2)),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()};i(e);document.addEventListener("mousemove",i),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)}))},suckColor:function(e){var t=this;e&&"CANVAS"!==e.tagName||(this.suckerPreview=document.createElement("div"),document.body.appendChild(this.suckerPreview),document.addEventListener("mousemove",this.mousemoveHandler),document.addEventListener("mouseup",this.mousemoveHandler),e.addEventListener("click",(function(n){var i=e.getBoundingClientRect(),s=i.top,o=i.left,r=i.width,a=i.height,l=n.pageX-o,c=n.pageY-s,u=d(e.getContext("2d").getImageData(Math.min(l,r-1),Math.min(c,a-1),1,1).data,4),h=u[0],m=u[1],v=u[2],p=u[3];p=parseFloat((p/255).toFixed(2)),t.setColorValue({r:h,g:m,b:v,a:p}),t.setColorPos(),t.renderSaturation(t.$refs.canvasSaturation,t.rgba.toRgbString(),t.hueHeight),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()})))},renderSaturation:function(e,t,n){var i=e.getContext("2d");e.width=n,e.height=n,i.fillStyle=t,i.fillRect(0,0,n,n),this.createLinearGradient("l",i,n,n,"#FFFFFF","rgba(255,255,255,0)"),this.createLinearGradient("p",i,n,n,"rgba(0,0,0,0)","#000000")},renderHue:function(e,t,n){var i=e.getContext("2d");e.width=t,e.height=n;var s=i.createLinearGradient(0,0,0,n);s.addColorStop(0,"#FF0000"),s.addColorStop(.17,"#FF00FF"),s.addColorStop(.34,"#0000FF"),s.addColorStop(.51,"#00FFFF"),s.addColorStop(.68,"#00FF00"),s.addColorStop(.17*5,"#FFFF00"),s.addColorStop(1,"#FF0000"),i.fillStyle=s,i.fillRect(0,0,t,n)},renderAlpha:function(e,t,n,i,s){if(e){var o=this.createAlphaSquare(i),r=e.getContext("2d");e.width=t,e.height=n,r.fillStyle=r.createPattern(o,"repeat"),r.fillRect(0,0,t,n),this.createLinearGradient("p",r,t,n,"rgba(255,255,255,0)",s)}},renderColor:function(e,t,n,i){var s=this.createAlphaSquare(i),o=e.getContext("2d");e.width=t,e.height=n,o.fillStyle=o.createPattern(s,"repeat"),o.fillRect(0,0,t,n)},createAlphaSquare:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=2*e;return t.width=i,t.height=i,n.fillStyle="#ffffff",n.fillRect(0,0,i,i),n.fillStyle="#ccd5db",n.fillRect(0,0,e,e),n.fillRect(e,e,e,e),t},createLinearGradient:function(e,t,n,i,s,o){var r="l"===e,a=t.createLinearGradient(0,0,r?n:0,r?0:i);a.addColorStop(.01,s),a.addColorStop(.99,o),t.fillStyle=a,t.fillRect(0,0,n,i)},rgb2hex:function(e,t){var n=e.r,i=e.g,s=e.b,o=function(e){return("0"+Number(e).toString(16)).slice(-2)},r="#".concat(o(n)).concat(o(i)).concat(o(s));return t?r.toUpperCase():r},hex2rgba:function(e){var t=function(e){return parseInt(e,16)||0};return{r:t((e=e.slice(1)).slice(0,2)),g:t(e.slice(2,4)),b:t(e.slice(4,6)),a:1}},rgb2rgba:function(e){return"string"==typeof e?(e=(/rgba?\((.*?)\)/.exec(e)||["","0,0,0,1"])[1].split(","),{r:Number(e[0])||0,g:Number(e[1])||0,b:Number(e[2])||0,a:Number(e[3]?e[3]:1)}):e},rgb2hsv:function(e){var t=e.r,n=e.g,i=e.b;t/=255,n/=255,i/=255;var s=Math.max(t,n,i),o=Math.min(t,n,i),r=s-o,a=0;return s===o?a=0:s===t?a=n>=i?60*(n-i)/r:60*(n-i)/r+360:s===n?a=60*(i-t)/r+120:s===i&&(a=60*(t-n)/r+240),{h:a=Math.floor(a),s:parseFloat((0===s?0:1-o/s).toFixed(2)),v:parseFloat(s.toFixed(2))}},suckerMaskClick:function(e){this.keydownHandler({keyCode:27})},bindSuckerMaskClickEvent:function(){var e=this;setTimeout((function(){var t=document.getElementById("suckerMaskId");null!==t?e.isOpenSucker?t.addEventListener("click",e.suckerMaskClick):t.removeEventListener("click",e.suckerMaskClick):e.bindSuckerMaskClickEvent()}),500)}}};var G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"h2-color-picker"},[n("div",{staticClass:"color-set"},[n("div",{ref:"saturation",staticClass:"saturation",on:{mousedown:e.selectSaturation}},[n("canvas",{ref:"canvasSaturation"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideSaturationStyle})]),e._v(" "),n("div",{ref:"hue",staticClass:"hue",on:{mousedown:e.selectHue}},[n("canvas",{ref:"canvasHue"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideHueStyle})]),e._v(" "),n("div",{ref:"alpha",staticClass:"alpha",on:{mousedown:e.selectAlpha}},[n("canvas",{ref:"canvasAlpha"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideAlphaStyle})])]),e._v(" "),n("div",{staticClass:"color-show",style:{height:e.selectedColorHeight+"px"}},[n("div",{staticClass:"show"},[n("canvas",{ref:"canvasColor"}),e._v(" "),n("div",{staticClass:"color",style:{background:e.rgba.toRgbaString()}})]),e._v(" "),e.isSucking?e._e():n("svg",{staticClass:"sucker",class:{active:e.isOpenSucker},style:{display:e.suckerEnabled?"block":"none"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"-12 -12 48 48"},on:{click:e.openSucker}},[n("path",{attrs:{d:"M13.1,8.2l5.6,5.6c0.4,0.4,0.5,1.1,0.1,1.5s-1.1,0.5-1.5,0.1c0,0-0.1,0-0.1-0.1l-1.4-1.4l-7.7,7.7C7.9,21.9,7.6,22,7.3,22H3.1C2.5,22,2,21.5,2,20.9l0,0v-4.2c0-0.3,0.1-0.6,0.3-0.8l5.8-5.8C8.5,9.7,9.2,9.6,9.7,10s0.5,1.1,0.1,1.5c0,0,0,0.1-0.1,0.1l-5.5,5.5v2.7h2.7l7.4-7.4L8.7,6.8c-0.5-0.4-0.5-1-0.1-1.5s1.1-0.5,1.5-0.1c0,0,0.1,0,0.1,0.1l1.4,1.4l3.5-3.5c1.6-1.6,4.1-1.6,5.8-0.1c1.6,1.6,1.6,4.1,0.1,5.8L20.9,9l-3.6,3.6c-0.4,0.4-1.1,0.5-1.5,0.1"}})]),e._v(" "),e.isSucking?n("svg",{staticClass:"sucker",attrs:{viewBox:"-16 -16 68 68",xmlns:"http://www.w3.org/2000/svg",stroke:"#9099a4"}},[n("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[n("g",{attrs:{transform:"translate(1 1)","stroke-width":"4"}},[n("circle",{attrs:{"stroke-opacity":".5",cx:"18",cy:"18",r:"18"}}),e._v(" "),n("path",{attrs:{d:"M36 18c0-9.94-8.06-18-18-18"}},[n("animateTransform",{attrs:{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"1s",repeatCount:"indefinite"}})],1)])])]):e._e()]),e._v(" "),n("div",{staticClass:"color-type"},[n("div",{staticClass:"name"},[e._v("\n            HEX\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.modelHex,expression:"modelHex"}],staticClass:"value",style:{width:e.totalWidth-60+"px"},attrs:{maxlength:"7"},domProps:{value:e.modelHex},on:{input:[function(t){t.target.composing||(e.modelHex=t.target.value)},e.inputColor]}})]),e._v(" "),n("div",{staticClass:"color-type"},[n("div",{staticClass:"name"},[e._v("\n            RGBA\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.modelRgba,expression:"modelRgba"}],staticClass:"value",style:{width:e.totalWidth-60+"px"},attrs:{maxlength:"15"},domProps:{value:e.modelRgba},on:{input:[function(t){t.target.composing||(e.modelRgba=t.target.value)},e.inputColor]}})]),e._v(" "),n("ul",{staticClass:"colors",style:{width:e.totalWidth+"px"}},e._l(e.colorsDefault,(function(t){return n("li",{key:t,staticClass:"item",style:{background:t},on:{click:function(n){return e.selectColor(t)}}})})),0),e._v(" "),e.colorsHistory.length?n("ul",{staticClass:"colors history",style:{width:e.totalWidth+"px"}},e._l(e.colorsHistory,(function(t){return n("li",{key:t,staticClass:"item",on:{click:function(n){return e.selectColor(t)}}},[n("div",{staticClass:"alpha",style:{background:"url("+e.imgAlphaBase64+")"}}),e._v(" "),n("div",{staticClass:"color",style:{background:t}})])})),0):e._e()])};G._withStripped=!0;const D={components:{colorPicker:H({render:G,staticRenderFns:[]},void 0,A,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{model:{type:Object,default:null},modelKey:{type:String,default:""},css:{type:Object,default:null},suckerEnable:{type:Boolean,default:!1}},data:function(){return{color:this.model[this.modelKey],isOpenSucker:!1,canvasSucker:null,suckerArea:[],mask:null}},computed:{eqxPage:function(){return Vue.store.state.scene.eqxPage}},methods:{changeColor:function(e){this.model[this.modelKey]=e.toRgbaString()},openSucker:function(e){},setSuckerCanvas:function(e){e.css({position:"absolute",left:0,top:0,opacity:0,pointerEvents:"auto",zIndex:1002}),e.addEventListener("mousedown",(function(e){return e.stopPropagation()}))},getSuckerArea:function(){var e=this.eqxPage.$el.getBoundingClientRect(),t=this.eqxPage.$el.parentElement.parentElement.getBoundingClientRect();return[Math.max(t.left,e.left),Math.max(t.top,e.top),Math.min(t.right,e.right),Math.min(t.bottom,e.bottom)]},createMask:function(e){var t=d(e,4),n=t[0],i=t[1],s=t[2],o=t[3],r=this.canvasMask=document.createElement("canvas"),a=r.getContext("2d");return r.width=document.body.clientWidth,r.height=document.body.clientHeight,r.setAttribute("id","suckerMaskId"),a.fillStyle="rgba(0,0,0,0.7)",a.fillRect(0,0,r.width,r.height),a.clearRect(n,i,s-n,o-i),r.css({position:"absolute",left:0,top:0,outline:"10000px solid rgba(0,0,0,0.7)",zIndex:6}),r}}};var q=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-color-picker",style:this.css,on:{mousedown:function(e){e.stopPropagation()}}},[t("color-picker",{attrs:{"sucker-canvas":this.canvasSucker,"sucker-area":this.suckerArea,color:this.color,"sucker-enabled":this.suckerEnable},on:{change:this.changeColor,openSucker:this.openSucker}})],1)};q._withStripped=!0;const N=H({render:q,staticRenderFns:[]},void 0,D,void 0,!1,void 0,!1,void 0,void 0,void 0);var Y=null;function W(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Y&&j();var s=Vue.extend(N);Y=new s({propsData:{model:e,modelKey:t,css:n,suckerEnable:i}}).$mount(),document.body.querySelector(".eqx-h2open").appendChild(Y.$el)}function j(){Y&&(document.body.querySelector(".eqx-h2open").removeChild(Y.$el),Y.$destroy(),Y=null)}function U(){return{isOpenSucker:(Y||{}).isOpenSucker}}function K(e){return("0"+Number(e).toString(16)).slice(-2)}Vue.use((function(e){e.colorPicker=e.prototype.colorPicker={open:W,close:j,getState:U}})),Vue.filter("rgb2hex",(function(e,t){var n="";if(/#/.test(e))n=e;else if(/rgb/.test(e)){var i=/rgba?\((.*?)\)/.exec(e)[1].split(",");n="#".concat(K(i[0])).concat(K(i[1])).concat(K(i[2]))}return t?n.toUpperCase():n}));var X=8,Z=46,Q=32,ee=37,te=38,ne=39,ie=40,se=65,oe=67,re=71,ae=76,le=83,ce=86,ue=89,de=90,he=187,me=189,ve=function(t){s(o,t);var i=c(o);function o(){var t;return e(this,o),(t=i.call(this)).keydownEventHandler=null,t}return n(o,null,[{key:"bindKeydown",value:function(e,t,n){this.keydownEventHandler=function(t){var n=t.ctrlKey||t.metaKey,i=t.shiftKey;switch(t.keyCode){case X:case Z:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.delSelectedElements();break;case Q:if(Vue.elements.isTextEditing())break;t.preventDefault();break;case ee:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:-1*(i?10:1),y:0});break;case te:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:0,y:-1*(i?10:1)});break;case ne:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:1*(i?10:1),y:0});break;case ie:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:0,y:1*(i?10:1)});break;case se:if(Vue.elements.isTextEditing())break;n&&(t.preventDefault(),Vue.drawingBoard.selectAllElement());break;case oe:if(Vue.elements.isTextEditing())break;n&&t.preventDefault();break;case re:n&&(t.preventDefault(),i?Vue.elements.unGroupSelected():Vue.elements.groupSelected());break;case ae:case le:n&&t.preventDefault();break;case ce:if(Vue.elements.isTextEditing())break;n&&t.preventDefault();break;case ue:n&&t.preventDefault();break;case de:if(Vue.elements.isTextEditing())break;n&&t.preventDefault();break;case me:case he:n&&t.preventDefault()}if([X,Z,ee,te,ne,ie,re,ae,ce,me,he].includes(t.keyCode)){e.addEventListener("keyup",(function t(n){e.removeEventListener("keyup",t)}))}},e.addEventListener("keydown",this.keydownEventHandler)}},{key:"unbindKeydown",value:function(e,t,n){e.removeEventListener("keydown",this.keydownEventHandler)}}]),o}(function(){function t(){e(this,t),console.log("directive")}return n(t,[{key:"record",value:function(){}}]),t}()),pe={bind:function(e,t,n){"editor"===t.arg&&ve.bindKeydown(e,t,n)},unbind:function(e,t,n){"editor"===t.arg&&ve.unbindKeydown(e,t,n)}},ge=function(){function t(n,i){e(this,t),this.options=Object.assign({onScrollMove:function(){},onScrollEnd:function(){}},i),this.wrap=n,this.ul=n.children[0],this.scroll=null,this.scrollBarHeight=0,this.scrollY=0,this.maxScrollY=0,this.ratioY=0,this.timeoutId=0,this.inMouseDown=!1,this.dragStartY=0,this.initScroll()}return n(t,[{key:"initScroll",value:function(){var e=this.scroll=document.createElement("div");Object.assign(e.style,{position:"absolute",right:"2px",top:"0",width:"8px",background:"rgba(0,0,0,.4)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",transition:"background .3s"}),this.wrap.appendChild(e),this.wrap.onwheel=this.wheelHandler.bind(this),this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),e.onmouseover=this.mouseoverHandler.bind(this),e.onmouseleave=this.mouseleaveHandler.bind(this),e.onmousedown=this.mousedownHandler.bind(this),this.mousemoveHandler=this.mousemoveHandler.bind(this),this.mouseupHandler=this.mouseupHandler.bind(this)}},{key:"wheelHandler",value:function(e){var t=this;this.scrollMove(e),this.options.onScrollMove(e,{maxScrollY:this.maxScrollY,scrollY:this.scrollY}),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.options.onScrollEnd(e,{maxScrollY:t.maxScrollY,scrollY:t.scrollY})}),300)}},{key:"resizeHandler",value:function(){var e=this;clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){e.refresh()}),300)}},{key:"scrollMove",value:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();var t=e.deltaY;e.deltaMode&&1===e.deltaMode&&(t=30*e.deltaY),this.scrollY+=t,this.scrollY>=this.maxScrollY&&(this.scrollY=this.maxScrollY),this.scrollY<=0&&(this.scrollY=0),this.ul.style.transform="translate3d(0,".concat(-this.scrollY,"px,0)"),this.scroll.style.transform="translate3d(0,".concat(Math.floor(this.scrollY*this.ratioY),"px,0)")}},{key:"refresh",value:function(){var e=this.wrap.offsetHeight||1,t=this.ul.offsetHeight||1;this.maxScrollY=t-e,this.ratioY=e/t,this.ratioY<1?(this.scrollBarHeight=Math.floor(this.ratioY*e),Object.assign(this.scroll.style,{height:this.scrollBarHeight+"px",display:"block"}),this.scrollMove({deltaY:0}),this.wrap.onwheel=this.wheelHandler.bind(this)):(Object.assign(this.scroll.style,{display:"none"}),this.scrollMove({deltaY:-this.maxScrollY/this.ratioY}),this.wrap.onwheel=null)}},{key:"scrollTo",value:function(e){e.x;var t=e.y;this.refresh(),t/=this.ratioY,this.scrollMove({deltaY:t})}},{key:"scrollToTop",value:function(){this.scrollTo({y:-this.maxScrollY})}},{key:"scrollToBottom",value:function(){this.scrollTo({y:this.maxScrollY})}},{key:"setScrollSelected",value:function(e){var t=e?{background:"rgba(0,0,0,.5)"}:{background:"rgba(0,0,0,.4)"};Object.assign(this.scroll.style,t)}},{key:"mouseoverHandler",value:function(){this.setScrollSelected(!0)}},{key:"mouseleaveHandler",value:function(){this.inMouseDown||this.setScrollSelected(!1)}},{key:"mousedownHandler",value:function(e){var t=document;t.addEventListener("mousemove",this.mousemoveHandler),t.addEventListener("mouseup",this.mouseupHandler),t.addEventListener("mouseleave",this.mouseupHandler),this.dragStartY=e.clientY,this.inMouseDown=!0,this.setScrollSelected(!0)}},{key:"mousemoveHandler",value:function(e){e.preventDefault();var t=e.clientY,n=(t-this.dragStartY)/this.ratioY;this.dragStartY=t;var i=Object.assign({},e,{deltaY:n});this.scrollMove(i),this.options.onScrollMove(e,{maxScrollY:this.maxScrollY,scrollY:this.scrollY})}},{key:"mouseupHandler",value:function(e){var t=this,n=document;n.removeEventListener("mousemove",this.mousemoveHandler),n.removeEventListener("mouseup",this.mouseupHandler),n.removeEventListener("mouseleave",this.mouseupHandler),this.inMouseDown=!1,this.setScrollSelected(!1),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.options.onScrollEnd(e,{maxScrollY:t.maxScrollY,scrollY:t.scrollY})}),300)}},{key:"destroy",value:function(){this.wrap.onwheel=null,this.scroll.onmouseover=null,this.scroll.onmouseleave=null,this.scroll.onmousedown=null,window.removeEventListener("resize",this.resizeHandler)}}]),t}(),fe={bind:function(e){e.style.overflow="hidden";e.myScroll=new ge(e,{}),Vue.nextTick((function(){return e.myScroll.refresh()}))},componentUpdated:function(e){Vue.nextTick((function(){return e.myScroll.refresh()}))},unbind:function(e){e.myScroll.destroy(),e.myScroll=null,delete e.myScroll}};Vue.directive("keymap",pe),Vue.directive("scrollBar",fe);var ye,xe,be="ELEMENT_SELECT",we="SET_BACKGROUND",ke="HISTORY_SET",Se="HISTORY_BACK",Ee="HISTORY_FORWORD",Ce="CACHE_IMAGE",Be="CLEAR_CACHE_IMAGE",$e="FONT_LIST_INIT",_e="FONT_SELECTED",Re="FONT_LAYER",Ve="OPEN_LOADING_CHANGE",Je={state:{eqxElementsSelected:[],background:null,disableBack:!0,disableForward:!0,cacheImage:{},openLoading:!1,editorConfig:{settingBar:!0,toolBar:!0,name:"图片编辑器开放平台",eagleEye:!0,debug:!0}},mutations:(i(ye={},"EDITOR_CONFIG_CHANGE",(function(e,t){e.editorConfig=Object.assign(e.editorConfig,t)})),i(ye,be,(function(e,t){var n=t.eqxElements;e.eqxElementsSelected=n})),i(ye,we,(function(e,t){var n=t.background;e.background=n})),i(ye,ke,(function(e,t){var n=t.disableBack,i=t.disableForward;e.disableBack=n,e.disableForward=i})),i(ye,Se,(function(e){if(!e.disableBack){var t=Vue.operatRecord.back();Vue.operatRecord.renderDrawBoard(t)}})),i(ye,Ee,(function(e){if(!e.disableForward){var t=Vue.operatRecord.forward();Vue.operatRecord.renderDrawBoard(t)}})),i(ye,Ce,(function(e,t){var n=t.key,i=t.value;e.cacheImage[n]=i})),i(ye,Be,(function(e){e.cacheImage={}})),i(ye,Ve,(function(e,t){e.openLoading=t})),ye)},Fe={state:{list:[],selectedItem:{},layer:{show:!1}},mutations:(i(xe={},$e,(function(e,t){e.list=t})),i(xe,_e,(function(e,t){e.selectedItem=t})),i(xe,Re,(function(e,t){var n=t.show;e.layer.show=n})),xe)};Vue.store=new Vuex.Store({modules:{scene:Je,font:Fe}});var Le=Vue.store,He={combine:100,text:101,image:102},ze=[{name:"报隶-常规体",fontFamily:"STBaoliSC-Regular",src:""},{name:"冬青黑体",fontFamily:"HiraginoSansGB-W3",src:""},{name:"黑体-细体",fontFamily:"STHeitiSC-Light",src:""},{name:"华文楷体-常规体",fontFamily:"STKaiti",src:""},{name:"华文宋体-常规体",fontFamily:"STSong",src:""},{name:"圆体-常规体",fontFamily:"STYuanti-SC-Regular",src:""},{name:"雅痞-常规体",fontFamily:"YuppySC-Regular",src:""},{name:"行楷-细体",fontFamily:"STXingkaiSC-Light",src:""},{name:"魏碑-粗体",fontFamily:"WeibeiSC-Bold",src:""},{name:"娃娃体-常规体",fontFamily:"DFWaWaSC-W5",src:""},{name:"手札体-常规体",fontFamily:"HannotateSC-W5",src:""},{name:"凌慧体-中黑体",fontFamily:"MLingWaiMedium-SC",src:""},{name:"Didot",fontFamily:"Didot",src:""},{name:"Cochin",fontFamily:"Cochin",src:""},{name:"ComicSansMS",fontFamily:"ComicSansMS",src:""}],Pe=[{name:"方正粗黑宋",fontFamily:"FZCHSJW--GB1-0",src:""},{name:"汉仪中圆简",fontFamily:"HYe3gj",src:""},{name:"方正大黑简体",fontFamily:"FZDHTJW--GB1-0",src:""},{name:"方正报宋简体",fontFamily:"FZBSJW--GB1-0",src:""},{name:"方正姚体简体",fontFamily:"FZYTJW--GB1-0",src:""},{name:"华文彩云 ",fontFamily:"STCaiyun",src:""},{name:"隶书",fontFamily:"LiSu",src:""},{name:"InkFree",fontFamily:"InkFree",src:""},{name:"Constantia-Bold",fontFamily:"Constantia-Bold",src:""}];var Me={getSysFonts:function(){return g.isMac?ze:Pe}};const Ie={directives:{dragStyleLayer:{bind:function(e,t){var n=t.value||{},i=n.target,s=n.container,o=n.onMouseDown,r=n.onMouseMove,a=n.onMouseUp;e.addEventListener("mousedown",(function(t){t.preventDefault();var n=document.querySelector(i)||e,l=document.querySelector(s),c=t.pageX,u=t.pageY,d=0,h=0,m=parseInt(n.css("left"))||0,v=parseInt(n.css("top"))||0,p={},f={};l&&(p=n.getBoundingClientRect(),f=l.getBoundingClientRect()),g.isFunction(o)&&o(n);var y=function(e){d=e.pageX-c,h=e.pageY-u;var t={left:m+d,top:v+h};if(l){var i={left:0,top:0,right:f.width-p.width,bottom:f.height-p.height};t.left<i.left&&(t.left=i.left),t.left>i.right&&(t.left=i.right),t.top<i.top&&(t.top=i.top),t.top>i.bottom&&(t.top=i.bottom)}n.css({left:t.left+"px",top:t.top+"px"}),g.isFunction(r)&&r(n,t.top)};document.addEventListener("mousemove",y),document.addEventListener("mouseup",(function e(t){document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",e),g.isFunction(a)&&a(n)}))}))}}},props:{},data:function(){return{font:{list:[{name:"默认字体",fontFamily:"",src:""}],selectedItem:null},chooseFontList:[],height:0}},computed:{scene:function(){return Vue.store.state.scene},eqxElementsSelected:function(){return this.scene.eqxElementsSelected},eqxElement:function(){return this.eqxElementsSelected[0]},css:function(){return this.eqxElement.elementJson.css},property:function(){return this.eqxElement.elementJson.property},fontList:function(){return Vue.store.state.font.list},getPositionStyle:function(){return{left:document.querySelector(".eqx-h2open").clientWidth-183-183+"px",top:"0px"}}},created:function(){var e=this;this.font.list=this.font.list.concat(Me.getSysFonts(),this.fontList),this.setSelectedFont(),setTimeout((function(){return e.$refs.wrap&&e.$refs.wrap.myScroll.refresh()}),300)},mounted:function(){var e=this.$el.parentElement.offsetHeight;this.height=e-40-48},methods:{close:function(){Vue.store.commit("FONT_LAYER",{show:!1})},setSelectedFont:function(){var e=this;this.css&&(this.font.selectedItem=this.font.list.find((function(t){return t.fontFamily===e.css.fontFamily}))||{})},chooseFont:function(e){this.font.selectedItem=e,this.css.fontFamily=e.fontFamily,this.property.fontFamilyName=e.name,e.src?(this.property.src=e.src,[He.text].includes(this.eqxElement.elementJson.type)&&this.eqxElement.createFontFace()):delete this.property.src,Vue.operatRecord.addRecord()}}};var Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-text-font",style:e.getPositionStyle,attrs:{id:"eqc-setting-text-font"}},[n("div",{directives:[{name:"drag-style-layer",rawName:"v-drag-style-layer",value:{target:"#eqc-setting-text-font",container:".eqx-h2open"},expression:"{target: '#eqc-setting-text-font', container: '.eqx-h2open'}"}],staticClass:"head"},[n("span",[e._v("字体")]),e._v(" "),n("i",{staticClass:"close eqf-no",on:{click:e.close}})]),e._v(" "),n("div",{staticClass:"showFontList"},[n("div",{staticClass:"container"},[n("div",{staticClass:"eqc-drop-dwon-container"},[n("div",{directives:[{name:"scroll-bar",rawName:"v-scroll-bar"}],ref:"wrap",staticClass:"wrap",style:{height:e.height+"px"}},[n("ul",{staticClass:"list"},e._l(e.font.list,(function(t,i){return n("li",{key:i,staticClass:"item ellipsis",class:{active:e.font.selectedItem&&t.name===e.font.selectedItem.name},style:{fontFamily:t.fontFamily},on:{click:function(n){return e.chooseFont(t)}}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])})),0)])])])])])};Te._withStripped=!0;const Oe=H({render:Te,staticRenderFns:[]},void 0,Ie,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ae=function(){var e=this.$createElement;this._self._c;return this._m(0)};Ae._withStripped=!0;const Ge={components:{SettingFont:Oe,Loading:H({render:Ae,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-loading"},[t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-inner"},[t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})])])])])}]},void 0,{},void 0,!1,void 0,!1,void 0,void 0,void 0)},data:function(){return{preventDefault:function(e){return e.preventDefault()}}},computed:{font:function(){return Vue.store.state.font},openLoading:function(){return Vue.store.state.scene.openLoading},settingBar:function(){return Vue.store.state.scene.editorConfig.settingBar}},mounted:function(){document.addEventListener("dragstart",this.dragstart),document.addEventListener("contextmenu",this.preventDefault),this.$el.addEventListener("wheel",this.preventDefault)}};var De=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqx-h2open"},[n("div",{ref:"eqxCenter",staticClass:"eqx-center"},[n("div",{directives:[{name:"keymap",rawName:"v-keymap:editor",arg:"editor"}],ref:"editor",staticClass:"eqx-editor",attrs:{tabindex:"0"}})]),e._v(" "),e.settingBar?n("div",{ref:"eqxRight",staticClass:"eqx-right"}):e._e(),e._v(" "),n("transition",{attrs:{name:"rotate-y-left"}},[e.font.layer.show?n("setting-font"):e._e()],1),e._v(" "),e.openLoading?n("loading"):e._e()],1)};De._withStripped=!0;const qe=H({render:De,staticRenderFns:[]},void 0,Ge,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ne=function t(){e(this,t)},Ye=function t(){e(this,t),this.size={},this.positon={}};const We={computed:{backgroundStyle:function(){return this.property.backgroundStyle},bottomStyle:function(){var e=this.property.bottom,t=e.type,n=e.color,i=e.colors,s=e.rotate,o="";return o=0===t?n:"linear-gradient(".concat(s,"deg, ").concat(i[0]||"transparent"," 0%, ").concat(i[1]||"transparent"," 100%)"),Object.assign(this.property.bottomStyle,{background:o})},middleStyle:function(){return Object.assign(this.property.middleStyle,{})},topStyle:function(){return Object.assign(this.property.topStyle,{})}}};var je=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqx-background",style:this.backgroundStyle},[t("div",{ref:"bottom",staticClass:"bottom",style:this.bottomStyle}),this._v(" "),t("div",{ref:"middle",staticClass:"middle",style:this.middleStyle}),this._v(" "),t("div",{ref:"top",staticClass:"top",style:this.topStyle})])};je._withStripped=!0;const Ue=H({render:je,staticRenderFns:[]},void 0,We,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ke=function(){function t(){e(this,t);var n=Vue.extend(Ue);this.defaultData(),this.$vm=new n({data:{property:this.property}}).$mount(),this.$el=this.$vm.$el,Vue.store.commit("SET_BACKGROUND",{background:this})}return n(t,[{key:"defaultData",value:function(){this.property={clearCount:0,blur:0,bottom:{color:"transparent",colors:["",""],rotate:0,type:0},middle:{opacity:1,size:.1,src:"",type:0},top:{color:"#",colors:["",""],opacity:.4,rotate:0,type:0},backgroundStyle:{position:"absolute",width:"100%",height:"100%",overflow:"hidden"},bottomStyle:{position:"absolute",left:0,top:0,width:"100%",height:"100%"},middleStyle:{position:"absolute",left:0,top:0,width:"100%",height:"100%",filter:"blur(0px)"},topStyle:{position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:"0.4"}}}},{key:"setBackground",value:function(e){Object.assign(this.property,e)}},{key:"clearBackground",value:function(){Object.assign(this.property,{clearCount:0,blur:0,bottom:{color:"transparent",colors:["",""],rotate:0,type:0},middle:{opacity:1,size:.1,src:"",type:0},top:{color:"#",colors:["",""],opacity:.4,rotate:0,type:0}})}},{key:"setBackgroundColor",value:function(e){Array.isArray(e)?(this.property.bottom.type=1,this.property.bottom.colors=e):(this.property.bottom.type=0,this.property.bottom.color=e)}}]),t}();const Xe={};var Ze=function(){var e=this.$createElement;this._self._c;return this._m(0)};Ze._withStripped=!0;const Qe=H({render:Ze,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqx-range-mask"},[t("div",{staticClass:"shadow"},[t("div",{staticClass:"bleed"})])])}]},void 0,Xe,void 0,!1,void 0,!1,void 0,void 0,void 0);var et=function t(n){e(this,t);var i=Vue.extend(Qe);this.$vm=(new i).$mount(),this.$el=this.$vm.$el};const tt={computed:{style:function(){return{transform:"scale(".concat(this.elementsJson.scale,")"),width:"".concat(this.elementsJson.width,"px"),height:"".concat(this.elementsJson.height,"px")}}}};var nt=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"eqx-elements",style:this.style})};nt._withStripped=!0;const it=H({render:nt,staticRenderFns:[]},void 0,tt,void 0,!1,void 0,!1,void 0,void 0,void 0);var st=function(){function t(n){e(this,t),this.id=n.id,this.elementIds=n.elementIds,this.groupIds=n.groupIds,this.style=n.style}return n(t,[{key:"includeElement",value:function(e){return this.elementIds.indexOf(e)>=0}},{key:"includeGroup",value:function(e){return this.groupIds.indexOf(e)>=0}},{key:"move",value:function(e){this.style.x+=e.x,this.style.y+=e.y}},{key:"setRotate",value:function(e){this.style.rotate=e}},{key:"setPosition",value:function(e){this.style.x=e.x,this.style.y=e.y}},{key:"setSize",value:function(e){this.style.width=e.width,this.style.height=e.height}}]),t}(),ot=function(){function t(){e(this,t),this.groupList=[]}return n(t,[{key:"getRelationship",value:function(){return JSON.parse(JSON.stringify(this.groupList))}},{key:"setRelationship",value:function(e){var t=this;this.groupList=[],e.forEach((function(e){var n=new st(e);t.groupList.push(n)}))}},{key:"updateElementGroup",value:function(e){var t=this,n=[],i=this.getElementParentGroup(e),s=[];!function e(n){n.groupIds.forEach((function(n){var i=t.getGroup(n);i.groupIds.length>0&&e(i),s.push(i)}))}(i),(n=n.concat(s)).push(i);for(var o=this.getGroupParentGroup(i);null!==o;)n.push(o),o=this.getGroupParentGroup(o);var r=[],a={};return n.forEach((function(e){e.groupIds.forEach((function(e){a[e]||(r.push(t.getGroup(e)),a[e]=!0)})),a[e.id]||(r.push(e),a[e.id]=!0)})),this.delGroups(r),new Promise((function(e,n){t.asynGroupUpdate(r,0,e)}))}},{key:"asynGroupUpdate",value:function(e,t,n){var i=this;if(e.length!==t){var s=e[t],o=this.getAllElementByGroupAndGrouplist(s.id,e),r=Vue.elements.getByIds(o);Vue.elementsBoxs.setSelectedElement(r),Vue.elementBoxEdit.$vm.$nextTick((function(){i.group(r,s.id),i.asynGroupUpdate(e,t+1,n)}))}else n()}},{key:"getAllElementByGroupAndGrouplist",value:function(e,t){for(var n=[],i=0;i<t.length;i++){var s=t[i];if(s.id===e){n=n.concat(s.elementIds);for(var o=0;o<s.groupIds.length;o++){var r=s.groupIds[o];n=n.concat(this.getAllElementByGroupAndGrouplist(r,t))}return n}}}},{key:"getGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id===e)return n}}},{key:"delGroups",value:function(e){var t=this;e.forEach((function(e){t.delGroup(e)}))}},{key:"delGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){if(this.groupList[t].id===e.id){this.groupList.splice(t,1);break}}}},{key:"group",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=[],o=[];e.forEach((function(e){var t=n.getElementTopGroup(e);t?o.push(t.id):s.push(e.elementJson.id)}));var r=h(new Set(o));if(0===s.length&&1===r.length)return!1;var a=new st({id:i||t.newId(this.groupList),elementIds:s,groupIds:r,style:this.getStyle()});return this.groupList.push(a),!0}},{key:"getStyle",value:function(){var e=Vue.elementBoxEdit.getDataJson();return{width:e.elementWidth,height:e.elementHeight,rotate:e.rotate,x:e.elementX,y:e.elementY}}},{key:"unGroup",value:function(e){var t=this.searchGroupIndex(e);return t>=0&&(this.groupList.splice(t,1),!0)}},{key:"searchGroup",value:function(e){for(var t=e.map((function(e){return e.elementJson.id})).sort().toString(),n=this.groupList.length-1;n>=0;n--){var i=this.groupList[n];if(t===this.getAllElementByGroup(i.id).sort().toString())return i}return null}},{key:"searchGroupIndex",value:function(e){for(var t=e.map((function(e){return e.elementJson.id})).sort().toString(),n=this.groupList.length-1;n>=0;n--){var i=this.groupList[n];if(t===this.getAllElementByGroup(i.id).sort().toString())return n}return-1}},{key:"getAllElementIdsByElementInGroup",value:function(e){var t=this.getElementTopGroup(e);return null!==t?this.getAllElementByGroup(t.id):[e.elementJson.id]}},{key:"getAllElementByGroup",value:function(e){for(var t=[],n=0;n<this.groupList.length;n++){var i=this.groupList[n];if(i.id===e){t=t.concat(i.elementIds);for(var s=0;s<i.groupIds.length;s++){var o=i.groupIds[s];t=t.concat(this.getAllElementByGroup(o))}return t}}}},{key:"getElementTopGroup",value:function(e){var t=this.getElementParentGroup(e);return null===t?null:this.getGroupRootGroup(t)}},{key:"getElementParentGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.includeElement(e.elementJson.id))return n}return null}},{key:"getElementsGroup",value:function(e){var t,n=this,i=[],s=[],o=function(e,t){null===e||s[e.id]||(i.push(e),s[e.id]=!0),t&&t(null===e)};return e.forEach((function(e){var i=n.getElementParentGroup(e),s=i;o(i,(function(e){if(!e){t=!0;var i=function(){var e=n.getGroupParentGroup(s);o(e,(function(n){n?t=!1:s=e}))};do{i()}while(t)}}))})),i}},{key:"getGroupParentGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id!==e.id&&n.includeGroup(e.id))return n}return null}},{key:"getGroupRootGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id!==e.id&&n.includeGroup(e.id))return this.getGroupRootGroup(n)}return e}},{key:"getFirstGroupElementCount",value:function(){return this.groupList.length>0?this.groupList[0].elementIds.length:-1}},{key:"moveGroups",value:function(e,t){e.forEach((function(e){e.move(t)}))}},{key:"updateGroups",value:function(e){}}],[{key:"newId",value:function(e){var t=0;do{t=g.getRandom(100,99999)}while(e.map((function(e){return e.id})).indexOf(t)>-1);return t}}]),t}(),rt=function(){function t(n){e(this,t);var i=Vue.extend(it);this.$vm=new i({data:{elementsJson:{scale:n.scale,width:n.size.width,height:n.size.height}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementList=[],this.elementRelationship=new ot}return n(t,[{key:"getAllElementByElementInGroup",value:function(e){var t=this.elementRelationship.getAllElementIdsByElementInGroup(e);return this.elementList.filter((function(e){return t.indexOf(e.elementJson.id)>=0}))}},{key:"getElementTopGroup",value:function(e){return this.elementRelationship.getElementTopGroup(e)}},{key:"getElementParentGroup",value:function(e){return this.elementRelationship.getElementParentGroup(e)}},{key:"getElementsGroup",value:function(e){return this.elementRelationship.getElementsGroup(e)}},{key:"getFirstGroupElementCount",value:function(){return this.elementRelationship.getFirstGroupElementCount()}},{key:"add",value:function(e){if(e.state){if(e.bind(this),e.setScale(this.scale),!e.elementJson.id){var n=t.newId(this.elementList);e.updateId(n);var i=t.newZIndex(this.elementList);e.updateCss({zIndex:i})}this.$el.appendChild(e.$el),this.elementList.push(e)}else e.destroy()}},{key:"setScale",value:function(e){var t=this;this.scale=e,this.$vm.$data.elementsJson.scale=e,this.elementList.forEach((function(e){e.setScale(t.scale)}))}},{key:"getByIds",value:function(e){return this.elementList.filter((function(t){return e.includes(t.elementJson.id)}))}},{key:"getSelected",value:function(){return this.elementList.filter((function(e){return!0===e.selected}))}},{key:"getAll",value:function(){return this.elementList}},{key:"setSelected",value:function(e){e.forEach((function(e){e.setSelected(!0)}))}},{key:"clearSelected",value:function(){this.elementList.forEach((function(e){e.setSelected(!1)}))}},{key:"selectAll",value:function(){this.elementList.forEach((function(e){e.setSelected()}))}},{key:"delSelected",value:function(){this.elementList=this.elementList.filter((function(e){return!e.selected||(e.destroy(),!1)}))}},{key:"delAll",value:function(){this.elementList=this.elementList.filter((function(e){return e.destroy(),!1}))}},{key:"delElement",value:function(e){this.elementList=this.elementList.filter((function(t){return t.elementJson.id!==e.elementJson.id||(e.destroy(),!1)}))}},{key:"moveSelected",value:function(e){this.elementList.forEach((function(t){t.selected&&t.move(e)}))}},{key:"getElementInSelectedById",value:function(e){for(var t=!1,n=0;n<this.elementList.length;n++){var i=this.elementList[n];if(i.selected&&i.elementJson.id===e){t=i;break}}return t}},{key:"getSelectedElements",value:function(){var e=[];return this.getSelected().map((function(t){e.push(t)})),e}},{key:"updateElementGroup",value:function(e){return this.elementRelationship.updateElementGroup(e)}},{key:"groupSelected",value:function(){var e=this.getSelected();e.length>1&&this.elementRelationship.group(e)&&(this.getFirstGroupElementCount()!==e.length&&Vue.elementsBoxs.setGroupElement(e),Vue.elementsBoxs.setElementBoxEditIsGroup(!0),this.sortGroup(e),Vue.operatRecord.addRecord())}},{key:"unGroupSelected",value:function(){var e=this.getSelected();e.length>1&&this.elementRelationship.unGroup(e)&&(this.getFirstGroupElementCount()!==e.length&&Vue.elementsBoxs.setGroupElement(e),Vue.elementsBoxs.setElementBoxEditIsGroup(!1),Vue.operatRecord.addRecord())}},{key:"sortGroup",value:function(e){console.log("组合成功");var t=e.map((function(e){return e.elementJson.css.zIndex})).sort(),n=t[0],i=-1;console.log("选择的元素 zIndex 小到大排序：",JSON.stringify(t));for(var s=t.length-1;s>0;s--)if(t[s]-1!==t[s-1]){i=t[s]-1;break}if(i>=0){console.log("选择的元素 zIndex 不连续，需要排序，zIndex：",n,"~",i,"的元素需要排序");var o=[],r=[];this.elementList.forEach((function(e){var s=e.elementJson.css.zIndex;s>=n&&s<=i&&(t.includes(s)?r.push(e):o.push(e))})),o.sort((function(e,t){return e.elementJson.css.zIndex>t.elementJson.css.zIndex})),r.sort((function(e,t){return e.elementJson.css.zIndex>t.elementJson.css.zIndex})),o.concat(r).forEach((function(e,t){e.updateCss({zIndex:n+t})}))}else console.log("不需要排序")}},{key:"searchGroupIndex",value:function(e){return this.elementRelationship.searchGroupIndex(e)}},{key:"searchGroup",value:function(e){return this.elementRelationship.searchGroup(e)}},{key:"moveSelectedElementGroups",value:function(e,t){this.elementRelationship.moveGroups(e,t)}},{key:"getRelationship",value:function(){return this.elementRelationship.getRelationship()}},{key:"setRelationship",value:function(e){return this.elementRelationship.setRelationship(e)}},{key:"updateRelationship",value:function(e){this.elementRelationship.updateGroups(e)}},{key:"isTextEditing",value:function(){for(var e=!1,t=Vue.elements.getSelected(),n=0;n<t.length;n++){var i=t[n];if(i.elementJson.type===He.text&&i.isEditing){e=!0;break}}return e}},{key:"openSettingListener",value:function(){for(var e=Vue.elements.getSelected(),t=0;t<e.length;t++){var n=e[t];n.elementJson.type===He.text&&n.isEditing&&(n.setCssIsUpdate(!0),n.setPropertyIsUpdate(!0))}}}],[{key:"newId",value:function(e){var t=0;do{t=g.getRandom(100,99999)}while(e.map((function(e){return e.elementJson.id})).indexOf(t)>-1);return t}},{key:"newZIndex",value:function(e){var t=e.map((function(e){return e.elementJson.css.zIndex})),n=t.length?t:[0];return Math.max.apply(Math,n)+1}}]),t}();const at={};var lt=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"eqx-boxs"})};lt._withStripped=!0;const ct=H({render:lt,staticRenderFns:[]},void 0,at,void 0,!1,void 0,!1,void 0,void 0,void 0);var ut={image:7,text:5,combine:4},dt=function(e){return(1|e)===e},ht=function(e){return(2|e)===e},mt=function(e){return(4|e)===e},vt={noResize:0,vertexLeftTop:1,vertexRightTop:2,vertexRightBottom:4,vertexLeftBottom:8,lineTop:16,lineRight:32,lineBottom:64,lineLeft:128},pt={line:0,vertex:1};const gt={computed:{elementResizeBarEnum:function(){return vt},allowResizeW:function(){return dt(this.dataJson.resizeType)},allowResizeH:function(){return ht(this.dataJson.resizeType)},allowResizeWH:function(){return mt(this.dataJson.resizeType)},getStyle:function(){return this.dataJson.visible?{width:"".concat(this.dataJson.width,"px"),height:"".concat(this.dataJson.height,"px"),left:"".concat(this.dataJson.x-1,"px"),top:"".concat(this.dataJson.y-1,"px"),transform:"rotate(".concat(this.dataJson.rotate,"deg)"),transformOrigin:this.dataJson.transformOrigin}:{}},getMaskStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)")}:{}},getRotateMaskStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)"),transformOrigin:this.dataJson.transformOrigin}:{}},getRotateStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)")}:{}},getRotateValueStyle:function(){return{left:"".concat(this.dataJson.rotateValueLeft||-12,"px"),top:"".concat(this.dataJson.rotateValueTop||-40,"px")}}}};var ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{class:["eqx-box-edit",e.dataJson.isGroup||1===e.dataJson.elementCount?"eqx-box-edit-group":""],style:e.getStyle},[(e.dataJson.resizeBar,e.elementResizeBarEnum.noResize,e.elementResizeBarEnum.noResize,n("div",{ref:"boxEditMask",staticClass:"box-edit-mask",style:e.getMaskStyle},[n("div")])),e._v(" "),n("div",{ref:"boxEditRotateMask",staticClass:"box-edit-rotate-mask",style:e.getRotateMaskStyle}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexLeftTop)===e.elementResizeBarEnum.vertexLeftTop,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexLeftTop)===elementResizeBarEnum.vertexLeftTop"}],ref:"vertexWestNorth",staticClass:"vertex west-north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexRightTop)===e.elementResizeBarEnum.vertexRightTop,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexRightTop)===elementResizeBarEnum.vertexRightTop"}],ref:"vertexEastNorth",staticClass:"vertex east-north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexRightBottom)===e.elementResizeBarEnum.vertexRightBottom,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexRightBottom)===elementResizeBarEnum.vertexRightBottom"}],ref:"vertexEastSouth",staticClass:"vertex east-south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexLeftBottom)===e.elementResizeBarEnum.vertexLeftBottom,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexLeftBottom)===elementResizeBarEnum.vertexLeftBottom"}],ref:"vertexWestSouth",staticClass:"vertex west-south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineTop)===e.elementResizeBarEnum.lineTop,expression:"dataJson.controlSizeBarVisible && allowResizeH &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineTop)===elementResizeBarEnum.lineTop"}],ref:"sideNorth",staticClass:"side north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeW&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineRight)===e.elementResizeBarEnum.lineRight,expression:"dataJson.controlSizeBarVisible && allowResizeW &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineRight)===elementResizeBarEnum.lineRight"}],ref:"sideEast",staticClass:"side east"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineBottom)===e.elementResizeBarEnum.lineBottom,expression:"dataJson.controlSizeBarVisible && allowResizeH &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineBottom)===elementResizeBarEnum.lineBottom"}],ref:"sideSouth",staticClass:"side south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeW&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineLeft)===e.elementResizeBarEnum.lineLeft,expression:"dataJson.controlSizeBarVisible && allowResizeW &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineLeft)===elementResizeBarEnum.lineLeft"}],ref:"sideWest",staticClass:"side west"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.middleLineVisible,expression:"dataJson.middleLineVisible"}],ref:"middleLine",staticClass:"middle-line"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlRotateBarVisible,expression:"dataJson.controlRotateBarVisible"}],ref:"rotate",staticClass:"rotate",style:e.getRotateStyle},[n("i",{staticClass:"icon eqf-flip"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.rotating,expression:"dataJson.rotating"}],staticClass:"rotate-value",style:e.getRotateValueStyle,domProps:{textContent:e._s(e.dataJson.rotate+"°")}})])]):e._e()};ft._withStripped=!0;const yt=H({render:ft,staticRenderFns:[]},void 0,gt,void 0,!1,void 0,!1,void 0,void 0,void 0);function xt(){var e;e=1===Vue.elementBoxEdit.elementList.length?Vue.elementBoxEdit.elementList[0].elementResizeType:ut.combine;var t=vt,n=pt;dt(e)&&(bt(this.$refs.sideWest,t.lineLeft,n.line),bt(this.$refs.sideEast,t.lineRight,n.line)),ht(e)&&(bt(this.$refs.sideNorth,t.lineTop,n.line),bt(this.$refs.sideSouth,t.lineBottom,n.line)),mt(e)&&(bt(this.$refs.vertexWestNorth,t.vertexLeftTop,n.vertex),bt(this.$refs.vertexWestSouth,t.vertexLeftBottom,n.vertex),bt(this.$refs.vertexEastNorth,t.vertexRightTop,n.vertex),bt(this.$refs.vertexEastSouth,t.vertexRightBottom,n.vertex))}function bt(e,t,n){e.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault(),Vue.elementBoxEdit.setResizebar(t);var i,s=function(){var e=Vue.elementBoxEdit.$vm.$data.dataJson.x-1,t=Vue.elementBoxEdit.$vm.$data.dataJson.y-1,n=Vue.elementBoxEdit.$vm.$data.dataJson.rotate,i=Vue.elementBoxEdit.$vm.$data.dataJson.width+2,s=Vue.elementBoxEdit.$vm.$data.dataJson.height+2,o=null;if(n%90==0&&i===s||n%180==0)o={rotate:0,x:e,y:t,width:i,height:s};else if(90===n||270===n){var r=0,a=0,l=0,c=0;if(i>s){var u=e+(i-s)/2;r=r>u||0===r?u:r;var d=t-(i-s)/2;a=a>d||0===a?d:a;var h=u+s;l=l<h?h:l;var m=d+i;c=c<m?m:c}else if(i<s){var v=e-(s-i)/2;r=r>v||0===r?v:r;var p=t+(s-i)/2;a=a>p||0===a?p:a;var g=v+s;l=l<g?g:l;var f=p+i;c=c<f?f:c}o={rotate:0,x:r,y:a,width:l-r,height:c-a}}else{var y=Vue.elementBoxEdit.$vm.$el.getBoundingClientRect();o={x:"",y:"",width:i,height:s,rotate:n,x1:y.x,y1:y.y,width1:y.width,height1:y.height}}var x=F.getVertex(o);if(90===n)return{lt:x.rt,rt:x.rb,rb:x.lb,lb:x.lt};if(180===n)return{lt:x.rb,rt:x.lb,rb:x.lt,lb:x.rt};if(270===n)return{lt:x.lb,rt:x.lt,rb:x.rt,lb:x.rb};return x}(Vue.elementBoxEdit),o={rotate:Vue.elementBoxEdit.$vm.$data.dataJson.rotate,width:Vue.elementBoxEdit.$vm.$data.dataJson.width,height:Vue.elementBoxEdit.$vm.$data.dataJson.height,x:Vue.elementBoxEdit.$vm.$data.dataJson.x,y:Vue.elementBoxEdit.$vm.$data.dataJson.y},r=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),a=pt;i=n===a.line?function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),s=null,o=null,r=null,a=vt;switch(t){case a.lineTop:r="left bottom";var l=F.getPointPositionRotateWithCenterPoint(e.lt,e.lb,-n);s=l.x,o=l.y;break;case a.lineRight:case a.lineBottom:r="left top",s=e.lt.x,o=e.lt.y;break;case a.lineLeft:r="right top";var c=F.getPointPositionRotateWithCenterPoint(e.lt,e.rt,-n);s=c.x,o=c.y}n%90!=0?(s=s-i.x+1,o=o-i.y+1):(s+=1,o+=1);return{transformOrigin:r,x:s,y:o}}(s,t,o.rotate):function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),s=null,o=null,r=null,a=vt;switch(t){case a.vertexLeftTop:r="right bottom";var l=F.getPointPositionRotateWithCenterPoint(e.lt,e.rb,-n);s=l.x,o=l.y;break;case a.vertexLeftBottom:r="right top";var c=F.getPointPositionRotateWithCenterPoint(e.lt,e.rt,-n);s=c.x,o=c.y;break;case a.vertexRightTop:r="left bottom";var u=F.getPointPositionRotateWithCenterPoint(e.lt,e.lb,-n);s=u.x,o=u.y;break;case a.vertexRightBottom:r="left top",s=e.lt.x,o=e.lt.y}n%90!=0?(s=s-i.x+1,o=o-i.y+1):(s+=1,o+=1);return{transformOrigin:r,x:s,y:o}}(s,t,o.rotate);var l=function(){var e=Vue.elementBoxEdit.scale,t=[];return Vue.elementBoxEdit.elementList.forEach((function(n){t.push({id:n.elementJson.id,type:n.elementJson.type,x:n.elementJson.css.x*e,y:n.elementJson.css.y*e,width:n.getBoxSize().width*e,height:n.getBoxSize().height*e}),n.resizeInitDataStore(),n.setCssIsUpdate(!1),n.setPropertyIsUpdate(!1)})),t}(),c=function(){var e=Vue.elementBoxEdit.scale,t=[];return Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList).forEach((function(n){var i={id:n.id,x:n.style.x*e,y:n.style.y*e,width:n.style.width*e,height:n.style.height*e,rotate:n.style.rotate};t.push(i)})),t}(),u=!1,d=function(e){u||Vue.elementBoxEdit.updateCss({transformOrigin:i.transformOrigin,x:i.x,y:i.y});var c=function(e){return{x:e.pageX,y:e.pageY}}(e),d=null;if(o.rotate%90!=0){var h=function(e,t,n){var i=vt,s=null;switch(t){case i.vertexLeftTop:s=F.calcFootOfPerpendicular(e.rb,e.lb,n);break;case i.vertexLeftBottom:s=F.calcFootOfPerpendicular(e.rt,e.lt,n);break;case i.vertexRightTop:s=F.calcFootOfPerpendicular(e.lb,e.rb,n);break;case i.vertexRightBottom:s=F.calcFootOfPerpendicular(e.lt,e.rt,n);break;case i.lineTop:s=F.calcFootOfPerpendicular(e.lt,e.lb,n);break;case i.lineRight:s=F.calcFootOfPerpendicular(e.lt,e.rt,n);break;case i.lineBottom:s=F.calcFootOfPerpendicular(e.lt,e.lb,n);break;case i.lineLeft:s=F.calcFootOfPerpendicular(e.lt,e.rt,n)}return s}(s,t,c);d=n===a.line?function(e,t,n,i,s){var o=vt,r=null,a=null,l=null,c=null,u=null;switch(n){case o.lineTop:c=F.calcHypotenuseLength(i.x-t.lb.x,i.y-t.lb.y),a=t.lb.y-c-s.y-1;break;case o.lineRight:l=F.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y);break;case o.lineBottom:c=F.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y);break;case o.lineLeft:l=F.calcHypotenuseLength(i.x-t.rt.x,i.y-t.rt.y),r=t.rt.x-l-s.x-1}u={rotate:e.rotate},null!==l&&(u.width=l);null!==c&&(u.height=c);null!==r&&(u.x=r);null!==a&&(u.y=a);return u}(o,s,t,h,r):function(e,t,n,i,s){var o=vt,r=null,a=null,l=null,c=null,u=null;switch(n){case o.vertexLeftTop:l=F.calcHypotenuseLength(i.x-t.rb.x,i.y-t.rb.y),c=Math.round(l/(e.width/e.height)),r=t.rb.x-l-s.x-1,a=t.rb.y-c-s.y-1;break;case o.vertexLeftBottom:l=F.calcHypotenuseLength(i.x-t.rt.x,i.y-t.rt.y),c=Math.round(l/(e.width/e.height)),r=t.rt.x-l-s.x-1;break;case o.vertexRightTop:l=F.calcHypotenuseLength(i.x-t.lb.x,i.y-t.lb.y),c=Math.round(l/(e.width/e.height)),a=t.lb.y-c-s.y-1;break;case o.vertexRightBottom:l=F.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y),c=Math.round(l/(e.width/e.height))}u={width:l,height:c,rotate:e.rotate},null!==r&&(u.x=r);null!==a&&(u.y=a);return u}(o,s,t,h,r)}else d=n===a.line?function(e,t,n,i,s){var o=vt,r=null,a=null,l=null,c=null,u=null;switch(n){case o.lineTop:[0,180].includes(e.rotate)?(c=Math.abs(t.lb.y-(i.y-s.y)),a=t.lb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.lb.x-(i.x-s.x)),a=t.lb.y-c-1);break;case o.lineRight:[0,180].includes(e.rotate)?l=Math.abs(i.x-t.lb.x-s.x):[90,270].includes(e.rotate)&&(l=Math.abs(i.y-t.lb.y-s.y));break;case o.lineBottom:[0,180].includes(e.rotate)?c=Math.abs(i.y-s.y-t.lt.y):[90,270].includes(e.rotate)&&(c=Math.abs(t.lt.x-(i.x-s.x)));break;case o.lineLeft:[0,180].includes(e.rotate)&&(l=Math.abs(i.x-s.x-t.rt.x),r=t.rt.x-l-1),[90,270].includes(e.rotate)&&(l=Math.abs(t.rt.y-(i.y-s.y)),r=t.rt.x-l-1)}u={rotate:e.rotate},null!==l&&(u.width=l);null!==c&&(u.height=c);null!==r&&(u.x=r);null!==a&&(u.y=a);return u}(o,s,t,c,r):function(e,t,n,i,s){var o=vt,r=null,a=null,l=null,c=null,u=null;switch(n){case o.vertexLeftTop:[0,180].includes(e.rotate)?(l=Math.abs(t.rt.x-(i.x-s.x)),c=Math.round(l/(e.width/e.height)),r=t.rb.x-l-1,a=t.rb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.lb.x-(i.x-s.x)),l=Math.round(c*(e.width/e.height)),r=t.rb.x-l-1,a=t.rb.y-c-1);break;case o.vertexLeftBottom:[0,180].includes(e.rotate)?(l=Math.abs(t.rt.x-(i.x-s.x)),c=Math.round(l/(e.width/e.height)),r=t.rt.x-l-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.rt.x-(i.x-s.x)),l=Math.round(c*(e.width/e.height)),r=t.rt.x-l-1);break;case o.vertexRightTop:[0,180].includes(e.rotate)?(l=Math.abs(i.x-t.lb.x-s.x),c=Math.round(l/(e.width/e.height)),a=t.lb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(i.x-t.lb.x-s.x),l=Math.round(c*(e.width/e.height)),a=t.lb.y-c-1);break;case o.vertexRightBottom:[0,180].includes(e.rotate)&&(l=Math.abs(i.x-t.lb.x-s.x),c=Math.round(l/(e.width/e.height))),[90,270].includes(e.rotate)&&(c=Math.abs(t.rt.x-(i.x-s.x)),l=Math.round(c*(e.width/e.height)))}u={width:l,height:c,rotate:e.rotate},null!==r&&(u.x=r);null!==a&&(u.y=a);return u}(o,s,t,c,r);!function(e,t,n,i){var s=Vue.elementBoxEdit.scale;if(i===pt.line&&e[0].type===He.text){var o=Vue.elementBoxEdit.elementList[0].getResizeMinSize().width,r=o>n.width?o:n.width,a=Vue.elementBoxEdit.elementList[0].getResizeBoxHeight(r);n.width=r,n.height=a}n.elementWidth=n.width/s,n.elementHeight=n.height/s,Vue.elementBoxEdit.updateCss(n),wt(e,t,i,!1),Vue.elementBoxEdit.elementList.length>1&&Vue.elementsBoxs.setElementsGroupVisible(!1)}(l,o,d,n),u=!0};document.addEventListener("mousemove",d),document.addEventListener("mouseup",(function e(t){u&&(d(t),function(e,t,n,i){Vue.elementBoxEdit.reset(),wt(e,n,i,!0),function(e,t,n){var i=Vue.elementBoxEdit.scale,s=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),o=Vue.elementBoxEdit.$vm.$refs.boxEditMask.getBoundingClientRect(),r={x:o.x-s.x,y:o.y-s.y,width:o.width,height:o.height};if(Vue.elementBoxEdit.elementList.length>1){var a=Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList);1===a.length&&Vue.elements.getFirstGroupElementCount()===Vue.elementBoxEdit.elementList.length?(a[0].setPosition({x:r.x/i,y:r.y/i}),a[0].setSize({width:r.width/i,height:r.height/i})):a.length>0&&Vue.elements.getFirstGroupElementCount()!==Vue.elementBoxEdit.elementList.length&&a.forEach((function(n){var s=e.filter((function(e){return e.id===n.id}))[0];n.setPosition({x:(r.x+(s.x-t.x)/t.width*r.width)/i,y:(r.y+(s.y-t.y)/t.height*r.height)/i}),n.setSize({width:r.width*(s.width/t.width)/i,height:r.height*(s.height/t.height)/i})})),a.length>0&&Vue.elementsBoxs.setGroupElement(Vue.elementBoxEdit.elementList)}}(t,n)}(l,c,o,n)),Vue.elementBoxEdit.setResizebar(vt.noResize),u=!1,Vue.operatRecord.addRecord(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e)}))}))}function wt(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=Vue.elementBoxEdit.scale,o=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),r=Vue.elementBoxEdit.$vm.$refs.boxEditMask.getBoundingClientRect(),a={x:r.x-o.x,y:r.y-o.y,width:r.width,height:r.height};1===Vue.elementBoxEdit.elementList.length?(i&&(Vue.elementBoxEdit.elementList[0].setCssIsUpdate(!0),Vue.elementBoxEdit.elementList[0].setPropertyIsUpdate(!0)),Vue.elementBoxEdit.elementList[0].resizeUpdateCss({x:a.x/s,y:a.y/s,width:a.width/s,height:a.height/s},n,i)):(Vue.elementBoxEdit.elementList.forEach((function(o){i&&(o.setCssIsUpdate(!0),o.setPropertyIsUpdate(!0));var r=e.filter((function(e){return e.id===o.elementJson.id}))[0];o.resizeUpdateCss({x:(a.x+(r.x-t.x)/t.width*a.width)/s,y:(a.y+(r.y-t.y)/t.height*a.height)/s,width:a.width*(r.width/t.width)/s,height:a.height*(r.height/t.height)/s},n,i)})),Vue.elementBoxHover.show(Vue.elementBoxEdit.elementList))}function kt(){var e=this.$el;this.$refs.rotate.addEventListener("mousedown",(function(t){t.stopPropagation(),t.preventDefault();var n=e.getBoundingClientRect(),i=n.left,s=n.top,o={x:i+n.width/2,y:s+n.height/2},r=0,a=[],l=[];if(1===Vue.elementBoxEdit.elementList.length)r=Vue.elementBoxEdit.elementList[0].elementJson.css.rotate,Vue.elementBoxEdit.elementList[0].setCssIsUpdate(!1),Vue.elementBoxEdit.elementList[0].setPropertyIsUpdate(!1);else if(Vue.elementBoxEdit.elementList.length>1){r=Vue.elementBoxEdit.$vm.$data.dataJson.rotate;var c=Vue.elementBoxEdit.scale;Vue.elementBoxEdit.elementList.forEach((function(e){var t=e.elementJson,n={id:t.id,x:t.css.x*c,y:t.css.y*c,width:e.getBoxSize().width*c,height:e.getBoxSize().height*c,rotate:t.css.rotate};n.centerX=n.x+n.width/2,n.centerY=n.y+n.height/2,a.push(n),e.setCssIsUpdate(!1),e.setPropertyIsUpdate(!1)})),Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList).forEach((function(e){var t={id:e.id,x:e.style.x*c,y:e.style.y*c,width:e.style.width*c,height:e.style.height*c,rotate:e.style.rotate};t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,l.push(t)}))}Vue.elementBoxEdit.showRotate(r);var u=function(e){var t={x:e.pageX,y:e.pageY},n=function(e,t){var n=t.x-e.x,i=t.y-e.y,s=Math.abs(n/i),o=Math.atan(s)/(2*Math.PI)*360;n>0&&i<0||(n>=0&&i>0?o=180-o:n<0&&i>0?o=180+o:n<0&&i<0&&(o=360-o));return Math.floor(o)}(o,t);n=360===n?0:n,Vue.elementBoxEdit.showRotate(n),Vue.elementBoxEdit.setRotate(r,n,a,l),Vue.elementBoxEdit.elementList.length>1&&(Vue.elementsBoxs.setHoverElement(Vue.elementBoxEdit.elementList),Vue.elementsBoxs.setElementsGroupVisible(!1))};document.addEventListener("mousemove",u),document.addEventListener("mouseup",(function e(t){Vue.elementBoxEdit.hideRotate(),Vue.elementBoxEdit.elementList.forEach((function(e){e.setCssIsUpdate(!0),e.setPropertyIsUpdate(!0)})),Vue.elementBoxEdit.elementList.length>1&&Vue.elements.getFirstGroupElementCount()!==Vue.elementBoxEdit.elementList.length&&Vue.elementsBoxs.setGroupElement(Vue.elementBoxEdit.elementList),Vue.operatRecord.addRecord(),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",e)}))}))}var St=function(){function t(n){e(this,t);var i=Vue.extend(yt);this.$vm=new i({data:{dataJson:{controlSizeBarVisible:!0,controlRotateBarVisible:!0,visible:!1,x:0,y:0,width:0,height:0,elementX:0,elementY:0,elementWidth:0,elementHeight:0,transformOrigin:"center center",rotate:0,rotating:!1,rotateValueLeft:0,rotateValueTop:0,middleLineVisible:!1,moveing:!1,resizeType:0,resizeBar:vt.noResize,isGroup:!1,elementCount:0}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementList=null}return n(t,[{key:"updateCss",value:function(e){Object.assign(this.$vm.$data.dataJson,e)}},{key:"setScale",value:function(e){this.scale=e}},{key:"reset",value:function(){if(this.$vm.$refs.boxEditMask&&"center center"!==this.$vm.$data.dataJson.transformOrigin){var e=this.scale,t=this.$vm.$el.parentElement.parentElement.getBoundingClientRect(),n=this.$vm.$refs.boxEditMask.firstChild.getBoundingClientRect(),i=n.x-t.x,s=n.y-t.y;this.updateCss({transformOrigin:"center center",x:i+1,y:s+1,elementX:(i+1)/e,elementY:(s+1)/e,controlSizeBarVisible:!0,controlRotateBarVisible:!0})}}},{key:"remove",value:function(){var e=this;return new Promise((function(t,n){e.elementList=[],e.$vm.$data.dataJson.visible=!1,e.$vm.$nextTick((function(){t()}))}))}},{key:"getPosition",value:function(){return{x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y}}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t={x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y}),this.$vm.$data.dataJson.x=t.x+e.x,this.$vm.$data.dataJson.y=t.y+e.y,this.$vm.$data.dataJson.elementX=this.$vm.$data.dataJson.x/this.scale,this.$vm.$data.dataJson.elementY=this.$vm.$data.dataJson.y/this.scale}},{key:"show",value:function(e){if(this.elementList=e,0!==e.length){var t=0,n=0,i=0,s=0,o=0;if(this.elementList.length>1&&this.$vm.$data.dataJson.visible&&!this.$vm.$data.dataJson.isGroup&&Vue.elements.getSelected().length===this.elementList.length)t=this.$vm.$data.dataJson.elementX,n=this.$vm.$data.dataJson.elementY,i=t+this.$vm.$data.dataJson.elementWidth,s=n+this.$vm.$data.dataJson.elementHeight,o=this.$vm.$data.dataJson.rotate;else if(1===e.length){var r=e[0],a=r.elementJson.css,l=r.getBoxSize(),c=l.width,u=l.height;t=a.x,n=a.y,i=a.x+c,s=a.y+u,o=a.rotate}else if(e.length>1){var d=Vue.elements.searchGroup(e);if(d&&d.style){var h=d.style,m=h.x,v=h.y,p=h.width,g=h.height;t=m,n=v,i=m+p,s=v+g,o=d.style.rotate}else{var f={};e.forEach((function(e){null!==Vue.elements.getElementTopGroup(e)&&(f[e.elementJson.id]=!0)})),Vue.elements.getElementsGroup(e).forEach((function(e){var o=e.style,r=Et(o.x,o.y,o.width,o.height,o.rotate,t,n,i,s);t=r.minX,n=r.minY,i=r.maxX,s=r.maxY})),e.forEach((function(e){if(!f[e.elementJson.id]){var o=e.elementJson.css,r=o.x,a=o.y,l=o.rotate,c=e.getBoxSize(),u=Et(r,a,c.width,c.height,l,t,n,i,s);t=u.minX,n=u.minY,i=u.maxX,s=u.maxY}})),o=0}}this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.x=t*this.scale,this.$vm.$data.dataJson.y=n*this.scale,this.$vm.$data.dataJson.elementX=t,this.$vm.$data.dataJson.elementY=n,this.$vm.$data.dataJson.width=(i-t)*this.scale,this.$vm.$data.dataJson.height=(s-n)*this.scale,this.$vm.$data.dataJson.elementWidth=i-t,this.$vm.$data.dataJson.elementHeight=s-n,this.$vm.$data.dataJson.rotate=o,this.$vm.$data.dataJson.elementCount=e.length,this.$vm.$data.dataJson.resizeType=function(e){if(1===e.length)return e[0].elementResizeType;return 4}(e)}}},{key:"bind",value:function(){this.$vm.$nextTick((function(){xt.call(this),kt.call(this)}))}},{key:"setControlSizeBarVisible",value:function(e){this.$vm.$data.dataJson.controlSizeBarVisible=e}},{key:"setControlRotateBarVisible",value:function(e){this.$vm.$data.dataJson.controlRotateBarVisible=e}},{key:"showRotate",value:function(e){this.setControlSizeBarVisible(!1),this.setRotating(!0),this.$vm.$data.dataJson.rotate=e;var t=function(e){var t=0,n=0;if(0===e)t=-12,n=-35;else if(e>0&&e<90){var i=35*Math.sin(Math.PI/180*e),s=35*Math.cos(Math.PI/180*e);t=-12+i,n=-s}else if(90===e)t=23,n=-3;else if(e>90&&e<180){var o=35*Math.cos(Math.PI/180*(e-90)),r=35*Math.sin(Math.PI/180*(e-90));t=-12+o,n=r}else if(180===e)t=-12,n=35;else if(e>180&&e<270){var a=35*Math.sin(Math.PI/180*(e-180)),l=35*Math.cos(Math.PI/180*(e-180));t=-12-a,n=l}else if(270===e)t=-47,n=-3;else if(e>270&&e<360){var c=35*Math.cos(Math.PI/180*(e-270)),u=35*Math.sin(Math.PI/180*(e-270));t=-12-c,n-=u}return{left:t,top:n}}(e);this.$vm.$data.dataJson.rotateValueLeft=t.left,this.$vm.$data.dataJson.rotateValueTop=t.top}},{key:"hideRotate",value:function(){this.setControlSizeBarVisible(!0),this.setRotating(!1),this.setMiddleLineVisible(!1)}},{key:"setRotate",value:function(e,t,n,i){var s=this.scale;if(this.setMiddleLineVisible(t%45==0),this.elementList.length>1){var o=Vue.elements.getElementsGroup(this.elementList);if(1===o.length&&Vue.elements.getFirstGroupElementCount()===this.elementList.length)o[0].setRotate(t);else if(o.length>0&&Vue.elements.getFirstGroupElementCount()!==this.elementList.length){var r=this.getElementBoxEditInfo();o.forEach((function(n){var o=i.filter((function(e){return n.id===e.id}))[0],a=t-e,l=F.getPointPositionRotateWithCenterPoint({x:o.centerX,y:o.centerY},{x:r.centerX,y:r.centerY},a),c=(o.rotate+a)%360;c=360===c?0:c,n.setRotate(c),n.setPosition({x:l.x/s-o.width/s/2,y:l.y/s-o.height/s/2})}))}}if(1===this.elementList.length)this.elementList[0].updateCss({rotate:t});else{var a=this.getElementBoxEditInfo();this.elementList.forEach((function(i){var o=n.filter((function(e){return i.elementJson.id===e.id}))[0],r=t-e,l=F.getPointPositionRotateWithCenterPoint({x:o.centerX,y:o.centerY},{x:a.centerX,y:a.centerY},r),c=(o.rotate+r)%360;c=360===c?0:c,i.updateCss({x:l.x/s-o.width/s/2,y:l.y/s-o.height/s/2,rotate:c})}))}}},{key:"getElementBoxEditInfo",value:function(){var e={x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y,width:this.$vm.$data.dataJson.width,height:this.$vm.$data.dataJson.height};return e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,e}},{key:"setMiddleLineVisible",value:function(e){this.$vm.$data.dataJson.middleLineVisible=e}},{key:"calcPointInElementBoxEdit",value:function(e){return!!this.$vm.$data.dataJson.visible&&F.calcPointInRotateRect({x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y,width:this.$vm.$data.dataJson.width,height:this.$vm.$data.dataJson.height,rotate:this.$vm.$data.dataJson.rotate},e)}},{key:"getElementBoxEditVisible",value:function(){return this.$vm.$data.dataJson.visible}},{key:"setMoving",value:function(e){this.$vm.$data.dataJson.moving=e}},{key:"getMoving",value:function(){return this.$vm.$data.dataJson.moving}},{key:"setRotating",value:function(e){this.$vm.$data.dataJson.rotating=e}},{key:"getRotating",value:function(){return this.$vm.$data.dataJson.rotating}},{key:"setResizebar",value:function(e){this.$vm.$data.dataJson.resizeBar=parseInt(e)}},{key:"getResizebar",value:function(){return this.$vm.$data.dataJson.resizeBar}},{key:"getResizing",value:function(){return this.$vm.$data.dataJson.resizeBar!==vt.noResize}},{key:"setIsGroup",value:function(e){this.$vm.$data.dataJson.isGroup=e}},{key:"getDataJson",value:function(){return JSON.parse(JSON.stringify(this.$vm.$data.dataJson))}},{key:"setResizing",value:function(e){this.updateCss({transformOrigin:e.transformOrigin,x:e.x,y:e.y})}},{key:"getElementList",value:function(){return this.elementList}}]),t}();function Et(e,t,n,i,s,o,r,a,l){var c=s;if(s%90==0&&n===i||s%180==0)o=o>e||0===o?e:o,r=r>t||0===r?t:r,a=a<e+n?e+n:a,l=l<t+i?t+i:l;else if(90===s||270===s){if(n>i){var u=e+(n-i)/2;o=o>u||0===o?u:o;var d=t-(n-i)/2;r=r>d||0===r?d:r;var h=u+i;a=a<h?h:a;var m=d+n;l=l<m?m:l}else if(n<i){var v=e-(i-n)/2;o=o>v||0===o?v:o;var p=t+(i-n)/2;r=r>p||0===r?p:r;var g=v+i;a=a<g?g:a;var f=p+n;l=l<f?f:l}}else s>0&&s<90||(s>90&&s<180?c=180-s:s>180&&s<270?c=s-180:s>270&&s<360&&(c=360-s));if(s%90!=0){var y=Math.sin(Math.PI/180*c),x=Math.cos(Math.PI/180*c),b=n*x+i*y,w=i*x+n*y,k=e+n/2,S=t+i/2,E=k-b/2,C=S-w/2,B=k+b/2,$=S+w/2;o=o>E||0===o?E:o,r=r>C||0===r?C:r,a=a<B?B:a,l=l<$?$:l}return{minX:o,minY:r,maxX:a,maxY:l}}const Ct={methods:{getStyle:function(e){return{width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.x-1,"px"),top:"".concat(e.y-1,"px"),transform:"rotate(".concat(e.rotate,"deg)")}}}};var Bt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{staticClass:"eqx-box-hovers"},[e._l(e.dataJson.list,(function(t,i){return[n("div",{key:i,staticClass:"eqx-box-hover",style:e.getStyle(t)})]}))],2):e._e()};Bt._withStripped=!0;const $t=H({render:Bt,staticRenderFns:[]},void 0,Ct,void 0,!1,void 0,!1,void 0,void 0,void 0);var _t=function(){function t(n){e(this,t);var i=Vue.extend($t);this.$vm=new i({data:{dataJson:{visible:!1,list:[]}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementList=[]}return n(t,[{key:"setScale",value:function(e){this.scale=e}},{key:"removeAll",value:function(){this.elementList=[],this.$vm.$data.dataJson.visible=!1,this.$vm.$data.dataJson.list=[]}},{key:"show",value:function(e){var t=this;0!==e.length&&(this.elementList=e,this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.list=[],e.forEach((function(e,n){var i=e.getBoxSize(),s=i.width,o=i.height;t.$vm.$data.dataJson.list.push({x:e.elementJson.css.x*t.scale,y:e.elementJson.css.y*t.scale,width:s*t.scale,height:o*t.scale,rotate:e.elementJson.css.rotate})})))}},{key:"add",value:function(e){var t=e.getBoxSize(),n=t.width,i=t.height;this.elementList.push(e),this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.list.push({x:e.elementJson.css.x*this.scale,y:e.elementJson.css.y*this.scale,width:n*this.scale,height:i*this.scale,rotate:e.elementJson.css.rotate})}},{key:"remove",value:function(e){for(var t=0;t<this.elementList.length;t++)if(this.elementList[t].elementJson.id===e.elementJson.id){this.elementList.splice(t,1);break}this.elementList.length>0?this.show(this.elementList):this.removeAll()}}]),t}();const Rt={methods:{getStyle:function(e){return{width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.x-1,"px"),top:"".concat(e.y-1,"px"),transform:"rotate(".concat(e.rotate,"deg)")}}}};var Vt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{staticClass:"eqx-box-groups"},[e._l(e.dataJson.list,(function(t,i){return[n("div",{key:i,staticClass:"eqx-box-group",style:e.getStyle(t)})]}))],2):e._e()};Vt._withStripped=!0;const Jt=H({render:Vt,staticRenderFns:[]},void 0,Rt,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ft=function(){function t(){e(this,t);var n=Vue.extend(Jt);this.$vm=new n({data:{dataJson:{visible:!1,list:[]}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.groupList=[]}return n(t,[{key:"setScale",value:function(e){this.scale=e}},{key:"removeAll",value:function(){this.groupList=[],this.$vm.$data.dataJson.visible=!1,this.$vm.$data.dataJson.list=[]}},{key:"getList",value:function(){return this.groupList}},{key:"show",value:function(e){var t=this;this.groupList=[],this.$vm.$data.dataJson.list=[],Vue.elements.getElementsGroup(e).forEach((function(e){var n={id:e.id,style:e.style};t.groupList.push(n);var i=n.style,s=i.x,o=i.y,r=i.width,a=i.height,l=i.rotate;t.$vm.$data.dataJson.list.push({id:n.id,x:s*t.scale,y:o*t.scale,width:r*t.scale,height:a*t.scale,rotate:l})})),this.setVisble(0!==this.groupList.length)}},{key:"setVisble",value:function(e){this.$vm.$data.dataJson.visible=e}}]),t}(),Lt=function(){function t(n){e(this,t);var i=Vue.extend(ct);this.$vm=new i({data:{scale:1,hoverBox:{visible:!1,list:[]}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementBoxEdit=new St,this.$el.appendChild(this.elementBoxEdit.$el),this.elementBoxHover=new _t,this.$el.appendChild(this.elementBoxHover.$el),this.elementBoxGroup=new Ft,this.$el.appendChild(this.elementBoxGroup.$el),n.isRender||(Vue.elementBoxEdit=Vue.prototype.elementBoxEdit=this.elementBoxEdit,Vue.elementBoxHover=Vue.prototype.elementBoxHover=this.elementBoxHover,Vue.elementBoxGroup=Vue.prototype.elementBoxGroup=this.elementBoxGroup)}return n(t,[{key:"setScale",value:function(e,t){this.scale=e,this.elementBoxEdit.setScale(e),this.setSelectedElement(t),this.elementBoxGroup.setScale(e),Vue.elements.getFirstGroupElementCount()!==t.length&&this.setGroupElement(t),this.elementBoxHover.setScale(e),t.length>1&&this.setHoverElement(t)}},{key:"resetBoxEdit",value:function(){this.elementBoxEdit.reset()}},{key:"clearSelected",value:function(){return this.elementBoxEdit.remove()}},{key:"setSelectedElement",value:function(e){this.elementBoxEdit.show(e)}},{key:"setElementBoxEditIsGroup",value:function(e){this.elementBoxEdit.setIsGroup(e)}},{key:"setSelectedElementBoxEditBind",value:function(){this.elementBoxEdit.bind()}},{key:"setSelectedElementControlBarVisible",value:function(e){this.elementBoxEdit.setControlSizeBarVisible(e),this.elementBoxEdit.setControlRotateBarVisible(e)}},{key:"moveSelectedElementBoxEdit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.elementBoxEdit.move(e,t)}},{key:"getSelectedElementBoxEditPosition",value:function(){return this.elementBoxEdit.getPosition()}},{key:"clearGroupElement",value:function(){this.elementBoxGroup.removeAll()}},{key:"setGroupElement",value:function(e){this.elementBoxGroup.show(e)}},{key:"getGroupElement",value:function(){return this.elementBoxGroup.getList()}},{key:"setElementsGroupVisible",value:function(e){return this.elementBoxGroup.setVisble(e)}},{key:"clearHoverElement",value:function(){this.elementBoxHover.removeAll()}},{key:"setHoverElement",value:function(e){this.elementBoxHover.show(e)}},{key:"addHoverElement",value:function(e){this.elementBoxHover.add(e)}},{key:"delHoverElement",value:function(e){this.elementBoxHover.remove(e)}},{key:"moveHoverElement",value:function(e){this.elementBoxHover.move(e)}},{key:"calcPointInElementBoxEdit",value:function(e){var t=this.$el.getBoundingClientRect(),n={x:e.x-t.x,y:e.y-t.y};return this.elementBoxEdit.calcPointInElementBoxEdit(n)}},{key:"getElementBoxEditVisible",value:function(){return this.elementBoxEdit.getElementBoxEditVisible()}},{key:"setElementBoxEditMoving",value:function(e){return this.elementBoxEdit.setMoving(e)}},{key:"getElementBoxEditMoving",value:function(){return this.elementBoxEdit.getMoving()}},{key:"setElementBoxEditRotating",value:function(e){return this.elementBoxEdit.setRotating(e)}},{key:"getElementBoxEditRotating",value:function(){return this.elementBoxEdit.getRotating()}},{key:"getElementBoxEditResizing",value:function(){return this.elementBoxEdit.getResizing()}}]),t}();const Ht={computed:{style:function(){return{marginTop:this.dataJson.offsetX+"px",marginLeft:this.dataJson.offsetY+"px"}}}};var zt=function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"drawingBoard",staticClass:"eqx-drawing-board",style:this.style})};zt._withStripped=!0;const Pt=H({render:zt,staticRenderFns:[]},void 0,Ht,void 0,!1,void 0,!1,void 0,void 0,void 0);var Mt=function(t){s(o,t);var i=c(o);function o(t){var n;e(this,o),(n=i.call(this)).dataJson={offsetX:0,offsetY:0};var s=a(n),r=Vue.extend(Pt);return n.$vm=new r({data:function(){return{dataJson:s.dataJson}}}).$mount(),n.$el=n.$vm.$el,n.size=t.size,n.scale=t.scale||"auto",n.editorSize=t.editorSize,n.background=new Ke,n.$el.appendChild(n.background.$el),n.rangeMask=new et,n.$el.appendChild(n.rangeMask.$el),n.elements=new rt({size:n.size,scale:1}),n.$el.appendChild(n.elements.$el),t.isRender?n.setScale("1"):(n.elementsBoxs=new Lt({isRender:t.isRender}),n.$el.appendChild(n.elementsBoxs.$el),Vue.elements=Vue.prototype.elements=n.elements,Vue.elementsBoxs=Vue.prototype.elementsBoxs=n.elementsBoxs,n.setScale(n.scale)),n}return n(o,[{key:"setScale",value:function(e){var t=this;return new Promise((function(n,i){var s,o=t.editorSize.width/t.editorSize.height,r=t.size.width/t.size.height;"auto"===e?(o>r?s=(t.editorSize.height-100)*r:s=t.editorSize.width-100,t.scale=s/t.size.width):"1"===e?t.scale=1:"+"===e?t.scale*=1.2:"-"===e&&(t.scale*=.8);var a=t.size.width*t.scale,l=t.size.height*t.scale;It.call(t,a,l),t.elements.setScale(t.scale),t.elementsBoxs&&t.elementsBoxs.setScale(t.scale,t.elements.getSelected()),n(t.scale)}))}},{key:"addElement",value:function(e,t){this.elements.add(e),t||Vue.operatRecord.addRecord()}},{key:"delSelectedElements",value:function(){this.elements.delSelected(),this.elementsBoxs&&this.elementsBoxs.clearSelected(),this.elementsBoxs&&this.elementsBoxs.clearHoverElement(),Vue.operatRecord.addRecord()}},{key:"moveSelectedElements",value:function(e){}},{key:"selectAllElement",value:function(){this.elements.selectAll();var e=this.elements.getAll();this.elementsBoxs&&this.elementsBoxs.setSelectedElement(e),this.elementsBoxs&&this.elementsBoxs.setHoverElement(e)}},{key:"clearElements",value:function(){this.elements.delAll(),this.elementsBoxs&&this.elementsBoxs.clearSelected(),this.elementsBoxs&&this.elementsBoxs.clearGroupElement(),this.elementsBoxs&&this.elementsBoxs.clearHoverElement()}},{key:"setBackground",value:function(e){this.background.setBackground(e)}},{key:"setMove",value:function(e,t){this.dataJson.offsetX=e,this.dataJson.offsetY=t}}]),o}(Ye);function It(e,t){this.$el.css({width:"".concat(e,"px"),height:"".concat(t,"px")})}const Tt={computed:{selectBoxStyle:function(){return this.selectBoxJson.visible?{left:"".concat(this.selectBoxJson.left,"px"),top:"".concat(this.selectBoxJson.top,"px"),width:"".concat(this.selectBoxJson.width,"px"),height:"".concat(this.selectBoxJson.height,"px"),border:"1px solid #1593ff"}:{}}}};var Ot=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"eqx-select-box",style:this.selectBoxStyle})};Ot._withStripped=!0;const At=H({render:Ot,staticRenderFns:[]},void 0,Tt,void 0,!1,void 0,!1,void 0,void 0,void 0);var Gt=function(t){s(o,t);var i=c(o);function o(t){var n;e(this,o),n=i.call(this);var s=Vue.extend(At);return n.$vm=new s({data:{selectBoxJson:{visible:!1}}}).$mount(),n.$el=n.$vm.$el,n}return n(o,[{key:"updateStyle",value:function(e){this.$vm.$data.selectBoxJson=e}},{key:"clearStyle",value:function(){this.$el.removeAttr("style"),this.$vm.$data.selectBoxJson.visible=!1}}]),o}(Ye);const Dt={computed:{ratioPage:function(){return this.maxSizeCover/Math.max(this.drawingBoard.size.width,this.drawingBoard.size.height)},eagleEye:function(){return Vue.store.state.scene.editorConfig.eagleEye}}};var qt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.eagleEye?n("div",{staticClass:"eqx-overview-map",class:{active:e.showPreview}},[n("div",{ref:"cover",staticClass:"cover",style:{width:e.drawingBoard.size.width*e.ratioPage+"px",height:e.drawingBoard.size.height*e.ratioPage+"px"}}),e._v(" "),n("div",{staticClass:"container"},[n("div",{ref:"box",staticClass:"box",on:{mousedown:e.drag}})])]):e._e()};qt._withStripped=!0;const Nt=H({render:qt,staticRenderFns:[]},void 0,Dt,void 0,!1,void 0,!1,void 0,void 0,void 0);var Yt=function(t){s(i,t);var n=c(i);function i(t){var s;e(this,i),s=n.call(this);var o=Vue.extend(Nt);return s.$vm=new o({data:function(){return{maxSizeCover:150,maxSizeMask:190,showPreview:!1,drawingBoard:Vue.drawingBoard,firstScale:Vue.drawingBoard.scale}},watch:{"drawingBoard.scale":function(){this.setBoxRect()},"drawingBoard.dataJson.offsetX":function(){this.setBoxRect()},"drawingBoard.dataJson.offsetY":function(){this.setBoxRect()}},methods:{setBoxRect:function(){var e=this.drawingBoard.scale,t=this.drawingBoard.dataJson,n=t.offsetX,i=t.offsetY,s=this.drawingBoard.size,o=s.width,r=s.height;this.$refs.box.css({width:o*this.ratioPage/e+"px",height:r*this.ratioPage/e+"px",transform:"translate(".concat(-n*this.ratioPage/e,"px, ").concat(-i*this.ratioPage/e,"px)")}),e<=this.firstScale?(this.showPreview=!1,this.drawingBoard.setMove(0,0),this.$refs.box.css({transform:""})):this.showPreview=!0},drag:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.drawingBoard.scale,i=this.drawingBoard.dataJson,s=i.offsetX,o=i.offsetY,r=this.drawingBoard.size,a=r.width,l=r.height,c=e.pageX,u=e.pageY,d=300*l/600,h=300*a/600;this.$refs.box.css({cursor:"-webkit-grabbing"});var m=function(e){var i=s-(e.pageX-c)*n/t.ratioPage,r=o-(e.pageY-u)*n/t.ratioPage;r>d*n&&(r=d*n),r<-d*n&&(r=-d*n),i>h*n&&(i=h*n),i<-h*n&&(i=-h*n),t.drawingBoard.setMove(i,r)};document.addEventListener("mousemove",m),document.addEventListener("mouseup",(function e(n){document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",e),t.$refs.box.css({cursor:""})}))}}}).$mount(),s.$el=s.$vm.$el,s}return i}(Ye);const Wt={computed:{isMac:function(){return g.isMac},disableBack:function(){return Vue.store.state.scene.disableBack},disableForward:function(){return Vue.store.state.scene.disableForward},editorConfig:function(){return Vue.store.state.scene.editorConfig}}};var jt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.editorConfig.toolBar?n("div",{staticClass:"eqx-tool-bar",on:{mousedown:function(e){e.stopPropagation()}}},[n("div",{staticClass:"info"},[e.showSceneLabel?e._e():n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.dataJson.drawingBoardWidth,expression:"dataJson.drawingBoardWidth",modifiers:{number:!0}}],staticClass:"size",attrs:{readonly:"readonly",type:"number"},domProps:{value:e.dataJson.drawingBoardWidth},on:{input:function(t){t.target.composing||e.$set(e.dataJson,"drawingBoardWidth",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),e.showSceneLabel?e._e():n("i",{staticClass:"link eqf-no"}),e._v(" "),e.showSceneLabel?e._e():n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.dataJson.drawingBoardHeight,expression:"dataJson.drawingBoardHeight",modifiers:{number:!0}}],staticClass:"size",attrs:{readonly:"readonly",type:"number"},domProps:{value:e.dataJson.drawingBoardHeight},on:{input:function(t){t.target.composing||e.$set(e.dataJson,"drawingBoardHeight",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),e.showSceneLabel?e._e():n("span",{staticClass:"unit"},[e._v("像素")])]),e._v(" "),n("div",{staticClass:"title"},[e._v("\n        "+e._s(e.editorConfig.name)+"\n    ")]),e._v(" "),n("div",{staticClass:"scale"},[n("span",{staticClass:"item hint--top hint--rounded",class:{disable:e.disableBack},attrs:{"data-hint":e.isMac?"撤销 ⌘Z":"撤销 Ctrl Z"},on:{click:e.back}},[n("i",{staticClass:"icon eqf-back"})]),e._v(" "),n("span",{staticClass:"item hint--top hint--rounded",class:{disable:e.disableForward},attrs:{"data-hint":e.isMac?"恢复 ⌘Y":"恢复 Ctrl Y"},on:{click:e.forward}},[n("i",{staticClass:"icon eqf-rework"})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":e.isMac?"缩小 ⌘-":"缩小 Ctrl -"}},[n("span",{staticClass:"icon eqf-zoom-in plus",on:{click:function(t){return e.setScale("-")}}})]),e._v(" "),n("span",{staticClass:"icon num"},[e._v(e._s(e.dataJson.scale))]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":e.isMac?"放大 ⌘+":"放大 Ctrl +"}},[n("span",{staticClass:"icon eqf-zoom-out plus",on:{click:function(t){return e.setScale("+")}}})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":"适合画布"}},[n("span",{staticClass:"icon eqf-bigger fit",on:{click:function(t){return e.setScale("auto")}}})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":"真实尺寸"}},[n("span",{staticClass:"icon real border",on:{click:function(t){return e.setScale("1")}}},[e._v("1:1\n            ")])])])]):e._e()};jt._withStripped=!0;const Ut=H({render:jt,staticRenderFns:[]},void 0,Wt,void 0,!1,void 0,!1,void 0,void 0,void 0);function Kt(e){var t=e.scale,n=e.getSelected(),i=[];n.forEach((function(e){i.push({id:e.elementJson.id,x:e.elementJson.css.x,y:e.elementJson.css.y})}));var s,o,r=event.pageX,a=event.pageY,l=Vue.elementsBoxs.getSelectedElementBoxEditPosition(),c=!1,u=function(e){s=e.pageX-r,o=e.pageY-a,n.forEach((function(e){var n=i.filter((function(t){return t.id===e.elementJson.id}))[0];e.move({x:s/t,y:o/t},{x:n.x,y:n.y}),e.setCssIsUpdate(!1),e.setPropertyIsUpdate(!1)})),c||(l=Vue.elementsBoxs.getSelectedElementBoxEditPosition()),Vue.elementsBoxs.moveSelectedElementBoxEdit({x:s,y:o},l),Vue.elementsBoxs.setElementBoxEditMoving(!0),Vue.elementsBoxs.setSelectedElementControlBarVisible(!1),n.length>1&&(Vue.elementsBoxs.setHoverElement(n),Vue.elementsBoxs.setElementsGroupVisible(!1)),c=!0};document.addEventListener("mousemove",u),document.addEventListener("mouseup",(function e(i){if(Vue.elementsBoxs.setElementBoxEditMoving(!1),Vue.elementsBoxs.setSelectedElementControlBarVisible(!0),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",e),c){if(n.length>1&&c){var r=Vue.elements.getElementsGroup(n);r.length>0&&(Vue.elements.moveSelectedElementGroups(r,{x:s/t,y:o/t}),Vue.elements.getFirstGroupElementCount()!==n.length?(Vue.elementsBoxs.setGroupElement(n),Vue.elementsBoxs.setElementsGroupVisible(!0)):Vue.elementsBoxs.setElementsGroupVisible(!1))}n.forEach((function(e){e.setCssIsUpdate(!0),e.setPropertyIsUpdate(!0)})),Vue.operatRecord.addRecord(),c=!1}}))}function Xt(e,t,n,i,s){var o=this;return new Promise((function(r,a){if(o.selectBox.clearStyle(),e&&t.length>0){1===t.length&&Vue.elementsBoxs.clearHoverElement(),Vue.elements.setSelected(t),Vue.elementsBoxs.setSelectedElement(t);var l=t.length>1&&Vue.elements.searchGroupIndex(t)>=0;Vue.elementsBoxs.setElementBoxEditIsGroup(l),Vue.elementsBoxs.setSelectedElementBoxEditBind();var c=Vue.elementsBoxs.getGroupElement();(0===c.length||1===c.length&&Vue.elements.getFirstGroupElementCount()===Vue.elements.getSelected().length)&&Vue.elementsBoxs.clearGroupElement()}document.removeEventListener("selectstart",n),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s),r()}))}function Zt(e,t){var n=this;return new Promise((function(i,s){t.focus(),Vue.elementsBoxs.resetBoxEdit(),Vue.elementsBoxs.$vm.$nextTick((function(){if(Vue.elementsBoxs.getElementBoxEditVisible()&&Vue.elementsBoxs.calcPointInElementBoxEdit({x:e.pageX,y:e.pageY}))return void Kt(Vue.elements);new Promise((function(e,t){var n=Vue.elements.getSelected(),i=Vue.elementBoxEdit.getElementList();if(n.length>1&&1===i.length&&i[0].elementJson.type===He.text&&null!==Vue.elements.getElementTopGroup(i[0])&&Object.prototype.hasOwnProperty.call(i[0],"initHeight")){var s=i[0].getBoxSize().height,o=i[0].initHeight;s&&o&&s!==o?Vue.elements.updateElementGroup(i[0]).then((function(){e()})):e()}else e()})).then((function(){Vue.elements.openSettingListener(),Vue.elements.clearSelected(),Vue.elementsBoxs.clearSelected(),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement();var s={x0:e.pageX,y0:e.pageY},o=t.getBoundingClientRect(),r=o.left,a=o.top,l=function(e){return e.preventDefault()},c=[],u=!1;Vue.store.commit("ELEMENT_SELECT",{eqxElements:[]}),Vue.store.commit("FONT_LAYER",{show:!1});var d=function(e){u=!0,s.x1=e.pageX,s.y1=e.pageY;var t=function(e,t,n){var i={left:e.x0-t,top:e.y0-n};i.width=e.x1-e.x0,i.height=e.y1-e.y0,e.x1<e.x0&&(i.left=e.x1-t,i.width=-i.width);e.y1<e.y0&&(i.top=e.y1-n,i.height=-i.height);return i}(s,r,a);n.selectBox.updateStyle({visible:!0,left:t.left,top:t.top,width:t.width,height:t.height});var i=Qt.call(n);if(c=function(e,t){var n=[];return e.filter((function(e){F.rectIsOverlap({x:e.x,y:e.y,width:e.width,height:e.height,x1:e.x1,y1:e.y1,width1:e.width1,height1:e.height1,rotate:e.rotate},{x:t.left,y:t.top,width:t.width,height:t.height,rotate:0})?(e.element.setSelected(!0),n.push(e.element)):e.element.setSelected(!1)})),n}(i,t),Vue.elementsBoxs.clearGroupElement(),c.length>0){var o=[];c.forEach((function(e){var t=Vue.elements.getAllElementByElementInGroup(e);o=o.concat(t)}));var l=[],d={};o.forEach((function(e){d[e.elementJson.id]||(l.push(e),d[e.elementJson.id]=!0)})),c=l,Vue.elementsBoxs.setHoverElement(c),Vue.elementsBoxs.setGroupElement(c)}else Vue.elementsBoxs.clearHoverElement()},h=function e(t){Xt.call(n,u,c,l,d,e)};document.addEventListener("selectstart",l),document.addEventListener("mousemove",d),document.addEventListener("mouseup",h),i([u,c,l,d,h])}))}))}))}function Qt(){var e=this.$el.getBoundingClientRect().left,t=this.$el.getBoundingClientRect().top,n=Vue.drawingBoard.$el.getBoundingClientRect().left,i=Vue.drawingBoard.$el.getBoundingClientRect().top;return Vue.elements.elementList.map((function(s){var o=s.$el.getBoundingClientRect();return{element:s,x:s.elementJson.css.x*Vue.elements.scale+n-e,y:s.elementJson.css.y*Vue.elements.scale+i-t,width:s.getBoxSize().width*Vue.elements.scale,height:s.getBoxSize().height*Vue.elements.scale,rotate:s.elementJson.css.rotate,x1:o.x-e,y1:o.y-t,width1:o.width,height1:o.height}}))}var en=function(t){s(o,t);var i=c(o);function o(t){var n;e(this,o),n=i.call(this,t);var s=Vue.extend(Ut),r=a(n);return n.$vm=new s({data:{dataJson:{drawingBoardWidth:Vue.drawingBoard.size.width,drawingBoardHeight:Vue.drawingBoard.size.height,scale:"".concat(parseFloat(100*Vue.drawingBoard.scale).toFixed(0),"%"),title:t.name}},methods:{setScale:function(e){r.setDrawingBoardScale(e)},back:function(){!this.disableBack&&Vue.store.commit("HISTORY_BACK")},forward:function(){!this.disableForward&&Vue.store.commit("HISTORY_FORWORD")}}}).$mount(),n.$el=n.$vm.$el,n.editor=t.editor,n}return n(o,[{key:"setDrawingBoardScale",value:function(e){var t=this;Zt.call(this.editor,event,this.editor.$el).then((function(n){var i=d(n,5),s=i[0],o=i[1],r=i[2],a=i[3],l=i[4];Xt.call(t.editor,s,o,r,a,l).then((function(n){Vue.drawingBoard.setScale(e).then((function(e){t.$vm.$data.dataJson.scale="".concat((100*e).toFixed(0),"%")}))}))}))}}]),o}(Ye);const tn={props:{model:{type:Object,default:null},modelKey:{type:String,default:null}},data:function(){return{selected:[],showPanel:!1}},computed:{showRadius:function(){var e=this.selected.includes("lt")?"8px":"0px",t=this.selected.includes("rt")?"8px":"0px",n=this.selected.includes("lb")?"8px":"0px",i=this.selected.includes("rb")?"8px":"0px";return"".concat(e," ").concat(t," ").concat(i," ").concat(n)}},watch:{model:function(e){if(e.lt)-1===this.selected.indexOf("lt")&&this.selected.push("lt");else{var t=this.selected.indexOf("lt");t>-1&&this.selected.splice(t,1)}if(e.rt)-1===this.selected.indexOf("rt")&&this.selected.push("rt");else{var n=this.selected.indexOf("rt");n>-1&&this.selected.splice(n,1)}if(e.lb)-1===this.selected.indexOf("lb")&&this.selected.push("lb");else{var i=this.selected.indexOf("lb");i>-1&&this.selected.splice(i,1)}if(e.rb)-1===this.selected.indexOf("rb")&&this.selected.push("rb");else{var s=this.selected.indexOf("rb");s>-1&&this.selected.splice(s,1)}}},mounted:function(){this.model.lt&&this.selected.push("lt"),this.model.rt&&this.selected.push("rt"),this.model.lb&&this.selected.push("lb"),this.model.rb&&this.selected.push("rb")},methods:{setRadius:function(e,t){t.stopPropagation();var n=this.selected.indexOf(e);-1===n?(this.selected.push(e),this.model[e]=!0):(this.selected.splice(n,1),this.model[e]=!1)},showSelectPanel:function(e){e.stopPropagation(),this.showPanel=!this.showPanel},hideSelectPanel:function(){this.showPanel=!1}}};var nn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-border-radius"},[n("base-input",{attrs:{model:e.model,min:0,max:500,"model-key":e.modelKey}}),e._v(" "),n("div",{staticClass:"current",on:{click:function(t){return e.showSelectPanel(t)}}},[n("div",{staticClass:"current-icon",style:{borderRadius:e.showRadius.replace(/8/g,"6")}}),e._v(" "),n("i",{staticClass:"icon eqf-menu-down",class:{roate:e.showPanel}})]),e._v(" "),e.showPanel?n("div",{staticClass:"select-panel"},[n("div",{staticClass:"inner",style:{borderRadius:e.showRadius}}),e._v(" "),n("div",{staticClass:"left-top",class:{selected:e.selected.includes("lt")},on:{click:function(t){return e.setRadius("lt",t)}}}),e._v(" "),n("div",{staticClass:"right-top",class:{selected:e.selected.includes("rt")},on:{click:function(t){return e.setRadius("rt",t)}}}),e._v(" "),n("div",{staticClass:"left-bottom",class:{selected:e.selected.includes("lb")},on:{click:function(t){return e.setRadius("lb",t)}}}),e._v(" "),n("div",{staticClass:"right-bottom",class:{selected:e.selected.includes("rb")},on:{click:function(t){return e.setRadius("rb",t)}}})]):e._e()],1)};nn._withStripped=!0;const sn={components:{SettingBorderRadius:H({render:nn,staticRenderFns:[]},void 0,tn,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:255}},computed:{imageOpenHeight:function(){return 255},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.imageOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.imageOpenHeight?this.normalCloseHeight:this.imageOpenHeight,this.$emit("heightChange",this.height)},rotateComp:function(e){var t=this.property;"x"===e?t.rotateY=180===t.rotateY?0:180:"y"===e&&(t.rotateX=180===t.rotateX?0:180)}}};var on=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-image",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("图片")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            圆角\n        ")]),e._v(" "),e.property&&e.property.borderRadius?n("setting-border-radius",{ref:"imgRadiusPanel",attrs:{model:e.property.borderRadius,"model-key":"val"}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            翻转\n        ")]),e._v(" "),n("ul",{staticClass:"rotate"},[n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("x")}}},[n("i",{staticClass:"eqf-flipshuiping"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("水平")])]),e._v(" "),n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("y")}}},[n("i",{staticClass:"eqf-flipchuizhi"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("垂直")])])])],1)])};on._withStripped=!0;const rn=H({render:on,staticRenderFns:[]},void 0,sn,void 0,!1,void 0,!1,void 0,void 0,void 0);const an={props:{model:{type:Object,default:null},modelKey:{type:String,default:null},state:{type:Number,default:1}},computed:{value:function(){return this.model[this.modelKey]}},watch:{model:function(e){}},mounted:function(){},methods:{setAlign:function(e){this.model[this.modelKey]=e,Vue.operatRecord.addRecord()}}};var ln=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"eqc-setting-text-align"},[n("li",{staticClass:"icon fl eqf-align-left",class:{active:!e.isMuti&&("left"===e.value||"flex-start"===e.value),rotateLeft:e.updownState},on:{click:function(t){return e.setAlign("left")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-center",class:{active:!e.isMuti&&"center"===e.value,rotateCenter:e.updownState},on:{click:function(t){return e.setAlign("center")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-right",class:{active:!e.isMuti&&("right"===e.value||"flex-end"===e.value),rotateRight:e.updownState},on:{click:function(t){return e.setAlign("right")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-justify",class:{active:!e.isMuti&&"justify"===e.value,rotateJustify:e.updownState},on:{click:function(t){return e.setAlign("justify")}}})])};ln._withStripped=!0;const cn=H({render:ln,staticRenderFns:[]},void 0,an,void 0,!1,void 0,!1,void 0,void 0,void 0);const un={props:{model:{type:Object,default:null},textType:{type:Number,default:0}},data:function(){return{}},computed:{},watch:{},methods:{setFontWeight:function(){this.model.fontWeight=this.model.fontWeight?"":"bold",Vue.operatRecord.addRecord()},setFontStyle:function(){this.model.fontStyle=this.model.fontStyle?"":"italic",Vue.operatRecord.addRecord()},setTextDecoration:function(e){"underline"===e?(this.isLineThrough=!1,this.isUnderline=!this.isUnderline,this.model.textDecoration=this.isUnderline?"underline":""):"line-through"===e&&(this.isUnderline=!1,this.isLineThrough=!this.isLineThrough,this.model.textDecoration=this.isLineThrough?"line-through":""),Vue.operatRecord.addRecord()}}};var dn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"eqc-setting-text-style"},[n("li",{staticClass:"icon fl eqf-b",class:{active:"bold"===e.model.fontWeight},on:{click:function(t){return e.setFontWeight()}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-i",class:{active:"italic"===e.model.fontStyle},on:{click:function(t){return e.setFontStyle()}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-u",class:{active:"underline"===e.model.textDecoration},on:{click:function(t){return e.setTextDecoration("underline")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-s",class:{active:"line-through"===e.model.textDecoration},on:{click:function(t){return e.setTextDecoration("line-through")}}})])};dn._withStripped=!0;const hn={components:{SettingTextAlign:cn,SettingTextStyle:H({render:dn,staticRenderFns:[]},void 0,un,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:321}},computed:{textOpenHeight:function(){return 471},normalCloseHeight:function(){return 40},font:function(){return Vue.store.state.font}},mounted:function(){this.isOpen?this.height=this.textOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.textOpenHeight?this.normalCloseHeight:this.textOpenHeight,this.$emit("heightChange",this.height)},chooseFont:function(){Vue.store.commit("FONT_LAYER",{show:!this.font.layer.show})}}};var mn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-text",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("文字")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            字体\n        ")]),e._v(" "),n("div",{staticClass:"font-style-btn",on:{click:function(t){return e.chooseFont()}}},[n("span",[e._v(e._s(e.property.fontFamilyName?e.property.fontFamilyName:"默认字体"))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-right"})]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            文字颜色字号\n        ")]),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("setting-color",{attrs:{model:e.css,"model-key":"color"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"fontSize"}})],1)]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            背景颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.css,"model-key":"backgroundColor"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            内边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"padding"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[e._m(1),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:100,max:200,"model-key":"lineHeight",unit:"","unit-view":"%"}})],1)]),e._v(" "),n("div",{staticClass:"right"},[e._m(2),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"letterSpacing"}})],1)])]),e._v(" "),n("setting-text-align",{attrs:{model:e.css,"model-key":"textAlign"}}),e._v(" "),n("setting-text-style",{attrs:{model:e.css}})],1)])};mn._withStripped=!0;const vn=H({render:mn,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"content"},[t("div",{staticClass:"name left"},[this._v("\n                行间距\n            ")]),this._v(" "),t("div",{staticClass:"name right"},[this._v("\n                字间距\n            ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-linehigh"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-lineshort"})])}]},void 0,hn,void 0,!1,void 0,!1,void 0,void 0,void 0);const pn={props:{tab:{type:String,default:"bottom"},property:{type:Object,default:function(){return{}}}},data:function(){return{customColor:{color:""},hotColors:["#FFFFFF","#FF1900","#F47365","#FFB243","#FFE623","#6EFF2A","#5FE793","#1BC7B1","#00BEFF","#2E81FF","#8D91FF","#5D61FF","#FF89CF","#FC3CAD","#BF3DCE","#8E00A7","#66004A","#A36565","#5D1B1B"],loveColors:[],clientHeight:document.documentElement.clientHeight||document.body.clientHeight}},computed:{background:function(){return this.isBackgroundBottom?this.property.bottom:this.property.top},disableOpacity:function(){return""===this.background.color},isBackgroundBottom:function(){return"bottom"===this.tab}},watch:{"customColor.color":function(e){this.background.color=e},"background.opacity":function(e){this.background.opacity=e}},methods:{chooseColor:function(e){this.background.color=e,this.isBackgroundBottom||(this.background.opacity=.4),this.background.type=0,Vue.operatRecord.addRecord()},showColorPanel:function(e,t){document.addEventListener("mousedown",this.hideColorPanel),this.customColor.color=t;var n=this.clientHeight-338,i=e.pageY;i>=n&&(i=n),this.colorPicker.open(this.customColor,"color",{left:"356px",top:i+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(document.removeEventListener("mousedown",this.hideColorPanel),this.colorPicker.close())}}};var gn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-color-purity"},[n("div",{staticClass:"color-selected"},[n("div",{staticClass:"color-bg"},[n("div",{staticClass:"color",style:{background:e.background.color},on:{click:function(t){return e.showColorPanel(t,e.background.color)}}})]),e._v(" "),"transparent"===e.background.color?n("div",{staticClass:"value"},[e._v("\n            透明\n        ")]):e._e(),e._v(" "),"transparent"!==e.background.color?n("div",{staticClass:"value"},[e._v("\n            "+e._s(e._f("rgb2hex")(e.background.color,!0))+"\n        ")]):e._e()]),e._v(" "),e.isBackgroundBottom?e._e():n("div",{staticClass:"property"},[n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{staticClass:"input",style:{pointerEvents:e.disableOpacity?"none":"",background:e.disableOpacity?"#ECEEF0":""},attrs:{model:e.background,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}})],1),e._v(" "),n("div",{staticClass:"color-name"},[e._v("\n        推荐颜色\n    ")]),e._v(" "),n("ul",{staticClass:"color-list"},e._l(e.hotColors,(function(t,i){return n("li",{key:i,staticClass:"item",class:{clear:0===i},style:{background:0===i?"":t,border:2===i?"1px solid #ccd5db":""},on:{click:function(n){return e.chooseColor(t)}}})})),0)])};gn._withStripped=!0;const fn=H({render:gn,staticRenderFns:[]},void 0,pn,void 0,!1,void 0,!1,void 0,void 0,void 0);const yn={props:{tab:{type:String,default:"bottom"},property:{type:Object,default:function(){return{}}}},data:function(){return{customColor:{color:""},clientHeight:document.documentElement.clientHeight||document.body.clientHeight,colorIndex:0,hotColors:[["#626262","#000000"],["#FFFFFF","#D9D9D9"],["#FF1919","#960000"],["#FF3A19","#F47365"],["#FF7433","#FFB243"],["#FFA449","#FFF623"],["#D8FF00","#5FE793"],["#73FFB0","#00B644"],["#B4EC51","#429321"],["#00E5FF","#1593FF"],["#1593FF","#5D61FF"],["#1F66E1","#1C1FA3"],["#ABABF3","#729FE4"],["#FBC1FF","#8D91FF"],["#7762FF","#4B4FFF"],["#FF8FE6","#FF52AF"],["#A470E9","#BF3DCE"],["#FF104F","#FC3CAD"],["#7F1862","#3F0D2F"],["#C67D7D","#985353"]],loveColors:[]}},computed:{background:function(){return this.isBackgroundBottom?this.property.bottom:this.property.top},disableOpacity:function(){return this.background.colors[0]+this.background.colors[1]===""},isBackgroundBottom:function(){return"bottom"===this.tab}},watch:{"customColor.color":function(e){var t=this.background.colors.slice();t[this.colorIndex]=e,this.background.colors=t},"background.opacity":function(e){this.background.opacity=e}},methods:{setStyleBackground:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"linear-gradient(".concat(t,"deg, ").concat(e[0]||"transparent"," 0%, ").concat(e[1]||"transparent"," 100%)")},setRotate:function(){var e=this.background.rotate;(e+=90)>=360&&(e-=360),this.background.rotate=e,Vue.operatRecord.addRecord()},chooseColor:function(e){this.background.colors=e,this.isBackgroundBottom||(this.background.opacity=.4),this.background.type=1,Vue.operatRecord.addRecord()},showColorPanel:function(e,t){document.addEventListener("mousedown",this.hideColorPanel),this.customColor.color=this.background.colors[t],this.colorIndex=t;var n=this.clientHeight-338,i=e.pageY;i>=n&&(i=n),this.colorPicker.open(this.customColor,"color",{left:"356px",top:i+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(document.removeEventListener("mousedown",this.hideColorPanel),this.colorPicker.close())}}};var xn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-color-linear"},[n("div",{staticClass:"color-selected main"},[n("div",{staticClass:"color-bg show"},[n("div",{staticClass:"color",style:{background:e.setStyleBackground(e.background.colors,90)}})])]),e._v(" "),n("div",{staticClass:"color-selected linear"},[n("div",{staticClass:"color-box",style:{background:e.background.colors[0]},on:{click:function(t){return e.showColorPanel(t,0)}}}),e._v(" "),n("div",{staticClass:"rotate-box",on:{click:e.setRotate}},[n("i",{staticClass:"eqf-refresh-cw"})]),e._v(" "),n("div",{staticClass:"color-box",style:{background:e.background.colors[1]},on:{click:function(t){return e.showColorPanel(t,1)}}})]),e._v(" "),e.isBackgroundBottom?e._e():n("div",{staticClass:"property"},[n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{staticClass:"input",style:{pointerEvents:e.disableOpacity?"none":"",background:e.disableOpacity?"#ECEEF0":""},attrs:{model:e.background,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}})],1),e._v(" "),n("div",{staticClass:"color-name"},[e._v("\n        推荐颜色\n    ")]),e._v(" "),n("ul",{staticClass:"color-list"},e._l(e.hotColors,(function(t,i){return n("li",{key:i,staticClass:"item",class:{clear:0===i},style:{background:0===i?"":e.setStyleBackground(t)},on:{click:function(n){return e.chooseColor(t)}}})})),0)])};xn._withStripped=!0;const bn={components:{ColorPurity:fn,ColorLinear:H({render:xn,staticRenderFns:[]},void 0,yn,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{property:{type:Object,default:function(){return{}}}},data:function(){return{colorTypeList:[{name:"纯色",type:0},{name:"渐变色",type:1}],typeSelected:null}},computed:{background:function(){return this.property.bottom},isPurity:function(){return this.typeSelected===this.colorTypeList[0]}},mounted:function(){this.typeSelected=this.colorTypeList[0]},methods:{selectColorType:function(e){this.typeSelected=e,this.background.type=e.type,Vue.operatRecord.addRecord()},backToPure:function(){this.typeSelected=this.colorTypeList[0]}}};var wn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-background-basic"},[n("div",{staticClass:"color-type"},e._l(e.colorTypeList,(function(t,i){return n("span",{key:i,staticClass:"type-item",class:{active:e.typeSelected===t},on:{click:function(n){return e.selectColorType(t)}}},[e._v(e._s(t.name))])})),0),e._v(" "),e.isPurity?n("color-purity",{attrs:{tab:"bottom",property:e.property}}):e._e(),e._v(" "),e.isPurity?e._e():n("color-linear",{attrs:{tab:"bottom",property:e.property}})],1)};wn._withStripped=!0;const kn={components:{BackgroundBasic:H({render:wn,staticRenderFns:[]},void 0,bn,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:400,tabList:[{name:"基础",type:"basic"},{name:"高级",type:"high"}],tabSelected:null}},computed:{backgroundOpenHeight:function(){return 400},normalCloseHeight:function(){return 40}},mounted:function(){this.tabSelected=this.tabList[0],this.height=this.backgroundOpenHeight},methods:{toggleClick:function(){},selectTab:function(e){this.tabSelected=e},clearBackground:function(){this.property.clearCount=this.property.clearCount+1}}};var Sn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-background",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("背景")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"nav"},[n("div",[n("span",{staticClass:"clear",on:{click:e.clearBackground}},[e._v("清空背景")])])]),e._v(" "),n("background-basic",{directives:[{name:"show",rawName:"v-show",value:e.tabSelected===e.tabList[0],expression:"tabSelected === tabList[0]"}],ref:"basic",attrs:{property:e.property}})],1)])};Sn._withStripped=!0;const En=H({render:Sn,staticRenderFns:[]},void 0,kn,void 0,!1,void 0,!1,void 0,void 0,void 0);const Cn={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:326}},computed:{isText:function(){return this.type===He.text},positionHeight:function(){return this.type===He.image?392:(this.type,He.text,326)},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.positionHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.normalCloseHeight?this.positionHeight:this.normalCloseHeight,this.$emit("heightChange",this.height)}}};var Bn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-position",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("位置")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            旋转角度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,max:359,"model-key":"rotate",unit:"","unit-view":"°"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            左边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,"model-key":"x"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            上边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,"model-key":"y"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            宽度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"width"}}),e._v(" "),e.isText?e._e():n("div",{staticClass:"name"},[e._v("\n            高度\n        ")]),e._v(" "),e.isText?e._e():n("base-input",{attrs:{model:e.css,min:0,"model-key":"height"}})],1)])};Bn._withStripped=!0;const $n=H({render:Bn,staticRenderFns:[]},void 0,Cn,void 0,!1,void 0,!1,void 0,void 0,void 0);const _n={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{elementType:He,height:321}},computed:{shadowOpenHeight:function(){return 321},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.shadowOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.shadowOpenHeight?this.normalCloseHeight:this.shadowOpenHeight,this.$emit("heightChange",this.height)}}};var Rn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-shadow",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("投影")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            投影颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"dropShadow","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:e.type===e.elementType.text?-100:Number.MIN_SAFE_INTEGER,max:e.type===e.elementType.text?100:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"x","unit-view":""}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:e.type===e.elementType.text?-100:Number.MIN_SAFE_INTEGER,max:e.type===e.elementType.text?100:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"y","unit-view":""}})],1)]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            模糊\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.property,min:0,max:e.type===e.elementType.text?10:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"blur","unit-view":""}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.property,min:0,max:100,"model-key":"dropShadow","model-key-type":"transparency",unit:"","unit-view":"%"}})],1)])};Rn._withStripped=!0;const Vn=H({render:Rn,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("横向距离")]),this._v(" "),t("p",[this._v("纵向距离")])])}]},void 0,_n,void 0,!1,void 0,!1,void 0,void 0,void 0);const Jn={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:189}},computed:{strokeOpenHeight:function(){return 189},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.strokeOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.strokeOpenHeight?this.normalCloseHeight:this.strokeOpenHeight,this.$emit("heightChange",this.height)}}};var Fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-stroke",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("描边")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            描边颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"stroke","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:0,max:10,"model-key":"stroke","model-key-type":"size"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:0,max:10,"model-key":"stroke","model-key-type":"distance"}})],1)])],1)])};Fn._withStripped=!0;const Ln=H({render:Fn,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("描边尺寸")]),this._v(" "),t("p",[this._v("描边距离")])])}]},void 0,Jn,void 0,!1,void 0,!1,void 0,void 0,void 0);const Hn={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:189}},computed:{cubeOpenHeight:function(){return 189},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.cubeOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.cubeOpenHeight?this.normalCloseHeight:this.cubeOpenHeight,this.$emit("heightChange",this.height)}}};var zn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-cube",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("立体")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            立体颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"cube","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:0,max:20,"model-key":"cube","model-key-type":"size"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:0,max:359,"model-key":"angle",unit:"","unit-view":"°"}})],1)])],1)])};zn._withStripped=!0;const Pn=H({render:zn,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("尺寸")]),this._v(" "),t("p",[this._v("角度")])])}]},void 0,Hn,void 0,!1,void 0,!1,void 0,void 0,void 0);var Mn="100",In="101",Tn="102",On="103",An="104",Gn="105",Dn="106",qn="107",Nn="108",Yn="109",Wn="110",jn="111",Un="112",Kn="113",Xn="114",Zn="115",Qn="116",ei="117",ti="118",ni="119",ii="120",si="default",oi="move",ri="";function ai(e){var t=this;this.$el.addEventListener("mousedown",(function(n){if(n.stopPropagation(),t.allowEvent(jn)){var i=e.getSelected(),s=e.getElementInSelectedById(t.elementJson.id);if(i.length<=0||!s){var o=Vue.elements.getAllElementByElementInGroup(t);if(o.length>1)e.clearSelected(),e.setSelected(o),Vue.elementsBoxs.setHoverElement(o),Vue.elementsBoxs.clearSelected(),Vue.elementsBoxs.setSelectedElement(o),Vue.elements.getFirstGroupElementCount()!==o.length&&Vue.elementsBoxs.setGroupElement(o),Vue.elementsBoxs.setElementBoxEditIsGroup(!0),t.setCursor(oi),Vue.elementsBoxs.setSelectedElementBoxEditBind();else{var r=t.getSelected();e.clearSelected(),Vue.elementsBoxs.clearGroupElement(),t.setSelected(),Vue.store.commit("ELEMENT_SELECT",{eqxElements:e.getSelectedElements()}),t.setCursor(oi),Vue.elementsBoxs.clearHoverElement(),r||Vue.elementsBoxs.clearSelected().then((function(){Vue.elementsBoxs.setSelectedElement([t]),Vue.elementsBoxs.setElementBoxEditIsGroup(!1),Vue.elementsBoxs.setSelectedElementControlBarVisible(!0),Vue.elementsBoxs.setSelectedElementBoxEditBind()}))}}Kt(e)}}))}function li(e){var t=this,n=this.$el;n.addEventListener("mouseenter",(function(){ci()||(t.getSelected()?t.setCursor(oi):(t.setCursor(si),Vue.elementsBoxs.addHoverElement(t)))})),n.addEventListener("mouseleave",(function(){ci()||(t.getSelected()?t.setCursor(ri):Vue.elementsBoxs.delHoverElement(t))}))}function ci(e){return Vue.elementsBoxs.getElementBoxEditMoving()||Vue.elementsBoxs.getElementBoxEditRotating()||Vue.elementsBoxs.getElementBoxEditResizing()}var ui=function(){function t(n){e(this,t),n.id?this.elementJson=n:this.elementJson={id:null,type:null,css:{zIndex:null,width:n.width||100,height:n.height||100,x:n.x||0,y:n.y||0,opacity:n.opacity||1,display:n.display||"block",rotate:n.rotate||0,position:"absolute",isUpdate:!0},property:{lock:!1,isUpdate:!0}},this.elementResizeType=null,this.elementScale=null,this.selected=!1,this.isPrepare=!0,this.state=!0}return n(t,[{key:"bind",value:function(e){ai.call(this,e),li.call(this,e)}},{key:"updateId",value:function(e){Object.assign(this.elementJson,{id:e})}},{key:"updateCss",value:function(e){Object.assign(this.elementJson.css,e)}},{key:"updateProperty",value:function(e){Object.assign(this.elementJson.property,e)}},{key:"setScale",value:function(e){this.elementScale=e}},{key:"setSelected",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.selected=e}},{key:"getSelected",value:function(){return this.selected}},{key:"allowEvent",value:function(e){switch(e){case Mn:case In:case Tn:case On:case An:case Gn:case Dn:case qn:case Nn:case Yn:case Wn:case jn:case Un:case Kn:case Xn:case Zn:case Qn:case ei:case ti:case ni:case ii:default:return!0}}},{key:"setCursor",value:function(e){this.$el.css({cursor:e})}},{key:"getBoxSize",value:function(){var e=this.elementJson.css;return{width:e.width,height:e.height}}},{key:"getResizeBoxHeight",value:function(e){return{height:this.elementJson.css.height}}},{key:"getResizeMinSize",value:function(){var e=this.elementJson.css;return{width:e.width,height:e.height}}},{key:"resizeUpdateCss",value:function(e,t){this.updateCss(e)}},{key:"resizeInitDataStore",value:function(){}},{key:"settingUpdateCss",value:function(e){}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e)}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t={x:this.elementJson.css.x,y:this.elementJson.css.y}),this.elementJson.css.x=t.x+e.x,this.elementJson.css.y=t.y+e.y}},{key:"destroy",value:function(){this.$el.remove(),this.$vm.$destroy()}},{key:"setCssIsUpdate",value:function(e){this.elementJson.css.isUpdate=e}},{key:"setPropertyIsUpdate",value:function(e){this.elementJson.property.isUpdate=e}}]),t}();const di={computed:{style:function(){return{transform:"translate(".concat(this.elementJson.css.x,"px,").concat(this.elementJson.css.y,"px) rotate(").concat(this.elementJson.css.rotate,"deg)"),zIndex:this.elementJson.css.zIndex,opacity:this.elementJson.css.opacity,position:this.elementJson.css.position}},resizeWidth:function(){return this.elementJson.svgData.resizeWidth?parseFloat(this.elementJson.svgData.resizeWidth):null},resizeHeight:function(){return this.elementJson.svgData.resizeHeight?parseFloat(this.elementJson.svgData.resizeHeight):null},width:function(){return parseFloat(this.elementJson.svgData.svgWidth)},height:function(){return parseFloat(this.elementJson.svgData.svgHeight)},texts:function(){return this.elementJson.svgData.texts},fill:function(){return this.elementJson.css.color},fontFamily:function(){return this.elementJson.css.fontFamily},content:function(){return this.elementJson.property.content},fontSize:function(){return parseFloat(this.elementJson.css.fontSize)},list:function(){return this.elementJson.svgData.list},visible:function(){return this.elementJson.svgData.visible},backgroundColor:function(){return this.elementJson.css.backgroundColor},fontWeight:function(){return this.elementJson.css.fontWeight},fontStyle:function(){return this.elementJson.css.fontStyle},textDecoration:function(){return this.elementJson.css.textDecoration},lines:function(){return this.elementJson.svgData.lines},filter:function(){return this.elementJson.svgData.filter},isDropShowEnable:function(){return 1-this.elementJson.property.dropShadow.transparency/100>0},dropShadow:function(){return this.elementJson.property.dropShadow},id:function(){return this.elementJson.id},isStrokeEnable:function(){return this.elementJson.svgData.svgStroke.size>0},stroke:function(){return this.elementJson.svgData.svgStroke},isCubeEnable:function(){return this.elementJson.svgData.svgCube.length>0},cube:function(){return this.elementJson.svgData.svgCube}}};var hi=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqx-element-text",style:e.style},[n("svg",{ref:"textSvg",staticStyle:{overflow:"visible"},style:{opacity:e.visible?1:0},attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:e.resizeWidth?e.resizeWidth:e.width,height:e.resizeHeight?e.resizeHeight:e.height,viewBox:"0 0 "+e.width+" "+e.height,"xml:space":"preserve"}},[e.isDropShowEnable?n("defs",[n("filter",{attrs:{id:"shadow_"+e.id,filterUnits:"userSpaceOnUse",x:e.filter.x,y:e.filter.y,width:e.filter.width,height:e.filter.height}},[n("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:e.dropShadow.blur,result:"blur"}}),e._v(" "),n("feOffset",{attrs:{in:"blur",dx:e.dropShadow.x,dy:e.dropShadow.y,result:"offsetBlur"}}),e._v(" "),n("feFlood",{attrs:{"flood-color":e.dropShadow.color,"flood-opacity":1-e.dropShadow.transparency/100}}),e._v(" "),n("feComposite",{attrs:{in2:"offsetBlur",operator:"in"}}),e._v(" "),n("feMerge",[n("feMergeNode"),e._v(" "),n("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1)]):e._e(),e._v(" "),n("g",[n("g",[n("g",{attrs:{id:"hiddenTexts",opacity:"0"}},[e._l(e.texts,(function(t,i){return e._l(t,(function(t,s){return n("text",{key:s,attrs:{"data-line":""+i,"alignment-baseline":"auto","font-size":e.fontSize,"dominant-baseline":"text-before-edge",x:"0",y:"0"}},[e._v(e._s(t))])}))}))],2),e._v(" "),n("g",[n("rect",{attrs:{x:"0",y:"0",width:"100%",height:"100%",fill:e.backgroundColor}})])]),e._v(" "),n("g",[e._l(e.cube,(function(t,i){return n("g",{key:i},[n("g",{staticStyle:{"stroke-miterlimit":"10","stroke-linejoin":"round","stroke-linecap":"butt","stroke-dasharray":"0, 0",fill:"none"},style:[{"font-family":e.fontFamily},{fill:e.fill},{"font-weight":e.fontWeight},{"font-style":e.fontStyle},{stroke:t.color},{"stroke-width":10}],attrs:{filter:0===i?"url(#shadow_"+e.id+")":"",transform:"translate(0 0) translate("+t.x+" "+t.y+")"}},e._l(e.list,(function(t,i){return n("text",{key:i,attrs:{"dominant-baseline":"text-before-edge","font-size":t.size,x:t.x,y:t.y}},[e._v(e._s(t.text))])})),0)])})),e._v(" "),e.isStrokeEnable?n("g",[n("g",{staticStyle:{"stroke-miterlimit":"10","stroke-linejoin":"round","stroke-linecap":"butt","stroke-dasharray":"0, 0",fill:"none"},style:[{"font-family":e.fontFamily},{fill:e.fill},{"font-weight":e.fontWeight},{"font-style":e.fontStyle},{stroke:e.stroke.color},{"stroke-width":e.stroke.size}],attrs:{filter:e.isDropShowEnable&&!e.isCubeEnable?"url(#shadow_"+e.id+")":""}},e._l(e.list,(function(t,i){return n("text",{key:i,attrs:{"dominant-baseline":"text-before-edge","font-size":t.size,x:t.x,y:t.y}},[e._v(e._s(t.text))])})),0)]):e._e(),e._v(" "),e.isStrokeEnable?n("g",[n("g",{staticStyle:{stroke:"#ffffff","stroke-miterlimit":"10","stroke-linejoin":"round","stroke-linecap":"butt","stroke-dasharray":"0, 0",fill:"none"},style:[{"font-family":e.fontFamily},{fill:e.fill},{"font-weight":e.fontWeight},{"font-style":e.fontStyle},{"stroke-width":e.stroke.distance}]},e._l(e.list,(function(t,i){return n("text",{key:i,attrs:{"dominant-baseline":"text-before-edge","font-size":t.size,x:t.x,y:t.y}},[e._v(e._s(t.text))])})),0)]):e._e(),e._v(" "),n("g",[n("g",{style:[{"font-family":e.fontFamily},{fill:e.fill},{"font-weight":e.fontWeight},{"font-style":e.fontStyle}],attrs:{filter:e.isCubeEnable||e.isStrokeEnable||!e.isDropShowEnable?"":"url(#shadow_"+e.id+")"}},e._l(e.list,(function(t,i){return n("text",{key:i,attrs:{"dominant-baseline":"text-before-edge","font-size":t.size,x:t.x,y:t.y}},[e._v(e._s(t.text))])})),0)]),e._v(" "),n("g",{attrs:{"stroke-linecap":"butt"}},e._l(e.lines,(function(t,i){return n("line",{key:i,style:[{stroke:e.fill},{"stroke-width":2}],attrs:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}})})),0)],2)])])])};hi._withStripped=!0;const mi=H({render:hi,staticRenderFns:[]},void 0,di,void 0,!1,void 0,!1,void 0,void 0,void 0);function vi(e){var t=this,n=this.$el;n.addEventListener("dblclick",(function(e){if(e.stopPropagation(),!t.isEditing){var i=t.getBoxSize().height;t.initHeight=i,t.isEditing=!0,t.hideSVG(!0),t.editBox.show(t);var s=Vue.elementBoxEdit;if(1===Vue.elements.getSelected().length){var o=pi.call(t,Vue.elementBoxEdit);Vue.elementBoxEdit.setResizing(o)}else Vue.elementsBoxs.setSelectedElement([t]),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement(),Vue.elementBoxEdit.$vm.$nextTick((function(){var e=pi.call(t,Vue.elementBoxEdit);Vue.elementBoxEdit.setResizing(e)}));Vue.elementBoxEdit.setControlSizeBarVisible(!1),Vue.elementBoxEdit.setControlRotateBarVisible(!1),t.setCssIsUpdate(!1),t.setPropertyIsUpdate(!1);n.oninput=function(){!function(e){var n=t.editBox.$vm.$el.offsetHeight;t.updateSVGData({svgHeight:n});var i=e.scale;e.updateCss({height:n*i}),e.$vm.$nextTick((function(){var n=e.$vm.$el.parentElement.parentElement.getBoundingClientRect(),s=e.$vm.$refs.boxEditMask.getBoundingClientRect(),o=s.x-n.x,r=s.y-n.y;s.width,s.height;t.updateCss({x:o/i,y:r/i})}))}(s)}}}))}function pi(e){return function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),s=null,o=null;"left top",s=e.lt.x,o=e.lt.y,n%90!=0?(s=s-i.x+1,o=o-i.y+1):(s+=1,o+=1);return{transformOrigin:"left top",x:s,y:o}}(function(e){var t=e.$vm.$data.dataJson.x-1,n=e.$vm.$data.dataJson.y-1,i=e.$vm.$data.dataJson.rotate,s=e.$vm.$data.dataJson.width+2,o=e.$vm.$data.dataJson.height+2,r=null;if(i%90==0&&s===o||i%180==0)r={rotate:0,x:t,y:n,width:s,height:o};else if(90===i||270===i){var a=0,l=0,c=0,u=0;if(s>o){var d=t+(s-o)/2;a=a>d||0===a?d:a;var h=n-(s-o)/2;l=l>h||0===l?h:l;var m=d+o;c=c<m?m:c;var v=h+s;u=u<v?v:u}else if(s<o){var p=t-(o-s)/2;a=a>p||0===a?p:a;var g=n+(o-s)/2;l=l>g||0===l?g:l;var f=p+o;c=c<f?f:c;var y=g+s;u=u<y?y:u}r={rotate:0,x:a,y:l,width:c-a,height:u-l}}else{var x=e.$vm.$el.getBoundingClientRect();r={x:"",y:"",width:s,height:o,rotate:i,x1:x.x,y1:x.y,width1:x.width,height1:x.height}}var b=F.getVertex(r);if(90===i)return{lt:b.rt,rt:b.rb,rb:b.lb,lb:b.lt};if(180===i)return{lt:b.rb,rt:b.lb,rb:b.lt,lb:b.rt};if(270===i)return{lt:b.lb,rt:b.lt,rb:b.rt,lb:b.rb};return b}(e),vt.lineBottom,this.elementJson.css.rotate)}const gi={computed:{css:function(){return this.dataJson.visible?Object.assign({},this.dataJson.elementJson.css,{width:parseFloat(this.dataJson.elementJson.svgData.svgWidth)+parseFloat(this.dataJson.elementJson.css.letterSpacing)+"px",height:"auto",left:0,top:0,x:"",y:"",opacity:"",rotate:"",zIndex:"",lineHeight:this.dataJson.lineHeight,cursor:this.dataJson.cursor,padding:parseFloat(this.dataJson.elementJson.css.padding)+"px",letterSpacing:parseFloat(this.dataJson.elementJson.css.letterSpacing)+"px",fontSize:parseFloat(this.dataJson.elementJson.css.fontSize)+"px"}):{}},content:function(){return this.dataJson.elementJson.property.content}}};var fi=function(){var e=this.$createElement,t=this._self._c||e;return this.dataJson.visible?t("div",{ref:"textEdit",staticClass:"eqx-element-text-edit",style:[this.css],attrs:{contenteditable:"true"},domProps:{innerHTML:this._s(this.content)}}):this._e()};fi._withStripped=!0;const yi=H({render:fi,staticRenderFns:[]},void 0,gi,void 0,!1,void 0,!1,void 0,void 0,void 0);var xi=function(){function t(){e(this,t);var n=Vue.extend(yi);this.dataJson={visible:!1,width:0,height:0,x:0,y:0},this.$vm=new n({data:{dataJson:this.dataJson}}).$mount(),this.$el=this.$vm.$el}return n(t,[{key:"remove",value:function(){this.$vm.$data.dataJson.visible=!1}},{key:"show",value:function(e){var t=this,n=e.elementJson,i=parseFloat(n.svgData.svgHeight),s=parseFloat(n.css.padding),o=n.svgData.totalLineCount;this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.lineHeight=(i-2*s)/o+"px",this.$vm.$data.dataJson.cursor="text",this.$vm.$data.dataJson.elementJson=n,this.$vm.$nextTick((function(){var e;e=t.$vm.$el,setTimeout((function(){if(getSelection&&document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!0),t.setEnd(e,e.childNodes.length),t.setStart(e,0);var n=getSelection();n.removeAllRanges(),n.addRange(t)}else if(document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!0),i.select()}e.focus()}),1)}))}}]),t}();var bi=function(t){s(r,t);var i=c(r);function r(t){var n;e(this,r),(n=i.call(this,t)).elementResizeType=ut.text,t.id||(n.elementJson.type=He.text,n.elementJson.property=Object.assign({},n.elementJson.property,n.setDefaultProperty(t)),n.elementJson.css=Object.assign({},n.elementJson.css,n.setDefaultCss(t)),n.elementJson.svgData=Object.assign({},n.setDefaultSVGData()));var s=a(n),o=Vue.extend(mi);return n.$vm=new o({data:{elementJson:n.elementJson},watch:{"elementJson.svgData.list":{handler:function(e,t){null===t&&(s.settingUpdateProperty(s.elementJson.property),s.isPrepare=!0)},immediate:!0}}}).$mount(),n.$el=n.$vm.$el,n.isEditing=!1,n.textRects=[],n.editBox=new xi,n.$el.appendChild(n.editBox.$el),n.$vm.$nextTick((function(){n.measureText()})),n.createFontFace(),n.isPrepare=!1,n}return n(r,[{key:"allowEvent",value:function(e){switch(u(o(r.prototype),"allowEvent",this).call(this,e),e){case jn:return!this.isEditing;default:return!0}}},{key:"createFontFace",value:function(){var e=this.elementJson,t=e.css,n=e.property;if(n.fontFamily&&n.src&&""!==t.fontFamily&&""!==n.src&&!document.querySelector("#"+t.fontFamily)){var i=document.createElement("style");i.id=t.fontFamily,i.innerHTML='@font-face{font-family: "'.concat(t.fontFamily,'";src: url(').concat(n.src,') format("woff")}\r\n'),document.head.appendChild(i)}}},{key:"updateId",value:function(e){u(o(r.prototype),"updateId",this).call(this,e),this.$vm.$data.elementJson.id=e}},{key:"updateCss",value:function(e){u(o(r.prototype),"updateCss",this).call(this,e)}},{key:"updateProperty",value:function(e){u(o(r.prototype),"updateProperty",this).call(this,e)}},{key:"updateSVGData",value:function(e){Object.assign(this.elementJson.svgData,e)}},{key:"bind",value:function(e){u(o(r.prototype),"bind",this).call(this,e),vi.call(this,e)}},{key:"setDefaultCss",value:function(e){return{fontFamily:e.fontFamily||"",fontSize:e.fontSize||"14px",fontWeight:e.fontWeight||"",fontStyle:e.fontStyle||"",letterSpacing:e.letterSpacing||"0",lineHeight:e.lineHeight||"1",color:e.color||"rgba(0,0,0,1)",padding:e.padding||"12px",backgroundColor:e.backgroundColor||"transparent",textAlign:e.textAlign||"center",writingMode:e.writingMode||"",textDecoration:e.textDecoration||"",borderWidth:e.borderWidth||"0",borderRadius:e.borderRadius||"0",borderStyle:e.borderStyle||"solid",borderColor:e.borderColor||"rgba(255,255,255,1)",wordWrap:"break-word",wordBreak:"break-all"}}},{key:"setDefaultProperty",value:function(e){return{content:e.content||"双击进行编辑",fontFamilyName:e.fontFamilyName||"默认字体",src:e.src||"",dropShadow:{color:e.dropShadow&&e.dropShadow.color||"rgba(0,0,0,0)",x:e.dropShadow&&parseFloat(e.dropShadow.x)>=-100&&parseFloat(e.dropShadow.x)<=100?parseFloat(e.dropShadow.x):0,y:e.dropShadow&&parseFloat(e.dropShadow.y)>=-100&&parseFloat(e.dropShadow.y)<=100?parseFloat(e.dropShadow.y):0,blur:e.dropShadow&&parseFloat(e.dropShadow.blur)>=0&&parseFloat(e.dropShadow.blur)<=10?parseFloat(e.dropShadow.blur):0,transparency:e.dropShadow&&parseFloat(e.dropShadow.transparency)>=0&&parseFloat(e.dropShadow.transparency)<=100?parseFloat(e.dropShadow.transparency):100},stroke:{size:e.stroke&&parseFloat(e.stroke.size)>=0&&parseFloat(e.stroke.size)<=10?parseFloat(e.stroke.size):0,color:e.stroke&&e.stroke.color||"#5D61FF",distance:e.stroke&&parseFloat(e.stroke.distance)>=0&&parseFloat(e.stroke.distance)<=10?parseFloat(e.stroke.distance):0},angle:e.angle&&parseFloat(e.angle)>=0&&parseFloat(e.angle)<=360?parseFloat(e.angle):45,cube:[{size:e.cube&&parseFloat(e.cube.size)>=0&&parseFloat(e.cube.size)<=20?parseFloat(e.cube.size):0,color:e.cube&&e.cube.color||"#FF2A6A"}]}}},{key:"setDefaultSVGData",value:function(){return{visible:!0,svgWidth:0,svgHeight:0,texts:this.formatContentString(this.elementJson.property.content),list:null,lines:[],totalLineCount:0,resizeWidth:null,resizeHeight:null,resizeInit:{},filter:{x:0,y:0,width:"100%",height:"100%"},svgStroke:{color:"#5D61FF",size:0,distance:0},svgCube:[]}}},{key:"formatContent",value:function(e){return e.replace(/\r?\n/g,"<br>").replace(/\s/g,"&nbsp;")}},{key:"hideSVG",value:function(e){this.elementJson.svgData.visible=!e}},{key:"setSelected",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(u(o(r.prototype),"setSelected",this).call(this,t),!t&&this.isEditing){this.elementJson.svgData.list=[],this.elementJson.svgData.lines=[];var n=this.editBox.$vm.$el.innerHTML;n&&(n=(n=n.replace(/<div><br><\/div>/g,"\n").replace(/<br>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"")).replace(/<.*?>/gi,""));var i=this.formatContent(n);""===i&&Vue.elements.delElement(this),this.elementJson.svgData.texts=this.formatContentString(i),this.elementJson.property.content=i,this.$vm.$nextTick((function(){e.measureText()})),this.editBox.remove(),this.hideSVG(!1),this.isEditing=!1,this.oninput=null}}},{key:"getBoxSize",value:function(){if(this.elementJson.svgData.resizeWidth&&this.elementJson.svgData.resizeHeight)return{width:this.elementJson.svgData.resizeWidth,height:this.elementJson.svgData.resizeHeight};var e=this.elementJson.svgData.svgWidth,t=this.elementJson.svgData.svgHeight,n=parseFloat(this.elementJson.css.letterSpacing);return this.isEditing&&(e+=n),{width:e,height:t}}},{key:"getResizeBoxHeight",value:function(e){var t=e/Vue.elementsBoxs.scale-2*parseFloat(this.elementJson.css.padding)-2,n=this.getPositionInfo(this.textRects,t);return n&&n.svgHeight?n.svgHeight*Vue.elementsBoxs.scale:0}},{key:"getResizeMinSize",value:function(){var e=this.elementJson.css,t=e.fontSize,n=e.padding,i=this.elementJson.svgData.svgHeight;return{width:parseFloat(t)+2*parseFloat(n),height:i}}},{key:"getPositionInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.elementJson.css,i=this.groupTexts(e,"lineNum"),s=[];i.map((function(e){return s.push(parseInt(e[0].lineNum))}));for(var o=s[s.length-1]+1,r=[],a=0,l=0,c=t||parseFloat(n.width),u=parseFloat(n.fontSize),d=parseFloat(n.letterSpacing),h=parseFloat(n.lineHeight),m=-1,v=function(e){var t=i.filter((function(t,n){return parseInt(t[0].lineNum)===e})),n=0,s=m+1,o=[];if(!t||!t[0])return m+=1,"continue";o=t[0];for(var v=0;v<o.length;v++){var p=o[v],g=o.reduce((function(e,t){return e>t.height?e:t.height}),0),f=o.slice(n,v).reduce((function(e,t){return e+parseFloat(t.width)}),0)+d*(v-n);f+p.width>c&&(s+=1,n=v,f=0);var y=(u*h-u)/2,x=s*parseFloat(g)+y*(2*s+1);r.push({text:p.text,x:f,y:x,size:u,w:p.width,h:g});var b=(s+1)*parseFloat(g)+y*(s+1)*2,w=f+p.width;a=w>a?w:a,l=b>l?b:l,m=s}},p=0;p<o;p++)v(p);a=a<c?c:a,n.padding&&(r=this.setPositionWithTextPadding(r,parseFloat(n.padding)),a+=2*parseFloat(n.padding),l+=2*parseFloat(n.padding)),["left","center","right","justify"].includes(n.textAlign)&&(r=this.setPositionWithTextAlign(r,n.textAlign,parseFloat(n.padding),a));var g=[];return["underline","line-through"].includes(n.textDecoration)&&(g=this.setLinesPosition(r,n.textDecoration)),{list:r,totalLineCount:m+1,svgWidth:a,svgHeight:l,lines:g}}},{key:"resizeUpdate",value:function(e){var t=this,n=this.elementJson.css,i=n.padding,s=n.letterSpacing,o=n.fontSize,r=this.elementJson.svgData.resizeInit,a=Math.abs(r.width-e.width)/r.width;a=e.width>r.width?1+a:1-a;var l=(r.width-2*parseFloat(i))*a,c=parseFloat(i)*a,u=parseFloat(s)*a,d=parseFloat(o)*a;c<0&&(c=0),u<0&&(u=0),d<0&&(d=0),this.updateCss({fontSize:d,width:l,padding:c,letterSpacing:u}),this.$vm.$nextTick((function(){t.measureText()}))}},{key:"resizeInitDataStore",value:function(){this.elementJson.svgData.resizeInit={x:this.elementJson.css.x,y:this.elementJson.css.y,width:this.elementJson.svgData.svgWidth,height:this.elementJson.svgData.svgHeight}}},{key:"resizeUpdateCss",value:function(e,t,n){var i=this;t===pt.line?(this.updateCss({width:e.width-2*parseFloat(this.elementJson.css.padding),x:e.x,y:e.y}),this.$vm.$nextTick((function(){i.measureText()}))):(this.updateCss({x:e.x,y:e.y}),n?this.resizeUpdate(e):this.updateSVGData({resizeWidth:e.width,resizeHeight:e.height}))}},{key:"setDropShaow",value:function(e){var t=e.x,n=e.y,i=this.elementJson.svgData,s=i.list,o=i.filter,r=this.groupTexts(s,"y");if(0!==r.length){var a=r.reduce((function(e,t){return t.length>e.length?t:e})),l=a.length,c=t/(a[l-1].x-a[0].x+a[l-1].w),u=n/(r[r.length-1][0].y-r[0][0].y+r[r.length-1][0].h);o.x=parseFloat(t)<0?"-".concat(100*Math.abs(c),"%"):0,o.y=parseFloat(n)<0?"-".concat(100*Math.abs(u),"%"):0,o.width="".concat(100*(1+Math.abs(c)),"%"),o.height="".concat(100*(1+Math.abs(u)),"%")}}},{key:"setStroke",value:function(e){var t=e.size,n=e.distance,i=e.color,s=this.elementJson.svgData.svgStroke;s.color=i,s.distance=0===t?0:n,s.size=s.distance+t}},{key:"setCube",value:function(e){var t=this.elementJson.svgData.svgCube;t.splice(0);for(var n=0;n<e.length;n++)t.push(e[n])}},{key:"settingUpdateProperty",value:function(e){var t=e.dropShadow,n=e.stroke,i=e.cube,s=e.angle;if(t){var o=r.dropShadow(t);this.setDropShaow(o)}if(n&&this.setStroke(n),i&&s){var a=r.cube(i,s);this.setCube(a)}}},{key:"settingUpdateCss",value:function(e){var t=this;this.updateCss(e),this.$vm.$nextTick((function(){t.measureText()}))}},{key:"formatContentString",value:function(e){var t=e.split("<br>");return t=t.map((function(e){return e.replace(/&nbsp;/g," ")}))}},{key:"measureText",value:function(){var e=this;this.getTextsRect().then((function(t){e.textRects=t,e.setPosition(t)})).catch((function(e){return console.log(e)}))}},{key:"getTextsRect",value:function(){var e=this.$el.querySelector("#hiddenTexts").children;return new Promise((function(t,n){if(e)for(var i=[],s=0;s<e.length;s++){var o=e[s].getBBox(),r=o.width,a=o.height,l=0===r?12:r;i.push({lineNum:e[s].attr("data-line"),text:e[s].innerHTML,width:l,height:a}),s===e.length-1&&t(i)}else n()}))}},{key:"setPosition",value:function(e){var t=this.getPositionInfo(e);this.updateTextRender(t)}},{key:"setPositionWithTextPadding",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var s=e[i];s.x+=t,s.y+=t,n.push(s)}return n}},{key:"setPositionWithTextAlign",value:function(e,t,n,i){var s=[];if(e&&e.length>0)for(var o=this.groupTexts(e,"y"),r=0;r<o.length;r++){var a=o[r],l=a[0],c=a[a.length-1],u=c.x+c.w-l.x,d=0;"left"===t?d=-n:"center"===t?d=(i-u-2*n)/2:"right"===t?d=i-u-n:"justify"===t&&a.length>2&&(d=(i-l.w-c.w)/(a.length-2));for(var h=0;h<a.length;h++){var m=a[h];"justify"===t?0===h?m.x=0:h===a.length-1?m.x=i-m.w:m.x=l.w+d*(h-1)+(d-m.w)/2:m.x+=d,s.push(m)}}return s}},{key:"setLinesPosition",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var s=e[i],o=e[i+1],r=s.x,a=s.y+("underline"===t?s.h:"line-through"===t?s.h/2:0),l=o&&o.x>r?o.x:r+s.w,c=a;n.push({x1:r,x2:l,y1:a,y2:c})}return n}},{key:"groupTexts",value:function(e,t){for(var n=[],i={},s=0;s<e.length;s++){var o=e[s][t];i[o]||(i[o]=[]),i[o].push(e[s])}for(var r in i)n.push(i[r]);return n}},{key:"updateTextRender",value:function(e){var t=e.list,n=e.totalLineCount,i=e.svgWidth,s=e.svgHeight,o=e.lines;this.elementJson.svgData.list=t,this.elementJson.svgData.lines=o,this.elementJson.svgData.svgWidth=i,this.elementJson.svgData.svgHeight=s,this.elementJson.svgData.totalLineCount=n,this.elementJson.svgData.resizeInit={},this.elementJson.svgData.resizeWidth=null,this.elementJson.svgData.resizeHeight=null,Vue.elementsBoxs.getElementBoxEditResizing()||(1===Vue.elements.getSelected().length?this.selected&&Vue.elementsBoxs.setSelectedElement([this]):Vue.elements.getSelected().length>1&&(Vue.elementsBoxs.setSelectedElement(Vue.elements.getSelected()),Vue.elementsBoxs.setHoverElement(Vue.elements.getSelected()),Vue.elementsBoxs.setGroupElement(Vue.elements.getSelected())))}}],[{key:"dropShadow",value:function(e){if(e.color.indexOf("#")>-1){var t=L.hex2rgba(e.color);e.color="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}else if(e.transparency!==e.lastTransparency){var n=parseFloat((100-e.transparency)/100).toFixed(2),i=e.color.match(/(\d(\.\d+)?)+/g);e.color="rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(n,")"),e.lastTransparency=e.transparency}else{var s=e.color.match(/(\d(\.\d+)?)+/g),o=100-parseInt(100*s[3]);e.transparency=o}return e}},{key:"cube",value:function(e,t){var n=[];if(e)for(var i=t*Math.PI/180,s=e[0].color,o=e[0].size,r=0;r<o;r++)n.push({color:s,x:r*Math.cos(i),y:r*Math.sin(i)});return n}}]),r}(ui);const wi={computed:{style:function(){return{transform:"translate(".concat(this.elementJson.css.x,"px,").concat(this.elementJson.css.y,"px) rotate(").concat(this.elementJson.css.rotate,"deg)"),zIndex:this.elementJson.css.zIndex,opacity:this.elementJson.css.opacity,position:this.elementJson.css.position}},imageStyle:function(){var e=this.elementJson.property,t=this.elementJson.css,n=null;return 0===e.rotateX&&0===e.rotateY||(n="rotateX(".concat(e.rotateX,"deg) rotateY(").concat(e.rotateY,"deg)")),{width:"".concat(t.width,"px"),height:"".concat(t.height,"px"),display:t.display,transform:n,background:"url(".concat(e.src,") center center / cover"),filter:t.filter,borderRadius:t.borderRadius}}}};var ki=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqx-element-image",style:this.style},[t("div",{style:this.imageStyle})])};ki._withStripped=!0;const Si=H({render:ki,staticRenderFns:[]},void 0,wi,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ei=function(t){s(r,t);var i=c(r);function r(t){var n;e(this,r),(n=i.call(this,t)).elementResizeType=ut.image,t.id||(n.check(t)?n.state=!0:n.state=!1,n.elementJson.type=He.image,n.elementJson.property.src=t.src,n.defaultData()),n.updateProperty();var s=Vue.extend(Si);return n.$vm=new s({data:{elementJson:n.elementJson}}).$mount(),n.$el=n.$vm.$el,n}return n(r,[{key:"check",value:function(e){var t=!0,n=Vue.store.state.scene.editorConfig.debug;return!e.src&&n&&(console.error("Image组件的src属性为空！"),t=!1),t}},{key:"defaultData",value:function(){this.elementJson.property.dropShadow||(this.elementJson.property.dropShadow={x:0,y:0,color:"rgba(0,0,0,0)",blur:0,transparency:100,lastcolor:"rgba(0,0,0,0)"}),this.elementJson.property.rotateX||(this.elementJson.property.rotateX=0,this.elementJson.property.rotateY=0),this.elementJson.property.borderRadius||(this.elementJson.property.borderRadius={lb:!0,lt:!0,rb:!0,rt:!0,val:0}),this.elementJson.css.opacity||(this.elementJson.css.opacity=0)}},{key:"updateId",value:function(e){u(o(r.prototype),"updateId",this).call(this,e),this.$vm.$data.elementJson.id=e}},{key:"updateCss",value:function(e){u(o(r.prototype),"updateCss",this).call(this,e),this.$vm.$data.elementJson.css=this.elementJson.css}},{key:"settingUpdateCss",value:function(){this.selected&&Vue.elementsBoxs.setSelectedElement([this])}},{key:"updateProperty",value:function(){u(o(r.prototype),"updateProperty",this).call(this);var e=this.elementJson.property,t=this.elementJson.css,n=this.elementJson.property.borderRadius,i=n.lt?n.val:"0px",s=n.rt?n.val:"0px",a=n.lb?n.val:"0px",l=n.rb?n.val:"0px";t.borderRadius="".concat(i,"px ").concat(s,"px ").concat(l,"px ").concat(a,"px");var c=parseFloat((100-e.dropShadow.transparency)/100).toFixed(2),d=e.dropShadow.color.match(/(\d(\.\d+)?)+/g);t.dropShadowcolor="rgba(".concat(d[0],",").concat(d[1],",").concat(d[2],",").concat(c,")"),t.filter="drop-shadow(".concat(t.dropShadowcolor," ").concat(e.dropShadow.x,"px ").concat(e.dropShadow.y,"px ").concat(e.dropShadow.blur,"px)"),e.dropShadow.lastcolor!==e.dropShadow.color&&(e.dropShadow.lastcolor=e.dropShadow.color,e.dropShadow.transparency=0)}},{key:"bind",value:function(e){u(o(r.prototype),"bind",this).call(this,e)}},{key:"setTransform",value:function(e){var t=this.$vm.$data.elementJson.property;"x"===e?t.rotateY=180===t.rotateY?0:180:"y"===e&&(t.rotateX=180===t.rotateX?0:180)}},{key:"setDropShow",value:function(e){Object.assign(this.elementJson.property.dropShadow,e)}}]),r}(ui),Ci={101:bi,102:Ei},Bi=null,$i=null,_i=null;function Ri(e){var t=[];return function e(n){var i=getComputedStyle(n),s=i.fontFamily,o=i.backgroundImage,r=n.getAttribute("xlink:href")||n.getAttribute("src");if(s&&(Bi[s]=!0),o&&-1!==o.search(/http[^"]*/)&&-1===o.search('^url\\("data:image/(png|jpeg|gif|svg+xmlsvg-xml);base64,(\\w|\\/|\\+|=)*"\\)$')){var a=o.match(/http[^"]*/)[0],l=Vue.store.state.scene.cacheImage[a];l&&null!==l&&l.length>0?$i[a]=l:$i[a]=null}if(r&&r.startsWith("http")){var c=r.match(/http[^"]*/)[0],u=Vue.store.state.scene.cacheImage[c];u&&null!==u&&u.length>0?$i[c]=u:$i[c]=null}"CANVAS"===n.tagName&&t.push(Pi(n.toDataURL()).then((function(e){e.style.cssText=n.style.cssText,n.parentElement.insertBefore(e,n),n.parentElement.removeChild(n)}))),Array.from(n.children).forEach((function(t){return e(t)}))}(e),Promise.all(t)}function Vi(){var e=[];return Array.from(document.styleSheets).forEach((function(t){"STYLE"===t.ownerNode.tagName&&e.push.apply(e,h(Array.from(t.cssRules)))})),e.forEach((function(e){if(e.type===CSSRule.FONT_FACE_RULE){var t=e.style.getPropertyValue("font-family").replace(/"/g,"");Bi[t]&&e.style.getPropertyValue("src")&&(Bi[t]=e.style.getPropertyValue("src").match(/http[^"]*/)[0])}})),Promise.resolve()}function Ji(){var e=[];for(var t in Bi)!0!==Bi[t]&&function(t){e.push(Li(Bi[t]).then((function(e){return Mi(e)})).then((function(e){Bi[t]=e})))}(t);return Promise.all(e)}function Fi(){var e=[];for(var t in $i)null===$i[t]&&function(t){e.push(Li(t).then((function(e){return Mi(e)})).then((function(e){Vue.store.commit("CACHE_IMAGE",{key:t,value:e}),$i[t]=e})))}(t);return Promise.all(e)}function Li(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="blob",i.onload=function(){(i.status>=200&&i.status<300||304===i.status)&&t(i.response)},i.onerror=function(){n()},i.send()}))}function Hi(e){var t=parseFloat(e.style.width),n=parseFloat(e.style.height),i=[],s=(new XMLSerializer).serializeToString(e);for(var o in s=s.replace(/\sbackground-clip/g," -webkit-background-clip"),$i){var r=o.replace("?","\\?");r=r.replace(new RegExp("\\|","g"),"\\|"),s=new RegExp("&quot;".concat(r,"&quot;"),"g").test(s)?s.replace(new RegExp("&quot;".concat(r,"&quot;"),"g"),"&quot;".concat($i[o],"&quot;")):s.replace(new RegExp('"'.concat(r,'"'),"g"),'"'.concat($i[o],'"'))}for(var a in Bi)"string"==typeof Bi[a]&&i.push("@font-face {font-family: ".concat(a,"; src: url(").concat(Bi[a],");}"));return s="<style>".concat(i.join(""),"</style>").concat(s),Promise.resolve({html:s,width:t,height:n})}function zi(e){var t=e.html,n=e.width,i=e.height,s='<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(n,'" height="').concat(i,'"><foreignObject width="100%" height="100%">').concat(t,"</foreignObject></svg>");return Mi(new Blob([s],{type:"image/svg+xml;charset=utf-8"})).then((function(e){return Pi(e)})).then((function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.height=e.height,t.width=e.width,n.drawImage(e,0,0,e.width,e.height,0,0,e.width*_i.scale,e.height*_i.scale),t}))}function Pi(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=function(){n()},i.src=e}))}function Mi(e){return new Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(){n()},i.readAsDataURL(e)}))}function Ii(e){Vue.store.commit("OPEN_LOADING_CHANGE",!0),e=Object.assign({mutil:1},e);var t=document.createElement("div"),n=document.createElement("div");n.attr({id:"tmp-h2-open-wrapper"}),t.css({width:Vue.drawingBoard.size.width*e.mutil+"px",height:Vue.drawingBoard.size.height*e.mutil+"px",opacity:0,zIndex:-1e3}),n.css({position:"absolute",top:0,left:0,width:Vue.drawingBoard.size.width*e.mutil+"px",height:Vue.drawingBoard.size.height*e.mutil+"px"}),t.appendChild(n),document.body.appendChild(t);var i=new Mt({isRender:!0,scale:"auto",size:{width:Vue.drawingBoard.size.width*e.mutil,height:Vue.drawingBoard.size.height*e.mutil},editorSize:{width:Vue.drawingBoard.size.width*e.mutil,height:Vue.drawingBoard.size.height*e.mutil}});return n.appendChild(i.$el),Vue.elements.elementList.map((function(t){var n=JSON.parse(JSON.stringify(t.elementJson));n.type===He.text&&(n.svgData.list=null),function(e,t){if(1!==t){var n=e.property,i=["width","height","top","left","bottom","right","fontSize","letterSpacing","borderWidth","padding","x","y"];for(var s in e.css)i.includes(s)&&(e.css[s]=parseFloat(e.css[s])*t);for(var o in e.property)switch(o){case"dropShadow":var r=n.dropShadow;r.x=r.x*t,r.y=r.y*t,r.blur=r.blur*t;break;case"shadow":var a=n.shadow;a.h=a.h*t,a.v=a.v*t,a.blur=a.blur*t;break;case"cube":var l=n.cube;l[0].size=l[0].size*t;break;case"stroke":var c=n.stroke;c.size=c.size*t,c.distance=c.distance*t;break;case"shake":var u=n.shake;u.size=u.size*t;break;case"borderRadius":var d=n.borderRadius;d.val="".concat(parseInt(d.val)*t,"px")}}}(n,e.mutil);var s=new Ci[t.elementJson.type](n,i);i.addElement(s,!0)})),i.setBackground(Vue.drawingBoard.background.property),new Promise((function(e,s){var o;(o=i.elements,new Promise((function(e,t){var n;o.elementList.length>0?n=setInterval((function(){o.elementList.every((function(e){return e.isPrepare}))&&(clearInterval(n),n=null,e())}),100):e()}))).then((function(){(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Bi={},$i={},_i=Object.assign({backgroundColor:"",scale:1},t),e.style.backgroundColor=_i.backgroundColor,Ri(e).then((function(){return Vi()})).then((function(){return Promise.all([Ji(),Fi()])})).then((function(){return Hi(e)})).then((function(e){return zi(e)}))})(n).then((function(n){t.remove(),i=null,n.css({width:"",height:""}),Vue.store.commit("OPEN_LOADING_CHANGE",!1),e(n)})).catch((function(e){return s(e)}))}))}))}var Ti={page2Canvas:Ii,downloadFile:function(e){Ii(e).then((function(t){var n=document.createElement("a"),i="png";["png","jpeg"].includes(e.fileType)&&(i=e.fileType),n.href=t.toDataURL("image/".concat(i),1),e&&e.fileName?n.download=e.fileName+"."+i:n.download="轻设计编辑器开放平台"+(new Date).getTime()+"."+i;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(s)}))}};const Oi={data:function(){return{btnHover:!1,width:Vue.drawingBoard.size.width,height:Vue.drawingBoard.size.height,sizeList:[{name:"原尺寸",value:1},{name:"2倍图",value:2},{name:"3倍图",value:3},{name:"4倍图",value:4}]}},methods:{download:function(){Ti.downloadFile({mutil:1})},chooseSize:function(e){Ti.downloadFile({mutil:e})}}};var Ai=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"download-setting"},[n("div",{staticClass:"btn",on:{mouseleave:function(t){e.btnHover=!1},mouseover:function(t){e.btnHover=!0}}},[n("span",{on:{click:e.download}},[e._v("下载当前图片")])]),e._v(" "),n("div",{staticClass:"size-panel",style:{height:e.btnHover?"148px":0},on:{mouseleave:function(t){e.btnHover=!1},mouseover:function(t){e.btnHover=!0}}},e._l(e.sizeList,(function(t,i){return n("span",{key:i,staticClass:"item",on:{click:function(n){return e.chooseSize(t.value)}}},[e._v(e._s(t.name+" : "+e.width*t.value+" * "+e.height*t.value+"px"))])})),0)])};Ai._withStripped=!0;const Gi={components:{ShadowSetting:Vn,ImageSetting:rn,TextSetting:vn,BackgroundSetting:En,PositionSetting:$n,StrokeSetting:Ln,CubeSetting:Pn,DownloadSetting:H({render:Ai,staticRenderFns:[]},void 0,Oi,void 0,!1,void 0,!1,void 0,void 0,void 0)},data:function(){return{imageTypeList:["ImageSetting","ShadowSetting","PositionSetting"],textTypeList:["TextSetting","ShadowSetting","StrokeSetting","CubeSetting","PositionSetting"],emptyList:["DownloadSetting","BackgroundSetting"],chooseList:["DownloadSetting","BackgroundSetting"],clearBackgroundCount:0,scroll:{state:!1,scrollY:0,scrollContentY:0}}},computed:{eqxElementsSelected:function(){return Vue.store.state.scene.eqxElementsSelected},currentElementType:function(){return this.eqxElementsSelected.length>0?this.elementJson.type:""},elementJson:function(){return this.eqxElementsSelected.length>1?null:1===this.eqxElementsSelected.length?this.eqxElementsSelected[0].elementJson:null},property:function(){return this.elementJson?this.elementJson.property:null},css:function(){return this.elementJson?this.elementJson.css:null},backgroundProperty:function(){return Vue.drawingBoard.background.property}},watch:{eqxElementsSelected:function(){this.getComponentList(),0===this.eqxElementsSelected.length?this.pWidth=0:this.pWidth=this.panelWidth},property:{handler:function(e){e&&e.isUpdate&&this.eqxElementsSelected[0].settingUpdateProperty(e)},deep:!0},css:{handler:function(e){e&&e.isUpdate&&this.eqxElementsSelected[0].settingUpdateCss(e)},deep:!0},backgroundProperty:{handler:function(e,t){e.clearCount!==this.clearBackgroundCount&&(Vue.drawingBoard.clearBackground(),Vue.operatRecord.addRecord())},deep:!0}},methods:{refreshScrollBar:function(e){var t=this;setTimeout((function(){return t.$refs.listWrapper&&t.$refs.listWrapper.myScroll.refresh()}),300)},getComponentList:function(){this.eqxElementsSelected.length>0?this.currentElementType===He.image?this.chooseList=this.imageTypeList:this.currentElementType===He.text&&(this.chooseList=this.textTypeList):this.chooseList=this.emptyList,this.refreshScrollBar()}}};var Di=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"scroll-bar",rawName:"v-scroll-bar"}],ref:"listWrapper",staticClass:"eqx-setting-panel",style:{height:e.height+"px"}},[n("div",{ref:"content",staticClass:"setting-content"},[e._l(e.chooseList,(function(t,i){return[n(t,{key:t,tag:"component",attrs:{type:e.currentElementType,property:"BackgroundSetting"===t?e.backgroundProperty:e.property,css:e.css,"is-open":0==i},on:{heightChange:e.refreshScrollBar}})]}))],2)])};Di._withStripped=!0;const qi=H({render:Di,staticRenderFns:[]},void 0,Gi,void 0,!1,void 0,!1,void 0,void 0,void 0);var Ni=function(t){s(i,t);var n=c(i);function i(t){var s;e(this,i),s=n.call(this);var o=Vue.extend(qi);return s.$vm=new o({data:function(){return{height:t.height}}}).$mount(),s.$el=s.$vm.$el,s}return i}(Ye),Yi=function(){function t(){e(this,t),this.records=[],this.currentPosition=-1,this.isFirstPos=!0,this.isLastPos=!0}return n(t,[{key:"addRecord",value:function(){var e=[];Vue.elements.getAll().map((function(t){e.push(t.elementJson)}));var t={elements:e,background:Vue.drawingBoard.background.property,relations:Vue.elements.getRelationship()},n=JSON.stringify(t);n!==this.records[this.currentPosition]&&(this.currentPosition<this.records.length&&(this.records.length=this.currentPosition+1),this.records.push(n),this.currentPosition++,this.setFirstAndLastPos())}},{key:"back",value:function(){return this.currentPosition>=0&&this.currentPosition--,this.setFirstAndLastPos(),JSON.parse(this.records[this.currentPosition])}},{key:"forward",value:function(){return this.currentPosition<=this.records.length-1&&this.currentPosition++,this.setFirstAndLastPos(),JSON.parse(this.records[this.currentPosition])}},{key:"setFirstAndLastPos",value:function(){this.isFirstPos=0===this.currentPosition,this.isLastPos=this.currentPosition===this.records.length-1,Vue.store.commit("HISTORY_SET",{disableBack:this.isFirstPos,disableForward:this.isLastPos})}},{key:"renderDrawBoard",value:function(e){Vue.store.commit("ELEMENT_SELECT",{eqxElements:[]}),Vue.elements.clearSelected(),Vue.elementsBoxs.clearSelected(),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement(),Vue.elements.$el.innerHTML="",Vue.elements.delAll();var t=e.elements,n=e.background,i=e.relations;t.map((function(e){var t=new Ci[e.type](e,Vue.drawingBoard);Vue.drawingBoard.addElement(t,!0),t.setSelected(!1)})),i&&Vue.elements.setRelationship(i),Vue.drawingBoard.background.setBackground(n)}}]),t}();function Wi(){var e=this,t=this.$el;t.addEventListener("mousedown",(function(n){Zt.call(e,n,t)}))}return{Editor:function(t){s(o,t);var i=c(o);function o(t){var n;e(this,o),t=Object.assign({},t),n=i.call(this,t);var s=new Vue({store:Le,el:"#".concat(t.target),render:function(e){return e(qe)}});if(n.$vm=s,n.$el=n.$vm.$children[0].$refs.editor,n.$el.focus(),n.$eqxCenterEl=n.$vm.$children[0].$refs.eqxCenter,n.$rightEl=n.$vm.$children[0].$refs.eqxRight,n.drawingBoard=new Mt({scale:"auto",size:{width:t.drawingBoard.width,height:t.drawingBoard.height},editorSize:{width:n.$el.offsetWidth,height:n.$el.offsetHeight}}),n.$el.appendChild(n.drawingBoard.$el),Vue.drawingBoard=Vue.prototype.drawingBoard=n.drawingBoard,n.selectBox=new Gt,n.$el.appendChild(n.selectBox.$el),n.overViewMap=new Yt,n.$el.appendChild(n.overViewMap.$el),n.toolBar=new en({name:t.name,editor:a(n)}),n.$eqxCenterEl.appendChild(n.toolBar.$el),n.settingPanel=new Ni({height:n.$rightEl.offsetHeight}),n.$rightEl.appendChild(n.settingPanel.$el),n.operatRecord=new Yi,Vue.operatRecord=Vue.prototype.operatRecord=n.operatRecord,n.$vm.$nextTick((function(){Wi.call(a(n))})),t.fonts){for(var r=[],l=0;l<t.fonts.length;l++){var c=t.fonts[l];Object.prototype.hasOwnProperty.call(c,"name")&&Object.prototype.hasOwnProperty.call(c,"fontFamily")&&""!==c.name&&""!==c.fontFamily&&r.push(c)}Vue.store.commit("FONT_LIST_INIT",r)}return Vue.store.commit("EDITOR_CONFIG_CHANGE",t),n}return n(o,[{key:"addElement",value:function(e){this.drawingBoard.addElement(e)}},{key:"clearElements",value:function(){this.drawingBoard.clearElements()}},{key:"clearBackground",value:function(){this.drawingBoard.background.clearBackground()}},{key:"setBackgroundColor",value:function(e){this.drawingBoard.background.setBackgroundColor(e)}},{key:"exportImg",value:function(e){return 1===(e=Object.assign({type:1},e)).type?Ti.downloadFile(e):Ti.page2Canvas(e)}}]),o}(Ne),Image:Ei,Text:bi}}));
