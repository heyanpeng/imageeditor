/*!
 * h2.js beta v0.4
 * (c) 2020-2020 eqxiu
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):(e=e||self).h2=t(e.THREE)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?c(e):t}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return d(this,n)}}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,a=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw a}}return n}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=g(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}function y(e,t){return Object.prototype.toString.call(e).toLowerCase()==="[object ".concat(t,"]")}var x={isObject:function(e){return y(e,"object")},isArray:function(e){return y(e,"array")},isString:function(e){return y(e,"string")},isFunction:function(e){return y(e,"function")},isSupportWebp:!![].map&&0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp"),isWin:["Win32","Windows"].includes(navigator.platform),isWin64:new RegExp(/win64/).test(navigator.userAgent.toLowerCase()),isMac:["Mac68K","MacPPC","Macintosh","MacIntel"].includes(navigator.platform),isChrome:/Chrome/.test(navigator.userAgent),isFirefox:/Firefox/.test(navigator.userAgent),isSafari:/Safari/.test(navigator.userAgent),isEdge:/Edge/.test(navigator.userAgent),isBlob:function(e){return y(e,"blob")},getRandom:function(e,t){var n=t-e+1;return Math.floor(Math.random()*n+e)},getChromeVersion:function(){return Number(/Chrome\/(\d+)/.exec(navigator.userAgent)[1])},blobToDataURL:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}},b="[custom error]",w="[custom debug]",_="[custom info]",k="[custom warn]";var E={error:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).error.apply(e,[b].concat(n)),["pro"].includes(Vue.env.name)},debug:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).debug.apply(e,[w].concat(n))},info:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).info.apply(e,[_].concat(n))},warn:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).warn.apply(e,[k].concat(n))}};var S={css:function(e,t){if(x.isString(e)){if(null==t)return this.style[e];this.style[e]=t}else x.isObject(e)?Object.assign(this.style,e):E.error("css方法的参数不符合要求");return this},attr:function(e,t){if(x.isString(e)){if(null==t)return this.getAttribute(e);this.setAttribute(e,t)}else if(x.isObject(e))for(var n in e)this.setAttribute(n,e[n]);else E.error("attr方法的参数不符合要求");return this},removeAttr:function(e){if(x.isString(e))this.removeAttribute(e);else if(x.isArray(e)){var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.removeAttribute(i)}}catch(e){n.e(e)}finally{n.f()}}else E.error("removeAttr方法的参数不符合要求");return this},trigger:function(e){var t=document.createEvent("MouseEvents");return t.initMouseEvent(e,!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(t),this},clone:function(){var e=document.createElement("div");return e.innerHTML=this.outerHTML,e.children[0]},remove:function(){this.parentElement&&this.parentElement.removeChild(this)}};function C(e,t){var n=e.x,i=e.y,o=e.x+e.width,a=e.y+e.height,s=t.x,r=t.y,l=t.x+t.width,c=t.y+t.height;return!(n>l||s>o||i>c||r>a)}function B(e,t){var n=!1;return!n&&(n=R(e,{x:t.x,y:t.y})),n||(n=R(e,{x:t.x+t.width,y:t.y})),n||(n=R(e,{x:t.x+t.width,y:t.y+t.height})),n||(n=R(e,{x:t.x,y:t.y+t.height})),n}function R(e,t){var n=t.x,i=t.y,o=e.x+e.width/2,a=e.y+e.height/2,s=-e.rotate*Math.PI/180,r=(n-o)*Math.cos(s)-(i-a)*Math.sin(s)+o,l=(n-o)*Math.sin(s)+(i-a)*Math.cos(s)+a;return r>=e.x&&r<=e.x+e.width&&l>=e.y&&l<=e.y+e.height}function L(e,t){var n=!1,i=0;if(e.rotate>0&&e.rotate<90){i=e.rotate;var o=Math.sin(Math.PI/180*i),a=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.height*o,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.width*o});if(!n)n=$(t,{x:e.x1+e.width*a,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.height*a})}else if(e.rotate>90&&e.rotate<180){i=180-e.rotate;var s=Math.sin(Math.PI/180*i),r=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.height*r});if(!n)n=$(t,{x:e.x1+e.height*s,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.width*s});if(!n)n=$(t,{x:e.x1+e.width*r,y:e.y1})}else if(e.rotate>180&&e.rotate<270){i=e.rotate-180;var l=Math.sin(Math.PI/180*i),c=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1+e.width*l,y:e.y1+e.height1});if(!n)n=$(t,{x:e.x1,y:e.y1+e.height*l});if(!n)n=$(t,{x:e.x1+e.height*c,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.width*c})}else if(e.rotate>270&&e.rotate<360){i=360-e.rotate;var d=Math.sin(Math.PI/180*i),u=Math.cos(Math.PI/180*i);if(!n)n=$(t,{x:e.x1,y:e.y1+e.width*d});if(!n)n=$(t,{x:e.x1+e.width*u,y:e.y1});if(!n)n=$(t,{x:e.x1+e.width1,y:e.y1+e.height*u});if(!n)n=$(t,{x:e.x1+e.height*d,y:e.y1+e.height1})}return n}function $(e,t){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}function V(e){var t,n,i,o,a,s,r,l,c=0;if(e.rotate>0&&e.rotate<90){c=e.rotate;var d=Math.sin(Math.PI/180*c),u=Math.cos(Math.PI/180*c);t=e.x1+e.height*d,n=e.y1,i=e.x1+e.width1,o=e.y1+e.width*d,a=e.x1+e.width*u,s=e.y1+e.height1,r=e.x1,l=e.y1+e.height*u}else if(e.rotate>90&&e.rotate<180){c=180-e.rotate;var h=Math.sin(Math.PI/180*c),p=Math.cos(Math.PI/180*c);t=e.x1+e.width1,n=e.y1+e.height*p,i=e.x1+e.height*h,o=e.y1+e.height1,a=e.x1,s=e.y1+e.width*h,r=e.x1+e.width*p,l=e.y1}else if(e.rotate>180&&e.rotate<270){c=e.rotate-180;var m=Math.sin(Math.PI/180*c),g=Math.cos(Math.PI/180*c);t=e.x1+e.width*g,n=e.y1+e.height1,i=e.x1,o=e.y1+e.height*g,a=e.x1+e.height*m,s=e.y1,r=e.x1+e.width1,l=e.y1+e.width*m}else if(e.rotate>270&&e.rotate<360){c=360-e.rotate;var f=Math.sin(Math.PI/180*c),v=Math.cos(Math.PI/180*c);t=e.x1,n=e.y1+e.width*f,i=e.x1+e.width*v,o=e.y1,a=e.x1+e.width1,s=e.y1+e.height*v,r=e.x1+e.height*f,l=e.y1+e.height1}return{lt:{x:t,y:n},rt:{x:i,y:o},rb:{x:a,y:s},lb:{x:r,y:l}}}function F(e){return{lt:{x:e.x,y:e.y},rt:{x:e.x+e.width,y:e.y},rb:{x:e.x+e.width,y:e.y+e.height},lb:{x:e.x,y:e.y+e.height}}}function T(e,t){var n=V(e),i=F(t),o={A:n.lt,B:n.rt},a={A:n.rt,B:n.rb},s={A:n.lb,B:n.rb},r={A:n.lt,B:n.lb},l={A:i.lt,B:i.rt},c={A:i.rt,B:i.rb},d={A:i.lb,B:i.rb},u={A:i.lt,B:i.lb};return!!z(o,l)||(!!z(o,c)||(!!z(o,d)||(!!z(o,u)||(!!z(a,l)||(!!z(a,c)||(!!z(a,d)||(!!z(a,u)||(!!z(s,l)||(!!z(s,c)||(!!z(s,d)||(!!z(s,u)||(!!z(r,l)||(!!z(r,c)||(!!z(r,d)||!!z(r,u)))))))))))))))}function z(e,t){return Math.min(e.A.x,e.B.x)<=Math.max(t.A.x,t.B.x)&&Math.min(t.A.y,t.B.y)<=Math.max(e.A.y,e.B.y)&&Math.min(t.A.x,t.B.x)<=Math.max(e.A.x,e.B.x)&&Math.min(e.A.y,e.B.y)<=Math.max(t.A.y,t.B.y)&&(n=(t.A.x-e.A.x)*(e.B.y-e.A.y)-(e.B.x-e.A.x)*(t.A.y-e.A.y),i=(t.B.x-e.A.x)*(e.B.y-e.A.y)-(e.B.x-e.A.x)*(t.B.y-e.A.y),o=(e.A.x-t.A.x)*(t.B.y-t.A.y)-(t.B.x-t.A.x)*(e.A.y-t.A.y),a=(e.B.x-t.A.x)*(t.B.y-t.A.y)-(t.B.x-t.A.x)*(e.B.y-t.A.y),n*i<=1e-8&&o*a<=1e-8);var n,i,o,a}Object.assign(HTMLElement.prototype,S),Object.assign(SVGElement.prototype,S),Object.assign(HTMLDocument.prototype,S);var H={rectIsOverlap:function(e,t){if(0===e.rotate||180===e.rotate)return C(e,t);if(90===e.rotate||270===e.rotate){var n={x:e.x+e.width/2,y:e.y+e.height/2};return C({x:n.x-e.height/2,y:n.y-e.width/2,width:e.height,height:e.width},t)}return B(e,t)||L(e,t)||T(e,t)},calcRectIsOverlay:C,calcSelectBoxVertexInRect:B,calcPointInRotateRect:R,calcRectVertexInSelectBox:L,calcPointInRect:$,getPointPositionRotateWithCenterPoint:function(e,t,n){var i=Math.sin(n/180*Math.PI),o=Math.cos(n/180*Math.PI);return{x:(e.x-t.x)*o-(e.y-t.y)*i+t.x,y:(e.x-t.x)*i+(e.y-t.y)*o+t.y}},getRotateRectVertex:V,calcRectLineHaveIntersectionPoint:T,judgeIntersect:z,getVertex:function(e){return 0===e.rotate?F(e):V(e)},calcFootOfPerpendicular:function(e,t,n){var i=e.x-t.x,o=e.y-t.y;if(Math.abs(i)<1e-8&&Math.abs(o)<1e-8)return e;var a=(n.x-e.x)*(e.x-t.x)+(n.y-e.y)*(e.y-t.y);return a/=i*i+o*o,{x:e.x+a*i,y:e.y+a*o}},calcHypotenuseLength:function(e,t){return Math.round(Math.sqrt(Math.pow(Math.abs(e),2)+Math.pow(Math.abs(t),2)))}};var D={rgb2hex:function(e,t){var n=e.r,i=e.g,o=e.b,a=function(e){return("0"+Number(e).toString(16)).slice(-2)},s="#".concat(a(n)).concat(a(i)).concat(a(o));return t?s.toUpperCase():s},hex2rgba:function(e){var t=function(e){return parseInt(e,16)||0};return{r:t((e=e.slice(1)).slice(0,2)),g:t(e.slice(2,4)),b:t(e.slice(4,6)),a:1}},rgb2rgba:function(e){return"string"==typeof e?(e=(/rgba?\((.*?)\)/.exec(e)||["","0,0,0,1"])[1].split(","),{r:Number(e[0])||0,g:Number(e[1])||0,b:Number(e[2])||0,a:Number(e[3]?e[3]:1)}):e},rgb2hsv:function(e){var t=e.r,n=e.g,i=e.b;t/=255,n/=255,i/=255;var o=Math.max(t,n,i),a=Math.min(t,n,i),s=o-a,r=0;return o===a?r=0:o===t?r=n>=i?60*(n-i)/s:60*(n-i)/s+360:o===n?r=60*(i-t)/s+120:o===i&&(r=60*(t-n)/s+240),{h:r=Math.floor(r),s:parseFloat((0===o?0:1-a/o).toFixed(2)),v:parseFloat(o.toFixed(2))}}};function A(e,t,n,i,o,a,s,r,l,c){"boolean"!=typeof s&&(l=r,r=s,s=!1);const d="function"==typeof n?n.options:n;let u;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),i&&(d._scopeId=i),a?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},d._ssrRegister=u):t&&(u=s?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),u)if(d.functional){const e=d.render;d.render=function(t,n){return u.call(n),e(t,n)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,u):[u]}return n}const O={props:{model:{type:Object,default:null},modelKey:{type:String,default:""},modelKeyType:{type:String,default:""},min:{type:Number,default:-9999},max:{type:Number,default:9999},unit:{type:String,default:"px"},unitView:{type:String,default:"px"},step:{type:Number,default:1},reverse:{type:Boolean,default:!1}},computed:{value:function(){return this.model2view(this.model[this.modelKey])},drawingBoard:function(){return Vue.store.state.scene.drawingBoard}},mounted:function(){var e=this,t=this.step,n=this.$refs.input;n.addEventListener("mousedown",(function(n){var i=n.pageX,o=parseInt(n.target.value),a=function(n){var a=n.pageX-i,s=o+a*t;e.setValue(s)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e)}))})),n.addEventListener("input",(function(t){var n=parseInt(t.target.value)||0;e.setValue(n)})),n.addEventListener("blur",(function(e){Vue.operatRecord.addRecord()}))},methods:{view2model:function(e){return"transform"===this.modelKey?e="rotateZ(".concat(e,"deg)"):["shadow","stroke","shake","dropShadow"].includes(this.modelKey)?e=Object.assign(this.model[this.modelKey],a({},this.modelKeyType,e)):"cube"===this.modelKey?e=[Object.assign(this.model[this.modelKey][0],a({},this.modelKeyType,e))]:"%"===this.unitView&&(e=this.reverse?Number((1-e/100).toFixed(2)):Number((e/100).toFixed(2))),e},model2view:function(e){if("..."===e)return e;if("transform"===this.modelKey)e=/rotateZ?\((.*)deg\)/.exec(e)[1];else if(["shadow","stroke","shake","dropShadow"].includes(this.modelKey)){if(e){var t=e[this.modelKeyType];e=Math.ceil(t)}}else if("cube"===this.modelKey&&"size"===this.modelKeyType){if(e&&e[0]){var n=e[0][this.modelKeyType];e=Math.ceil(n)}}else e="%"===this.unitView?this.reverse?parseInt(100-100*e):parseInt(100*e):parseInt(e);return e},setValue:function(e){isNaN(e)&&(e=0);var t=this.min,n=this.max;e<t?e=t:e>n&&(e=n);var i=this.view2model(e);this.model[this.modelKey]=i,this.$refs.input.value=this.model2view(i)}}};var P=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-base-input hint--top hint--rounded",attrs:{"data-hint":"左右拖动改变大小"}},[t("input",{ref:"input",attrs:{type:"text"},domProps:{value:this.value}}),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:this.unitView,expression:"unitView"}],staticClass:"unit"},[this._v("\n        "+this._s(this.unitView)+"\n    ")])])};P._withStripped=!0;const M=A({render:P,staticRenderFns:[]},void 0,O,void 0,!1,void 0,!1,void 0,void 0,void 0);var J=function(){var e=this.$createElement;return(this._self._c||e)("a",{staticClass:"eqc-btn"},[this._t("default")],2)};J._withStripped=!0;const I=A({render:J,staticRenderFns:[]},void 0,{},void 0,!1,void 0,!1,void 0,void 0,void 0);const N={props:{model:{type:Object,default:null},modelKey:{type:String,default:""},modelKeyType:{type:String,default:""},showBorder:{type:Boolean,default:!1},isMuti:{type:Boolean,default:!1}},data:function(){return{clientHeight:document.documentElement.clientHeight||document.body.clientHeight}},computed:{backgroundColor:function(){if("..."===this.model[this.modelKey])return"#ffffff";var e="";switch(this.modelKey){case"shake":case"gradient":e=this.model[this.modelKey]?this.model[this.modelKey].colors[this.modelKeyType]:"#ffffff";break;case"shadow":case"stroke":e=this.model[this.modelKey]?this.model[this.modelKey].color:"#ffffff";break;case"cube":e=this.model[this.modelKey]?this.model[this.modelKey][0].color:"#ffffff";break;case"dropShadow":e=this.model[this.modelKey]?this.model[this.modelKey].color:"rgba(0,0,0,0.2)";break;default:e=this.model[this.modelKey]}return e}},methods:{showColorPanel:function(e){document.addEventListener("mousedown",this.hideColorPanel);var t="",n="";switch(this.modelKey){case"dropShadow":case"shadow":case"stroke":t=this.model[this.modelKey],n=this.modelKeyType;break;case"gradient":case"shake":t=this.model[this.modelKey].colors,n=this.modelKeyType;break;case"cube":t=this.model[this.modelKey][0],n="color";break;default:t=this.model,n=this.modelKey}var i=this.clientHeight-338,o=e.pageY;o>=i&&(o=i),this.colorPicker.open(t,n,{right:"184px",top:o+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(this.colorPicker.close(),document.removeEventListener("mousedown",this.hideColorPanel),Vue.operatRecord.addRecord())}}};var G=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-setting-color",on:{mousedown:function(e){e.stopPropagation()},click:this.showColorPanel}},[t("div",{staticClass:"color",class:[{border:this.showBorder}],style:[{backgroundColor:this.backgroundColor}]})])};G._withStripped=!0;const q=A({render:G,staticRenderFns:[]},void 0,N,void 0,!1,void 0,!1,void 0,void 0,void 0);const Y={model:{prop:"model",event:"change"},props:{type:{type:String,default:"normal"},id:{type:String,default:""},name:{type:String,default:""},value:{type:null,default:null},model:{type:null,default:null}},data:function(){return{specialValue:!1}},watch:{value:function(){"special"===this.type&&(this.specialValue=this.value,this.initSpecialEffect())}},mounted:function(){"special"===this.type&&(this.specialValue=this.value,this.initSpecialEffect())},methods:{chooseClick:function(){this.specialValue=!this.specialValue,this.initSpecialEffect(),this.$emit("change",this.specialValue)},initSpecialEffect:function(){var e=this.$refs.span,t=this.$refs.spanBox;e&&t&&(this.specialValue?(e.style.marginLeft="12px",t.style.background="#1593ff"):(e.style.marginLeft="0",t.style.background="#CCD5DB"))}}};var j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-base-radio"},["normal"===e.type?n("div",{staticClass:"radio-normal",class:{active:e.model===e.value}},[n("input",{attrs:{id:e.id,name:e.name,type:"radio"},domProps:{value:e.value},on:{change:function(t){return e.$emit("change",t.target.value)}}})]):e._e(),e._v(" "),"special"===e.type?n("div",{ref:"spanBox",staticClass:"radio-special",on:{click:e.chooseClick}},[n("span",{ref:"span"})]):e._e()])};j._withStripped=!0;const W=A({render:j,staticRenderFns:[]},void 0,Y,void 0,!1,void 0,!1,void 0,void 0,void 0);const U={props:{maxItemNum:{type:Number,default:10},scrollBarOptions:{type:Object,default:null},css:{type:Object,default:null},contentCss:{type:Object,default:null},list:{type:Array,default:null},itemKey:{type:String,default:"id"},name:{type:String,default:"name"},selectedItem:{type:Object,default:function(){return{}}}},methods:{choose:function(e){this.$emit("choose",e)}}};var X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"dropDown",staticClass:"eqc-drop-dwon",style:e.css},[n("div",{directives:[{name:"scroll-bar",rawName:"v-scroll-bar",value:e.scrollBarOptions,expression:"scrollBarOptions"}],staticClass:"wrap",style:{maxHeight:30*e.maxItemNum+"px"}},[n("ul",{staticClass:"list",style:e.contentCss},e._l(e.list,(function(t){return n("li",{key:t[e.itemKey],staticClass:"item ellipsis",class:{active:t[e.itemKey]===e.selectedItem[e.itemKey]},style:[{fontFamily:t.fontFamily},{padding:t.tag||t.flag?"0 6px":"0 12px"}],on:{click:function(n){return e.choose(t)}}},[n("p",{style:[{fontSize:t.tag||t.flag?"12px":"14px"}]},[e._v("\n                    "+e._s(t.name)+"\n                ")]),e._v(" "),n("div",{staticClass:"tags"},[t.tag&&t.tag.show?n("p",{staticClass:"tag",style:t.tag.css},[e._v("\n                        "+e._s(t.tag.name)+"\n                    ")]):e._e(),e._v(" "),t.flag&&t.flag.show?n("p",{staticClass:"flag",style:t.flag.css},[e._v("\n                        "+e._s(t.flag.name)+"\n                    ")]):e._e()])])})),0)])])};X._withStripped=!0;const K=A({render:X,staticRenderFns:[]},void 0,U,void 0,!1,void 0,!1,void 0,void 0,void 0);Vue.component("BaseInput",M),Vue.component("BaseButton",I),Vue.component("BaseDropDown",K),Vue.component("SettingColor",q),Vue.component("BaseRadio",W);const Z={props:{color:{type:String,default:"#ff00ff"},suckerCanvas:{type:null,default:null},suckerArea:{type:Array,default:function(){return[]}},colorsDefault:{type:Array,default:function(){return["#000000","#FFFFFF","#FF1900","#F47365","#FFB243","#FFE623","#6EFF2A","#1BC7B1","#00BEFF","#2E81FF","#5D61FF","#FF89CF","#FC3CAD","#BF3DCE","#8E00A7","#6600A4"]}},colorsHistoryKey:{type:String,default:"h2-color-history"},suckerEnabled:{type:Boolean,default:!0}},data:function(){return{slideSaturationStyle:{},slideHueStyle:{},slideAlphaStyle:{},hueWidth:15,hueHeight:152,alphaSize:5,selectedColorHeight:30,isOpenSucker:!1,suckerPreview:null,isSucking:!1,imgAlphaBase64:"",modelRgba:"",modelHex:"",r:0,g:0,b:0,a:1,h:0,s:0,v:0,colorsHistory:JSON.parse(localStorage.getItem(this.colorsHistoryKey))||[],colorSelected:""}},computed:{totalWidth:function(){return this.hueHeight+2*(this.hueWidth+8)},rgba:function(){var e=this;return{r:this.r,g:this.g,b:this.b,a:this.a,toRgbString:function(){return"rgb(".concat([e.r,e.g,e.b].join(","),")")},toRgbaStringShort:function(){return"".concat([e.r,e.g,e.b,e.a].join(","))},toRgbaString:function(){return"rgba(".concat(e.rgba.toRgbaStringShort(),")")},toHexString:function(){return e.rgb2hex(e.rgba,!0)}}},hsv:function(){return{h:this.h,s:this.s,v:this.v}}},watch:{rgba:function(e){this.$emit("change",e)},suckerCanvas:function(e){this.isSucking=!1,this.suckColor(e)}},created:function(){this.setColorValue(this.color),this.setColorPos(),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.imgAlphaBase64=this.createAlphaSquare(this.alphaSize).toDataURL()},mounted:function(){this.renderHue(this.$refs.canvasHue,this.hueWidth,this.hueHeight),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.renderColor(this.$refs.canvasColor,this.totalWidth-this.selectedColorHeight,this.selectedColorHeight,this.alphaSize)},destroyed:function(){this.setcolorsHistory(this.colorSelected)},methods:{keydownHandler:function(e){27===e.keyCode&&(this.isOpenSucker=!this.isOpenSucker,this.isSucking=!1,this.$emit("openSucker",this.isOpenSucker),document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("mousemove",this.mousemoveHandler),document.removeEventListener("mouseup",this.mousemoveHandler),this.suckerPreview&&(document.body.removeChild(this.suckerPreview),this.suckerPreview=null),this.bindSuckerMaskClickEvent())},mousemoveHandler:function(e){var t=e.pageX,n=e.pageY,i=this.suckerCanvas.getBoundingClientRect(),o=i.top,a=i.left,s=i.width,r=i.height,l=e.pageX-a,c=e.pageY-o,d=p(this.suckerCanvas.getContext("2d").getImageData(Math.min(l,s-1),Math.min(c,r-1),1,1).data,4),u=d[0],h=d[1],m=d[2],g=d[3];g=parseFloat((g/255).toFixed(2));var f=this.suckerPreview.style;Object.assign(f,{position:"absolute",left:e.pageX+20+"px",top:e.pageY-36+"px",width:"24px",height:"24px",borderRadius:"50%",border:"2px solid #fff",boxShadow:"0 0 8px 0 rgba(0, 0, 0, 0.16)",background:"rgba(".concat([u,h,m,g].join(","),")"),zIndex:95});var v=document.getElementById("suckerMaskId");t>=this.suckerArea[0]&&n>=this.suckerArea[1]&&t<=this.suckerArea[2]&&n<=this.suckerArea[3]?(f.display="",null!==v&&v.css({pointerEvents:"none"})):(f.display="none",null!==v&&v.css({pointerEvents:"auto"}))},openSucker:function(){this.keydownHandler({keyCode:27}),this.isOpenSucker&&(this.isSucking=!0,document.addEventListener("keydown",this.keydownHandler))},inputColor:function(e){this.setColorValue(e.target.value)&&(this.setColorPos(),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.colorSelected=this.rgba.toRgbaString())},setcolorsHistory:function(e){if(e){var t=this.colorsHistory,n=t.indexOf(e);n>=0&&t.splice(n,1),t.length>=8&&(t.length=7),t.unshift(e),this.colorsHistory=t,localStorage.setItem(this.colorsHistoryKey,JSON.stringify(t))}},setColorValue:function(e){var t={r:0,g:0,b:0,a:1};if(new RegExp(/^((2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),){2}(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?),?(0\.\d{1,2}|1|0)$/).test(e)&&(e="rgb("+e+")"),/^#([0-9a-fA-F]{6})$/.test(e))t=this.hex2rgba(e);else if(/rgb/.test(e))t=this.rgb2rgba(e);else{if("[object Object]"!==Object.prototype.toString.call(e))return!1;t=e}var n=t,i=n.r,o=n.g,a=n.b,s=n.a;this.r=i,this.g=o,this.b=a,this.a=s||0===s?s:1;var r=this.rgb2hsv(this.rgba),l=r.h,c=r.s,d=r.v;return this.h=l,this.s=c,this.v=d,!0},setColorPos:function(){this.slideSaturationStyle={left:this.s*this.hueHeight-5+"px",top:(1-this.v)*this.hueHeight-5+"px"},this.slideHueStyle={top:(1-this.h/360)*this.hueHeight-2+"px"},this.slideAlphaStyle={top:this.a*this.hueHeight-2+"px"}},selectColor:function(e){this.setColorValue(e),this.setColorPos(),this.renderSaturation(this.$refs.canvasSaturation,this.rgba.toRgbString(),this.hueHeight),this.renderAlpha(this.$refs.canvasAlpha,this.hueWidth,this.hueHeight,this.alphaSize,this.rgba.toRgbString()),this.modelHex=this.rgba.toHexString(),this.modelRgba=this.rgba.toRgbaStringShort(),this.colorSelected=this.rgba.toRgbaString()},selectSaturation:function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),e.target===this.$refs.canvasSaturation){var n=this.$refs.saturation.getBoundingClientRect(),i=n.top,o=n.left,a=e.target.getContext("2d"),s=function(e){var n=e.pageX-o,s=e.pageY-i;n<0&&(n=0),s<0&&(s=0),n>t.hueHeight&&(n=t.hueHeight),s>t.hueHeight&&(s=t.hueHeight),t.slideSaturationStyle={left:n-5+"px",top:s-5+"px"};var r=p(a.getImageData(Math.min(n,t.hueHeight-1),Math.min(s,t.hueHeight-1),1,1).data,3),l=r[0],c=r[1],d=r[2];t.setColorValue({r:l,g:c,b:d}),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort()};s(e);document.addEventListener("mousemove",s),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),t.colorSelected=t.rgba.toRgbaString()}))}},selectHue:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.$refs.hue.getBoundingClientRect().top,i=e.target.getContext("2d"),o=function(e){var o=e.pageY-n;o<0&&(o=0),o>t.hueHeight&&(o=t.hueHeight),t.slideHueStyle={top:o-2+"px"},t.slideSaturationStyle={left:t.hueHeight-5+"px",top:"-5px"};var a=p(i.getImageData(0,Math.min(o,t.hueHeight-1),1,1).data,3),s=a[0],r=a[1],l=a[2];t.setColorValue({r:s,g:r,b:l}),t.renderSaturation(t.$refs.canvasSaturation,t.rgba.toRgbString(),t.hueHeight),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()};o(e);document.addEventListener("mousemove",o),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)}))},selectAlpha:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.$refs.alpha.getBoundingClientRect().top,i=function(e){var i=e.pageY-n;i<0&&(i=0),i>t.hueHeight&&(i=t.hueHeight),t.slideAlphaStyle={top:i-2+"px"},t.a=parseFloat((i/t.hueHeight).toFixed(2)),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()};i(e);document.addEventListener("mousemove",i),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)}))},suckColor:function(e){var t=this;e&&"CANVAS"!==e.tagName||(this.suckerPreview=document.createElement("div"),document.body.appendChild(this.suckerPreview),document.addEventListener("mousemove",this.mousemoveHandler),document.addEventListener("mouseup",this.mousemoveHandler),e.addEventListener("click",(function(n){var i=e.getBoundingClientRect(),o=i.top,a=i.left,s=i.width,r=i.height,l=n.pageX-a,c=n.pageY-o,d=p(e.getContext("2d").getImageData(Math.min(l,s-1),Math.min(c,r-1),1,1).data,4),u=d[0],h=d[1],m=d[2],g=d[3];g=parseFloat((g/255).toFixed(2)),t.setColorValue({r:u,g:h,b:m,a:g}),t.setColorPos(),t.renderSaturation(t.$refs.canvasSaturation,t.rgba.toRgbString(),t.hueHeight),t.renderAlpha(t.$refs.canvasAlpha,t.hueWidth,t.hueHeight,t.alphaSize,t.rgba.toRgbString()),t.modelHex=t.rgba.toHexString(),t.modelRgba=t.rgba.toRgbaStringShort(),t.colorSelected=t.rgba.toRgbaString()})))},renderSaturation:function(e,t,n){var i=e.getContext("2d");e.width=n,e.height=n,i.fillStyle=t,i.fillRect(0,0,n,n),this.createLinearGradient("l",i,n,n,"#FFFFFF","rgba(255,255,255,0)"),this.createLinearGradient("p",i,n,n,"rgba(0,0,0,0)","#000000")},renderHue:function(e,t,n){var i=e.getContext("2d");e.width=t,e.height=n;var o=i.createLinearGradient(0,0,0,n);o.addColorStop(0,"#FF0000"),o.addColorStop(.17,"#FF00FF"),o.addColorStop(.34,"#0000FF"),o.addColorStop(.51,"#00FFFF"),o.addColorStop(.68,"#00FF00"),o.addColorStop(.17*5,"#FFFF00"),o.addColorStop(1,"#FF0000"),i.fillStyle=o,i.fillRect(0,0,t,n)},renderAlpha:function(e,t,n,i,o){if(e){var a=this.createAlphaSquare(i),s=e.getContext("2d");e.width=t,e.height=n,s.fillStyle=s.createPattern(a,"repeat"),s.fillRect(0,0,t,n),this.createLinearGradient("p",s,t,n,"rgba(255,255,255,0)",o)}},renderColor:function(e,t,n,i){var o=this.createAlphaSquare(i),a=e.getContext("2d");e.width=t,e.height=n,a.fillStyle=a.createPattern(o,"repeat"),a.fillRect(0,0,t,n)},createAlphaSquare:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=2*e;return t.width=i,t.height=i,n.fillStyle="#ffffff",n.fillRect(0,0,i,i),n.fillStyle="#ccd5db",n.fillRect(0,0,e,e),n.fillRect(e,e,e,e),t},createLinearGradient:function(e,t,n,i,o,a){var s="l"===e,r=t.createLinearGradient(0,0,s?n:0,s?0:i);r.addColorStop(.01,o),r.addColorStop(.99,a),t.fillStyle=r,t.fillRect(0,0,n,i)},rgb2hex:function(e,t){var n=e.r,i=e.g,o=e.b,a=function(e){return("0"+Number(e).toString(16)).slice(-2)},s="#".concat(a(n)).concat(a(i)).concat(a(o));return t?s.toUpperCase():s},hex2rgba:function(e){var t=function(e){return parseInt(e,16)||0};return{r:t((e=e.slice(1)).slice(0,2)),g:t(e.slice(2,4)),b:t(e.slice(4,6)),a:1}},rgb2rgba:function(e){return"string"==typeof e?(e=(/rgba?\((.*?)\)/.exec(e)||["","0,0,0,1"])[1].split(","),{r:Number(e[0])||0,g:Number(e[1])||0,b:Number(e[2])||0,a:Number(e[3]?e[3]:1)}):e},rgb2hsv:function(e){var t=e.r,n=e.g,i=e.b;t/=255,n/=255,i/=255;var o=Math.max(t,n,i),a=Math.min(t,n,i),s=o-a,r=0;return o===a?r=0:o===t?r=n>=i?60*(n-i)/s:60*(n-i)/s+360:o===n?r=60*(i-t)/s+120:o===i&&(r=60*(t-n)/s+240),{h:r=Math.floor(r),s:parseFloat((0===o?0:1-a/o).toFixed(2)),v:parseFloat(o.toFixed(2))}},suckerMaskClick:function(e){this.keydownHandler({keyCode:27})},bindSuckerMaskClickEvent:function(){var e=this;setTimeout((function(){var t=document.getElementById("suckerMaskId");null!==t?e.isOpenSucker?t.addEventListener("click",e.suckerMaskClick):t.removeEventListener("click",e.suckerMaskClick):e.bindSuckerMaskClickEvent()}),500)}}};var Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"h2-color-picker"},[n("div",{staticClass:"color-set"},[n("div",{ref:"saturation",staticClass:"saturation",on:{mousedown:e.selectSaturation}},[n("canvas",{ref:"canvasSaturation"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideSaturationStyle})]),e._v(" "),n("div",{ref:"hue",staticClass:"hue",on:{mousedown:e.selectHue}},[n("canvas",{ref:"canvasHue"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideHueStyle})]),e._v(" "),n("div",{ref:"alpha",staticClass:"alpha",on:{mousedown:e.selectAlpha}},[n("canvas",{ref:"canvasAlpha"}),e._v(" "),n("div",{staticClass:"slide",style:e.slideAlphaStyle})])]),e._v(" "),n("div",{staticClass:"color-show",style:{height:e.selectedColorHeight+"px"}},[n("div",{staticClass:"show"},[n("canvas",{ref:"canvasColor"}),e._v(" "),n("div",{staticClass:"color",style:{background:e.rgba.toRgbaString()}})]),e._v(" "),e.isSucking?e._e():n("svg",{staticClass:"sucker",class:{active:e.isOpenSucker},style:{display:e.suckerEnabled?"block":"none"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"-12 -12 48 48"},on:{click:e.openSucker}},[n("path",{attrs:{d:"M13.1,8.2l5.6,5.6c0.4,0.4,0.5,1.1,0.1,1.5s-1.1,0.5-1.5,0.1c0,0-0.1,0-0.1-0.1l-1.4-1.4l-7.7,7.7C7.9,21.9,7.6,22,7.3,22H3.1C2.5,22,2,21.5,2,20.9l0,0v-4.2c0-0.3,0.1-0.6,0.3-0.8l5.8-5.8C8.5,9.7,9.2,9.6,9.7,10s0.5,1.1,0.1,1.5c0,0,0,0.1-0.1,0.1l-5.5,5.5v2.7h2.7l7.4-7.4L8.7,6.8c-0.5-0.4-0.5-1-0.1-1.5s1.1-0.5,1.5-0.1c0,0,0.1,0,0.1,0.1l1.4,1.4l3.5-3.5c1.6-1.6,4.1-1.6,5.8-0.1c1.6,1.6,1.6,4.1,0.1,5.8L20.9,9l-3.6,3.6c-0.4,0.4-1.1,0.5-1.5,0.1"}})]),e._v(" "),e.isSucking?n("svg",{staticClass:"sucker",attrs:{viewBox:"-16 -16 68 68",xmlns:"http://www.w3.org/2000/svg",stroke:"#9099a4"}},[n("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[n("g",{attrs:{transform:"translate(1 1)","stroke-width":"4"}},[n("circle",{attrs:{"stroke-opacity":".5",cx:"18",cy:"18",r:"18"}}),e._v(" "),n("path",{attrs:{d:"M36 18c0-9.94-8.06-18-18-18"}},[n("animateTransform",{attrs:{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"1s",repeatCount:"indefinite"}})],1)])])]):e._e()]),e._v(" "),n("div",{staticClass:"color-type"},[n("div",{staticClass:"name"},[e._v("\n            HEX\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.modelHex,expression:"modelHex"}],staticClass:"value",style:{width:e.totalWidth-60+"px"},attrs:{maxlength:"7"},domProps:{value:e.modelHex},on:{input:[function(t){t.target.composing||(e.modelHex=t.target.value)},e.inputColor]}})]),e._v(" "),n("div",{staticClass:"color-type"},[n("div",{staticClass:"name"},[e._v("\n            RGBA\n        ")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.modelRgba,expression:"modelRgba"}],staticClass:"value",style:{width:e.totalWidth-60+"px"},attrs:{maxlength:"15"},domProps:{value:e.modelRgba},on:{input:[function(t){t.target.composing||(e.modelRgba=t.target.value)},e.inputColor]}})]),e._v(" "),n("ul",{staticClass:"colors",style:{width:e.totalWidth+"px"}},e._l(e.colorsDefault,(function(t){return n("li",{key:t,staticClass:"item",style:{background:t},on:{click:function(n){return e.selectColor(t)}}})})),0),e._v(" "),e.colorsHistory.length?n("ul",{staticClass:"colors history",style:{width:e.totalWidth+"px"}},e._l(e.colorsHistory,(function(t){return n("li",{key:t,staticClass:"item",on:{click:function(n){return e.selectColor(t)}}},[n("div",{staticClass:"alpha",style:{background:"url("+e.imgAlphaBase64+")"}}),e._v(" "),n("div",{staticClass:"color",style:{background:t}})])})),0):e._e()])};Q._withStripped=!0;const ee={components:{colorPicker:A({render:Q,staticRenderFns:[]},void 0,Z,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{model:{type:Object,default:null},modelKey:{type:String,default:""},css:{type:Object,default:null},suckerEnable:{type:Boolean,default:!1}},data:function(){return{color:this.model[this.modelKey],isOpenSucker:!1,canvasSucker:null,suckerArea:[],mask:null}},computed:{eqxPage:function(){return Vue.store.state.scene.eqxPage}},methods:{changeColor:function(e){this.model[this.modelKey]=e.toRgbaString()},openSucker:function(e){},setSuckerCanvas:function(e){e.css({position:"absolute",left:0,top:0,opacity:0,pointerEvents:"auto",zIndex:1002}),e.addEventListener("mousedown",(function(e){return e.stopPropagation()}))},getSuckerArea:function(){var e=this.eqxPage.$el.getBoundingClientRect(),t=this.eqxPage.$el.parentElement.parentElement.getBoundingClientRect();return[Math.max(t.left,e.left),Math.max(t.top,e.top),Math.min(t.right,e.right),Math.min(t.bottom,e.bottom)]},createMask:function(e){var t=p(e,4),n=t[0],i=t[1],o=t[2],a=t[3],s=this.canvasMask=document.createElement("canvas"),r=s.getContext("2d");return s.width=document.body.clientWidth,s.height=document.body.clientHeight,s.setAttribute("id","suckerMaskId"),r.fillStyle="rgba(0,0,0,0.7)",r.fillRect(0,0,s.width,s.height),r.clearRect(n,i,o-n,a-i),s.css({position:"absolute",left:0,top:0,outline:"10000px solid rgba(0,0,0,0.7)",zIndex:6}),s}}};var te=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-color-picker",style:this.css,on:{mousedown:function(e){e.stopPropagation()}}},[t("color-picker",{attrs:{"sucker-canvas":this.canvasSucker,"sucker-area":this.suckerArea,color:this.color,"sucker-enabled":this.suckerEnable},on:{change:this.changeColor,openSucker:this.openSucker}})],1)};te._withStripped=!0;const ne=A({render:te,staticRenderFns:[]},void 0,ee,void 0,!1,void 0,!1,void 0,void 0,void 0);var ie=null;function oe(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];ie&&ae();var o=Vue.extend(ne);ie=new o({propsData:{model:e,modelKey:t,css:n,suckerEnable:i}}).$mount(),document.body.querySelector(".eqx-h2open").appendChild(ie.$el)}function ae(){ie&&(document.body.querySelector(".eqx-h2open").removeChild(ie.$el),ie.$destroy(),ie=null)}function se(){return{isOpenSucker:(ie||{}).isOpenSucker}}Vue.use((function(e){e.colorPicker=e.prototype.colorPicker={open:oe,close:ae,getState:se}}));const re={props:{data:{type:Object,default:void 0},params:{type:Object,default:void 0}},data:function(){return{dialog:"cDialog",value:null}},methods:{close:function(e){var t=this,n=this.$el;n.addEventListener("animationend",(function(){var e=document.querySelector(".eqx-h2open");e?e.removeChild(n):document.body.removeChild(n),t.$destroy()})),n.className="eqc-dialog-base close",e&&(this.value=e)}}};var le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-dialog-base"},[n("div",{staticClass:"mask",style:{background:e.params.maskBackground},on:{click:function(t){return e.close()}}}),e._v(" "),n("div",{staticClass:"content"},[n(e.dialog,{tag:"component",attrs:{data:e.data,close:e.close}})],1)])};le._withStripped=!0;const ce=A({render:le,staticRenderFns:[]},void 0,re,void 0,!1,void 0,!1,void 0,void 0,void 0);var de={delayLoadJS:function(e){if(!e)return Promise.reject();return new Promise((function(t,n){var i,o=null,a=v(document.querySelectorAll("script"));try{for(a.s();!(i=a.n()).done;){var s=i.value;if(new RegExp(e).test(s.src))return void ue(o=s,(function(){return t()}))}}catch(e){a.e(e)}finally{a.f()}if(!o){var r=document.createElement("script");r.src=e,r.onload=function(){t(),r.onload=null},r.onerror=function(){return n()},document.body.appendChild(r)}}))},delayLoadCSS:function(e){if(!e)return Promise.reject();return new Promise((function(t,n){var i,o=null,a=v(document.querySelectorAll("link"));try{for(a.s();!(i=a.n()).done;){var s=i.value;if(new RegExp(e).test(s.href))return void ue(o=s,t)}}catch(e){a.e(e)}finally{a.f()}if(!o){var r=document.createElement("link");r.rel="stylesheet",r.href=e,r.onload=function(){t(),r.onload=null},r.onerror=function(){return n()},document.head.appendChild(r)}}))}};function ue(e,t){var n=e.onload;n?e.onload=function(){n(),t()}:t()}const he={props:{data:{type:Object,default:null},close:{type:Function,default:null}},data:function(){return{cropper:null,selectedRatio:"fixed",buttonEnable:!1}},computed:{src:function(){return this.data.src.split("?")[0]}},watch:{selectedRatio:function(e){var t="fixed"===e?this.data.ratio:e;this.cropper.setAspectRatio(t)}},mounted:function(){var e=this,t=this,n=this.$refs.image;n.setAttribute("crossOrigin","Anonymous");var i=[de.delayLoadCSS("//lib.eqh5.com/cropperjs/1.3.5/cropper.min.css"),de.delayLoadJS("//lib.eqh5.com/cropperjs/1.3.5/cropper.min.js")];Promise.all(i).then((function(){var i=e.data.rotateX?-1:1,o=e.data.rotateY?-1:1,a=e.data.type,s=e.data.ratio;e.cropper=new Cropper(n,{viewMode:2,dragMode:"move",aspectRatio:s,minContainerWidth:1,minContainerHeight:1,checkCrossOrigin:!1,guides:!1,center:!1,background:!1,movable:!1,zoomable:!1,toggleDragModeOnDblclick:!1,ready:function(){if(this.cropper.scaleX(o),this.cropper.scaleY(i),"background"===a){var e={},n=this.cropper.imageData,r=n.aspectRatio;s===r?(e.width=n.naturalWidth,e.height=n.naturalHeight):s<r?e.height=n.naturalHeight:s>r&&(e.width=n.naturalWidth),this.cropper.setData(e);var l=this.cropper.cropBoxData;s<r?this.cropper.setCropBoxData({left:(n.width-l.width)/2}):s>r&&this.cropper.setCropBoxData({top:(n.height-l.height)/2})}t.buttonEnable=!0}})})).catch((function(t){return t&&e.logger.error(t)}));var o=this.data.crop;o&&n.addEventListener("ready",(function(){this.cropper.setData({x:o.left,y:o.top,width:o.width,height:o.height})}))},methods:{cancel:function(){this.close(),this.cropper&&this.cropper.destroy()},ok:function(){if(this.buttonEnable&&this.cropper){var e=this,t=this.cropper.getData(!0),n=t.x,i=t.y,o=t.width,a=t.height,s=t.scaleX,r=t.scaleY,l=this.cropper.getImageData();n=-1===s?l.naturalWidth-n-o:n,i=-1===r?l.naturalHeight-i-a:i;var c=document.createElement("IMG");c.crossOrigin="Anonymous",c.src=this.src,c.onload=function(){var t=document.createElement("CANVAS");t.width=o,t.height=a,t.getContext("2d").drawImage(c,n,i,o,a,0,0,o,a);var l=t.toDataURL();e.close({selectedRatio:this.selectedRatio,crop:{left:n,top:i,width:o,height:a,scaleX:-1===s,scaleY:-1===r,imageData:l}})}}}}};var pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-image-crop dialog"},[n("div",{staticClass:"head"},[n("span",[e._v("图片裁切")]),e._v(" "),n("i",{staticClass:"close eqf-no",on:{click:e.cancel}})]),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"preview"},[n("div",{ref:"wrap",staticClass:"wrap"},[n("img",{ref:"image",attrs:{src:e.src,alt:""}})])])]),e._v(" "),e.data.hideOptions?e._e():n("div",{staticClass:"option"},[n("base-radio",{attrs:{id:"ratio_1",value:"fixed",name:"selectedRatio"},model:{value:e.selectedRatio,callback:function(t){e.selectedRatio=t},expression:"selectedRatio"}}),e._v(" "),n("label",{attrs:{for:"ratio_1"}},[e._v("固定比例")]),e._v(" "),n("base-radio",{attrs:{id:"ratio_2",value:"0",name:"selectedRatio"},model:{value:e.selectedRatio,callback:function(t){e.selectedRatio=t},expression:"selectedRatio"}}),e._v(" "),n("label",{attrs:{for:"ratio_2"}},[e._v("自由裁切")]),e._v(" "),n("base-radio",{attrs:{id:"ratio_3",value:"1",name:"selectedRatio"},model:{value:e.selectedRatio,callback:function(t){e.selectedRatio=t},expression:"selectedRatio"}}),e._v(" "),n("label",{attrs:{for:"ratio_3"}},[e._v("1:1")])],1),e._v(" "),n("div",{staticClass:"foot"},[n("base-button",{staticClass:"btn white h36",nativeOn:{click:function(t){return e.cancel(t)}}},[e._v("\n            取消\n        ")]),e._v(" "),n("base-button",{class:["btn","blue","h36","ok",e.buttonEnable?"":"disable"],nativeOn:{click:function(t){return e.ok(t)}}},[e._v("\n            确定\n        ")])],1)])};pe._withStripped=!0;const me=A({render:pe,staticRenderFns:[]},void 0,he,void 0,!1,void 0,!1,void 0,void 0,void 0);const ge={props:{data:{type:Object,default:null},close:{type:Function,default:null}},methods:{ok:function(){this.close({})}}};var fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-dialog-notice dialog"},[n("div",{staticClass:"content",domProps:{innerHTML:e._s(e.data.msg)}}),e._v(" "),n("div",{staticClass:"foot"},[n("base-button",{staticClass:"btn blue h36 ok",nativeOn:{click:function(t){return e.ok(t)}}},[e._v("\n            "+e._s(e.data.btnName||"确定")+"\n        ")])],1)])};fe._withStripped=!0;const ve=A({render:fe,staticRenderFns:[]},void 0,ge,void 0,!1,void 0,!1,void 0,void 0,void 0);function ye(){document.body.querySelectorAll(".eqc-dialog-base").forEach((function(e){return e.remove()}))}function xe(e){return e=Object.assign({component:null,data:null,params:{}},e),new Promise((function(t,n){var i=new(Vue.extend(ce))({components:{cDialog:e.component},propsData:{data:e.data,params:e.params},destroyed:function(){this.value?t(JSON.parse(JSON.stringify(this.value))):n()}}).$mount(),o=document.querySelector(".eqx-h2open");o?o.append(i.$el):document.body.appendChild(i.$el)}))}function be(e){return xe({component:me,data:e})}function we(e){return xe({component:ve,data:e})}function _e(e){return("0"+Number(e).toString(16)).slice(-2)}Vue.use((function(e){e.dialog=e.prototype.dialog={close:ye,openImageCrop:be,openNotice:we}})),Vue.filter("rgb2hex",(function(e,t){var n="";if(/#/.test(e))n=e;else if(/rgb/.test(e)){var i=/rgba?\((.*?)\)/.exec(e)[1].split(",");n="#".concat(_e(i[0])).concat(_e(i[1])).concat(_e(i[2]))}return t?n.toUpperCase():n}));var ke=8,Ee=46,Se=32,Ce=37,Be=38,Re=39,Le=40,$e=65,Ve=67,Fe=71,Te=76,ze=83,He=86,De=89,Ae=90,Oe=187,Pe=189,Me=function(e){s(i,e);var t=u(i);function i(){var e;return n(this,i),(e=t.call(this)).keydownEventHandler=null,e}return o(i,null,[{key:"bindKeydown",value:function(e,t,n){this.keydownEventHandler=function(t){var n=t.ctrlKey||t.metaKey,i=t.shiftKey;switch(t.keyCode){case ke:case Ee:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.delSelectedElements();break;case Se:if(Vue.elements.isTextEditing())break;t.preventDefault();break;case Ce:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:-1*(i?10:1),y:0});break;case Be:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:0,y:-1*(i?10:1)});break;case Re:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:1*(i?10:1),y:0});break;case Le:if(Vue.elements.isTextEditing())break;t.preventDefault(),Vue.drawingBoard.moveSelectedElements({x:0,y:1*(i?10:1)});break;case $e:if(Vue.elements.isTextEditing())break;n&&(t.preventDefault(),Vue.drawingBoard.selectAllElement());break;case Ve:if(Vue.elements.isTextEditing())break;n&&(Vue.store.commit("ELEMENT_COPY"),t.preventDefault());break;case Fe:n&&(t.preventDefault(),i?Vue.elements.unGroupSelected():Vue.elements.groupSelected());break;case Te:n&&t.preventDefault(),Vue.store.commit("HISTORY_BACK");break;case ze:n&&t.preventDefault();break;case He:if(Vue.elements.isTextEditing())break;n&&(Vue.store.commit("ELEMENT_PASTE"),t.preventDefault());break;case De:n&&(t.preventDefault(),Vue.store.commit("HISTORY_FORWORD"));break;case Ae:if(Vue.elements.isTextEditing())break;n&&(t.preventDefault(),Vue.store.commit("HISTORY_BACK"));break;case Pe:n&&(t.preventDefault(),Vue.store.commit("EDITOR_SCALE_CHANGE","-"));break;case Oe:n&&(t.preventDefault(),Vue.store.commit("EDITOR_SCALE_CHANGE","+"))}if([ke,Ee,Ce,Be,Re,Le,Fe,Te,He,Pe,Oe].includes(t.keyCode)){e.addEventListener("keyup",(function t(n){e.removeEventListener("keyup",t)}))}},e.addEventListener("keydown",this.keydownEventHandler)}},{key:"unbindKeydown",value:function(e,t,n){e.removeEventListener("keydown",this.keydownEventHandler)}}]),i}(function(){function e(){n(this,e),console.log("directive")}return o(e,[{key:"record",value:function(){}}]),e}()),Je={bind:function(e,t,n){"editor"===t.arg&&Me.bindKeydown(e,t,n)},unbind:function(e,t,n){"editor"===t.arg&&Me.unbindKeydown(e,t,n)}},Ie=function(){function e(t,i){n(this,e),this.options=Object.assign({onScrollMove:function(){},onScrollEnd:function(){}},i),this.wrap=t,this.ul=t.children[0],this.scroll=null,this.scrollBarHeight=0,this.scrollY=0,this.maxScrollY=0,this.ratioY=0,this.timeoutId=0,this.inMouseDown=!1,this.dragStartY=0,this.initScroll()}return o(e,[{key:"initScroll",value:function(){var e=this.scroll=document.createElement("div");Object.assign(e.style,{position:"absolute",right:"2px",top:"0",width:"8px",background:"rgba(0,0,0,.4)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",transition:"background .3s"}),this.wrap.appendChild(e),this.wrap.onwheel=this.wheelHandler.bind(this),this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),e.onmouseover=this.mouseoverHandler.bind(this),e.onmouseleave=this.mouseleaveHandler.bind(this),e.onmousedown=this.mousedownHandler.bind(this),this.mousemoveHandler=this.mousemoveHandler.bind(this),this.mouseupHandler=this.mouseupHandler.bind(this)}},{key:"wheelHandler",value:function(e){var t=this;this.scrollMove(e),this.options.onScrollMove(e,{maxScrollY:this.maxScrollY,scrollY:this.scrollY}),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.options.onScrollEnd(e,{maxScrollY:t.maxScrollY,scrollY:t.scrollY})}),300)}},{key:"resizeHandler",value:function(){var e=this;clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){e.refresh()}),300)}},{key:"scrollMove",value:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();var t=e.deltaY;e.deltaMode&&1===e.deltaMode&&(t=30*e.deltaY),this.scrollY+=t,this.scrollY>=this.maxScrollY&&(this.scrollY=this.maxScrollY),this.scrollY<=0&&(this.scrollY=0),this.ul.style.transform="translate3d(0,".concat(-this.scrollY,"px,0)"),this.scroll.style.transform="translate3d(0,".concat(Math.floor(this.scrollY*this.ratioY),"px,0)")}},{key:"refresh",value:function(){var e=this.wrap.offsetHeight||1,t=this.ul.offsetHeight||1;this.maxScrollY=t-e,this.ratioY=e/t,this.ratioY<1?(this.scrollBarHeight=Math.floor(this.ratioY*e),Object.assign(this.scroll.style,{height:this.scrollBarHeight+"px",display:"block"}),this.scrollMove({deltaY:0}),this.wrap.onwheel=this.wheelHandler.bind(this)):(Object.assign(this.scroll.style,{display:"none"}),this.scrollMove({deltaY:-this.maxScrollY/this.ratioY}),this.wrap.onwheel=null)}},{key:"scrollTo",value:function(e){e.x;var t=e.y;this.refresh(),t/=this.ratioY,this.scrollMove({deltaY:t})}},{key:"scrollToTop",value:function(){this.scrollTo({y:-this.maxScrollY})}},{key:"scrollToBottom",value:function(){this.scrollTo({y:this.maxScrollY})}},{key:"setScrollSelected",value:function(e){var t=e?{background:"rgba(0,0,0,.5)"}:{background:"rgba(0,0,0,.4)"};Object.assign(this.scroll.style,t)}},{key:"mouseoverHandler",value:function(){this.setScrollSelected(!0)}},{key:"mouseleaveHandler",value:function(){this.inMouseDown||this.setScrollSelected(!1)}},{key:"mousedownHandler",value:function(e){var t=document;t.addEventListener("mousemove",this.mousemoveHandler),t.addEventListener("mouseup",this.mouseupHandler),t.addEventListener("mouseleave",this.mouseupHandler),this.dragStartY=e.clientY,this.inMouseDown=!0,this.setScrollSelected(!0)}},{key:"mousemoveHandler",value:function(e){e.preventDefault();var t=e.clientY,n=(t-this.dragStartY)/this.ratioY;this.dragStartY=t;var i=Object.assign({},e,{deltaY:n});this.scrollMove(i),this.options.onScrollMove(e,{maxScrollY:this.maxScrollY,scrollY:this.scrollY})}},{key:"mouseupHandler",value:function(e){var t=this,n=document;n.removeEventListener("mousemove",this.mousemoveHandler),n.removeEventListener("mouseup",this.mouseupHandler),n.removeEventListener("mouseleave",this.mouseupHandler),this.inMouseDown=!1,this.setScrollSelected(!1),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.options.onScrollEnd(e,{maxScrollY:t.maxScrollY,scrollY:t.scrollY})}),300)}},{key:"destroy",value:function(){this.wrap.onwheel=null,this.scroll.onmouseover=null,this.scroll.onmouseleave=null,this.scroll.onmousedown=null,window.removeEventListener("resize",this.resizeHandler)}}]),e}(),Ne={bind:function(e){e.style.overflow="hidden";e.myScroll=new Ie(e,{}),Vue.nextTick((function(){return e.myScroll.refresh()}))},componentUpdated:function(e){Vue.nextTick((function(){return e.myScroll.refresh()}))},unbind:function(e){e.myScroll.destroy(),e.myScroll=null,delete e.myScroll}};Vue.directive("keymap",Je),Vue.directive("scrollBar",Ne);var Ge="ELEMENT_SELECT",qe="SET_BACKGROUND",Ye="HISTORY_SET",je="HISTORY_BACK",We="HISTORY_FORWORD",Ue="CACHE_IMAGE",Xe="CLEAR_CACHE_IMAGE",Ke="FONT_LIST_INIT",Ze="FONT_SELECTED",Qe="FONT_LAYER",et="OPEN_LOADING_CHANGE",tt="EDITOR_CONFIG_CHANGE",nt="ELEMENT_COPY",it="ELEMENT_PASTE",ot="EDITOR_SCALE_CHANGE";function at(e){var t=e.scale,n=e.getSelected(),i=[];n.forEach((function(e){i.push({id:e.elementJson.id,x:e.elementJson.css.x,y:e.elementJson.css.y})}));var o=event.pageX,a=event.pageY,s={x:0,y:0,left:0,top:0},r=Vue.elementsBoxs.getSelectedElementBoxEditPosition(),l=Vue.guideLine;l.start(s),n.forEach((function(e){l.setBigRectStart(e)}));var c=!1,d=function(e){s.left=e.pageX-o,s.top=e.pageY-a,l.setBigRect(),l.clearGuideLine(),l.showGuideLine(),n.forEach((function(e,n){var o=i.filter((function(t){return t.id===e.elementJson.id}))[0];e.move({x:parseFloat(s.left/t),y:parseFloat(s.top/t)},{x:parseFloat(o.x),y:parseFloat(o.y)}),e.setCssIsUpdate(!1),e.setPropertyIsUpdate(!1)})),c||(r=Vue.elementsBoxs.getSelectedElementBoxEditPosition()),Vue.elementsBoxs.moveSelectedElementBoxEdit({x:parseFloat(s.left),y:parseFloat(s.top)},r),Vue.elementsBoxs.setElementBoxEditMoving(!0),Vue.elementsBoxs.setSelectedElementControlBarVisible(!1),n.length>1&&(Vue.elementsBoxs.setHoverElement(n),Vue.elementsBoxs.setElementsGroupVisible(!1)),c=!0};document.addEventListener("mousemove",d),document.addEventListener("mouseup",(function e(i){if(l.clearGuideLine(),Vue.elementsBoxs.setElementBoxEditMoving(!1),Vue.elementsBoxs.setSelectedElementControlBarVisible(!0),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e),c){if(n.length>1&&c){var o=Vue.elements.getElementsGroup(n);o.length>0&&(Vue.elements.moveSelectedElementGroups(o,{x:s.left/t,y:s.top/t}),Vue.elements.getFirstGroupElementCount()!==n.length?(Vue.elementsBoxs.setGroupElement(n),Vue.elementsBoxs.setElementsGroupVisible(!0)):Vue.elementsBoxs.setElementsGroupVisible(!1))}n.forEach((function(e){e.setCssIsUpdate(!0),e.setPropertyIsUpdate(!0)})),Vue.operatRecord.addRecord(),c=!1}}))}var st="100",rt="101",lt="102",ct="103",dt="104",ut="105",ht="106",pt="107",mt="108",gt="109",ft="110",vt="111",yt="112",xt="113",bt="114",wt="115",_t="116",kt="117",Et="118",St="119",Ct="120",Bt="default",Rt="move",Lt="",$t={text:101,image:102,qrcode:103,shape:104,frame:105,date:107,gif:108,textThreeD:113,table:114,puzzle:115,chart:116};function Vt(e,t,n,i,o){var a=this;return new Promise((function(s,r){if(a.selectBox.updateCss({display:"none"}),e&&t.length>0){1===t.length&&Vue.elementsBoxs.clearHoverElement(),Vue.elements.setSelected(t),Vue.elementsBoxs.setSelectedElement(t);var l=t.length>1&&Vue.elements.searchGroupIndex(t)>=0;Vue.elementsBoxs.setElementBoxEditIsGroup(l),Vue.elementsBoxs.setSelectedElementBoxEditBind();var c=Vue.elementsBoxs.getGroupElement();(0===c.length||1===c.length&&Vue.elements.getFirstGroupElementCount()===Vue.elements.getSelected().length)&&Vue.elementsBoxs.clearGroupElement()}document.removeEventListener("selectstart",n),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o),s()}))}function Ft(e,t){var n=this;return new Promise((function(i,o){if((t.focus(),Vue.elementsBoxs.resetBoxEdit(),Vue.elementsBoxs.getElementBoxEditVisible())&&Vue.elementsBoxs.calcPointInElementBoxEdit({x:e.pageX,y:e.pageY}))return void at(Vue.elements);new Promise((function(e,t){var n=Vue.elements.getSelected(),i=Vue.elementBoxEdit.getElementList();if(n.length>1&&1===i.length&&i[0].elementJson.type===$t.text&&null!==Vue.elements.getElementTopGroup(i[0])&&Object.prototype.hasOwnProperty.call(i[0],"initHeight")){var o=i[0].getBoxSize().height,a=i[0].initHeight;o&&a&&o!==a?Vue.elements.updateElementGroup(i[0]).then((function(){e()})):e()}else e()})).then((function(){Vue.elements.openSettingListener(),Vue.elements.clearSelected(),Vue.elementsBoxs.clearSelected(),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement();var o={x0:e.pageX,y0:e.pageY},a=t.getBoundingClientRect(),s=a.left,r=a.top,l=function(e){return e.preventDefault()},c=[],d=!1;Vue.store.commit("ELEMENT_SELECT",{eqxElements:[]}),Vue.store.commit("FONT_LAYER",{show:!1});var u=function(e){d=!0,o.x1=e.pageX,o.y1=e.pageY;var t=function(e,t,n){var i={left:e.x0-t,top:e.y0-n};i.width=e.x1-e.x0,i.height=e.y1-e.y0,e.x1<e.x0&&(i.left=e.x1-t,i.width=-i.width);e.y1<e.y0&&(i.top=e.y1-n,i.height=-i.height);return i}(o,s,r);n.selectBox.updateCss({display:"block",left:t.left+"px",top:t.top+"px",width:t.width+"px",height:t.height+"px",border:"1px solid #1593ff"});var i=Tt.call(n);if(c=function(e,t){var n=[];return e.filter((function(e){H.rectIsOverlap({x:e.x,y:e.y,width:e.width,height:e.height,x1:e.x1,y1:e.y1,width1:e.width1,height1:e.height1,rotate:e.rotate},{x:t.left,y:t.top,width:t.width,height:t.height,rotate:0})?(e.element.setSelected(!0),n.push(e.element)):e.element.setSelected(!1)})),n}(i,t),Vue.elementsBoxs.clearGroupElement(),c.length>0){var a=[];c.forEach((function(e){var t=Vue.elements.getAllElementByElementInGroup(e);a=a.concat(t)}));var l=[],u={};a.forEach((function(e){u[e.elementJson.id]||(l.push(e),u[e.elementJson.id]=!0)})),c=l,Vue.elementsBoxs.setHoverElement(c),Vue.elementsBoxs.setGroupElement(c)}else Vue.elementsBoxs.clearHoverElement()},h=function e(t){Vt.call(n,d,c,l,u,e)};document.addEventListener("selectstart",l),document.addEventListener("mousemove",u),document.addEventListener("mouseup",h),i([d,c,l,u,h])}))}))}function Tt(){var e=this.$el.getBoundingClientRect().left,t=this.$el.getBoundingClientRect().top,n=Vue.drawingBoard.$el.getBoundingClientRect().left,i=Vue.drawingBoard.$el.getBoundingClientRect().top;return Vue.elements.elementList.map((function(o){var a=o.$el.getBoundingClientRect();return{element:o,x:o.elementJson.css.x*Vue.elements.scale+n-e,y:o.elementJson.css.y*Vue.elements.scale+i-t,width:o.getBoxSize().width*Vue.elements.scale,height:o.getBoxSize().height*Vue.elements.scale,rotate:o.elementJson.css.rotate,x1:a.x-e,y1:a.y-t,width1:a.width,height1:a.height}}))}function zt(e){var t=this;this.$el.addEventListener("mousedown",(function(n){if(n.stopPropagation(),t.allowEvent(vt)){var i=e.getSelected();if(i.filter((function(e){return e.elementJson.type===$t.text&&e.isEditing})).length>0)Ft.call(Vue.editor,{pageX:1e4,pageY:1e4},Vue.editor.$el).then((function(e){var t=p(e,5),n=t[0],i=t[1],o=t[2],a=t[3],s=t[4];Vt.call(Vue.editor,n,i,o,a,s)}));else{Vue.elementsBoxs.resetBoxEdit();var o=e.getElementInSelectedById(t.elementJson.id);if(i.length<=0||!o){var a=Vue.elements.getAllElementByElementInGroup(t);if(a.length>1)e.clearSelected(),e.setSelected(a),Vue.elementsBoxs.setHoverElement(a),Vue.elementsBoxs.clearGroupElement(),Vue.elements.getFirstGroupElementCount()!==a.length&&Vue.elementsBoxs.setGroupElement(a),Vue.elementsBoxs.clearSelected().then((function(){Vue.elementsBoxs.setSelectedElement(a),Vue.elementsBoxs.setElementBoxEditIsGroup(!0),Vue.elementsBoxs.setSelectedElementBoxEditBind()}));else{var s=t.getSelected();e.clearSelected(),t.setSelected(),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement(),Vue.store.commit("ELEMENT_SELECT",{eqxElements:e.getSelectedElements()}),s||Vue.elementsBoxs.clearSelected().then((function(){Vue.elementsBoxs.setSelectedElement([t]),Vue.elementsBoxs.setElementBoxEditIsGroup(!1),Vue.elementsBoxs.setSelectedElementControlBarVisible(!0),Vue.elementsBoxs.setSelectedElementBoxEditBind()}))}t.setCursor(Rt)}at(e)}}}))}function Ht(e){var t=this,n=this.$el;n.addEventListener("mouseenter",(function(){Dt()||(t.getSelected()?t.setCursor(Rt):(t.setCursor(Bt),Vue.elementsBoxs.addHoverElement(t)))})),n.addEventListener("mouseleave",(function(){Dt()||(t.getSelected()?t.setCursor(Lt):Vue.elementsBoxs.delHoverElement(t))}))}function Dt(e){return Vue.elementsBoxs.getElementBoxEditMoving()||Vue.elementsBoxs.getElementBoxEditRotating()||Vue.elementsBoxs.getElementBoxEditResizing()}var At=function(){function e(t){n(this,e),t.id?this.elementJson=t:this.elementJson={id:null,type:null,css:{zIndex:null,width:t.width||100,height:t.height||100,x:t.x||0,y:t.y||0,opacity:t.opacity||1,display:t.display||"block",rotate:t.rotate||0,position:"absolute",transform:"rotateZ(0deg)",isUpdate:!0},property:{lock:!1,isUpdate:!0}},this.elementResizeType=null,this.elementScale=null,this.selected=!1,this.isPrepare=!0,this.state=!0,this.$el=null}return o(e,[{key:"render",value:function(){this.$el=document.createElement("div")}},{key:"bind",value:function(e){zt.call(this,e),Ht.call(this,e)}},{key:"updateId",value:function(e){Object.assign(this.elementJson,{id:e})}},{key:"updateCss",value:function(e){var t=e.x,n=e.y,i=e.rotate,o=e.zIndex,a=e.opacity,s=e.position;(t||n||i||o||a||s)&&(t=t||this.elementJson.css.x,n=n||this.elementJson.css.y,i=i||this.elementJson.css.rotate,o=o||this.elementJson.css.zIndex,a=a||this.elementJson.css.opacity,s=s||this.elementJson.css.position,this.$el.css({transform:"translate(".concat(t,"px,").concat(n,"px) rotate(").concat(i,"deg)"),zIndex:o,opacity:a,position:s})),Object.assign(this.elementJson.css,e)}},{key:"updateProperty",value:function(e){var t=this.elementJson.property;for(var n in Object.assign(t,e),t)void 0===t[n]&&delete t[n]}},{key:"setScale",value:function(e){this.elementScale=e}},{key:"setSelected",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.selected=e}},{key:"getSelected",value:function(){return this.selected}},{key:"allowEvent",value:function(e){switch(e){case st:case rt:case lt:case ct:case dt:case ut:case ht:case pt:case mt:case gt:case ft:case vt:case yt:case xt:case bt:case wt:case _t:case kt:case Et:case St:case Ct:default:return!0}}},{key:"setCursor",value:function(e){this.$el.css({cursor:e})}},{key:"getBoxSize",value:function(){var e=this.elementJson.css,t=e.width,n=e.height;return{width:parseFloat(t),height:parseFloat(n)}}},{key:"getResizeBoxHeight",value:function(e){return{height:this.elementJson.css.height}}},{key:"getResizeMinSize",value:function(){var e=this.elementJson.css;return{width:e.width,height:e.height}}},{key:"resizeUpdateCss",value:function(e,t){this.updateCss(e)}},{key:"resizeInitDataStore",value:function(){}},{key:"settingUpdateCss",value:function(e){}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e)}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t={x:this.elementJson.css.x,y:this.elementJson.css.y}),this.updateCss({x:t.x+e.x,y:t.y+e.y})}},{key:"destroy",value:function(){this.$el.remove()}},{key:"setCssIsUpdate",value:function(e){this.elementJson.css.isUpdate=e}},{key:"setPropertyIsUpdate",value:function(e){this.elementJson.property.isUpdate=e}}]),e}(),Ot={image:7,text:5,reverseText:6,combine:4,textThreeD:4},Pt=function(e){return(1|e)===e},Mt=function(e){return(2|e)===e},Jt=function(e){return(4|e)===e},It={noResize:0,vertexLeftTop:1,vertexRightTop:2,vertexRightBottom:4,vertexLeftBottom:8,lineTop:16,lineRight:32,lineBottom:64,lineLeft:128},Nt={line:0,vertex:1};function Gt(e){var t=this,n=this.$el;n.addEventListener("dblclick",(function(e){if(e.stopPropagation(),!t.isEditing){var i=t.getBoxSize().height;t.initHeight=i;var o="vertical-lr"===t.elementJson.css.writingMode;t.isEditing=!0,t.hideSVG(!0),t.editBox.show(t);var a=Vue.elementBoxEdit;if(1===Vue.elements.getSelected().length){var s=qt.call(t,Vue.elementBoxEdit);Vue.elementBoxEdit.setResizing(s)}else Vue.elementsBoxs.setSelectedElement([t]),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement(),Vue.elementBoxEdit.$vm.$nextTick((function(){var e=qt.call(t,Vue.elementBoxEdit);Vue.elementBoxEdit.setResizing(e)}));Vue.elementBoxEdit.setControlSizeBarVisible(!1),Vue.elementBoxEdit.setControlRotateBarVisible(!1),t.setCssIsUpdate(!1),t.setPropertyIsUpdate(!1);n.oninput=function(){var e,n,i,s,r;e=a,n=t.editBox.$el,i=n.offsetHeight,s=n.offsetWidth,r=e.scale,o?(t.updateSVGData({svgWidth:s}),e.updateCss({width:s*r})):(t.updateSVGData({svgHeight:i}),e.updateCss({height:i*r})),e.$vm.$nextTick((function(){var n=e.$vm.$el.parentElement.parentElement.getBoundingClientRect(),i=e.$vm.$refs.boxEditMask.getBoundingClientRect(),o=i.x-n.x,a=i.y-n.y;i.width,i.height,t.updateCss({x:o/r,y:a/r})}))}}}))}function qt(e){return function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),o=null,a=null;"left top",o=e.lt.x,a=e.lt.y,n%90!=0?(o=o-i.x+1,a=a-i.y+1):(o+=1,a+=1);return{transformOrigin:"left top",x:o,y:a}}(function(e){var t=e.$vm.$data.dataJson.x-1,n=e.$vm.$data.dataJson.y-1,i=e.$vm.$data.dataJson.rotate,o=e.$vm.$data.dataJson.width+2,a=e.$vm.$data.dataJson.height+2,s=null;if(i%90==0&&o===a||i%180==0)s={rotate:0,x:t,y:n,width:o,height:a};else if(90===i||270===i){var r=0,l=0,c=0,d=0;if(o>a){var u=t+(o-a)/2;r=r>u||0===r?u:r;var h=n-(o-a)/2;l=l>h||0===l?h:l;var p=u+a;c=c<p?p:c;var m=h+o;d=d<m?m:d}else if(o<a){var g=t-(a-o)/2;r=r>g||0===r?g:r;var f=n+(a-o)/2;l=l>f||0===l?f:l;var v=g+a;c=c<v?v:c;var y=f+o;d=d<y?y:d}s={rotate:0,x:r,y:l,width:c-r,height:d-l}}else{var x=e.$vm.$el.getBoundingClientRect();s={x:"",y:"",width:o,height:a,rotate:i,x1:x.x,y1:x.y,width1:x.width,height1:x.height}}var b=H.getVertex(s);if(90===i)return{lt:b.rt,rt:b.rb,rb:b.lb,lb:b.lt};if(180===i)return{lt:b.rb,rt:b.lb,rb:b.lt,lb:b.rt};if(270===i)return{lt:b.lb,rt:b.lt,rb:b.rt,lb:b.rb};return b}(e),It.lineBottom,this.elementJson.css.rotate)}var Yt=function(){function e(){n(this,e),this.dataJson={visible:!1,width:0,height:0,x:0,y:0},this.$el=null,this.render()}return o(e,[{key:"render",value:function(){(this.$el=document.createElement("div")).css({display:"none"}).attr({contenteditable:!0})}},{key:"updateCss",value:function(e){this.$el.removeAttr("style"),this.$el.css(e)}},{key:"updateContent",value:function(e){this.$el.innerHTML=e}},{key:"remove",value:function(){this.updateCss({display:"none"}),this.updateContent("")}},{key:"show",value:function(e){var t=e.elementJson,n=t.svgData,i=t.css,o=t.property,a=parseFloat(n.svgWidth),s=parseFloat(n.svgHeight),r=parseFloat(i.padding),l=parseFloat(i.letterSpacing),c=parseFloat(i.fontSize),d=n.totalLineCount,u="vertical-lr"===i.writingMode,h=u?a:s,p=o.borderRadius,m=0;if(p){var g=parseInt(p.val)+"px",f=p.lt?g:"0px",v=p.rt?g:"0px",y=p.lb?g:"0px",x=p.rb?g:"0px";m="".concat(f," ").concat(v," ").concat(x," ").concat(y)}var b,w=Object.assign({},i,{position:"absolute",display:"block",width:u?"auto":a+l+"px",height:u?s+l+"px":"auto",lineHeight:(h-2*r)/d+"px",cursor:"text",padding:r+"px",letterSpacing:l+"px",fontSize:c+"px",borderRadius:m,left:0,top:0,x:"",y:"",opacity:"",rotate:"",zIndex:""});this.updateCss(w),this.updateContent(o.content),b=this.$el,setTimeout((function(){if(getSelection&&document.createRange){var e=document.createRange();e.selectNodeContents(b),e.collapse(!0),e.setEnd(b,b.childNodes.length),e.setStart(b,0);var t=getSelection();t.removeAllRanges(),t.addRange(e)}else if(document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(b),n.collapse(!0),n.select()}b.focus()}),1)}}]),e}();var jt={text:0,shadow:1,gradient:2,cube:3,stroke:4,shake:5,chartlet:6},Wt=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),(o=t.call(this,e)).elementResizeType=Ot.text,e.id||(o.elementJson.type=$t.text,o.elementJson.property=Object.assign({},o.elementJson.property,o.setDefaultProperty(e)),o.elementJson.css=Object.assign({},o.elementJson.css,o.setDefaultCss(e)),o.elementJson.svgData=Object.assign({},o.setDefaultSVGData())),o.$svg=null,o.isEditing=!1,o.textRects=[],o.editBox=null,o.isPrepare=!1,o}return o(i,[{key:"allowEvent",value:function(e){switch(h(r(i.prototype),"allowEvent",this).call(this,e),e){case vt:return!this.isEditing;default:return!0}}},{key:"createFontFace",value:function(){var e=this.elementJson,t=e.css,n=e.property;if(n.fontFamily&&n.src&&""!==t.fontFamily&&""!==n.src&&!document.querySelector("#"+t.fontFamily)){var i=document.createElement("style");i.id=t.fontFamily,i.innerHTML='@font-face{font-family: "'.concat(t.fontFamily,'";src: url(').concat(n.src,') format("woff")}\r\n'),document.head.appendChild(i)}}},{key:"updateId",value:function(e){h(r(i.prototype),"updateId",this).call(this,e),this.elementJson.id=e}},{key:"updateCss",value:function(e){h(r(i.prototype),"updateCss",this).call(this,e)}},{key:"updateProperty",value:function(e){h(r(i.prototype),"updateProperty",this).call(this,e);var t=e.type,n=e.dropShadow,o=e.stroke,a=e.cube,s=e.angle,l=e.borderRadius,c=e.gradient,d=e.backgroundImage,u=e.shake;if(n){var p=i.dropShadow(n);this.setDropShaow(p)}if(o&&this.setStroke(o),a&&s){var m=i.cube(a,s);this.setCube(m)}if(l&&this.setbgBorderRadius(l),c&&t===jt.gradient&&this.setGradientDeriction(c),d&&t===jt.chartlet&&this.setChartlet(d),u&&s&&t===jt.shake){var g=i.shake(u,s);this.setShake(g)}}},{key:"updateSVGData",value:function(e){Object.assign(this.elementJson.svgData,e)}},{key:"render",value:function(){h(r(i.prototype),"render",this).call(this);var e=this.$svg=document.createElementNS("http://www.w3.org/2000/svg","svg");e.css({overflow:"visible",display:"block"}).attr({"xml:space":"preserve","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"}),e.innerHTML=this.initSvgHtml(),this.createFontFace(),this.$el.appendChild(e),this.measureText(),this.editBox=new Yt,this.$el.appendChild(this.editBox.$el),this.isPrepare=!0}},{key:"getChartletDef",value:function(e,t){return'<defs>\n            <pattern\n                id="pattern_'.concat(e,'"\n                x="0"\n                y="0"\n                viewBox="0 0 ').concat(t.width," ").concat(t.height,'"\n                width="').concat(t.width,'"\n                height="').concat(t.height,'"\n                patternUnits="userSpaceOnUse"\n            >\n                <image\n                    xlink:href="').concat(t.src,'"\n                    x="').concat(t.x,'"\n                    y="').concat(t.y,'"\n                    width="').concat(t.size,'"\n                    height="').concat(t.size,'"\n                />\n            </pattern>\n        </defs>')}},{key:"getGradientDef",value:function(e,t,n){return'<defs>\n        <linearGradient\n               id="gradient_'.concat(e,'"\n               x1="').concat(t.x1,'"\n               y1="').concat(t.y1,'"\n               x2="').concat(t.x2,'"\n               y2="').concat(t.y2,'"\n           >\n               <stop\n                   stop-color="').concat(n[0],'"\n                   offset="0%"\n                   stop-opacity="1"\n               />\n               <stop\n                   stop-color="').concat(n[1],'"\n                   offset="100%"\n                   stop-opacity="1"\n               />\n           </linearGradient>\n       </defs>')}},{key:"getShadowDef",value:function(e,t,n){return'<defs>\n            <filter\n                id="shadow_'.concat(e,'"\n                filterUnits="userSpaceOnUse"\n                x="').concat(t.x,'"\n                y="').concat(t.y,'"\n                width="').concat(t.width,'"\n                height="').concat(t.height,'"\n            >\n                <feGaussianBlur\n                    in="SourceAlpha"\n                    stdDeviation="').concat(n.blur,'"\n                    result="blur"\n                />\n                <feOffset\n                    in="blur"\n                    dx="').concat(n.x,'"\n                    dy="').concat(n.y,'"\n                    result="offsetBlur"\n                />\n                <feFlood\n                    flood-color="').concat(n.color,'"\n                    flood-opacity="').concat(1-n.transparency/100,'"\n                />\n                <feComposite\n                    in2="offsetBlur"\n                    operator="in"\n                />\n                <feMerge>\n                    <feMergeNode />\n                    <feMergeNode in="SourceGraphic" />\n                </feMerge>\n            </filter>\n        </defs>')}},{key:"getBorderRadiusDef",value:function(e,t){return""===t.path?"":'<defs>\n        <clipPath id="bgBorderRadius_'.concat(e,'">\n            <path d="').concat(t.path,'"/>\n        </clipPath>\n    </defs>')}},{key:"getHiddenTexts",value:function(e){for(var t=parseFloat(this.elementJson.css.fontSize),n='<g id="hiddenTexts" opacity="0">',i=0;i<e.length;i++)for(var o=e[i],a=0;a<o.length;a++)n+='<text\n                    class="hide-text"\n                    data-line="'.concat(i,'"\n                    alignment-baseline="auto"\n                    font-size="').concat(t,'"\n                    dominant-baseline="text-before-edge"\n                    x="0"\n                    y="0"\n                >').concat(o[a],"</text>");return n+="</g>"}},{key:"getTextsHtml",value:function(){var e=this.elementJson.svgData.list,t="";if(e)for(var n=0;n<e.length;n++){var i=e[n];t+='<text\n                    dominant-baseline="text-before-edge"\n                    font-size="'.concat(i.size,'"\n                    x="').concat(i.x,'"\n                    y="').concat(i.y,'"\n                >').concat(i.text,"</text>")}return t}},{key:"getBgRect",value:function(e,t){return'<g style="clip-path:url(#bgBorderRadius_'.concat(e,')">\n            <rect\n                x="0"\n                y="0"\n                width="100%"\n                height="100%"\n                fill="').concat(t,'"\n            />\n        </g>')}},{key:"getCubeG",value:function(e,t,n,i){for(var o="",a=this.getTextsHtml(),s=0;s<t.length;s++){var r=t[s],l=n+i+"fill:".concat(r.color,";stroke:").concat(r.color,";stroke-width:10;");o+='\n                <g\n                    filter="'.concat(0===s?"url(#shadow_"+e+")":"",'"\n                    transform = "translate(0 0) translate(').concat(r.x," ").concat(r.y,')"\n                    style="').concat(l,'"\n                >\n                ').concat(a,"\n            </g > ")}return o}},{key:"getShakeG",value:function(e,t,n,i){for(var o="",a=this.getTextsHtml(),s=0;s<t.length;s++){var r=t[s],l=n+i+"fill:".concat(r.color,";stroke:").concat(r.color,";stroke-width:1;");o+='\n                <g\n                    filter="'.concat(0===s?"url(#shadow_"+e+")":"",'"\n                    transform = "translate(0 0) translate(').concat(r.x," ").concat(r.y,')"\n                    style = "').concat(l,'"\n                >\n                ').concat(a,"\n            </g > ")}return o}},{key:"getFill",value:function(e){var t=this.elementJson.property.type,n=this.elementJson.css.color;return t===jt.gradient?n="url(#gradient_".concat(e,")"):t===jt.chartlet&&(n="url(#pattern_".concat(e,")")),n}},{key:"getStrokeG",value:function(e,t,n,i,o){for(var a="",s=this.getTextsHtml(),r=this.getFill(e),l=0;l<2;l++){var c=0===l?t.color:"#ffffff",d=0===l?t.size:t.distance,u=o?"url(#shadow_".concat(e,")"):"",h=n+i+"fill:".concat(r,";stroke:").concat(c,";stroke-width:").concat(d,";");a+='\n                <g\n                    filter="'.concat(0===l?u:"",'"\n                    style="').concat(h,'"\n                >\n                ').concat(s,"\n            </g > ")}return a}},{key:"getSvgText",value:function(e,t,n){var i=n?"url(#shadow_".concat(e,")"):"",o=this.getTextsHtml(),a=this.getFill(e);return'<g\n            filter="'.concat(i,'"\n            style="fill:').concat(a,";").concat(t,'"\n        >\n            ').concat(o,"\n        </g>")}},{key:"getSvgLine",value:function(e){var t="",n=this.elementJson.svgData,i=n.lines,o=n.lineSize;if(i&&o&&parseFloat(this.elementJson.css.fontSize)>0){t='<g stroke-linecap="butt">';for(var a=this.getFill(e),s=0;s<i.length;s++){var r=i[s];t+=' <line\n                x1="'.concat(r.x1,'"\n                y1="').concat(r.y1,'"\n                x2="').concat(r.x2,'"\n                y2="').concat(r.y2,'"\n                style="stroke:').concat(a,";stroke-width:").concat(o,';" />')}t+="</g>"}return t}},{key:"initSvgHtml",value:function(){var e=this.elementJson.svgData.texts;return this.getHiddenTexts(e)}},{key:"getInnerHtml",value:function(){var e="",t=this.elementJson.id;if(!t)return e;var n=this.elementJson.svgData,i=n.chartlet,o=n.gradientDer,a=n.filter,s=n.bgRadius,r=n.svgShake,l=n.svgCube,c=n.svgStroke,d=n.texts,u=this.elementJson.property,h=u.type,p=u.gradient,m=u.dropShadow,g=this.elementJson.css,f=g.fontFamily,v=g.fontWeight,y=g.fontStyle,x=g.backgroundColor,b="font-family:".concat(f,";font-weight:").concat(v,";font-style:").concat(y,";"),w="stroke-miterlimit: 10;stroke-linejoin: round;stroke-linecap: butt;stroke-dasharray: 0, 0;",_=1-m.transparency/100>0,k=c.size>0,E=l.length>0;return e=(h===jt.chartlet&&i?this.getChartletDef(t,i):"")+(h===jt.gradient&&o&&p?this.getGradientDef(t,o,p.colors):"")+(_&&a&&m?this.getShadowDef(t,a,m):"")+(s&&""!==s.path?this.getBorderRadiusDef(t,s):"")+(d?this.getHiddenTexts(d):"")+(x?this.getBgRect(t,x):"")+(l?this.getCubeG(t,l,b,w):"")+(r?this.getShakeG(t,r,b,w):"")+(c?this.getStrokeG(t,c,b,w,_&&!E):"")+this.getSvgText(t,b,!E&&!k&&_)+this.getSvgLine(t)}},{key:"updateSvgHeader",value:function(){if(this.$svg){var e=this.elementJson.svgData,t=e.visible,n=e.svgWidth,i=e.svgHeight,o=e.resizeWidth,a=e.resizeHeight;this.$svg.css({overflow:"visible",display:"block",opacity:t?1:0}).attr({width:o?parseFloat(o):parseFloat(n),height:a?parseFloat(a):parseFloat(i),viewBox:"0 0 ".concat(parseFloat(n)," ").concat(parseFloat(i))})}}},{key:"updateSvgInnerHtml",value:function(){this.$svg&&(this.$svg.innerHTML=this.getInnerHtml())}},{key:"updateSvgContent",value:function(){this.$svg&&(this.$svg.innerHTML=this.initSvgHtml())}},{key:"updateSvg",value:function(){this.updateSvgHeader(),this.updateSvgInnerHtml()}},{key:"bind",value:function(e){h(r(i.prototype),"bind",this).call(this,e),Gt.call(this,e)}},{key:"setDefaultCss",value:function(e){return{fontFamily:e.fontFamily||"inherit",fontSize:e.fontSize||"14px",fontWeight:e.fontWeight||"normal",fontStyle:e.fontStyle||"normal",letterSpacing:e.letterSpacing||"0",lineHeight:e.lineHeight||"1",color:e.color||"rgba(0,0,0,1)",padding:e.padding||"12px",backgroundColor:e.backgroundColor||"transparent",textAlign:e.textAlign||"center",writingMode:e.writingMode||"lr",textDecoration:e.textDecoration||"",wordWrap:"break-word",wordBreak:"break-all"}}},{key:"setDefaultProperty",value:function(e){return{type:jt.text,content:e.content||"双击进行编辑",fontFamilyName:e.fontFamilyName||"默认字体",src:e.src||"",dropShadow:{color:e.dropShadow&&e.dropShadow.color||"rgba(0,0,0,0)",x:e.dropShadow&&parseFloat(e.dropShadow.x)>=-100&&parseFloat(e.dropShadow.x)<=100?parseFloat(e.dropShadow.x):0,y:e.dropShadow&&parseFloat(e.dropShadow.y)>=-100&&parseFloat(e.dropShadow.y)<=100?parseFloat(e.dropShadow.y):0,blur:e.dropShadow&&parseFloat(e.dropShadow.blur)>=0&&parseFloat(e.dropShadow.blur)<=10?parseFloat(e.dropShadow.blur):0,transparency:e.dropShadow&&parseFloat(e.dropShadow.transparency)>=0&&parseFloat(e.dropShadow.transparency)<=100?parseFloat(e.dropShadow.transparency):100},stroke:{size:e.stroke&&parseFloat(e.stroke.size)>=0&&parseFloat(e.stroke.size)<=10?parseFloat(e.stroke.size):0,color:e.stroke&&e.stroke.color||"#5D61FF",distance:e.stroke&&parseFloat(e.stroke.distance)>=0&&parseFloat(e.stroke.distance)<=10?parseFloat(e.stroke.distance):0},angle:e.angle&&parseFloat(e.angle)>=0&&parseFloat(e.angle)<=360?parseFloat(e.angle):45,cube:[{size:e.cube&&parseFloat(e.cube.size)>=0&&parseFloat(e.cube.size)<=20?parseFloat(e.cube.size):0,color:e.cube&&e.cube.color||"#FF2A6A"}],borderRadius:{lt:!0,rt:!0,rb:!0,lb:!0,val:0},gradient:{angle:90,colors:{0:"#5D61FF",1:"#FF15F5"}},backgroundImage:"http://res1.eqh5.com/9d8aaa91-1883-4299-ad9a-3c10ab766f40.png",shake:{size:2,colors:{0:"rgba(255,95,255,1)",1:"rgba(6,234,201,1)"}}}}},{key:"setDefaultSVGData",value:function(){return{visible:!0,svgWidth:0,svgHeight:0,texts:this.formatContentString(this.elementJson.property.content),list:null,lines:[],lineSize:2,totalLineCount:0,resizeWidth:null,resizeHeight:null,resizeInit:{},filter:{x:0,y:0,width:"100%",height:"100%"},svgStroke:{color:"#5D61FF",size:0,distance:0},svgCube:[],svgShake:[],bgRadius:{path:""},gradientDer:{x1:"0",x2:"1",y1:"0",y2:"0"},chartlet:{width:0,height:0,src:"",x:0,y:0,size:0}}}},{key:"formatContent",value:function(e){return e.replace(/\r?\n/g,"<br>").replace(/\s/g,"&nbsp;")}},{key:"hideSVG",value:function(e){this.elementJson.svgData.visible=!e,this.$svg.css({opacity:this.elementJson.svgData.visible?1:0})}},{key:"setSelected",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(h(r(i.prototype),"setSelected",this).call(this,e),!e&&this.isEditing){this.elementJson.svgData.list=[],this.elementJson.svgData.lines=[];var t=this.editBox.$el.innerHTML;t&&(t=(t=t.replace(/<div><br><\/div>/g,"\n").replace(/<br>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"")).replace(/<.*?>/gi,""));var n=this.formatContent(t);""===n&&Vue.elements.delElement(this),this.elementJson.svgData.texts=this.formatContentString(n),this.elementJson.property.content=n,this.updateSvgContent(),this.measureText(),this.editBox.remove(),this.hideSVG(!1),this.isEditing=!1,this.oninput=null}}},{key:"getBoxSize",value:function(){if(this.elementJson.svgData.resizeWidth&&this.elementJson.svgData.resizeHeight)return{width:this.elementJson.svgData.resizeWidth,height:this.elementJson.svgData.resizeHeight};var e=this.elementJson.svgData.svgWidth,t=this.elementJson.svgData.svgHeight,n=parseFloat(this.elementJson.css.letterSpacing);return this.isEditing&&(e+=n),{width:e,height:t}}},{key:"getResizeBoxHeight",value:function(e){var t=this.elementJson.css,n=e/Vue.elementsBoxs.scale-2*parseFloat(this.elementJson.css.padding)-2,i=this.getPositionInfo(this.textRects,n);return i&&i.svgHeight&&i.svgWidth?t.writingMode&&"vertical-lr"===t.writingMode?i.svgWidth*Vue.elementsBoxs.scale:i.svgHeight*Vue.elementsBoxs.scale:0}},{key:"getResizeMinSize",value:function(){var e=this.elementJson.css,t=e.fontSize,n=e.padding,i=this.elementJson.svgData.svgHeight;return{width:Vue.elementsBoxs.scale*(parseFloat(t)+2*parseFloat(n)),height:i}}},{key:"getPositionInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.elementJson.css,i=this.groupTexts(e,"lineNum"),o=[];i.map((function(e){return o.push(parseInt(e[0].lineNum))}));for(var a=o[o.length-1]+1,s=[],r=0,l=0,c=t||parseFloat(n.width),d=parseFloat(n.fontSize),u=parseFloat(n.letterSpacing),h=parseFloat(n.lineHeight),p=-1,m=function(e){var t=i.filter((function(t,n){return parseInt(t[0].lineNum)===e})),n=0,o=p+1,a=[];if(!t||!t[0])return p+=1,"continue";a=t[0];for(var m=0;m<a.length;m++){var g=a[m],f=a.reduce((function(e,t){return e>t.height?e:t.height}),0),v=a.slice(n,m).reduce((function(e,t){return e+parseFloat(t.width)}),0)+u*(m-n);v+g.width>c&&(o+=1,n=m,v=0);var y=(d*h-d)/2,x=o*parseFloat(f)+y*(2*o+1);s.push({text:g.text,x:v,y:x,size:d,w:g.width,h:f});var b=(o+1)*parseFloat(f)+y*(o+1)*2,w=v+g.width;r=w>r?w:r,l=b>l?b:l,p=o}},g=0;g<a;g++)m(g);r=r<c?c:r,parseFloat(n.padding)>=0&&(s=this.setPositionWithTextPadding(s,parseFloat(n.padding)),r+=2*parseFloat(n.padding),l+=2*parseFloat(n.padding)),["left","center","right","justify"].includes(n.textAlign)&&(s=this.setPositionWithTextAlign(s,n.textAlign,parseFloat(n.padding),r));var f=[];if(["underline","line-through"].includes(n.textDecoration)&&(f=this.setLinesPosition(s,n.textDecoration)),n.writingMode&&"vertical-lr"===n.writingMode){this.setTextDirection(s,f);var v=r;r=l,l=v}return{list:s,totalLineCount:p+1,svgWidth:r,svgHeight:l,lines:f}}},{key:"resizeUpdate",value:function(e){var t=this.elementJson.css,n=t.padding,i=t.letterSpacing,o=t.fontSize,a=t.writingMode,s=this.elementJson.property,r=s.dropShadow,l=s.stroke,c=s.cube,d=s.borderRadius,u=this.elementJson.svgData.resizeInit,h="vertical-lr"===a?e.height:e.width,p="vertical-lr"===a?u.height:u.width,m=Math.abs(p-h)/p;m=h>p?1+m:1-m;var g=(p-2*parseFloat(n))*m,f=parseFloat(n)*m,v=parseFloat(i)*m,y=parseFloat(o)*m;f<0&&(f=0),v<0&&(v=0),y<0&&(y=0),r&&(r.x*=m,r.y*=m),l&&(l.size*=m,l.distance*=m),c&&(c[0].size*=m),d&&(d.val*=m),this.elementJson.svgData.lineSize*=m,this.updateCss({fontSize:y,width:g,padding:f,letterSpacing:v}),this.measureText()}},{key:"resizeInitDataStore",value:function(){this.elementJson.svgData.resizeInit={x:this.elementJson.css.x,y:this.elementJson.css.y,width:this.elementJson.svgData.svgWidth,height:this.elementJson.svgData.svgHeight}}},{key:"resizeUpdateCss",value:function(e,t,n){if(t===Nt.line){var i="vertical-lr"===this.elementJson.css.writingMode?e.height:e.width;this.updateCss({width:i-2*parseFloat(this.elementJson.css.padding),x:e.x,y:e.y}),this.measureText()}else this.updateCss({x:e.x,y:e.y}),n?this.resizeUpdate(e):this.updateSVGData({resizeWidth:e.width,resizeHeight:e.height}),this.updateSvgHeader()}},{key:"setDropShaow",value:function(e){var t=e.x,n=e.y,i=this.elementJson.svgData,o=i.list,a=i.filter,s=this.groupTexts(o,"y");if(0!==s.length){var r=s.reduce((function(e,t){return t.length>e.length?t:e})),l=r.length,c=t/(r[l-1].x-r[0].x+r[l-1].w),d=n/(s[s.length-1][0].y-s[0][0].y+s[s.length-1][0].h);a.x=parseFloat(t)<0?"-".concat(100*Math.abs(c),"%"):0,a.y=parseFloat(n)<0?"-".concat(100*Math.abs(d),"%"):0,a.width="".concat(100*(1+Math.abs(c)),"%"),a.height="".concat(100*(1+Math.abs(d)),"%")}}},{key:"setStroke",value:function(e){var t=e.size,n=e.distance,i=e.color,o=this.elementJson.svgData.svgStroke;o.color=i,o.distance=0===t?0:n,o.size=o.distance+t}},{key:"setCube",value:function(e){var t=this.elementJson.svgData.svgCube;t.splice(0);for(var n=0;n<e.length;n++)t.push(e[n])}},{key:"setShake",value:function(e){var t=this.elementJson.svgData.svgShake;t.splice(0);for(var n=0;n<e.length;n++)t.push(e[n])}},{key:"setbgBorderRadius",value:function(e){var t=this.elementJson.svgData,n=t.svgWidth,i=t.svgHeight,o=t.bgRadius,a="M0 0 h".concat(n," v").concat(i," h-").concat(n," z");if(e){var s=parseInt(e.val),r=n/2,l=i/2,c=s>r?r:s,d=s>l?l:s,u=e.lt?"M0 ".concat(d):"M0 0",h=e.lt?"a".concat(c," ").concat(d," 0 0 1 ").concat(c," -").concat(d):"",p=e.rt?"a".concat(c," ").concat(d," 0 0 1 ").concat(c," ").concat(d):"",m=e.rb?"a".concat(c," ").concat(d," 0 0 1 -").concat(c," ").concat(d):"",g=e.lb?"a".concat(c," ").concat(d," 0 0 1 -").concat(c," -").concat(d):"",f="h".concat(n);e.lt&&e.rt?f="h".concat(n-2*c):(e.lt||e.rt)&&(f="h".concat(n-c));var v="v".concat(i);e.rt&&e.rb?v="v".concat(i-2*d):(e.rt||e.rb)&&(v="v".concat(i-d));var y="h-".concat(n);e.rb&&e.lb?y="h-".concat(n-2*c):(e.rb||e.lb)&&(y="h-".concat(n-c)),a="".concat(u," ").concat(h," ").concat(f," ").concat(p," ").concat(v," ").concat(m," ").concat(y," ").concat(g," z")}o.path=a}},{key:"setTextDirection",value:function(e,t){e&&e.length>0&&(e=e.map((function(e,t){var n=e.y;e.y=.97*e.x,e.x=n}))),t&&t.length>0&&(t=t.map((function(e,t){var n=e.x1;e.x1=e.y1,e.y1=n;var i=e.x2;e.x2=e.y2,e.y2=i})))}},{key:"setGradientDeriction",value:function(e){var t=this.elementJson.svgData.gradientDer;[0,90,180,270].includes(e.angle)&&(90===e.angle?(t.x1="0",t.x2="1",t.y1="0",t.y2="0"):270===e.angle?(t.x1="1",t.x2="0",t.y1="0",t.y2="0"):180===e.angle?(t.x1="1",t.x2="1",t.y1="0",t.y2="1"):0===e.angle&&(t.x1="1",t.x2="1",t.y1="1",t.y2="0"))}},{key:"setChartlet",value:function(e){var t=this.elementJson.svgData,n=t.svgWidth,i=t.svgHeight,o=t.chartlet;o.width=n,o.height=i;var a=0,s=0,r=0;n>i?r=-((a=n)-i)/2:s=-((a=i)-n)/2,o.size=a,o.x=s,o.y=r,o.src="".concat(e,"?imageMogr2/auto-orient/thumbnail/").concat(a)}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e),this.updateSvg()}},{key:"settingUpdateCss",value:function(e){this.updateCss(e),this.measureText()}},{key:"formatContentString",value:function(e){var t=e.split("<br>");return t=t.map((function(e){return e.replace(/&nbsp;/g," ")}))}},{key:"measureText",value:function(){var e=this;setTimeout((function(){e.getTextsRect().then((function(t){e.textRects=t,e.updateRender(t)})).catch((function(e){return console.log(e)}))}),0)}},{key:"getTextsRect",value:function(){var e=this.$svg.querySelectorAll(".hide-text");return new Promise((function(t,n){if(e)for(var i=[],o=0;o<e.length;o++){var a=e[o],s=a.getBBox(),r=s.width,l=s.height,c=0===r?12:r;i.push({lineNum:a.attr("data-line"),text:a.innerHTML,width:c,height:l}),o===e.length-1&&t(i)}else n()}))}},{key:"updateRender",value:function(e){var t=this.getPositionInfo(e),n=t.list,i=t.totalLineCount,o=t.svgWidth,a=t.svgHeight,s=t.lines;this.elementJson.svgData.list=n,this.elementJson.svgData.lines=s,this.elementJson.svgData.svgWidth=o,this.elementJson.svgData.svgHeight=a,this.elementJson.svgData.totalLineCount=i,this.elementJson.svgData.resizeInit={},this.elementJson.svgData.resizeWidth=null,this.elementJson.svgData.resizeHeight=null,this.updateProperty(this.elementJson.property),this.updateSvg(),this.updateEditBox()}},{key:"setPositionWithTextPadding",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i];o.x+=t,o.y+=t,n.push(o)}return n}},{key:"setPositionWithTextAlign",value:function(e,t,n,i){var o=[];if(e&&e.length>0)for(var a=this.groupTexts(e,"y"),s=0;s<a.length;s++){var r=a[s],l=r[0],c=r[r.length-1],d=c.x+c.w-l.x,u=0;"left"===t?u=-n:"center"===t?u=(i-d-2*n)/2:"right"===t?u=i-d-n:"justify"===t&&r.length>2&&(u=(i-l.w-c.w)/(r.length-2));for(var h=0;h<r.length;h++){var p=r[h];"justify"===t?0===h?p.x=0:h===r.length-1?p.x=i-p.w:p.x=l.w+u*(h-1)+(u-p.w)/2:p.x+=u,o.push(p)}}return o}},{key:"setLinesPosition",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i],a=e[i+1],s=o.x,r=o.y+("underline"===t?o.h:"line-through"===t?o.h/2:0),l=a&&a.x>s?a.x:s+o.w,c=r;n.push({x1:s,x2:l,y1:r,y2:c})}return n}},{key:"groupTexts",value:function(e,t){for(var n=[],i={},o=0;o<e.length;o++){var a=e[o][t];i[a]||(i[a]=[]),i[a].push(e[o])}for(var s in i)n.push(i[s]);return n}},{key:"updateEditBox",value:function(){Vue.elementsBoxs.getElementBoxEditResizing()||(1===Vue.elements.getSelected().length?this.selected&&Vue.elementsBoxs.setSelectedElement([this]):Vue.elements.getSelected().length>1&&(Vue.elementsBoxs.setSelectedElement(Vue.elements.getSelected()),Vue.elementsBoxs.setHoverElement(Vue.elements.getSelected()),Vue.elementsBoxs.setGroupElement(Vue.elements.getSelected())))}}],[{key:"dropShadow",value:function(e){if(e.color.indexOf("#")>-1){var t=D.hex2rgba(e.color);e.color="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}else if(e.transparency!==e.lastTransparency){var n=parseFloat((100-e.transparency)/100).toFixed(2),i=e.color.match(/(\d(\.\d+)?)+/g);e.color="rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(n,")"),e.lastTransparency=e.transparency}else{var o=e.color.match(/(\d(\.\d+)?)+/g),a=100-parseInt(100*o[3]);e.transparency=a}return e}},{key:"cube",value:function(e,t){var n=[];if(e)for(var i=t*Math.PI/180,o=e[0].color,a=e[0].size,s=0;s<a;s++)n.push({color:o,x:s*Math.cos(i),y:s*Math.sin(i)});return n}},{key:"shake",value:function(e,t){var n=[];if(e)for(var i=t*Math.PI/180,o=e.colors[0],a=e.colors[1],s=e.size,r=1;r<=2;r++)for(var l=1;l<=s;l++)1===r?n.push({color:o,x:-l*Math.cos(i),y:-l*Math.sin(i)}):n.push({color:a,x:l*Math.cos(i),y:l*Math.sin(i)});return n}}]),i}(At),Ut=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),(o=t.call(this,e)).elementResizeType=Ot.image,e.id||(o.check(e)?o.state=!0:o.state=!1,o.elementJson.type=$t.image,o.elementJson.property.src=e.src,o.defaultData()),o.$image=null,o}return o(i,[{key:"check",value:function(e){var t=!0,n=Vue.store.state.scene.editorConfig.debug;return!e.src&&n&&(console.error("Image组件的src属性为空！"),t=!1),t}},{key:"defaultData",value:function(){this.elementJson.property.dropShadow||(this.elementJson.property.dropShadow={x:0,y:0,color:"rgba(0,0,0,0)",blur:0,transparency:100,lastcolor:"rgba(0,0,0,0)"}),this.elementJson.property.rotateX||(this.elementJson.property.rotateX=0,this.elementJson.property.rotateY=0),this.elementJson.property.borderRadius||(this.elementJson.property.borderRadius={lb:!0,lt:!0,rb:!0,rt:!0,val:0}),this.elementJson.css.opacity||(this.elementJson.css.opacity=0),this.elementJson.css=Object.assign({opacity:0,borderWidth:0,borderStyle:"solid",borderColor:"rgba(255,255,255,1)"},this.elementJson.css)}},{key:"updateId",value:function(e){h(r(i.prototype),"updateId",this).call(this,e)}},{key:"render",value:function(){h(r(i.prototype),"render",this).call(this);var e=this.elementJson,t=e.css,n=e.property,o=this.$image=document.createElement("div");this.updateCss(t),this.updateProperty(n),this.$el.appendChild(o)}},{key:"updateCss",value:function(e){h(r(i.prototype),"updateCss",this).call(this,e);var t=this.elementJson.css,n=t.width,o=t.height,a=t.borderWidth,s=this.elementJson.property,l=s.rotateX,c=s.rotateY;this.$image.css(e).css({x:"",y:"",zIndex:"",position:""}).css({transform:"rotateX(".concat(l,"deg) rotateY(").concat(c,"deg)")}),e.width&&e.height&&this.$image.css({borderWidth:a+"px",width:n+"px",height:o+"px"})}},{key:"settingUpdateCss",value:function(e){this.updateCss(e),this.selected&&Vue.elementsBoxs.setSelectedElement([this])}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e)}},{key:"dropShadow",value:function(e){var t={};if(e){if(e.transparency!==e.lastTransparency){var n=parseFloat((100-e.transparency)/100).toFixed(2),i=e.color.match(/(\d(\.\d+)?)+/g);e.color="rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(n,")"),e.lastTransparency=e.transparency}else{var o=e.color.match(/(\d(\.\d+)?)+/g),a=100-parseInt(100*o[3]);e.transparency=a}t.filter="drop-shadow(".concat(e.x,"px ").concat(e.y,"px ").concat(e.blur,"px ").concat(e.color,")")}return t}},{key:"updateProperty",value:function(e){h(r(i.prototype),"updateProperty",this).call(this,e);var t=this.elementJson.property;this.$image.css(this.dropShadow(t.dropShadow)),this.$image.css(i.borderRadius(t.borderRadius));var n="rotateX(".concat(t.rotateX,"deg) rotateY(").concat(t.rotateY,"deg)");this.$image.css({transform:n,background:"url(".concat(t.src,") center / cover")})}},{key:"bind",value:function(e){h(r(i.prototype),"bind",this).call(this,e)}},{key:"setTransform",value:function(e){var t=this.elementJson.property;"x"===e?t.rotateY=180===t.rotateY?0:180:"y"===e&&(t.rotateX=180===t.rotateX?0:180)}},{key:"setDropShow",value:function(e){Object.assign(this.elementJson.property.dropShadow,e)}}],[{key:"borderRadius",value:function(e){var t={};if(e){var n=e.lt?e.val:"0px",i=e.rt?e.val:"0px",o=e.lb?e.val:"0px",a=e.rb?e.val:"0px";t.borderRadius="".concat(n,"px ").concat(i,"px ").concat(a,"px ").concat(o,"px")}return t}}]),i}(At);function Xt(e){this.$el.addEventListener("dblclick",(function(e){e.stopPropagation(),Vue.dialog.openNotice({msg:"日期组件会自动更新日期到当前时间，无法自主修改，<br>若需要自主修改，请在左侧添加文本框。",btnName:"我知道了"}).then((function(e){})).catch((function(e){console.log(e)}))}))}var Kt={YEAR_MIN:1890,YEAR_MAX:2100,map:[1750378,339370,6020516,405156,314698,4934293,371351,279894,2804405,346837,8115922,419666,331429,4961866,394827,297627,3880278,370026,281433,1759058,345938,6019877,412453,313931,4936875,377517,288107,1764201,355753,7093650,429714,331045,4954701,395862,303798,3872181,370388,282281,1769106,347794,6016294,402731,313943,4936374,379738,296660,2821833,354121,7075475,420499,329003,5991003,387757,304490,3881813,371620,281417,1759891,346773,7058733,402742,314029,4945322,378290,290213,2825546,363850,8120981,412311,329046,5999285,387797,304850,3878565,372389,280138,2796695,338587,7066970,402794,314217,4945746,387922,289573,3864139,354891,8123563,410285,320877,5999465,396713,306578,3882277,372005,10246733,428630,336566,6006197,403157,315049,4947602,388754,298278,2812502,346711,8123606,418650,321237,4953801,395081,304787,3872043,361771,272987,1758554,337258,7060309,412580,322377,4938387,379541,288045,3861165,346805,9172394,419282,331173,6004042,396618,306325,3880238,361814,273077,1758642,345810,6008485,403237,312907,4934807,371883,288090,2812630,355177,11269970,420690,330533,6003275,387659,296107,4916571,361901,273258,1760082,347538,7068965,404773,313941,4936877,378038,279989,2813354,356041,8142482,421522,331046,5999190,387671,296150,3868373,362325,280393,2797203,337555,7058731,402731,305755,4937050,378218,289637,3864394,355146,8125077,420501,320813,5991085,387765,304554,3869605,363941,281930,2808981,339094,7059790,402774,314037,4937138,378578,290469,3870282,345675,8113303,410795,320859,5991126,387946,304978,3880741,363301,273035,1750171,337067],monthNames:["正月","二月","三月","四月","五月","六月","七月","八月","九月","十月","冬月","腊月"],dayNames:["","初一","初二","初三","初四","初五","初六","初七","初八","初九","初十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","廿一","廿二","廿三","廿四","廿五","廿六","廿七","廿八","廿九","三十"],heavenlyStems:["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],earthlyBranches:["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],animals:["鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"]},Zt={zddd:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],ddd:["sun","mon","tue","wed","thu","fri","sat"],Ddd:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],DDD:["SUN","MON","TUE","WED","THU","FRI","SAT"],Dddd:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dddd:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],DDDD:["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],mmm:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],mmmm:["January","February","March","April","May","June","July","August","September","October","November","December"]},Qt={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二",13:"十三",14:"十四",15:"十五",16:"十六",17:"十七",18:"十八",19:"十九",20:"二十",21:"二十一",22:"二十二",23:"二十三",24:"二十四",25:"二十五",26:"二十六",27:"二十七",28:"二十八",29:"二十九",30:"三十",31:"三十一"},en={year:"",month:"",day:"",gYear:"",zYear:"",animal:"",leap:""};function tn(e,t){t.map=8191&e,t.day=e>>13&31,t.month=e>>18&1,t.leapMonth=e>>20&15,t.hasLeapMonth=!!(e&1<<19)}function nn(e){var t=e.getFullYear(),n=e.getMonth(),i=e.getDate(),o=Kt.map,a=t-Kt.YEAR_MIN,s={};en.year=t,tn(o[a],s),(n<s.month||n===s.month&&i<s.day)&&(a-=1,en.year=t-1,tn(o[a],s));for(var r,l,c=new Date(en.year,s.month,s.day),d=(e.getTime()-c.getTime())/864e5>>0,u=0,h=0,p=0;p<14;){if(d<(u+=h=s.map&1<<p?30:29)){en.day=h-(u-d)+1;break}p+=1}return en.leap=!1,s.hasLeapMonth&&(p===s.leapMonth+1&&(en.leap=!0),p>s.leapMonth&&(p-=1)),en.month=p,l=(r=en).year-1890+26,en.gYear=l%10,en.zYear=l%12,en.animal=r.zYear,en.year=Kt.heavenlyStems[en.gYear]+Kt.earthlyBranches[en.zYear],en.month=Kt.monthNames[en.month],en.day=Kt.dayNames[en.day],en.gYear=Kt.heavenlyStems[en.gYear],en.zYear=Kt.earthlyBranches[en.zYear],en.animal=Kt.animals[en.animal],en.leap=en.leap?"闰":"",en}function on(e){var t=e.getTimezoneOffset(),n=e.getTime(),i=new Date(n+60*t*1e3+288e5);return{year:i.getFullYear(),month:i.getMonth(),mDay:i.getDate(),wDay:i.getDay()}}function an(e,t){var n="";t?(""+e).split("").map((function(e,t){n+=Qt[e]+""})):n=Qt[e];return n}function sn(e,t){return(e=""+e).substr(e.length-t)}function rn(e,t,n){if((e=""+e).length>=t)return e;var i=0;for(e=e.split("");i<t-e.length;)e.unshift(n),i++;var o="";return e.map((function(e){o+=e})),o}var ln=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),(o=t.call(this,e)).elementResizeType=Ot.text,e.id||(o.elementJson.type=$t.date,o.elementJson.property=Object.assign({},o.elementJson.property,o.setDefaultProperty(e)),o.elementJson.css=Object.assign({},o.elementJson.css,o.setDefaultCss(e)),o.elementJson.svgData=Object.assign({},o.setDefaultSVGData())),o.$svg=null,o.textRects=[],o.isPrepare=!1,o}return o(i,[{key:"createFontFace",value:function(){var e=this.elementJson,t=e.css,n=e.property;if(n.fontFamily&&n.src&&""!==t.fontFamily&&""!==n.src&&!document.querySelector("#"+t.fontFamily)){var i=document.createElement("style");i.id=t.fontFamily,i.innerHTML='@font-face{font-family: "'.concat(t.fontFamily,'";src: url(').concat(n.src,') format("woff")}\r\n'),document.head.appendChild(i)}}},{key:"updateId",value:function(e){h(r(i.prototype),"updateId",this).call(this,e),this.elementJson.id=e}},{key:"updateCss",value:function(e){h(r(i.prototype),"updateCss",this).call(this,e);var t=this.elementJson.css,n=t.x,o=t.y,a=t.rotate;(e.x&&e.y||e.rotate)&&this.$el.css({transform:"translate(".concat(n,"px,").concat(o,"px) rotate(").concat(a,"deg)")})}},{key:"updateProperty",value:function(e){h(r(i.prototype),"updateProperty",this).call(this,e);var t=e.type,n=e.dropShadow,o=e.stroke,a=e.cube,s=e.angle,l=e.borderRadius,c=e.gradient,d=e.backgroundImage,u=e.shake;if(n){var p=i.dropShadow(n);this.setDropShaow(p)}if(o&&this.setStroke(o),a&&s){var m=i.cube(a,s);this.setCube(m)}if(l&&this.setbgBorderRadius(l),c&&t===jt.gradient&&this.setGradientDeriction(c),d&&t===jt.chartlet&&this.setChartlet(d),u&&s&&t===jt.shake){var g=i.shake(u,s);this.setShake(g)}}},{key:"updateSVGData",value:function(e){Object.assign(this.elementJson.svgData,e)}},{key:"render",value:function(){h(r(i.prototype),"render",this).call(this);var e=this.$svg=document.createElementNS("http://www.w3.org/2000/svg","svg");e.css({overflow:"visible",display:"block"}).attr({"xml:space":"preserve","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"}),e.innerHTML=this.initSvgHtml(),this.createFontFace(),this.$el.appendChild(e),this.measureText(),this.isPrepare=!0}},{key:"getChartletDef",value:function(e,t){return'<defs>\n            <pattern\n                id="pattern_'.concat(e,'"\n                x="0"\n                y="0"\n                viewBox="0 0 ').concat(t.width," ").concat(t.height,'"\n                width="').concat(t.width,'"\n                height="').concat(t.height,'"\n                patternUnits="userSpaceOnUse"\n            >\n                <image\n                    xlink:href="').concat(t.src,'"\n                    x="').concat(t.x,'"\n                    y="').concat(t.y,'"\n                    width="').concat(t.size,'"\n                    height="').concat(t.size,'"\n                />\n            </pattern>\n        </defs>')}},{key:"getGradientDef",value:function(e,t,n){return'<defs>\n        <linearGradient\n               id="gradient_'.concat(e,'"\n               x1="').concat(t.x1,'"\n               y1="').concat(t.y1,'"\n               x2="').concat(t.x2,'"\n               y2="').concat(t.y2,'"\n           >\n               <stop\n                   stop-color="').concat(n[0],'"\n                   offset="0%"\n                   stop-opacity="1"\n               />\n               <stop\n                   stop-color="').concat(n[1],'"\n                   offset="100%"\n                   stop-opacity="1"\n               />\n           </linearGradient>\n       </defs>')}},{key:"getShadowDef",value:function(e,t,n){return'<defs>\n            <filter\n                id="shadow_'.concat(e,'"\n                filterUnits="userSpaceOnUse"\n                x="').concat(t.x,'"\n                y="').concat(t.y,'"\n                width="').concat(t.width,'"\n                height="').concat(t.height,'"\n            >\n                <feGaussianBlur\n                    in="SourceAlpha"\n                    stdDeviation="').concat(n.blur,'"\n                    result="blur"\n                />\n                <feOffset\n                    in="blur"\n                    dx="').concat(n.x,'"\n                    dy="').concat(n.y,'"\n                    result="offsetBlur"\n                />\n                <feFlood\n                    flood-color="').concat(n.color,'"\n                    flood-opacity="').concat(1-n.transparency/100,'"\n                />\n                <feComposite\n                    in2="offsetBlur"\n                    operator="in"\n                />\n                <feMerge>\n                    <feMergeNode />\n                    <feMergeNode in="SourceGraphic" />\n                </feMerge>\n            </filter>\n        </defs>')}},{key:"getBorderRadiusDef",value:function(e,t){return""===t.path?"":'<defs>\n        <clipPath id="bgBorderRadius_'.concat(e,'">\n            <path d="').concat(t.path,'"/>\n        </clipPath>\n    </defs>')}},{key:"getHiddenTexts",value:function(e){for(var t=parseFloat(this.elementJson.css.fontSize),n='<g id="hiddenTexts" opacity="0">',i=0;i<e.length;i++)for(var o=e[i],a=0;a<o.length;a++)n+='<text\n                    class="hide-text"\n                    data-line="'.concat(i,'"\n                    alignment-baseline="auto"\n                    font-size="').concat(t,'"\n                    dominant-baseline="text-before-edge"\n                    x="0"\n                    y="0"\n                >').concat(o[a],"</text>");return n+="</g>"}},{key:"getTextsHtml",value:function(){var e=this.elementJson.svgData.list,t="";if(e)for(var n=0;n<e.length;n++){var i=e[n];t+='<text\n                    dominant-baseline="text-before-edge"\n                    font-size="'.concat(i.size,'"\n                    x="').concat(i.x,'"\n                    y="').concat(i.y,'"\n                >').concat(i.text,"</text>")}return t}},{key:"getBgRect",value:function(e,t){return'<g style="clip-path:url(#bgBorderRadius_'.concat(e,')">\n            <rect\n                x="0"\n                y="0"\n                width="100%"\n                height="100%"\n                fill="').concat(t,'"\n            />\n        </g>')}},{key:"getCubeG",value:function(e,t,n,i){for(var o="",a=this.getTextsHtml(),s=0;s<t.length;s++){var r=t[s],l=n+i+"fill:".concat(r.color,";stroke:").concat(r.color,";stroke-width:10;");o+='\n                <g\n                    filter="'.concat(0===s?"url(#shadow_"+e+")":"",'"\n                    transform = "translate(0 0) translate(').concat(r.x," ").concat(r.y,')"\n                    style="').concat(l,'"\n                    \n                >\n                ').concat(a,"\n            </g > ")}return o}},{key:"getShakeG",value:function(e,t,n,i){for(var o="",a=this.getTextsHtml(),s=0;s<t.length;s++){var r=t[s],l=n+i+"fill:".concat(r.color,";stroke:").concat(r.color,";stroke-width:1;");o+='\n                <g\n                    filter="'.concat(0===s?"url(#shadow_"+e+")":"",'"\n                    transform = "translate(0 0) translate(').concat(r.x," ").concat(r.y,')"\n                    style = "').concat(l,'"\n                >\n                ').concat(a,"\n            </g > ")}return o}},{key:"getFill",value:function(e){var t=this.elementJson.property.type,n=this.elementJson.css.color;return t===jt.gradient?n="url(#gradient_".concat(e,")"):t===jt.chartlet&&(n="url(#pattern_".concat(e,")")),n}},{key:"getStrokeG",value:function(e,t,n,i,o){for(var a="",s=this.getTextsHtml(),r=this.getFill(e),l=0;l<2;l++){var c=0===l?t.color:"#ffffff",d=0===l?t.size:t.distance,u=o?"url(#shadow_".concat(e,")"):"",h=n+i+"fill:".concat(r,";stroke:").concat(c,";stroke-width:").concat(d,";");a+='\n                <g\n                    filter="'.concat(0===l?u:"",'"\n                    style="').concat(h,'"\n                >\n                ').concat(s,"\n            </g > ")}return a}},{key:"getSvgText",value:function(e,t,n){var i=n?"url(#shadow_".concat(e,")"):"",o=this.getTextsHtml(),a=this.getFill(e);return'<g\n            filter="'.concat(i,'"\n            style="fill:').concat(a,";").concat(t,'"\n        >\n            ').concat(o,"\n        </g>")}},{key:"getSvgLine",value:function(e){var t="",n=this.elementJson.svgData,i=n.lines,o=n.lineSize;if(i&&o&&parseFloat(this.elementJson.css.fontSize)>0){t='<g stroke-linecap="butt">';for(var a=this.getFill(e),s=0;s<i.length;s++){var r=i[s];t+=' <line\n                x1="'.concat(r.x1,'"\n                y1="').concat(r.y1,'"\n                x2="').concat(r.x2,'"\n                y2="').concat(r.y2,'"\n                style="stroke:').concat(a,";stroke-width:").concat(o,';" />')}t+="</g>"}return t}},{key:"createDateContent",value:function(){var e=this.elementJson.property.content||"+yyyy-+mm-+dd";return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zyyy zy cy yyyy yy MMMM Mmmm mmmm MMM Mmm mmm mm m DDDD dddd DDD ddd dd d ",n=on(e),i=nn(e);return t.replace("+zyyy",an(n.year,!0)).replace("+zy",an(sn(n.year,2))).replace("+yyyy",n.year).replace("+yy",sn(n.year,2)).replace("+MMMM",Zt.mmmm[n.month].toUpperCase()).replace("+Mmmm",Zt.mmmm[n.month]).replace("+mmmm",Zt.mmmm[n.month].toLowerCase()).replace("+MMM",Zt.mmm[n.month].toUpperCase()).replace("+Mmm",Zt.mmm[n.month]).replace("+mmm",Zt.mmm[n.month].toLowerCase()).replace("+mm",rn(n.month+1,2,"0")).replace("+zm",an(n.month+1)).replace("+m",n.month+1).replace("+DDDD",Zt.dddd[n.wDay].toUpperCase()).replace("+dddd",Zt.dddd[n.wDay]).replace("+Dddd",Zt.dddd[n.wDay].charAt(0).toUpperCase()+Zt.dddd[n.wDay].substr(1)).replace("+ddd",Zt.dddd[n.wDay].substr(0,3)).replace("+Ddd",Zt.dddd[n.wDay].charAt(0).toUpperCase()+Zt.dddd[n.wDay].substr(1,2)).replace("+DDD",Zt.dddd[n.wDay].substr(0,3).toUpperCase()).replace("+zddd",Zt.zddd[n.wDay]).replace("+dd",rn(n.mDay,2,"0")).replace("+zd",an(n.mDay)).replace("+d",n.mDay).replace("+cy",i.year).replace("+cm",i.month).replace("+cd",i.day)}(new Date,e)}},{key:"initSvgHtml",value:function(){var e=this.elementJson.svgData.texts;return this.getHiddenTexts(e)}},{key:"getInnerHtml",value:function(){var e="",t=this.elementJson.id;if(!t)return e;var n=this.elementJson.svgData,i=n.chartlet,o=n.gradientDer,a=n.filter,s=n.bgRadius,r=n.svgShake,l=n.svgCube,c=n.svgStroke,d=n.texts,u=this.elementJson.property,h=u.type,p=u.gradient,m=u.dropShadow,g=this.elementJson.css,f=g.fontFamily,v=g.fontWeight,y=g.fontStyle,x=g.backgroundColor,b="font-family:".concat(f,";font-weight:").concat(v,";font-style:").concat(y,";"),w="stroke-miterlimit: 10;stroke-linejoin: round;stroke-linecap: butt;stroke-dasharray: 0, 0;",_=1-m.transparency/100>0,k=c.size>0,E=l.length>0;return e=(h===jt.chartlet&&i?this.getChartletDef(t,i):"")+(h===jt.gradient&&o&&p?this.getGradientDef(t,o,p.colors):"")+(_&&a&&m?this.getShadowDef(t,a,m):"")+(s&&""!==s.path?this.getBorderRadiusDef(t,s):"")+(d?this.getHiddenTexts(d):"")+(x?this.getBgRect(t,x):"")+(l?this.getCubeG(t,l,b,w):"")+(r?this.getShakeG(t,r,b,w):"")+(c?this.getStrokeG(t,c,b,w,_&&!E):"")+this.getSvgText(t,b,!E&&!k&&_)+this.getSvgLine(t)}},{key:"updateSvgHeader",value:function(){if(this.$svg){var e=this.elementJson.svgData,t=e.visible,n=e.svgWidth,i=e.svgHeight,o=e.resizeWidth,a=e.resizeHeight;this.$svg.css({overflow:"visible",display:"block",opacity:t?1:0}).attr({width:o?parseFloat(o):parseFloat(n),height:a?parseFloat(a):parseFloat(i),viewBox:"0 0 ".concat(parseFloat(n)," ").concat(parseFloat(i))})}}},{key:"updateSvgInnerHtml",value:function(){this.$svg&&(this.$svg.innerHTML=this.getInnerHtml())}},{key:"updateSvg",value:function(){this.updateSvgHeader(),this.updateSvgInnerHtml()}},{key:"bind",value:function(e){h(r(i.prototype),"bind",this).call(this,e),Xt.call(this,e)}},{key:"setDefaultCss",value:function(e){return{fontFamily:e.fontFamily||"inherit",fontSize:e.fontSize||"14px",fontWeight:e.fontWeight||"",fontStyle:e.fontStyle||"normal",letterSpacing:e.letterSpacing||"0",lineHeight:e.lineHeight||"1",color:e.color||"rgba(0,0,0,1)",padding:e.padding||"12px",backgroundColor:e.backgroundColor||"transparent",textAlign:e.textAlign||"center",writingMode:e.writingMode||"lr",textDecoration:e.textDecoration||"",wordWrap:"break-word",wordBreak:"break-all"}}},{key:"setDefaultProperty",value:function(e){return{type:jt.text,content:"+yyyy-+mm-+dd",fontFamilyName:e.fontFamilyName||"默认字体",src:e.src||"",dropShadow:{color:e.dropShadow&&e.dropShadow.color||"rgba(0,0,0,0)",x:e.dropShadow&&parseFloat(e.dropShadow.x)>=-100&&parseFloat(e.dropShadow.x)<=100?parseFloat(e.dropShadow.x):0,y:e.dropShadow&&parseFloat(e.dropShadow.y)>=-100&&parseFloat(e.dropShadow.y)<=100?parseFloat(e.dropShadow.y):0,blur:e.dropShadow&&parseFloat(e.dropShadow.blur)>=0&&parseFloat(e.dropShadow.blur)<=10?parseFloat(e.dropShadow.blur):0,transparency:e.dropShadow&&parseFloat(e.dropShadow.transparency)>=0&&parseFloat(e.dropShadow.transparency)<=100?parseFloat(e.dropShadow.transparency):100},stroke:{size:e.stroke&&parseFloat(e.stroke.size)>=0&&parseFloat(e.stroke.size)<=10?parseFloat(e.stroke.size):0,color:e.stroke&&e.stroke.color||"#5D61FF",distance:e.stroke&&parseFloat(e.stroke.distance)>=0&&parseFloat(e.stroke.distance)<=10?parseFloat(e.stroke.distance):0},angle:e.angle&&parseFloat(e.angle)>=0&&parseFloat(e.angle)<=360?parseFloat(e.angle):45,cube:[{size:e.cube&&parseFloat(e.cube.size)>=0&&parseFloat(e.cube.size)<=20?parseFloat(e.cube.size):0,color:e.cube&&e.cube.color||"#FF2A6A"}],borderRadius:{lt:!0,rt:!0,rb:!0,lb:!0,val:0},gradient:{angle:90,colors:{0:"#5D61FF",1:"#FF15F5"}},backgroundImage:"http://res1.eqh5.com/9d8aaa91-1883-4299-ad9a-3c10ab766f40.png",shake:{size:2,colors:{0:"rgba(255,95,255,1)",1:"rgba(6,234,201,1)"}}}}},{key:"setDefaultSVGData",value:function(){return{visible:!0,svgWidth:0,svgHeight:0,texts:this.formatContentString(this.createDateContent()),list:null,lines:[],lineSize:2,totalLineCount:0,resizeWidth:null,resizeHeight:null,resizeInit:{},filter:{x:0,y:0,width:"100%",height:"100%"},svgStroke:{color:"#5D61FF",size:0,distance:0},svgCube:[],svgShake:[],bgRadius:{path:""},gradientDer:{x1:"0",x2:"1",y1:"0",y2:"0"},chartlet:{width:0,height:0,src:"",x:0,y:0,size:0}}}},{key:"hideSVG",value:function(e){this.elementJson.svgData.visible=!e}},{key:"getBoxSize",value:function(){return this.elementJson.svgData.resizeWidth&&this.elementJson.svgData.resizeHeight?{width:this.elementJson.svgData.resizeWidth,height:this.elementJson.svgData.resizeHeight}:{width:this.elementJson.svgData.svgWidth,height:this.elementJson.svgData.svgHeight}}},{key:"getResizeBoxHeight",value:function(e){var t=this.elementJson.css,n=e/Vue.elementsBoxs.scale-2*parseFloat(this.elementJson.css.padding)-2,i=this.getPositionInfo(this.textRects,n);return i&&i.svgHeight&&i.svgWidth?t.writingMode&&"vertical-lr"===t.writingMode?i.svgWidth*Vue.elementsBoxs.scale:i.svgHeight*Vue.elementsBoxs.scale:0}},{key:"getResizeMinSize",value:function(){var e=this.elementJson.css,t=e.fontSize,n=e.padding,i=this.elementJson.svgData.svgHeight;return{width:Vue.elementsBoxs.scale*(parseFloat(t)+2*parseFloat(n)),height:i}}},{key:"getPositionInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.elementJson.css,i=this.groupTexts(e,"lineNum"),o=[];i.map((function(e){return o.push(parseInt(e[0].lineNum))}));for(var a=o[o.length-1]+1,s=[],r=0,l=0,c=t||parseFloat(n.width),d=parseFloat(n.fontSize),u=parseFloat(n.letterSpacing),h=parseFloat(n.lineHeight),p=-1,m=function(e){var t=i.filter((function(t,n){return parseInt(t[0].lineNum)===e})),n=0,o=p+1,a=[];if(!t||!t[0])return p+=1,"continue";a=t[0];for(var m=0;m<a.length;m++){var g=a[m],f=a.reduce((function(e,t){return e>t.height?e:t.height}),0),v=a.slice(n,m).reduce((function(e,t){return e+parseFloat(t.width)}),0)+u*(m-n);v+g.width>c&&(o+=1,n=m,v=0);var y=(d*h-d)/2,x=o*parseFloat(f)+y*(2*o+1);s.push({text:g.text,x:v,y:x,size:d,w:g.width,h:f});var b=(o+1)*parseFloat(f)+y*(o+1)*2,w=v+g.width;r=w>r?w:r,l=b>l?b:l,p=o}},g=0;g<a;g++)m(g);r=r<c?c:r,parseFloat(n.padding)>=0&&(s=this.setPositionWithTextPadding(s,parseFloat(n.padding)),r+=2*parseFloat(n.padding),l+=2*parseFloat(n.padding)),["left","center","right","justify"].includes(n.textAlign)&&(s=this.setPositionWithTextAlign(s,n.textAlign,parseFloat(n.padding),r));var f=[];if(["underline","line-through"].includes(n.textDecoration)&&(f=this.setLinesPosition(s,n.textDecoration)),n.writingMode&&"vertical-lr"===n.writingMode){this.setTextDirection(s,f);var v=r;r=l,l=v}return{list:s,totalLineCount:p+1,svgWidth:r,svgHeight:l,lines:f}}},{key:"resizeUpdate",value:function(e){var t=this.elementJson.css,n=t.padding,i=t.letterSpacing,o=t.fontSize,a=t.writingMode,s=this.elementJson.property,r=s.dropShadow,l=s.stroke,c=s.cube,d=s.borderRadius,u=this.elementJson.svgData.resizeInit,h="vertical-lr"===a?e.height:e.width,p="vertical-lr"===a?u.height:u.width,m=Math.abs(p-h)/p;m=h>p?1+m:1-m;var g=(p-2*parseFloat(n))*m,f=parseFloat(n)*m,v=parseFloat(i)*m,y=parseFloat(o)*m;f<0&&(f=0),v<0&&(v=0),y<0&&(y=0),r&&(r.x*=m,r.y*=m),l&&(l.size*=m,l.distance*=m),c&&(c[0].size*=m),d&&(d.val*=m),this.elementJson.svgData.lineSize*=m,this.updateCss({fontSize:y,width:g,padding:f,letterSpacing:v}),this.measureText()}},{key:"resizeInitDataStore",value:function(){this.elementJson.svgData.resizeInit={x:this.elementJson.css.x,y:this.elementJson.css.y,width:this.elementJson.svgData.svgWidth,height:this.elementJson.svgData.svgHeight}}},{key:"resizeUpdateCss",value:function(e,t,n){if(t===Nt.line){var i="vertical-lr"===this.elementJson.css.writingMode?e.height:e.width;this.updateCss({width:i-2*parseFloat(this.elementJson.css.padding),x:e.x,y:e.y}),this.measureText()}else this.updateCss({x:e.x,y:e.y}),n?this.resizeUpdate(e):this.updateSVGData({resizeWidth:e.width,resizeHeight:e.height}),this.updateSvgHeader()}},{key:"setDropShaow",value:function(e){var t=e.x,n=e.y,i=this.elementJson.svgData,o=i.list,a=i.filter,s=this.groupTexts(o,"y");if(0!==s.length){var r=s.reduce((function(e,t){return t.length>e.length?t:e})),l=r.length,c=t/(r[l-1].x-r[0].x+r[l-1].w),d=n/(s[s.length-1][0].y-s[0][0].y+s[s.length-1][0].h);a.x=parseFloat(t)<0?"-".concat(100*Math.abs(c),"%"):0,a.y=parseFloat(n)<0?"-".concat(100*Math.abs(d),"%"):0,a.width="".concat(100*(1+Math.abs(c)),"%"),a.height="".concat(100*(1+Math.abs(d)),"%")}}},{key:"setStroke",value:function(e){var t=e.size,n=e.distance,i=e.color,o=this.elementJson.svgData.svgStroke;o.color=i,o.distance=0===t?0:n,o.size=o.distance+t}},{key:"setCube",value:function(e){var t=this.elementJson.svgData.svgCube;t.splice(0);for(var n=0;n<e.length;n++)t.push(e[n])}},{key:"setShake",value:function(e){var t=this.elementJson.svgData.svgShake;t.splice(0);for(var n=0;n<e.length;n++)t.push(e[n])}},{key:"setbgBorderRadius",value:function(e){var t=this.elementJson.svgData,n=t.svgWidth,i=t.svgHeight,o=t.bgRadius,a="M0 0 h".concat(n," v").concat(i," h-").concat(n," z");if(e){var s=parseInt(e.val),r=n/2,l=i/2,c=s>r?r:s,d=s>l?l:s,u=e.lt?"M0 ".concat(d):"M0 0",h=e.lt?"a".concat(c," ").concat(d," 0 0 1 ").concat(c," -").concat(d):"",p=e.rt?"a".concat(c," ").concat(d," 0 0 1 ").concat(c," ").concat(d):"",m=e.rb?"a".concat(c," ").concat(d," 0 0 1 -").concat(c," ").concat(d):"",g=e.lb?"a".concat(c," ").concat(d," 0 0 1 -").concat(c," -").concat(d):"",f="h".concat(n);e.lt&&e.rt?f="h".concat(n-2*c):(e.lt||e.rt)&&(f="h".concat(n-c));var v="v".concat(i);e.rt&&e.rb?v="v".concat(i-2*d):(e.rt||e.rb)&&(v="v".concat(i-d));var y="h-".concat(n);e.rb&&e.lb?y="h-".concat(n-2*c):(e.rb||e.lb)&&(y="h-".concat(n-c)),a="".concat(u," ").concat(h," ").concat(f," ").concat(p," ").concat(v," ").concat(m," ").concat(y," ").concat(g," z")}o.path=a}},{key:"setTextDirection",value:function(e,t){e&&e.length>0&&(e=e.map((function(e,t){var n=e.y;e.y=.97*e.x,e.x=n}))),t&&t.length>0&&(t=t.map((function(e,t){var n=e.x1;e.x1=e.y1,e.y1=n;var i=e.x2;e.x2=e.y2,e.y2=i})))}},{key:"setGradientDeriction",value:function(e){var t=this.elementJson.svgData.gradientDer;[0,90,180,270].includes(e.angle)&&(90===e.angle?(t.x1="0",t.x2="1",t.y1="0",t.y2="0"):270===e.angle?(t.x1="1",t.x2="0",t.y1="0",t.y2="0"):180===e.angle?(t.x1="1",t.x2="1",t.y1="0",t.y2="1"):0===e.angle&&(t.x1="1",t.x2="1",t.y1="1",t.y2="0"))}},{key:"setChartlet",value:function(e){var t=this.elementJson.svgData,n=t.svgWidth,i=t.svgHeight,o=t.chartlet;o.width=n,o.height=i;var a=0,s=0,r=0;n>i?r=-((a=n)-i)/2:s=-((a=i)-n)/2,o.size=a,o.x=s,o.y=r,o.src="".concat(e,"?imageMogr2/auto-orient/thumbnail/").concat(a)}},{key:"settingUpdateCss",value:function(e){this.updateCss(e),this.measureText()}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e),this.updateSvg()}},{key:"updateContent",value:function(){this.elementJson.property.content&&(this.elementJson.svgData.texts=this.formatContentString(this.createDateContent()),this.measureText())}},{key:"formatContentString",value:function(e){var t=e.split("<br>");return t=t.map((function(e){return e.replace(/&nbsp;/g," ")}))}},{key:"measureText",value:function(){var e=this;setTimeout((function(){e.getTextsRect().then((function(t){e.textRects=t,e.updateRender(t)})).catch((function(e){return console.log(e)}))}),0)}},{key:"getTextsRect",value:function(){var e=this.$svg.querySelectorAll(".hide-text");return new Promise((function(t,n){if(e)for(var i=[],o=0;o<e.length;o++){var a=e[o],s=a.getBBox(),r=s.width,l=s.height,c=0===r?12:r;i.push({lineNum:a.attr("data-line"),text:a.innerHTML,width:c,height:l}),o===e.length-1&&t(i)}else n()}))}},{key:"updateRender",value:function(e){var t=this.getPositionInfo(e),n=t.list,i=t.totalLineCount,o=t.svgWidth,a=t.svgHeight,s=t.lines;this.elementJson.svgData.list=n,this.elementJson.svgData.lines=s,this.elementJson.svgData.svgWidth=o,this.elementJson.svgData.svgHeight=a,this.elementJson.svgData.totalLineCount=i,this.elementJson.svgData.resizeInit={},this.elementJson.svgData.resizeWidth=null,this.elementJson.svgData.resizeHeight=null,this.updateProperty(this.elementJson.property),this.updateSvg(),this.updateEditBox()}},{key:"setPositionWithTextPadding",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i];o.x+=t,o.y+=t,n.push(o)}return n}},{key:"setPositionWithTextAlign",value:function(e,t,n,i){var o=[];if(e&&e.length>0)for(var a=this.groupTexts(e,"y"),s=0;s<a.length;s++){var r=a[s],l=r[0],c=r[r.length-1],d=c.x+c.w-l.x,u=0;"left"===t?u=-n:"center"===t?u=(i-d-2*n)/2:"right"===t?u=i-d-n:"justify"===t&&r.length>2&&(u=(i-l.w-c.w)/(r.length-2));for(var h=0;h<r.length;h++){var p=r[h];"justify"===t?0===h?p.x=0:h===r.length-1?p.x=i-p.w:p.x=l.w+u*(h-1)+(u-p.w)/2:p.x+=u,o.push(p)}}return o}},{key:"setLinesPosition",value:function(e,t){var n=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i],a=e[i+1],s=o.x,r=o.y+("underline"===t?o.h:"line-through"===t?o.h/2:0),l=a&&a.x>s?a.x:s+o.w,c=r;n.push({x1:s,x2:l,y1:r,y2:c})}return n}},{key:"groupTexts",value:function(e,t){for(var n=[],i={},o=0;o<e.length;o++){var a=e[o][t];i[a]||(i[a]=[]),i[a].push(e[o])}for(var s in i)n.push(i[s]);return n}},{key:"updateEditBox",value:function(){Vue.elementsBoxs.getElementBoxEditResizing()||(1===Vue.elements.getSelected().length?this.selected&&Vue.elementsBoxs.setSelectedElement([this]):Vue.elements.getSelected().length>1&&(Vue.elementsBoxs.setSelectedElement(Vue.elements.getSelected()),Vue.elementsBoxs.setHoverElement(Vue.elements.getSelected()),Vue.elementsBoxs.setGroupElement(Vue.elements.getSelected())))}}],[{key:"dropShadow",value:function(e){if(e.color.indexOf("#")>-1){var t=D.hex2rgba(e.color);e.color="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}else if(e.transparency!==e.lastTransparency){var n=parseFloat((100-e.transparency)/100).toFixed(2),i=e.color.match(/(\d(\.\d+)?)+/g);e.color="rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(n,")"),e.lastTransparency=e.transparency}else{var o=e.color.match(/(\d(\.\d+)?)+/g),a=100-parseInt(100*o[3]);e.transparency=a}return e}},{key:"cube",value:function(e,t){var n=[];if(e)for(var i=t*Math.PI/180,o=e[0].color,a=e[0].size,s=0;s<a;s++)n.push({color:o,x:s*Math.cos(i),y:s*Math.sin(i)});return n}},{key:"shake",value:function(e,t){var n=[];if(e)for(var i=t*Math.PI/180,o=e.colors[0],a=e.colors[1],s=e.size,r=1;r<=2;r++)for(var l=1;l<=s;l++)1===r?n.push({color:o,x:-l*Math.cos(i),y:-l*Math.sin(i)}):n.push({color:a,x:l*Math.cos(i),y:l*Math.sin(i)});return n}}]),i}(At);var cn={svg:function(e){return axios.get(e,{withCredentials:!1,ignoreInterceptor:!0}).then((function(e){var t=Date.now(),n=e.data.replace(/st\d+/g,(function(e){return e+t})).replace(/\(#(.*?)\)/g,(function(e,n){return"(#".concat(n+t,")")})).replace(/id="(.*?)"/g,(function(e,n){return'id="'.concat(n+t,'"')})),i=document.createElement("div");i.innerHTML=n;var o=i.querySelector("svg"),a=o.attr("width"),s=o.attr("height"),r=o.attr("viewBox"),l=r&&"string"==typeof r?r.split(" "):[0,0,parseInt(a),parseInt(s)];return o.attr({viewBox:"0 0 ".concat(l[2]," ").concat(l[3]),width:a||l[2],height:s||l[3]}),o}))}},dn=["a","animate","animateMotion","animateTransform","circle","clipPath","color-profile","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","g","hatch","hatchpath","image","line","linearGradient","marker","mask","mesh","meshgradient","meshpatch","meshrow","metadata","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","solidcolor","stop","svg","switch","symbol","text","textPath","title","tspan","unknown","use","view"],un=["accent-height","accumulate","additive","alignment-baseline","allowReorder","alphabetic","amplitude","arabic-form","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baseline-shift","baseProfile","bbox","begin","bias","by","calcMode","cap-height","class","clip","clipPathUnits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominant-baseline","dur","dx","dy","edgeMode","elevation","enable-background","end","exponent","externalResourcesRequired","fill","fill-opacity","fill-rule","filter","filterRes","filterUnits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","format","from","fr","fx","fy","g1","g2","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","glyphRef","gradientTransform","gradientUnits","hanging","height","href","hreflang","horiz-adv-x","horiz-origin-x","id","ideographic","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lang","lengthAdjust","letter-spacing","lighting-color","limitingConeAngle","local","marker-end","marker-mid","marker-start","markerHeight","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","max","media","method","min","mode","name","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overline-position","overline-thickness","panose-1","paint-order","path","pathLength","patternContentUnits","patternTransform","patternUnits","ping","pointer-events","points","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","referrerPolicy","refX","refY","rel","rendering-intent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","scale","seed","shape-rendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","string","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","surfaceScale","systemLanguage","tabindex","tableValues","target","targetX","targetY","text-anchor","text-decoration","text-rendering","textLength","to","transform","type","u1","u2","underline-position","underline-thickness","unicode","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","values","vector-effect","version","vert-adv-y","vert-origin-x","vert-origin-y","viewBox","viewTarget","visibility","width","widths","word-spacing","writing-mode","x","x-height","x1","x2","xChannelSelector","xlink:actuate","xlink:arcrole","xlink:href","xlink:role","xlink:show","xlink:title","xlink:type","xml:base","xml:lang","xml:space","y","y1","y2","yChannelSelector","z","zoomAndPan"],hn=function e(t){for(var n=0;n<t.children.length;n++){for(var i=[],o=t.children[n],a=0;a<o.attributes.length;a++){var s=o.attributes[a].name;un.includes(s)||i.push(s)}for(var r=0;r<i.length;r++)o.removeAttr(i[r]);e(o)}return t},pn=function e(t){for(var n=[],i=0;i<t.children.length;i++){var o=t.children[i];dn.includes(o.nodeName)?e(o):n.push(o)}for(var a=0;a<n.length;a++)t.removeChild(n[a]);return t},mn=function(e){return e=pn(e),e=hn(e)},gn=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),o=t.call(this,e),e.id||(e.css=Object.assign({rotate:0},e.css)),o.elementJson=e,o}return o(i,[{key:"updateId",value:function(e){h(r(i.prototype),"updateId",this).call(this,e)}},{key:"render",value:function(){var e=this;h(r(i.prototype),"render",this).call(this);var t=this.elementJson.property;this.setSvg(t.url).then((function(){e.updateCss(e.elementJson.css)}))}},{key:"setSvg",value:function(e){var t=this,n=this.elementJson.css,i=Object.assign({},n,{left:"",top:"",transform:"",zIndex:"",border:"",verticalAlign:"top",boxSizing:"content-box"});return cn.svg(e).then((function(e){e=mn(e);var n=t.$svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=parseFloat(e.attr("width")),a=parseFloat(e.attr("height")),s=e.attr("viewBox");n.css(i).attr({width:o,height:a,viewBox:s,preserveAspectRatio:"none"}).innerHTML='<defs>\n                                    <linearGradient id="Gradient_'.concat(t.elementJson.id,'" class="gradient-direction" x1="0" x2="0" y1="0" y2="1">\n                                        <stop class="stop-color-1" offset="0%" stop-color="#ffffff"/>\n                                        <stop class="stop-color-2" offset="100%" stop-color="#ffffff"/>\n                                    </linearGradient>\n                                </defs>\n                                ').concat(e.innerHTML),t.$paths=t.getShapPathByFillColor(n),t.updateProperty(t.elementJson.property),t.$el.appendChild(n),t.$stop1=n.querySelector(".stop-color-1"),t.$stop2=n.querySelector(".stop-color-2"),t.$direction=n.querySelector(".gradient-direction")}))}},{key:"getShapPathByFillColor",value:function(e){var t=e.querySelectorAll("[fill], [style*='fill:']"),n=this.elementJson.property.items,i=!1;n&&n.length===t.length&&t.forEach((function(e,t){n[t]&&n[t].fill&&!n[t].noUpdate&&(e.attr({fill:n[t].fill}),i=!0)}));var o={};return t.forEach((function(e,t){var n=e.css("fill"),i=e.attr("fill"),a=n||i||"rgba(0,0,0,0)";if(a.indexOf("rgb(")>-1&&"none"!==a){var s=a.match(/(\d(\.\d+)?)+/g);a=D.rgb2hex({r:s[0],g:s[1],b:s[2]},!0)}var r="gp_".concat(a);o[r]?o[r].push(e):o[r]=[e]})),i&&this.getShapeItems(o),o}},{key:"getShapeItems",value:function(e){var t=[];for(var n in e)t.push({fill:n.split("_")[1],gpId:n});this.elementJson.property.items=t}},{key:"setPathColor",value:function(e){var t=this,n=e.items,i=e.gradient;if(n&&1===n.length&&n[0].fill===e.lastModifyColor&&i&&i.enabled){if(this.$paths)for(var o in this.$paths)this.$paths[o].forEach((function(e){e.attr({fill:"url(#Gradient_".concat(t.elementJson.id,")")}),e.css({fill:"url(#Gradient_".concat(t.elementJson.id,")")})}));i.colors&&(this.$stop1&&this.$stop1.attr({"stop-color":i.colors[0]}),this.$stop1&&this.$stop2.attr({"stop-color":i.colors[1]})),[0,90,180,270].includes(i.angle)&&(90===i.angle?this.$direction&&this.$direction.attr({x1:"0",x2:"1",y1:"0",y2:"0"}):270===i.angle?this.$direction&&this.$direction.attr({x1:"1",x2:"0",y1:"0",y2:"0"}):180===i.angle?this.$direction&&this.$direction.attr({x1:"1",x2:"1",y1:"0",y2:"1"}):0===i.angle&&this.$direction&&this.$direction.attr({x1:"1",x2:"1",y1:"1",y2:"0"}))}else n&&this.$paths&&(n.forEach((function(e,n){for(var i in t.$paths)i!==e.gpId&&i!=="gp_".concat(e.svgFill)||t.$paths[i].forEach((function(t){t.attr({fill:e.fill}),t.css({fill:e.fill})}))})),e.gradient&&1===n.length&&(e.lastModifyColor=n[0].fill,e.gradient.enabled=!1))}},{key:"updateCss",value:function(e){h(r(i.prototype),"updateCss",this).call(this,e),h(r(i.prototype),"setScale",this).call(this),Object.prototype.hasOwnProperty.call(e,"border")&&delete e.border,this.$svg&&this.$svg.css(e).css({left:"",top:"",zIndex:"",transform:""}),this.updateProperty(this.elementJson.property)}},{key:"updateProperty",value:function(e){h(r(i.prototype),"updateProperty",this).call(this,e);var t=this.elementJson.property,n=t.dropShadow,o=t.rotateX,a=t.rotateY,s=t.borderRadius,l=[];this.setPathColor(e),o&&l.push("rotateX(180deg)"),a&&l.push(" rotateY(180deg)"),this.$svg&&this.$svg.css({transform:l.join(" ")}),this.$svg&&this.$svg.css(i.dropShadow(n)),this.$svg&&this.$svg.css(i.borderRadius(s))}},{key:"settingUpdateCss",value:function(e){this.updateCss(e),this.selected&&Vue.elementsBoxs.setSelectedElement([this])}},{key:"settingUpdateProperty",value:function(e){this.updateProperty(e)}}],[{key:"dropShadow",value:function(e){var t={};if(e){if(e.transparency!==e.lastTransparency){var n=parseFloat((100-e.transparency)/100).toFixed(2),i=e.color.match(/(\d(\.\d+)?)+/g);e.color="rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(n,")"),e.lastTransparency=e.transparency}else{var o=e.color.match(/(\d(\.\d+)?)+/g),a=100-parseInt(100*o[3]);e.transparency=a}t.filter="drop-shadow(".concat(e.x,"px ").concat(e.y,"px ").concat(e.blur,"px ").concat(e.color,")")}return t}},{key:"borderRadius",value:function(e){var t={};if(e){var n=e.lt?e.val:"0px",i=e.rt?e.val:"0px",o=e.lb?e.val:"0px",a=e.rb?e.val:"0px";t.borderRadius="".concat(n,"px ").concat(i,"px ").concat(a,"px ").concat(o,"px")}return t}}]),i}(At),fn=function(t,n){var i,o,a,s,r;void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(c),l.update(),p=h.NONE},this.update=(i=new e.Vector3,o=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),a=o.clone().inverse(),s=new e.Vector3,r=new e.Quaternion,function(){var e=l.object.position;return i.copy(e).sub(l.target),i.applyQuaternion(o),g.setFromVector3(i),l.autoRotate&&p===h.NONE&&$(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(g.theta+=f.theta*l.dampingFactor,g.phi+=f.phi*l.dampingFactor):(g.theta+=f.theta,g.phi+=f.phi),g.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,g.theta)),g.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=v,g.radius=Math.max(l.minDistance,Math.min(l.maxDistance,g.radius)),!0===l.enableDamping?l.target.addScaledVector(y,l.dampingFactor):l.target.add(y),i.setFromSpherical(g),i.applyQuaternion(a),e.copy(l.target).add(i),l.object.lookAt(l.target),!0===l.enableDamping?(f.theta*=1-l.dampingFactor,f.phi*=1-l.dampingFactor,y.multiplyScalar(1-l.dampingFactor)):(f.set(0,0,0),y.set(0,0,0)),v=1,!!(x||s.distanceToSquared(l.object.position)>m||8*(1-r.dot(l.object.quaternion))>m)&&(l.dispatchEvent(c),s.copy(l.object.position),r.copy(l.object.quaternion),x=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",ee,!1),l.domElement.removeEventListener("mousedown",Y,!1),l.domElement.removeEventListener("wheel",U,!1),l.domElement.removeEventListener("touchstart",K,!1),l.domElement.removeEventListener("touchend",Q,!1),l.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",W,!1),l.domElement.removeEventListener("keydown",X,!1)};var l=this,c={type:"change"},d={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=h.NONE,m=1e-6,g=new e.Spherical,f=new e.Spherical,v=1,y=new e.Vector3,x=!1,b=new e.Vector2,w=new e.Vector2,_=new e.Vector2,k=new e.Vector2,E=new e.Vector2,S=new e.Vector2,C=new e.Vector2,B=new e.Vector2,R=new e.Vector2;function L(){return Math.pow(.95,l.zoomSpeed)}function $(e){f.theta-=e}function V(e){f.phi-=e}var F,T=(F=new e.Vector3,function(e,t){F.setFromMatrixColumn(t,0),F.multiplyScalar(-e),y.add(F)}),z=function(){var t=new e.Vector3;return function(e,n){!0===l.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(l.object.up,t)),t.multiplyScalar(e),y.add(t)}}(),H=function(){var t=new e.Vector3;return function(e,n){var i=l.domElement;if(l.object.isPerspectiveCamera){var o=l.object.position;t.copy(o).sub(l.target);var a=t.length();a*=Math.tan(l.object.fov/2*Math.PI/180),T(2*e*a/i.clientHeight,l.object.matrix),z(2*n*a/i.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(T(e*(l.object.right-l.object.left)/l.object.zoom/i.clientWidth,l.object.matrix),z(n*(l.object.top-l.object.bottom)/l.object.zoom/i.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function D(e){l.object.isPerspectiveCamera?v/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function A(e){l.object.isPerspectiveCamera?v*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function O(e){b.set(e.clientX,e.clientY)}function P(e){k.set(e.clientX,e.clientY)}function M(e){if(1===e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}}function J(e){if(1===e.touches.length)k.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);k.set(t,n)}}function I(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);C.set(0,i)}function N(e){if(1===e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}_.subVectors(w,b).multiplyScalar(l.rotateSpeed);var i=l.domElement;$(2*Math.PI*_.x/i.clientHeight),V(2*Math.PI*_.y/i.clientHeight),b.copy(w)}function G(e){if(1===e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}S.subVectors(E,k).multiplyScalar(l.panSpeed),H(S.x,S.y),k.copy(E)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);B.set(0,i),R.set(0,Math.pow(B.y/C.y,l.zoomSpeed)),D(R.y),C.copy(B)}function Y(t){if(!1!==l.enabled){var n;switch(t.preventDefault(),l.domElement.focus?l.domElement.focus():window.focus(),t.button){case 0:n=l.mouseButtons.LEFT;break;case 1:n=l.mouseButtons.MIDDLE;break;case 2:n=l.mouseButtons.RIGHT;break;default:n=-1}switch(n){case e.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){C.set(e.clientX,e.clientY)}(t),p=h.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enablePan)return;P(t),p=h.PAN}else{if(!1===l.enableRotate)return;O(t),p=h.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enableRotate)return;O(t),p=h.ROTATE}else{if(!1===l.enablePan)return;P(t),p=h.PAN}break;default:p=h.NONE}p!==h.NONE&&(document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",W,!1),l.dispatchEvent(d))}}function j(e){if(!1!==l.enabled)switch(e.preventDefault(),p){case h.ROTATE:if(!1===l.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,b).multiplyScalar(l.rotateSpeed);var t=l.domElement;$(2*Math.PI*_.x/t.clientHeight),V(2*Math.PI*_.y/t.clientHeight),b.copy(w),l.update()}(e);break;case h.DOLLY:if(!1===l.enableZoom)return;!function(e){B.set(e.clientX,e.clientY),R.subVectors(B,C),R.y>0?D(L()):R.y<0&&A(L()),C.copy(B),l.update()}(e);break;case h.PAN:if(!1===l.enablePan)return;!function(e){E.set(e.clientX,e.clientY),S.subVectors(E,k).multiplyScalar(l.panSpeed),H(S.x,S.y),k.copy(E),l.update()}(e)}}function W(e){!1!==l.enabled&&(document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",W,!1),l.dispatchEvent(u),p=h.NONE)}function U(e){!1===l.enabled||!1===l.enableZoom||p!==h.NONE&&p!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),l.dispatchEvent(d),function(e){e.deltaY<0?A(L()):e.deltaY>0&&D(L()),l.update()}(e),l.dispatchEvent(u))}function X(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){var t=!1;switch(e.keyCode){case l.keys.UP:H(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:H(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:H(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:H(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function K(t){if(!1!==l.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(l.touches.ONE){case e.TOUCH.ROTATE:if(!1===l.enableRotate)return;M(t),p=h.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===l.enablePan)return;J(t),p=h.TOUCH_PAN;break;default:p=h.NONE}break;case 2:switch(l.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&I(e),l.enablePan&&J(e)}(t),p=h.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&I(e),l.enableRotate&&M(e)}(t),p=h.TOUCH_DOLLY_ROTATE;break;default:p=h.NONE}break;default:p=h.NONE}p!==h.NONE&&l.dispatchEvent(d)}}function Z(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case h.TOUCH_ROTATE:if(!1===l.enableRotate)return;N(e),l.update();break;case h.TOUCH_PAN:if(!1===l.enablePan)return;G(e),l.update();break;case h.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&q(e),l.enablePan&&G(e)}(e),l.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&q(e),l.enableRotate&&N(e)}(e),l.update();break;default:p=h.NONE}}function Q(e){!1!==l.enabled&&(l.dispatchEvent(u),p=h.NONE)}function ee(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",ee,!1),l.domElement.addEventListener("mousedown",Y,!1),l.domElement.addEventListener("wheel",U,!1),l.domElement.addEventListener("touchstart",K,!1),l.domElement.addEventListener("touchend",Q,!1),l.domElement.addEventListener("touchmove",Z,!1),l.domElement.addEventListener("keydown",X,!1),-1===l.domElement.tabIndex&&(l.domElement.tabIndex=0),this.update()};(fn.prototype=Object.create(e.EventDispatcher.prototype)).constructor=fn;var vn=function(t,n){fn.call(this,t,n),this.mouseButtons.LEFT=e.MOUSE.PAN,this.mouseButtons.RIGHT=e.MOUSE.ROTATE,this.touches.ONE=e.TOUCH.PAN,this.touches.TWO=e.TOUCH.DOLLY_ROTATE};function yn(e,t){var n=e.__state.conversionName.toString(),i=Math.round(e.r),o=Math.round(e.g),a=Math.round(e.b),s=e.a,r=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+i+","+o+","+a+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+a+","+s+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+a+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+a+","+s+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+a+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+a+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+r+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+r+",s:"+l+",v:"+c+",a:"+s+"}":"unknown format"}(vn.prototype=Object.create(e.EventDispatcher.prototype)).constructor=vn;var xn=Array.prototype.forEach,bn=Array.prototype.slice,wn={BREAK:{},extend:function(e){return this.each(bn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(bn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=bn.call(arguments);return function(){for(var t=bn.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(xn&&e.forEach&&e.forEach===xn)e.forEach(t,n);else if(e.length===e.length+0){var i,o=void 0;for(o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var o=this,a=arguments;function s(){i=null,n||e.apply(o,a)}var r=n||!i;clearTimeout(i),i=setTimeout(s,t),r&&e.apply(o,a)}},toArray:function(e){return e.toArray?e.toArray():bn.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},_n=[{litmus:wn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:yn},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:yn},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:yn},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:yn}}},{litmus:wn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:wn.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:wn.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(wn.isNumber(e.r)&&wn.isNumber(e.g)&&wn.isNumber(e.b)&&wn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(wn.isNumber(e.r)&&wn.isNumber(e.g)&&wn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(wn.isNumber(e.h)&&wn.isNumber(e.s)&&wn.isNumber(e.v)&&wn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(wn.isNumber(e.h)&&wn.isNumber(e.s)&&wn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],kn=void 0,En=void 0,Sn=function(){En=!1;var e=arguments.length>1?wn.toArray(arguments):arguments[0];return wn.each(_n,(function(t){if(t.litmus(e))return wn.each(t.conversions,(function(t,n){if(kn=t.read(e),!1===En&&!1!==kn)return En=kn,kn.conversionName=n,kn.conversion=t,wn.BREAK})),wn.BREAK})),En},Cn=void 0,Bn={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),a=n*(1-t),s=n*(1-o*t),r=n*(1-(1-o)*t),l=[[n,r,a],[s,n,a],[a,n,r],[a,s,n],[r,a,n],[n,a,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),o=Math.max(e,t,n),a=o-i,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=e===o?(t-n)/a:t===o?2+(n-e)/a:4+(e-t)/a,(s/=6)<0&&(s+=1),{h:360*s,s:a/o,v:o/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Cn=8*t)|e&~(255<<Cn)}},Rn="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},Ln=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},$n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vn=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},Fn=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+t(n));e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},Tn=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==t(n)&&"function"!=typeof n?e:n},zn=function(){function e(){if(Ln(this,e),this.__state=Sn.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return $n(e,[{key:"toString",value:function(){return yn(this)}},{key:"toHexString",value:function(){return yn(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Hn(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||zn.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(zn.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function Dn(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||zn.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(zn.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}zn.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Bn.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");wn.extend(e.__state,Bn.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},zn.recalculateHSV=function(e){var t=Bn.rgb_to_hsv(e.r,e.g,e.b);wn.extend(e.__state,{s:t.s,v:t.v}),wn.isNaN(t.h)?wn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},zn.COMPONENTS=["r","g","b","h","s","v","hex","a"],Hn(zn.prototype,"r",2),Hn(zn.prototype,"g",1),Hn(zn.prototype,"b",0),Dn(zn.prototype,"h"),Dn(zn.prototype,"s"),Dn(zn.prototype,"v"),Object.defineProperty(zn.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(zn.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Bn.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var An=function(){function e(t,n){Ln(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return $n(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),On={};wn.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){wn.each(e,(function(e){On[e]=t}))}));var Pn=/(\d+(\.\d+)?)px/;function Mn(e){if("0"===e||wn.isUndefined(e))return 0;var t=e.match(Pn);return wn.isNull(t)?0:parseFloat(t[1])}var Jn={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,o=t;wn.isUndefined(o)&&(o=!0),wn.isUndefined(i)&&(i=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var o=n||{},a=On[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var r=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,r,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;wn.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(t,o.bubbles||!1,o.cancelable||!0)}wn.defaults(s,i),e.dispatchEvent(s)},bind:function(e,t,n,i){var o=i||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),Jn},unbind:function(e,t,n,i){var o=i||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),Jn},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Jn},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!==i&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return Jn},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Mn(t["border-left-width"])+Mn(t["border-right-width"])+Mn(t["padding-left"])+Mn(t["padding-right"])+Mn(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Mn(t["border-top-width"])+Mn(t["border-bottom-width"])+Mn(t["padding-top"])+Mn(t["padding-bottom"])+Mn(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},In=function(e){function t(e,n){Ln(this,t);var i=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),Jn.bind(i.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return Fn(t,e),$n(t,[{key:"setValue",value:function(e){var n=Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(An),Nn=function(e){function t(e,n,i){Ln(this,t);var o=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i,s=o;if(o.__select=document.createElement("select"),wn.isArray(a)){var r={};wn.each(a,(function(e){r[e]=e})),a=r}return wn.each(a,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)})),o.updateDisplay(),Jn.bind(o.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),o.domElement.appendChild(o.__select),o}return Fn(t,e),$n(t,[{key:"setValue",value:function(e){var n=Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Jn.isActive(this.__select)?this:(this.__select.value=this.getValue(),Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(An),Gn=function(e){function t(e,n){Ln(this,t);var i=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;function a(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Jn.bind(i.__input,"keyup",a),Jn.bind(i.__input,"change",a),Jn.bind(i.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),Jn.bind(i.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return Fn(t,e),$n(t,[{key:"updateDisplay",value:function(){return Jn.isActive(this.__input)||(this.__input.value=this.getValue()),Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(An);function qn(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var Yn=function(e){function t(e,n,i){Ln(this,t);var o=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,wn.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=qn(o.__impliedStep),o}return Fn(t,e),$n(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=qn(e),this}}]),t}(An);var jn=function(e){function t(e,n,i){Ln(this,t);var o=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));o.__truncationSuspended=!1;var a=o,s=void 0;function r(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function c(){Jn.unbind(window,"mousemove",l),Jn.unbind(window,"mouseup",c),r()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Jn.bind(o.__input,"change",(function(){var e=parseFloat(a.__input.value);wn.isNaN(e)||a.setValue(e)})),Jn.bind(o.__input,"blur",(function(){r()})),Jn.bind(o.__input,"mousedown",(function(e){Jn.bind(window,"mousemove",l),Jn.bind(window,"mouseup",c),s=e.clientY})),Jn.bind(o.__input,"keydown",(function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,r())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Fn(t,e),$n(t,[{key:"updateDisplay",value:function(){var e,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(e*i)/i),Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Yn);function Wn(e,t,n,i,o){return i+(e-t)/(n-t)*(o-i)}var Un=function(e){function t(e,n,i,o,a){Ln(this,t);var s=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:i,max:o,step:a})),r=s;function l(e){e.preventDefault();var t=r.__background.getBoundingClientRect();return r.setValue(Wn(e.clientX,t.left,t.right,r.__min,r.__max)),!1}function c(){Jn.unbind(window,"mousemove",l),Jn.unbind(window,"mouseup",c),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function d(e){var t=e.touches[0].clientX,n=r.__background.getBoundingClientRect();r.setValue(Wn(t,n.left,n.right,r.__min,r.__max))}function u(){Jn.unbind(window,"touchmove",d),Jn.unbind(window,"touchend",u),r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),Jn.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),Jn.bind(window,"mousemove",l),Jn.bind(window,"mouseup",c),l(e)})),Jn.bind(s.__background,"touchstart",(function(e){if(1!==e.touches.length)return;Jn.bind(window,"touchmove",d),Jn.bind(window,"touchend",u),d(e)})),Jn.addClass(s.__background,"slider"),Jn.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return Fn(t,e),$n(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Yn),Xn=function(e){function t(e,n,i){Ln(this,t);var o=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,Jn.bind(o.__button,"click",(function(e){return e.preventDefault(),a.fire(),!1})),Jn.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Fn(t,e),$n(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(An),Kn=function(e){function t(e,n){Ln(this,t);var i=Tn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));i.__color=new zn(i.getValue()),i.__temp=new zn(0);var o=i;i.domElement=document.createElement("div"),Jn.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",Jn.bind(i.__input,"keydown",(function(e){13===e.keyCode&&u.call(this)})),Jn.bind(i.__input,"blur",u),Jn.bind(i.__selector,"mousedown",(function(){Jn.addClass(this,"drag").bind(window,"mouseup",(function(){Jn.removeClass(o.__selector,"drag")}))})),Jn.bind(i.__selector,"touchstart",(function(){Jn.addClass(this,"drag").bind(window,"touchend",(function(){Jn.removeClass(o.__selector,"drag")}))}));var a,s=document.createElement("div");function r(e){p(e),Jn.bind(window,"mousemove",p),Jn.bind(window,"touchmove",p),Jn.bind(window,"mouseup",c),Jn.bind(window,"touchend",c)}function l(e){m(e),Jn.bind(window,"mousemove",m),Jn.bind(window,"touchmove",m),Jn.bind(window,"mouseup",d),Jn.bind(window,"touchend",d)}function c(){Jn.unbind(window,"mousemove",p),Jn.unbind(window,"touchmove",p),Jn.unbind(window,"mouseup",c),Jn.unbind(window,"touchend",c),h()}function d(){Jn.unbind(window,"mousemove",m),Jn.unbind(window,"touchmove",m),Jn.unbind(window,"mouseup",d),Jn.unbind(window,"touchend",d),h()}function u(){var e=Sn(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function h(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,i=n.clientX,a=n.clientY,s=(i-t.left)/(t.right-t.left),r=1-(a-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),s>1?s=1:s<0&&(s=0),o.__color.v=r,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return wn.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),wn.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),wn.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),wn.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),wn.extend(s.style,{width:"100%",height:"100%",background:"none"}),Qn(s,"top","rgba(0,0,0,0)","#000"),wn.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=i.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",wn.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),Jn.bind(i.__saturation_field,"mousedown",r),Jn.bind(i.__saturation_field,"touchstart",r),Jn.bind(i.__field_knob,"mousedown",r),Jn.bind(i.__field_knob,"touchstart",r),Jn.bind(i.__hue_field,"mousedown",l),Jn.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return Fn(t,e),$n(t,[{key:"updateDisplay",value:function(){var e=Sn(this.getValue());if(!1!==e){var t=!1;wn.each(zn.COMPONENTS,(function(n){if(!wn.isUndefined(e[n])&&!wn.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&wn.extend(this.__color.__state,e)}wn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;wn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Qn(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),wn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(An),Zn=["-moz-","-o-","-webkit-","-ms-",""];function Qn(e,t,n,i){e.style.background="",wn.each(Zn,(function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "}))}var ei=function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(e){}},ti='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ni=function(e,t){var n=e[t];return wn.isArray(arguments[2])||wn.isObject(arguments[2])?new Nn(e,t,arguments[2]):wn.isNumber(n)?wn.isNumber(arguments[2])&&wn.isNumber(arguments[3])?wn.isNumber(arguments[4])?new Un(e,t,arguments[2],arguments[3],arguments[4]):new Un(e,t,arguments[2],arguments[3]):wn.isNumber(arguments[4])?new jn(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new jn(e,t,{min:arguments[2],max:arguments[3]}):wn.isString(n)?new Gn(e,t):wn.isFunction(n)?new Xn(e,t,""):wn.isBoolean(n)?new In(e,t):null};var ii=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},oi=function(){function e(){Ln(this,e),this.backgroundElement=document.createElement("div"),wn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Jn.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),wn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Jn.bind(this.backgroundElement,"click",(function(){t.hide()}))}return $n(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),wn.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Jn.unbind(e.domElement,"webkitTransitionEnd",t),Jn.unbind(e.domElement,"transitionend",t),Jn.unbind(e.domElement,"oTransitionEnd",t)};Jn.bind(this.domElement,"webkitTransitionEnd",t),Jn.bind(this.domElement,"transitionend",t),Jn.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Jn.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Jn.getHeight(this.domElement)/2+"px"}}]),e}();ei(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ai=function(){try{return!!window.localStorage}catch(e){return!1}}(),si=void 0,ri=!0,li=void 0,ci=!1,di=[],ui=function e(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Jn.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=wn.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=wn.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),wn.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),wn.isUndefined(i.parent)&&i.hideable&&di.push(this),i.resizable=wn.isUndefined(i.parent)&&i.resizable,i.autoPlace&&wn.isUndefined(i.scrollable)&&(i.scrollable=!0);var o,a=ai&&"true"===localStorage.getItem(vi(this,"isLocal")),s=void 0,r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(e){n.parent?n.getRoot().preset=e:i.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,_i(n,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,r&&(r.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?Jn.addClass(n.__ul,e.CLASS_CLOSED):Jn.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return a},set:function(e){ai&&(a=e,e?Jn.bind(window,"unload",s):Jn.unbind(window,"unload",s),localStorage.setItem(vi(n,"isLocal"),e))}}}),wn.isUndefined(i.parent)){if(this.closed=i.closed||!1,Jn.addClass(this.domElement,e.CLASS_MAIN),Jn.makeSelectable(this.domElement,!1),ai&&a){n.useLocalStorage=!0;var l=localStorage.getItem(vi(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Jn.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(Jn.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Jn.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Jn.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var c=document.createTextNode(i.name);Jn.addClass(c,"controller-name"),r=hi(n,c);Jn.addClass(this.__ul,e.CLASS_CLOSED),Jn.addClass(r,"title"),Jn.bind(r,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(wn.isUndefined(i.parent)&&(ri&&(li=document.createElement("div"),Jn.addClass(li,"dg"),Jn.addClass(li,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(li),ri=!1),li.appendChild(this.domElement),Jn.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||_i(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Jn.bind(window,"resize",this.__resizeHandler),Jn.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Jn.bind(this.__ul,"transitionend",this.__resizeHandler),Jn.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&wi(this),s=function(){ai&&"true"===localStorage.getItem(vi(n,"isLocal"))&&localStorage.setItem(vi(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((o=n.getRoot()).width+=1,wn.defer((function(){o.width-=1})))};function hi(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,n):e.__ul.appendChild(i),e.onResize(),i}function pi(e){Jn.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Jn.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function mi(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function gi(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[t.property]=t,n.load&&n.load.remembered){var a=n.load.remembered,s=void 0;if(a[e.preset])s=a[e.preset];else{if(!a.Default)return;s=a.Default}if(s[i]&&void 0!==s[i][t.property]){var r=s[i][t.property];t.initialValue=r,t.setValue(r)}}}}function fi(e,t,n,i){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new Kn(t,n);else{var a=[t,n].concat(i.factoryArgs);o=ni.apply(e,a)}i.before instanceof An&&(i.before=i.before.__li),gi(e,o),Jn.addClass(o.domElement,"c");var s=document.createElement("span");Jn.addClass(s,"property-name"),s.innerHTML=o.property;var r=document.createElement("div");r.appendChild(s),r.appendChild(o.domElement);var l=hi(e,r,i.before);return Jn.addClass(l,ui.CLASS_CONTROLLER_ROW),o instanceof Kn?Jn.addClass(l,"color"):Jn.addClass(l,Rn(o.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,wn.extend(n,{options:function(t){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),fi(e,n.object,n.property,{before:i,factoryArgs:[wn.toArray(arguments)]})}if(wn.isArray(t)||wn.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),fi(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Un){var i=new jn(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});wn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],o=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(i,e),t.apply(n,e)}})),Jn.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof jn){var o=function(t){if(wn.isNumber(n.__min)&&wn.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=fi(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(i),o&&a.listen(),a}return t};n.min=wn.compose(o,n.min),n.max=wn.compose(o,n.max)}else n instanceof In?(Jn.bind(t,"click",(function(){Jn.fakeEvent(n.__checkbox,"click")})),Jn.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof Xn?(Jn.bind(t,"click",(function(){Jn.fakeEvent(n.__button,"click")})),Jn.bind(t,"mouseover",(function(){Jn.addClass(n.__button,"hover")})),Jn.bind(t,"mouseout",(function(){Jn.removeClass(n.__button,"hover")}))):n instanceof Kn&&(Jn.addClass(t,"color"),n.updateDisplay=wn.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=wn.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&mi(e.getRoot(),!0),t}),n.setValue)}(e,l,o),e.__controllers.push(o),o}function vi(e,t){return document.location.href+"."+t}function yi(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function xi(e,t){t.style.display=e.useLocalStorage?"block":"none"}function bi(e){var t=e.__save_row=document.createElement("li");Jn.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Jn.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Jn.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",Jn.addClass(i,"button"),Jn.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",Jn.addClass(o,"button"),Jn.addClass(o,"save-as");var a=document.createElement("span");a.innerHTML="Revert",Jn.addClass(a,"button"),Jn.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?wn.each(e.load.remembered,(function(t,n){yi(e,n,n===e.preset)})):yi(e,"Default",!1),Jn.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(a),ai){var r=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(vi(0,"isLocal"))&&l.setAttribute("checked","checked"),xi(e,r),Jn.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,xi(e,r)}))}var c=document.getElementById("dg-new-constructor");Jn.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||si.hide()})),Jn.bind(n,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),si.show(),c.focus(),c.select()})),Jn.bind(i,"click",(function(){e.save()})),Jn.bind(o,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Jn.bind(a,"click",(function(){e.revert()}))}function wi(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function i(){Jn.removeClass(e.__closeButton,ui.CLASS_DRAG),Jn.unbind(window,"mousemove",n),Jn.unbind(window,"mouseup",i)}function o(o){return o.preventDefault(),t=o.clientX,Jn.addClass(e.__closeButton,ui.CLASS_DRAG),Jn.bind(window,"mousemove",n),Jn.bind(window,"mouseup",i),!1}e.__resize_handle=document.createElement("div"),wn.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Jn.bind(e.__resize_handle,"mousedown",o),Jn.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function _i(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ki(e,t){var n={};return wn.each(e.__rememberedObjects,(function(i,o){var a={},s=e.__rememberedObjectIndecesToControllers[o];wn.each(s,(function(e,n){a[n]=t?e.initialValue:e.getValue()})),n[o]=a})),n}ui.toggleHide=function(){ci=!ci,wn.each(di,(function(e){e.domElement.style.display=ci?"none":""}))},ui.CLASS_AUTO_PLACE="a",ui.CLASS_AUTO_PLACE_CONTAINER="ac",ui.CLASS_MAIN="main",ui.CLASS_CONTROLLER_ROW="cr",ui.CLASS_TOO_TALL="taller-than-window",ui.CLASS_CLOSED="closed",ui.CLASS_CLOSE_BUTTON="close-button",ui.CLASS_CLOSE_TOP="close-top",ui.CLASS_CLOSE_BOTTOM="close-bottom",ui.CLASS_DRAG="drag",ui.DEFAULT_WIDTH=245,ui.TEXT_CLOSED="Close Controls",ui.TEXT_OPEN="Open Controls",ui._keydownHandler=function(e){!document.activeElement||"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||ui.toggleHide()},Jn.bind(window,"keydown",ui._keydownHandler,!1),wn.extend(ui.prototype,{add:function(e,t){return fi(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return fi(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;wn.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&li.removeChild(this.domElement);var e=this;wn.each(this.__folders,(function(t){e.removeFolder(t)})),Jn.unbind(window,"keydown",ui._keydownHandler,!1),pi(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new ui(t);this.__folders[e]=n;var i=hi(this,n.domElement);return Jn.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],pi(e);var t=this;wn.each(e.__folders,(function(t){e.removeFolder(t)})),wn.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Jn.getOffset(e.__ul).top,n=0;wn.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=Jn.getHeight(t))})),window.innerHeight-t-20<n?(Jn.addClass(e.domElement,ui.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(Jn.removeClass(e.domElement,ui.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&wn.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:wn.debounce((function(){this.onResize()}),50),remember:function(){if(wn.isUndefined(si)&&((si=new oi).domElement.innerHTML=ti),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;wn.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&bi(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&_i(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ki(this)),e.folders={},wn.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ki(this),mi(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=ki(this,!0)),this.load.remembered[e]=ki(this),this.preset=e,yi(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){wn.each(this.__controllers,(function(t){this.getRoot().load.remembered?gi(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),wn.each(this.__folders,(function(e){e.revert(e)})),e||mi(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&ii.call(window,(function(){e(t)}));wn.each(t,(function(e){e.updateDisplay()}))}(this.__listening)},updateDisplay:function(){wn.each(this.__controllers,(function(e){e.updateDisplay()})),wn.each(this.__folders,(function(e){e.updateDisplay()}))}});var Ei=ui,Si=function e(){var t=0,n=document.createElement("div");function i(e){return n.appendChild(e.dom),e}function o(e){for(var i=0;i<n.children.length;i++)n.children[i].style.display=i===e?"block":"none";t=e}n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(e){e.preventDefault(),o(++t%n.children.length)}),!1);var a=(performance||Date).now(),s=a,r=0,l=i(new e.Panel("FPS","#0ff","#002")),c=i(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=i(new e.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:n,addPanel:i,showPanel:o,begin:function(){a=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(c.update(e-a,200),e>=s+1e3&&(l.update(1e3*r/(e-s),100),s=e,r=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:o}};Si.Panel=function(e,t,n){var i=1/0,o=0,a=Math.round,s=a(window.devicePixelRatio||1),r=80*s,l=48*s,c=3*s,d=2*s,u=3*s,h=15*s,p=74*s,m=30*s,g=document.createElement("canvas");g.width=r,g.height=l,g.style.cssText="width:80px;height:48px";var f=g.getContext("2d");return f.font="bold "+9*s+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=n,f.fillRect(0,0,r,l),f.fillStyle=t,f.fillText(e,c,d),f.fillRect(u,h,p,m),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(u,h,p,m),{dom:g,update:function(l,v){i=Math.min(i,l),o=Math.max(o,l),f.fillStyle=n,f.globalAlpha=1,f.fillRect(0,0,r,h),f.fillStyle=t,f.fillText(a(l)+" "+e+" ("+a(i)+"-"+a(o)+")",c,d),f.drawImage(g,u+s,h,p-s,m,u,h,p-s,m),f.fillRect(u+p-s,h,s,m),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(u+p-s,h,s,a((1-l/v)*m))}}};var Ci,Bi,Ri=function(e,t,n,i){var o=Li(n,e.x,e.y,e.z,i.x,i.y),a=Li(n,e.x,t.y,e.z,i.x,i.y),s=Li(n,t.x,t.y,e.z,i.x,i.y),r=Li(n,t.x,e.y,e.z,i.x,i.y),l=Li(n,e.x,e.y,t.z,i.x,i.y),c=Li(n,e.x,t.y,t.z,i.x,i.y),d=Li(n,t.x,t.y,t.z,i.x,i.y),u=Li(n,t.x,e.y,t.z,i.x,i.y),h=Li(n,0,0,0,i.x,i.y),p=[];p.push(o),p.push(a),p.push(s),p.push(r),p.push(l),p.push(c),p.push(d),p.push(u);var m=[];p.map((function(e){m.push(e.x)}));var g=[];p.filter((function(e){g.push(e.y)}));var f=Math.min.apply(Math,m),v=Math.min.apply(Math,g),y=Math.max.apply(Math,m),x=Math.max.apply(Math,g);return{minX:f,minY:v,maxX:y,maxY:x,centerX:h.x,centerY:h.y,width:y-f,height:x-v}},Li=function(t,n,i,o,a,s){var r=new e.Vector3(n,i,o).project(t);return r.x=Math.round((.5+r.x/2)*a),r.y=Math.round((.5-r.y/2)*s),r},$i=function(e){return e=Vue.filter("qiniuZoom")(e,"128"),Vue.filter("backgroundImage")(e)},Vi=function(e){return e=Vue.filter("qiniuZoom")(e,"128"),Vue.filter("backgroundImageAbsoluteUrl")(e)},Fi={getBoxInfo:function(t,n){var i={x:0,y:0,z:0},o={x:0,y:0,z:0};return t.$groups&&t.$groups.length>0&&t.$groups.forEach((function(t){var n=new e.Box3;n.expandByObject(t.group),i.x=i.x<n.max.x?n.max.x:i.x,i.y=i.y<n.max.y?n.max.y:i.y,i.z=i.z<n.max.z?n.max.z:i.z,o.x=o.x>n.min.x?n.min.x:o.x,o.y=o.y>n.min.y?n.min.y:o.y,o.z=o.z>n.min.z?n.min.z:o.z})),Ri(i,o,t.$camera,n)},getBoxInfo2:Ri,getVectorByVector3:Li,getTextureCover:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Vue.store.state.fontStyle.textThreeDTextTexture.styleList.filter((function(t){return t.name===e}));return t?$i(n[0].cover):Vi(n[0].cover)}},Ti=1,zi=2,Hi=3,Di=function(t){s(a,t);var i=u(a);function a(e){var t;n(this,a),(t=i.call(this,e)).elementResizeType=Ot.textThreeD;var o=t.getDefaultElementJson({});return t.elementJson.type=$t.textThreeD,t.elementJson.css=Object.assign({},t.elementJson.css,o.css),t.elementJson.property=Object.assign({},t.elementJson.property,o.property),t.isEditing=!1,t.$text=null,t.$gui=null,t.$stats=null,t.$statsDom=null,t.$scene=null,t.$camera=null,t.$renderer=null,t.$orbitControls=null,t.$axesHelper=null,t.$textData=null,t.$generateGeometryFun=null,t.$groups=null,t.$requestId=null,t.debug3DText=!1,t}return o(a,[{key:"getDefaultElementJson",value:function(e){return Object.assign({textContent:"双击编辑文字",textStyleType:2,textGradient:{colors:{0:"#FFFFFF",1:"#D9D9D9"},angle:0,change:!0},textShadowColor:"#706d9a",cameraPosition:{fov:27.27610739897152,x:4.3939296692920475,y:-152.87902671146819,z:734.2402172135614}},e),{property:{textContent:e.textContent||"双击编辑文字",textFontSize:60,textHeight:40,textCurveSegments:12,textFont:e.textFont||{name:"默认字体",src:"PangMenZhengDao_Regular.json"},textStyleType:e.textStyleType||1,textColor:e.textColor||"#000000",textGradient:e.textGradient||{colors:{0:"#5D61FF",1:"#FF15F5"},angle:0},textTexture:{cover:"1",size:50,offsetX:0,offsetY:0,angle:0},textShadowColor:e.textShadowColor||"#ffffff",textAlign:"center",letterSpacing:10,lineHeight:10,bevelThickness:8,bevelSize:0,bevelSegments:8,bevelOffset:0,cameraPosition:e.cameraPosition||{fov:40.96094260402277,x:-360.4104544426249,y:320.48641228407917,z:574.3629199989675},canvasStyle:{width:400,height:400,marginLeft:"0px",marginTop:"0px"}},css:{x:0,y:0,width:Math.round(381),height:Math.round(75)}}}},{key:"render",value:function(){h(r(a.prototype),"render",this).call(this);var e=this.$text=document.createElement("div");e.css({padding:"0px",display:"flex",justifyContent:"center",alignItems:"center"}),this.updateCss(this.elementJson.css),this.renderLoading(),this.$el.appendChild(e),this.initThreeD(),this.drawText()}},{key:"renderLoading",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"加载中...";this.$text.querySelectorAll(".loading").forEach((function(e){e.remove()}));var t=document.createElement("label");t.innerText=e,t.className="loading",t.css({position:"absolute",fontSize:"22px",color:"#1593ff"}),this.$text.append(t)}},{key:"removeLoading",value:function(){var e=this.$text.querySelectorAll(".loading");e&&e.length>0&&e.forEach((function(e){e.remove()}))}},{key:"updateCss",value:function(e){h(r(a.prototype),"updateCss",this).call(this,e);var t=this.elementJson.css,n=t.width,i=t.height,o=t.overflow;this.$text.css({width:n+"px",height:i+"px",overflow:o})}},{key:"updateProperty",value:function(e){JSON.stringify(this.elementJson.property)!==JSON.stringify(e)&&h(r(a.prototype),"updateProperty",this).call(this,e)}},{key:"resizeUpdateCss",value:function(e,t,n){if(n){var i=this.$el.querySelector("canvas"),o=i.getBoundingClientRect().width/Vue.drawingBoard.scale;i.css({transform:"scale(1)"}),this.$renderer.setSize(o,o),this.updateProperty({canvasStyle:{width:o,height:o,marginLeft:i.style.marginLeft,marginTop:i.style.marginTop}})}else{this.updateCss(e);var a=this.elementJson.css,s=a.width,r=a.height,l=this.$el.querySelector("canvas"),c=parseFloat(l.style.width)-20,d=parseFloat(l.style.height)-20,u=Math.max(s/c,r/d);this.updateReSize(u)}}},{key:"updateReSize",value:function(e){var t=this.$el.querySelector("canvas");t.css({transform:"scale(".concat(e,")")});var n=Fi.getBoxInfo(this,{x:t.getBoundingClientRect().width/Vue.drawingBoard.scale,y:t.getBoundingClientRect().height/Vue.drawingBoard.scale}),i=n.maxX-n.centerX,o=n.centerX-n.minX,a=n.maxY-n.centerY,s=o-i,r=n.centerY-n.minY-a;t.css({marginLeft:s+"px",marginTop:r+"px"})}},{key:"updateFont",value:function(e){h(r(a.prototype),"updateProperty",this).call(this,e),this.$textData.font=e.textFont.src,this.renderLoading("字体加载中..."),this.$generateGeometryFun()}},{key:"updateGeometry",value:function(e){h(r(a.prototype),"updateProperty",this).call(this,e),this.$textData.text=e.textContent,this.$textData.size=e.textFontSize,this.$textData.height=e.textHeight,this.$textData.textColor=e.textColor,this.$textData.textShadowColor=e.textShadowColor,this.$textData.bevelThickness=e.bevelThickness,this.$textData.bevelSize=e.bevelSize,this.$textData.bevelSegments=e.bevelSegments,this.$textData.bevelOffset=e.bevelOffset,this.$textData.letterSpacing=e.letterSpacing,this.$textData.lineHeight=e.lineHeight,this.$textData.textAlign=e.textAlign,this.$generateGeometryFun()}},{key:"updateColor",value:function(t){var n=this;h(r(a.prototype),"updateProperty",this).call(this,t),this.$groups.forEach((function(t){t.group.children.forEach((function(t){null!==t.material[0].map&&n.elementJson.property.textStyleType===Ti&&(t.material[0].map.dispose(),t.material[0].map=null,t.material[0]=new e.MeshBasicMaterial),n.elementJson.property.textStyleType===Ti&&(t.material[0].color=new e.Color(n.elementJson.property.textColor)),t.material[1].color=new e.Color(n.elementJson.property.textShadowColor)}))}))}},{key:"updateGradient",value:function(t){var n=this;h(r(a.prototype),"updateProperty",this).call(this,t);var i=this.elementJson.property.textGradient,o=0,s=0,l=new e.Group;this.$groups.forEach((function(e){l.add(e.group.clone()),o=o<e.maxGroupWidth?e.maxGroupWidth:o,s+=e.maxGroupHeight+e.maxGroupHeightOffset}));var c=this.getGradientCanvas(Math.ceil(o),Math.ceil(s),i.colors,i.angle);this.$groups.forEach((function(t,i){var a=t.group,r=t.groupCharSizeArr,l=o,d=0,u=0;0===i?(d=0,u=t.maxGroupHeight):i===n.$groups.length-1?(d=s-t.maxGroupHeight,u=s):n.$groups.forEach((function(e,t){t<i&&(d+=e.maxGroupHeight,u+=e.maxGroupHeight),t===i&&(u+=e.maxGroupHeight)}));var h=n.cutCanvas(c,0,d,l,u);a.children.forEach((function(t,i){var a=t.position.x+o/2,s=(a=a<0?0:a)+r[i].width,l=h.height,c=n.cutCanvas(h,a,0,s,l),d=c.width,u=c.height,p=c.getContext("2d"),m=p.getImageData(0,0,c.width,c.height);d!==u?(c.width=d>u?64:32,c.height=d>u?32:64):(c.width=64,c.height=64),p.putImageData(m,0,0),t.geometry.computeBoundingBox();var g=t.geometry.boundingBox,f=new e.CanvasTexture(c);f.repeat.set(1/Math.ceil(Math.abs(g.min.x)+Math.abs(g.max.x)),1/Math.ceil(Math.abs(g.min.y)+Math.abs(g.max.y))),t.material[0]=new e.MeshBasicMaterial,t.material[0].map=f}))}))}},{key:"getGradientCanvas",value:function(e,t,n,i){var o=document.createElement("canvas");o.width=e,o.height=t;var a,s,r,l,c=o.getContext("2d");0===i?(a=0,s=0,r=e,l=0):90===i?(a=0,s=0,r=0,l=t):180===i?(a=e,s=0,r=0,l=0):270===i&&(a=0,s=t,r=0,l=0);var d=c.createLinearGradient(a,s,r,l);return d.addColorStop(0,n[0]),d.addColorStop(1,n[1]),c.fillStyle=d,c.fillRect(0,0,e,t),o}},{key:"cutCanvas",value:function(e,t,n,i,o){var a=i-t,s=o-n,r=document.createElement("canvas");return r.width=a,r.height=s,r.getContext("2d").drawImage(e,t,n,a,s,0,0,a,s),r}},{key:"updateTexture",value:function(t){var n=this;h(r(a.prototype),"updateProperty",this).call(this,t),this.$groups.forEach((function(t){t.group.children.forEach((function(t){t.material[0]=new e.MeshBasicMaterial;var i=Fi.getTextureCover(n.elementJson.property.textTexture.cover,!1),o=(new e.TextureLoader).load(i);o.wrapT=e.RepeatWrapping,o.wrapS=e.RepeatWrapping,o.center.set(.5,.5),t.material[0].map=o;var a=(100-n.elementJson.property.textTexture.size)/1e3;t.material[0].map.repeat.set(a,a),t.material[0].map.offset.set(-n.elementJson.property.textTexture.offsetX/100,-n.elementJson.property.textTexture.offsetY/100),t.material[1].color=new e.Color(n.elementJson.property.textShadowColor)}))}))}},{key:"updatePosition",value:function(e){var t=this;h(r(a.prototype),"updateProperty",this).call(this,e);var n=parseInt(this.$groups.length/2),i=this.$groups[n];if(this.$groups.length%2>0){for(var o=0;o<n;o++){for(var s=this.$groups[o].group,l=0,c=o+1;c<n;c++)l+=this.$groups[0].maxGroupHeight;l+=(n-o)*this.elementJson.property.lineHeight,l+=i.maxGroupHeight/2,s.position.setY(l+i.maxGroupHeightOffset)}i.group.position.setY(-i.maxGroupHeight/2+i.maxGroupHeightOffset);for(var d=this.$groups.length-1;d>n;d--){for(var u=this.$groups[d].group,p=0,m=d;m>n;m--)p+=this.$groups[m].maxGroupHeight;p+=(d-n)*this.elementJson.property.lineHeight,p+=i.maxGroupHeight/2,u.position.setY(-p+i.maxGroupHeightOffset)}}else{for(var g=0;g<n;g++){for(var f=this.$groups[g].group,v=0,y=g+1;y<n;y++)v+=this.$groups[y].maxGroupHeight;v=v+(n-g)*this.elementJson.property.lineHeight-this.elementJson.property.lineHeight/2,f.position.setY(v+i.maxGroupHeightOffset)}for(var x=this.$groups.length-1;x>=n;x--){for(var b=this.$groups[x].group,w=0,_=x;_>=n;_--)w+=this.$groups[_].maxGroupHeight;w=w+(x+1-n)*this.elementJson.property.lineHeight-this.elementJson.property.lineHeight/2,b.position.setY(-w+i.maxGroupHeightOffset)}}var k=0;this.$groups.forEach((function(e){k=k>e.maxGroupWidth?k:e.maxGroupWidth})),"left"===this.elementJson.property.textAlign?this.$groups.forEach((function(e){e.group.children.forEach((function(n,i){for(var o=-k/2,a=0;a<i;a++)o+=e.groupCharSizeArr[a].width;o+=i*t.elementJson.property.letterSpacing,n.position.setX(o)}))})):"center"===this.elementJson.property.textAlign?this.$groups.forEach((function(e){e.group.children.forEach((function(n,i){for(var o=-e.maxGroupWidth/2,a=0;a<i;a++)o+=e.groupCharSizeArr[a].width;o+=i*t.elementJson.property.letterSpacing,n.position.setX(o)}))})):"right"===this.elementJson.property.textAlign&&this.$groups.forEach((function(e){e.group.children.forEach((function(n,i){for(var o=k/2,a=i;a<=e.group.children.length-1;a++)o-=e.groupCharSizeArr[a].width;o-=(e.group.children.length-1-i)*t.elementJson.property.letterSpacing,n.position.setX(o)}))}));for(var E=0;E<this.$groups.length;E++)this.$groups[E].group.position.setZ(-this.elementJson.property.textHeight/2)}},{key:"updateSize",value:function(){var t=new e.Group;this.$groups.forEach((function(e){t.add(e.group.clone())}));var n=new e.Box3;n.expandByObject(t);var i=new e.Sphere;n.getBoundingSphere(i);var o=Math.asin(i.radius/750)/(Math.PI/180),a=i.radius/Math.cos(o*Math.PI/180),s=JSON.parse(JSON.stringify(n.max)),r=JSON.parse(JSON.stringify(n.min));s.x=a,s.y=a,r.x=-a,r.y=-a;var l=new e.PerspectiveCamera(this.$camera.fov,1,.1,1e4);l.position.set(0,0,750),this.$renderer.render(this.$scene,l);var c=this.$renderer.getSize(new e.Vector2),d=Fi.getBoxInfo2(s,r,l,c),u=Math.max(d.width,d.height);this.$renderer.setSize(u,u);var h=2*o;this.$camera.fov=h,this.$camera.updateProjectionMatrix(),l=null,this.renderThreeD();var p=Fi.getBoxInfo(this,this.$renderer.getSize(new e.Vector2)),m=p.maxX-p.centerX,g=p.centerX-p.minX,f=p.maxY-p.centerY,v=g-m,y=p.centerY-p.minY-f;this.$el.querySelector("canvas")&&this.$el.querySelector("canvas").css({marginLeft:v+"px",marginTop:y+"px"});var x=this.elementJson.css,b=parseFloat(x.x)+parseFloat(x.width)/2,w=parseFloat(x.y)+parseFloat(x.height)/2;this.updateCss({x:b-(p.width+20)/2,y:w-(p.height+20)/2,width:p.width+20,height:p.height+20,overflow:this.debug3DText?"visible":"hidden"}),this.updateProperty({cameraPosition:{fov:this.$camera.fov,x:this.$camera.position.x,y:this.$camera.position.y,z:this.$camera.position.z},canvasStyle:{width:this.$renderer.getSize(new e.Vector2).x,height:this.$renderer.getSize(new e.Vector2).y,marginLeft:v+"px",marginTop:y+"px"}})}},{key:"initThreeD",value:function(){this.initScene(),this.initCamera(),this.initRenderer(),this.initOrbitControls(),this.initLights(),this.initAxesHelper()}},{key:"initScene",value:function(){this.debug3DText&&(this.$gui=new Ei,this.$stats=new Si,this.$statsDom=this.$stats.domElement,document.body.appendChild(this.$statsDom)),this.$scene=new e.Scene}},{key:"initCamera",value:function(){this.$camera=new e.PerspectiveCamera(this.elementJson.property.cameraPosition.fov,1,.1,1e4),this.$camera.position.set(this.elementJson.property.cameraPosition.x,this.elementJson.property.cameraPosition.y,this.elementJson.property.cameraPosition.z)}},{key:"initRenderer",value:function(){this.$renderer=new e.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this.$renderer.setSize(this.elementJson.property.canvasStyle.width,this.elementJson.property.canvasStyle.height,!1),this.$renderer.setPixelRatio(window.devicePixelRatio),this.$text.appendChild(this.$renderer.domElement),this.$renderer.domElement.css({marginLeft:this.elementJson.property.canvasStyle.marginLeft,marginTop:this.elementJson.property.canvasStyle.marginTop}),this.$renderer.domElement.classList.add("text-threed"),this.debug3DText&&this.$renderer.domElement.css({border:"1px solid red"})}},{key:"initOrbitControls",value:function(){this.$orbitControls=new fn(this.$camera,this.$renderer.domElement),this.$orbitControls.enableZoom=!1,this.$orbitControls.enableKeys=!1,this.$orbitControls.enablePan=!1,this.$orbitControls.enabled=!1}},{key:"initLights",value:function(){var t=new e.DirectionalLight("#ffffff");t.position.set(0,500,0),t.intensity=1,this.$scene.add(t);var n=new e.DirectionalLight("#ffffff");n.position.set(500,0,0),n.intensity=.8,this.$scene.add(n);var i=new e.DirectionalLight("#ffffff");i.position.set(0,-500,0),i.intensity=1,this.$scene.add(i);var o=new e.DirectionalLight("#ffffff");o.position.set(-500,0,0),o.intensity=.8,this.$scene.add(o)}},{key:"initAxesHelper",value:function(){this.$axesHelper=new e.AxesHelper(300),this.$axesHelper.visible=!1,this.$scene.add(this.$axesHelper)}},{key:"renderThreeD",value:function(){var e=this;!function t(){e.$requestId=requestAnimationFrame(t),null!==e.$scene?(e.debug3DText&&e.$stats.update(),e.$orbitControls.update(),e.$renderer.render(e.$scene,e.$camera)):cancelAnimationFrame(e.$requestId)}()}},{key:"clearText",value:function(){var e=this;this.$groups&&this.$groups.length>0&&this.$groups.forEach((function(t){t.group.children.forEach((function(e){e.geometry.dispose(),e.geometry=null,e.material[0]&&(e.material[0].dispose(),e.material[0]=null),e.material[1]&&(e.material[1].dispose(),e.material[1]=null)})),e.$scene.remove(t.group),t.group=null})),this.$groups=[];var t=[];this.$scene.children.forEach((function(e){"Mesh"===e.type&&(e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null,t.push(e))})),t.forEach((function(t){e.$scene.remove(t),t=null})),t=null,this.renderThreeD()}},{key:"dispose",value:function(){this.clearText(),this.$renderer.dispose(),this.$renderer=null,this.$scene.dispose(),this.$scene=null,this.$orbitControls.dispose(),this.$orbitControls=null,this.$axesHelper=null,this.$camera=null,this.$textData=null,this.$generateGeometryFun=null,this.$groups=null,this.debug3DText&&(this.$gui=null,this.$stats=null,this.$statsDom.remove(),this.$statsDom=null),cancelAnimationFrame(this.$requestId)}},{key:"getTextGroups",value:function(t,n){var i=this;return new Promise((function(o,a){var s=i.elementJson.property;new Promise((function(t,n){if(s.textStyleType===Hi){var i=Fi.getTextureCover(s.textTexture.cover,!1);(new e.TextureLoader).load(i,(function(n){n.wrapT=e.RepeatWrapping,n.wrapS=e.RepeatWrapping,n.center.set(.5,.5);var i=(100-s.textTexture.size)/1e3;n.repeat.set(i,i),t(n)}))}else t(null)})).then((function(i){for(var a=[],r=t.text.split("\n"),l=0;l<r.length;l++){for(var c=r[l].trim(),d=new e.Group,u=0,h=0,p=[],m=0;m<c.length;m++){var g=c[m],f=new e.TextGeometry(g,{font:n,size:t.size,height:t.height,curveSegments:t.curveSegments,bevelEnabled:(0!==t.bevelSize||0!==t.bevelOffset)&&t.bevelEnabled,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,bevelOffset:t.bevelOffset,bevelSegments:t.bevelSegments}),v=null;s.textStyleType===Ti?v=new e.MeshBasicMaterial({color:s.textColor}):s.textStyleType===zi||s.textStyleType===Hi&&(v=new e.MeshBasicMaterial({map:i}));var y=new e.MeshPhongMaterial({color:s.textShadowColor});f.computeBoundingBox();var x=f.boundingBox,b={width:Math.abs(x.min.x)+Math.abs(x.max.x),height:Math.abs(x.min.y)+Math.abs(x.max.y)};p.push(b);var w=Math.abs(x.min.y)+Math.abs(x.max.y);u=u>w?u:w,h=h>Math.abs(x.min.y)?h:Math.abs(x.min.y);var _=new e.Mesh(f,[v,y]);_.castShadow=!0,_.receiveShadow=!0,d.add(_)}var k=0;p.forEach((function(e){k+=e.width})),k+=(p.length-1)*t.letterSpacing,a.push({group:d,groupCharSizeArr:p,maxGroupWidth:k,maxGroupHeight:u,maxGroupHeightOffset:h})}o(a)}))}))}},{key:"drawText",value:function(){var e=this,t=this,n=this.$textData={text:this.elementJson.property.textContent,size:this.elementJson.property.textFontSize,height:this.elementJson.property.textHeight,curveSegments:this.elementJson.property.textCurveSegments,font:this.elementJson.property.textFont.src,bevelEnabled:!0,bevelThickness:this.elementJson.property.bevelThickness,bevelSize:this.elementJson.property.bevelSize,bevelSegments:this.elementJson.property.bevelSegments,bevelOffset:this.elementJson.property.bevelOffset,letterSpacing:this.elementJson.property.letterSpacing,lineHeight:this.elementJson.property.lineHeight,textAlign:this.elementJson.property.textAlign};(this.$generateGeometryFun=function(){var i="./iconfonts/".concat(e.$textData.font);e.getFont(i).then((function(i){null!==t.$groups&&t.clearText(),t.getTextGroups(n,i).then((function(n){var i=e.$groups=n;t.updatePosition(t.elementJson.property),t.elementJson.property.textStyleType===zi&&t.updateGradient(),i.forEach((function(e){t.$scene&&t.$scene.add(e.group)})),t.updateSize(),t.renderThreeD(),t.removeLoading(),t.$el.classList.add("h2-core-check-ele")}))})).catch((function(t){console.log(t),e.renderLoading("加载失败请稍后重试")}))})()}},{key:"getFont",value:function(t){return new Promise((function(n,i){(new e.FontLoader).load(t,(function(e){n(e)}),(function(e){}),(function(e){i(e)}))}))}}]),a}(At),Ai={101:Wt,102:Ut,104:gn,107:ln,113:Di},Oi=function(){function e(t){n(this,e),this.id=t.id,this.elementIds=t.elementIds,this.groupIds=t.groupIds,this.style=t.style}return o(e,[{key:"includeElement",value:function(e){return this.elementIds.indexOf(e)>=0}},{key:"includeGroup",value:function(e){return this.groupIds.indexOf(e)>=0}},{key:"move",value:function(e){this.style.x+=e.x,this.style.y+=e.y}},{key:"setRotate",value:function(e){this.style.rotate=e}},{key:"setPosition",value:function(e){this.style.x=e.x,this.style.y=e.y}},{key:"setSize",value:function(e){this.style.width=e.width,this.style.height=e.height}}]),e}(),Pi=function(){function e(){n(this,e),this.groupList=[]}return o(e,[{key:"getRelationship",value:function(){return JSON.parse(JSON.stringify(this.groupList))}},{key:"setRelationship",value:function(e){var t=this;this.groupList=[],e.forEach((function(e){var n=new Oi(e);t.groupList.push(n)}))}},{key:"updateElementGroup",value:function(e){var t=this,n=[],i=this.getElementParentGroup(e),o=[];!function e(n){n.groupIds.forEach((function(n){var i=t.getGroup(n);i.groupIds.length>0&&e(i),o.push(i)}))}(i),(n=n.concat(o)).push(i);for(var a=this.getGroupParentGroup(i);null!==a;)n.push(a),a=this.getGroupParentGroup(a);var s=[],r={};return n.forEach((function(e){e.groupIds.forEach((function(e){r[e]||(s.push(t.getGroup(e)),r[e]=!0)})),r[e.id]||(s.push(e),r[e.id]=!0)})),this.delGroups(s),new Promise((function(e,n){t.asynGroupUpdate(s,0,e)}))}},{key:"asynGroupUpdate",value:function(e,t,n){var i=this;if(e.length!==t){var o=e[t],a=this.getAllElementByGroupAndGrouplist(o.id,e),s=Vue.elements.getByIds(a);Vue.elementsBoxs.setSelectedElement(s),Vue.elementBoxEdit.$vm.$nextTick((function(){i.group(s,o.id),i.asynGroupUpdate(e,t+1,n)}))}else n()}},{key:"getAllElementByGroupAndGrouplist",value:function(e,t){for(var n=[],i=0;i<t.length;i++){var o=t[i];if(o.id===e){n=n.concat(o.elementIds);for(var a=0;a<o.groupIds.length;a++){var s=o.groupIds[a];n=n.concat(this.getAllElementByGroupAndGrouplist(s,t))}return n}}}},{key:"getGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id===e)return n}}},{key:"delElementGroup",value:function(e){var t=this.getElementsGroup(e);this.delGroups(t)}},{key:"delGroups",value:function(e){var t=this;e.forEach((function(e){t.delGroup(e)}))}},{key:"delGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){if(this.groupList[t].id===e.id){this.groupList.splice(t,1);break}}}},{key:"group",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=[],a=[];t.forEach((function(e){var t=n.getElementTopGroup(e);t?a.push(t.id):o.push(e.elementJson.id)}));var s=m(new Set(a));if(0===o.length&&1===s.length)return!1;var r=new Oi({id:i||e.newId(this.groupList),elementIds:o,groupIds:s,style:this.getStyle()});return this.groupList.push(r),!0}},{key:"getStyle",value:function(){var e=Vue.elementBoxEdit.getDataJson();return{width:e.elementWidth,height:e.elementHeight,rotate:e.rotate,x:e.elementX,y:e.elementY}}},{key:"unGroup",value:function(e){var t=this.searchGroupIndex(e);return t>=0&&(this.groupList.splice(t,1),!0)}},{key:"searchGroup",value:function(e){for(var t=e.map((function(e){return e.elementJson.id})).sort().toString(),n=this.groupList.length-1;n>=0;n--){var i=this.groupList[n];if(t===this.getAllElementByGroup(i.id).sort().toString())return i}return null}},{key:"searchGroupIndex",value:function(e){for(var t=e.map((function(e){return e.elementJson.id})).sort().toString(),n=this.groupList.length-1;n>=0;n--){var i=this.groupList[n];if(t===this.getAllElementByGroup(i.id).sort().toString())return n}return-1}},{key:"getAllElementIdsByElementInGroup",value:function(e){var t=this.getElementTopGroup(e);return null!==t?this.getAllElementByGroup(t.id):[e.elementJson.id]}},{key:"getAllElementByGroup",value:function(e){for(var t=[],n=0;n<this.groupList.length;n++){var i=this.groupList[n];if(i.id===e){t=t.concat(i.elementIds);for(var o=0;o<i.groupIds.length;o++){var a=i.groupIds[o];t=t.concat(this.getAllElementByGroup(a))}return t}}}},{key:"getElementTopGroup",value:function(e){var t=this.getElementParentGroup(e);return null===t?null:this.getGroupRootGroup(t)}},{key:"getElementParentGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.includeElement(e.elementJson.id))return n}return null}},{key:"getElementsGroup",value:function(e){var t,n=this,i=[],o=[],a=function(e,t){null===e||o[e.id]||(i.push(e),o[e.id]=!0),t&&t(null===e)};return e.forEach((function(e){var i=n.getElementParentGroup(e),o=i;a(i,(function(e){if(!e){t=!0;var i=function(){var e=n.getGroupParentGroup(o);a(e,(function(n){n?t=!1:o=e}))};do{i()}while(t)}}))})),i}},{key:"getGroupParentGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id!==e.id&&n.includeGroup(e.id))return n}return null}},{key:"getGroupRootGroup",value:function(e){for(var t=0;t<this.groupList.length;t++){var n=this.groupList[t];if(n.id!==e.id&&n.includeGroup(e.id))return this.getGroupRootGroup(n)}return e}},{key:"getFirstGroupElementCount",value:function(){return this.groupList.length>0?this.groupList[0].elementIds.length:-1}},{key:"moveGroups",value:function(e,t){e.forEach((function(e){e.move(t)}))}},{key:"updateGroups",value:function(e){}}],[{key:"newId",value:function(e){var t=0;do{t=x.getRandom(100,99999)}while(e.map((function(e){return e.id})).indexOf(t)>-1);return t}}]),e}(),Mi=function(){function e(t){n(this,e),this.$el=null,this.scale=null,this.elementList=[],this.elementRelationship=new Pi,this.render(t)}return o(e,[{key:"render",value:function(e){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-elements"}).css({position:"absolute",left:0,top:0,"z-index":0,"transform-origin":"left top",transform:"scale(".concat(e.scale,")"),width:"".concat(e.size.width,"px"),height:"".concat(e.size.height,"px")})}},{key:"getAllElementByElementInGroup",value:function(e){var t=this.elementRelationship.getAllElementIdsByElementInGroup(e);return this.elementList.filter((function(e){return t.indexOf(e.elementJson.id)>=0}))}},{key:"getElementTopGroup",value:function(e){return this.elementRelationship.getElementTopGroup(e)}},{key:"getElementParentGroup",value:function(e){return this.elementRelationship.getElementParentGroup(e)}},{key:"getElementsGroup",value:function(e){return this.elementRelationship.getElementsGroup(e)}},{key:"getFirstGroupElementCount",value:function(){return this.elementRelationship.getFirstGroupElementCount()}},{key:"add",value:function(t){if(t.state){if(t.render(),t.bind(this),t.setScale(this.scale),!t.elementJson.id){var n=e.newId(this.elementList);t.updateId(n);var i=e.newZIndex(this.elementList);t.updateCss({zIndex:i})}this.$el.appendChild(t.$el),this.elementList.push(t)}else t.destroy()}},{key:"setScale",value:function(e){var t=this;this.scale=e,this.$el.css({transform:"scale(".concat(e,")")}),this.elementList.forEach((function(e){e.setScale(t.scale)}))}},{key:"getByIds",value:function(e){return this.elementList.filter((function(t){return e.includes(t.elementJson.id)}))}},{key:"getSelected",value:function(){return this.elementList.filter((function(e){return!0===e.selected}))}},{key:"getUnSelected",value:function(){return this.elementList.filter((function(e){return!1===e.selected}))}},{key:"getAll",value:function(){return this.elementList}},{key:"setSelected",value:function(e){e.forEach((function(e){e.setSelected(!0)}))}},{key:"clearSelected",value:function(){this.elementList.forEach((function(e){e.setSelected(!1)}))}},{key:"selectAll",value:function(){this.elementList.forEach((function(e){e.setSelected()}))}},{key:"delSelected",value:function(){this.delRelationship(this.getSelected()),this.elementList=this.elementList.filter((function(e){return!e.selected||(e.destroy(),!1)}))}},{key:"delAll",value:function(){this.elementList=this.elementList.filter((function(e){return e.destroy(),!1}))}},{key:"delElement",value:function(e){this.elementList=this.elementList.filter((function(t){return t.elementJson.id!==e.elementJson.id||(e.destroy(),!1)}))}},{key:"moveSelected",value:function(e){this.elementList.forEach((function(t){t.selected&&t.move(e)}))}},{key:"getElementInSelectedById",value:function(e){for(var t=!1,n=0;n<this.elementList.length;n++){var i=this.elementList[n];if(i.selected&&i.elementJson.id===e){t=i;break}}return t}},{key:"getSelectedElements",value:function(){var e=[];return this.getSelected().map((function(t){e.push(t)})),e}},{key:"updateElementGroup",value:function(e){return this.elementRelationship.updateElementGroup(e)}},{key:"groupSelected",value:function(){var e=this.getSelected();e.length>1&&this.elementRelationship.group(e)&&(this.getFirstGroupElementCount()!==e.length&&Vue.elementsBoxs.setGroupElement(e),Vue.elementsBoxs.setElementBoxEditIsGroup(!0),this.sortGroup(e),Vue.operatRecord.addRecord())}},{key:"unGroupSelected",value:function(){var e=this.getSelected();e.length>1&&this.elementRelationship.unGroup(e)&&(this.getFirstGroupElementCount()!==e.length&&Vue.elementsBoxs.setGroupElement(e),Vue.elementsBoxs.setElementBoxEditIsGroup(!1),Vue.operatRecord.addRecord())}},{key:"sortGroup",value:function(e){console.log("组合成功");var t=e.map((function(e){return e.elementJson.css.zIndex})).sort(),n=t[0],i=-1;console.log("选择的元素 zIndex 小到大排序：",JSON.stringify(t));for(var o=t.length-1;o>0;o--)if(t[o]-1!==t[o-1]){i=t[o]-1;break}if(i>=0){console.log("选择的元素 zIndex 不连续，需要排序，zIndex：",n,"~",i,"的元素需要排序");var a=[],s=[];this.elementList.forEach((function(e){var o=e.elementJson.css.zIndex;o>=n&&o<=i&&(t.includes(o)?s.push(e):a.push(e))})),a.sort((function(e,t){return e.elementJson.css.zIndex>t.elementJson.css.zIndex})),s.sort((function(e,t){return e.elementJson.css.zIndex>t.elementJson.css.zIndex})),a.concat(s).forEach((function(e,t){e.updateCss({zIndex:n+t})}))}else console.log("不需要排序")}},{key:"searchGroupIndex",value:function(e){return this.elementRelationship.searchGroupIndex(e)}},{key:"searchGroup",value:function(e){return this.elementRelationship.searchGroup(e)}},{key:"moveSelectedElementGroups",value:function(e,t){this.elementRelationship.moveGroups(e,t)}},{key:"getRelationship",value:function(){return this.elementRelationship.getRelationship()}},{key:"setRelationship",value:function(e){return this.elementRelationship.setRelationship(e)}},{key:"updateRelationship",value:function(e){this.elementRelationship.updateGroups(e)}},{key:"delRelationship",value:function(e){this.elementRelationship.delElementGroup(e)}},{key:"isTextEditing",value:function(){for(var e=!1,t=Vue.elements.getSelected(),n=0;n<t.length;n++){var i=t[n];if(i.elementJson.type===$t.text&&i.isEditing){e=!0;break}}return e}},{key:"openSettingListener",value:function(){for(var e=Vue.elements.getSelected(),t=0;t<e.length;t++){var n=e[t];n.elementJson.type===$t.text&&n.isEditing&&(n.setCssIsUpdate(!0),n.setPropertyIsUpdate(!0))}}}],[{key:"newId",value:function(e){var t=0;do{t=x.getRandom(100,99999)}while(e.map((function(e){return e.elementJson.id})).indexOf(t)>-1);return t}},{key:"newZIndex",value:function(e){var t=e.map((function(e){return e.elementJson.css.zIndex})),n=t.length?t:[0];return Math.max.apply(Math,n)+1}}]),e}(),Ji={eqxElementsSelected:[],background:null,disableBack:!0,disableForward:!0,cacheImage:{},openLoading:!1,editorConfig:{settingBar:!0,toolBar:!0,name:"轻设计编辑器开放平台",eagleEye:!0,debug:!0},elementsCopyConfig:{copyArr:[],copyRelation:[]},scale:{code:"",time:(new Date).getTime()}},Ii=(a(Ci={},tt,(function(e,t){e.editorConfig=Object.assign(e.editorConfig,t)})),a(Ci,Ge,(function(e,t){var n=t.eqxElements;e.eqxElementsSelected=n})),a(Ci,qe,(function(e,t){var n=t.background;e.background=n})),a(Ci,Ye,(function(e,t){var n=t.disableBack,i=t.disableForward;e.disableBack=n,e.disableForward=i})),a(Ci,je,(function(e){if(!e.disableBack){var t=Vue.operatRecord.back();Vue.operatRecord.renderDrawBoard(t)}})),a(Ci,We,(function(e){if(!e.disableForward){var t=Vue.operatRecord.forward();Vue.operatRecord.renderDrawBoard(t)}})),a(Ci,Ue,(function(e,t){var n=t.key,i=t.value;e.cacheImage[n]=i})),a(Ci,Xe,(function(e){e.cacheImage={}})),a(Ci,et,(function(e,t){e.openLoading=t})),a(Ci,nt,(function(e){e.elementsCopyConfig.copyArr=[],Vue.elements.getSelected().map((function(t){e.elementsCopyConfig.copyArr.push(JSON.parse(JSON.stringify(t.elementJson)))})),e.elementsCopyConfig.copyRelation=Vue.elements.getRelationship()})),a(Ci,it,(function(e){Vue.elements.elementList.map((function(e){e.setSelected(!1)}));var t=[];e.elementsCopyConfig.copyArr.map((function(e){var n=JSON.parse(JSON.stringify(e));n.css.x+=50,n.css.y+=50;var i=new Ai[e.type](n,Vue.drawingBoard);Vue.drawingBoard.addElement(i,!0);var o=Mi.newId(Vue.elements.elementList);i.updateId(o),i.setSelected(!0),t.push(i)})),Vue.elementsBoxs.setSelectedElement(t)})),a(Ci,ot,(function(e,t){e.scale.code=t,e.scale.time=(new Date).getTime()})),Ci),Ni={state:Ji,mutations:Ii},Gi={state:{list:[],selectedItem:{},layer:{show:!1}},mutations:(a(Bi={},Ke,(function(e,t){e.list=t})),a(Bi,Ze,(function(e,t){e.selectedItem=t})),a(Bi,Qe,(function(e,t){var n=t.show;e.layer.show=n})),Bi)};Vue.store=new Vuex.Store({modules:{scene:Ni,font:Gi}});var qi=Vue.store,Yi=[{name:"报隶-常规体",fontFamily:"STBaoliSC-Regular",src:""},{name:"冬青黑体",fontFamily:"HiraginoSansGB-W3",src:""},{name:"黑体-细体",fontFamily:"STHeitiSC-Light",src:""},{name:"华文楷体-常规体",fontFamily:"STKaiti",src:""},{name:"华文宋体-常规体",fontFamily:"STSong",src:""},{name:"圆体-常规体",fontFamily:"STYuanti-SC-Regular",src:""},{name:"雅痞-常规体",fontFamily:"YuppySC-Regular",src:""},{name:"行楷-细体",fontFamily:"STXingkaiSC-Light",src:""},{name:"魏碑-粗体",fontFamily:"WeibeiSC-Bold",src:""},{name:"娃娃体-常规体",fontFamily:"DFWaWaSC-W5",src:""},{name:"手札体-常规体",fontFamily:"HannotateSC-W5",src:""},{name:"凌慧体-中黑体",fontFamily:"MLingWaiMedium-SC",src:""},{name:"Didot",fontFamily:"Didot",src:""},{name:"Cochin",fontFamily:"Cochin",src:""},{name:"ComicSansMS",fontFamily:"ComicSansMS",src:""}],ji=[{name:"微软雅黑",fontFamily:"微软雅黑",src:""},{name:"Ink Free",fontFamily:"InkFree",src:""}];var Wi={getSysFonts:function(){return x.isMac?Yi:ji}};const Ui={directives:{dragStyleLayer:{bind:function(e,t){var n=t.value||{},i=n.target,o=n.container,a=n.onMouseDown,s=n.onMouseMove,r=n.onMouseUp;e.addEventListener("mousedown",(function(t){t.preventDefault();var n=document.querySelector(i)||e,l=document.querySelector(o),c=t.pageX,d=t.pageY,u=0,h=0,p=parseInt(n.css("left"))||0,m=parseInt(n.css("top"))||0,g={},f={};l&&(g=n.getBoundingClientRect(),f=l.getBoundingClientRect()),x.isFunction(a)&&a(n);var v=function(e){u=e.pageX-c,h=e.pageY-d;var t={left:p+u,top:m+h};if(l){var i={left:0,top:0,right:f.width-g.width,bottom:f.height-g.height};t.left<i.left&&(t.left=i.left),t.left>i.right&&(t.left=i.right),t.top<i.top&&(t.top=i.top),t.top>i.bottom&&(t.top=i.bottom)}n.css({left:t.left+"px",top:t.top+"px"}),x.isFunction(s)&&s(n,t.top)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",(function e(t){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",e),x.isFunction(r)&&r(n)}))}))}}},props:{},data:function(){return{font:{list:[{name:"默认字体",fontFamily:"",src:""}],selectedItem:null},chooseFontList:[],height:0}},computed:{scene:function(){return Vue.store.state.scene},eqxElementsSelected:function(){return this.scene.eqxElementsSelected},eqxElement:function(){return this.eqxElementsSelected[0]},css:function(){return this.eqxElement.elementJson.css},property:function(){return this.eqxElement.elementJson.property},fontList:function(){return Vue.store.state.font.list},getPositionStyle:function(){return{left:document.querySelector(".eqx-h2open").clientWidth-183-183+"px",top:"0px"}}},created:function(){var e=this;this.font.list=this.font.list.concat(Wi.getSysFonts(),this.fontList),this.setSelectedFont(),setTimeout((function(){return e.$refs.wrap&&e.$refs.wrap.myScroll.refresh()}),300)},mounted:function(){var e=this.$el.parentElement.offsetHeight;this.height=e-40-48},methods:{close:function(){Vue.store.commit("FONT_LAYER",{show:!1})},setSelectedFont:function(){var e=this;this.css&&(this.font.selectedItem=this.font.list.find((function(t){return t.fontFamily===e.css.fontFamily}))||{})},chooseFont:function(e){this.font.selectedItem=e,this.css.fontFamily=e.fontFamily,this.property.fontFamilyName=e.name,e.src?(this.property.src=e.src,[$t.text,$t.date].includes(this.eqxElement.elementJson.type)&&this.eqxElement.createFontFace()):delete this.property.src,Vue.operatRecord.addRecord()}}};var Xi=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-text-font",style:e.getPositionStyle,attrs:{id:"eqc-setting-text-font"}},[n("div",{directives:[{name:"drag-style-layer",rawName:"v-drag-style-layer",value:{target:"#eqc-setting-text-font",container:".eqx-h2open"},expression:"{target: '#eqc-setting-text-font', container: '.eqx-h2open'}"}],staticClass:"head"},[n("span",[e._v("字体")]),e._v(" "),n("i",{staticClass:"close eqf-no",on:{click:e.close}})]),e._v(" "),n("div",{staticClass:"showFontList"},[n("div",{staticClass:"container"},[n("div",{staticClass:"eqc-drop-dwon-container"},[n("div",{directives:[{name:"scroll-bar",rawName:"v-scroll-bar"}],ref:"wrap",staticClass:"wrap",style:{height:e.height+"px"}},[n("ul",{staticClass:"list"},e._l(e.font.list,(function(t,i){return n("li",{key:i,staticClass:"item ellipsis",class:{active:e.font.selectedItem&&t.name===e.font.selectedItem.name},style:{fontFamily:t.fontFamily},on:{click:function(n){return e.chooseFont(t)}}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])})),0)])])])])])};Xi._withStripped=!0;const Ki=A({render:Xi,staticRenderFns:[]},void 0,Ui,void 0,!1,void 0,!1,void 0,void 0,void 0);var Zi=function(){var e=this.$createElement;this._self._c;return this._m(0)};Zi._withStripped=!0;const Qi={components:{SettingFont:Ki,Loading:A({render:Zi,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"eqc-loading"},[t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-inner"},[t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})]),this._v(" "),t("div",{staticClass:"loader-line-wrap"},[t("div",{staticClass:"loader-line"})])])])])}]},void 0,{},void 0,!1,void 0,!1,void 0,void 0,void 0)},data:function(){return{preventDefault:function(e){return e.preventDefault()}}},computed:{font:function(){return Vue.store.state.font},openLoading:function(){return Vue.store.state.scene.openLoading},settingBar:function(){return Vue.store.state.scene.editorConfig.settingBar}},mounted:function(){document.addEventListener("dragstart",this.dragstart),document.addEventListener("contextmenu",this.preventDefault),this.$el.addEventListener("wheel",this.preventDefault)}};var eo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqx-h2open"},[n("div",{ref:"eqxCenter",staticClass:"eqx-center"},[n("div",{directives:[{name:"keymap",rawName:"v-keymap:editor",arg:"editor"}],ref:"editor",staticClass:"eqx-editor",attrs:{tabindex:"0"}})]),e._v(" "),e.settingBar?n("div",{ref:"eqxRight",staticClass:"eqx-right"}):e._e(),e._v(" "),n("transition",{attrs:{name:"rotate-y-left"}},[e.font.layer.show?n("setting-font"):e._e()],1),e._v(" "),e.openLoading?n("loading"):e._e()],1)};eo._withStripped=!0;const to=A({render:eo,staticRenderFns:[]},void 0,Qi,void 0,!1,void 0,!1,void 0,void 0,void 0);var no=function e(){n(this,e)},io=function e(){n(this,e),this.size={},this.positon={}},oo=function(){function e(){n(this,e),this.defaultData(),this.$el=null,this.render(),Vue.store.commit("SET_BACKGROUND",{background:this})}return o(e,[{key:"render",value:function(){this.$el=document.createElement("div").css({position:"absolute",width:"100%",height:"100%",overflow:"hidden",background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAHVJREFUWAnt07ENwCAMRFGTLbz/bvYYkJL+O1KK7wqKs9DTsapqx+Bk5uC2iGd02wfLfCBFVVBBKkDzdlBBKkDzdlBBKkDzdlBBKkDza79Dl9z57r6v+OwnoYQKKkgFaN4OKkgFaN4OKkgFaN4OKkgFaP73HTxiJwr8lGq9hwAAAABJRU5ErkJggg==")'}),this.$bgBottom=document.createElement("div").css({position:"absolute",left:0,top:0,width:"100%",height:"100%"}),this.$bgMiddle=this.$bgBottom.clone(),this.$bgTop=this.$bgBottom.clone(),this.$el.attr({class:"eqx-background"}),this.$el.appendChild(this.$bgBottom),this.$el.appendChild(this.$bgMiddle),this.$el.appendChild(this.$bgTop)}},{key:"defaultData",value:function(){this.property={clearCount:0,blur:0,bottom:{color:"transparent",colors:["",""],rotate:0,type:0},middle:{opacity:1,size:.1,src:"",type:0},top:{color:"#",colors:["",""],opacity:.4,rotate:0,type:0}}}},{key:"setBackground",value:function(e){Object.assign(e,this.property),this.setBackgroundBottom(e.bottom),this.setBackgroundMiddle(e.middle),this.setBackgroundTop(e.top),e.blur||(e.blur=0),this.setBackgroundBlur(e.blur)}},{key:"setBackgroundBottom",value:function(e){ao.call(this,e,this.$bgBottom)}},{key:"setBackgroundMiddle",value:function(e){var t=e.type,n=e.src,i=e.size,o=e.opacity,a=e.crop;this.$bgMiddle.css("background",""),n&&(n=n.split("?")[0]+"?imageMogr2/auto-orient",this.setBackgroundImage(t,n,i,o,a))}},{key:"setBackgroundImage",value:function(e,t,n,i,o){o&&(t+="/crop/!".concat(o.width,"x").concat(o.height,"a").concat(o.left,"a").concat(o.top)),n=0===e?100*n+"%":"cover",this.$bgMiddle.css(Object.assign({background:"url(".concat(t,") center / ").concat(n),opacity:i}))}},{key:"setBackgroundBlur",value:function(e){this.$bgMiddle.css({filter:"blur(".concat(e,"px)")})}},{key:"setBackgroundTop",value:function(e){ao.call(this,e,this.$bgTop)}},{key:"clearBackground",value:function(){Object.assign(this.property,{clearCount:0,blur:0,bottom:{color:"transparent",colors:["",""],rotate:0,type:0},middle:{opacity:1,size:.1,src:"",type:0},top:{color:"#",colors:["",""],opacity:.4,rotate:0,type:0}}),this.setBackground(this.property)}},{key:"setBackgroundColor",value:function(e){Array.isArray(e)?(this.property.bottom.type=1,this.property.bottom.colors=e):(this.property.bottom.type=0,this.property.bottom.color=e),this.setBackground(this.property)}}]),e}();function ao(e,t){var n=e.type,i=e.color,o=e.colors,a=e.rotate,s=e.opacity,r={};(t=t||this.$bgBottom).css("background",""),0===n?r={background:i,opacity:s}:1===n&&(r={background:"linear-gradient(".concat(a,"deg, ").concat(o[0]||"transparent"," 0%, ").concat(o[1]||"transparent"," 100%)"),opacity:s}),t.css(r)}var so=function(){function e(t){n(this,e),this.$el=null,this.render()}return o(e,[{key:"render",value:function(){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-range-mask"}).css({position:"absolute",width:"100%",height:"100%",outline:"rgba(236, 238, 240, 0.9) solid 10000px","z-index":1e3,"pointer-events":"none"});var e=document.createElement("DIV");e.attr({class:"shadow"}).css({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",display:"flex","box-shadow":"rgba(0, 0, 0, 0.16) 0px 0px 4px 0px"});var t=document.createElement("DIV");t.attr({class:"bleed"}).css({width:"100%",border:"1px dashed rgb(118, 131, 143)",display:"none"}),e.appendChild(t),this.$el.appendChild(e)}}]),e}();const ro={computed:{elementResizeBarEnum:function(){return It},allowResizeW:function(){return Pt(this.dataJson.resizeType)},allowResizeH:function(){return Mt(this.dataJson.resizeType)},allowResizeWH:function(){return Jt(this.dataJson.resizeType)},getStyle:function(){return this.dataJson.visible?{width:"".concat(this.dataJson.width,"px"),height:"".concat(this.dataJson.height,"px"),left:"".concat(this.dataJson.x-1,"px"),top:"".concat(this.dataJson.y-1,"px"),transform:"rotate(".concat(this.dataJson.rotate,"deg)"),transformOrigin:this.dataJson.transformOrigin}:{}},getMaskStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)")}:{}},getRotateMaskStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)"),transformOrigin:this.dataJson.transformOrigin}:{}},getRotateStyle:function(){return this.dataJson.visible?{transform:"rotate(".concat(-this.dataJson.rotate,"deg)")}:{}},getRotateValueStyle:function(){return{left:"".concat(this.dataJson.rotateValueLeft||-12,"px"),top:"".concat(this.dataJson.rotateValueTop||-40,"px")}}}};var lo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{class:["eqx-box-edit",e.dataJson.isGroup||1===e.dataJson.elementCount?"eqx-box-edit-group":""],style:e.getStyle},[n("div",{directives:[{name:"show",rawName:"v-show",value:(e.dataJson.resizeBar|e.elementResizeBarEnum.noResize)!==e.elementResizeBarEnum.noResize||!0,expression:"(dataJson.resizeBar|elementResizeBarEnum.noResize)!==elementResizeBarEnum.noResize||true"}],ref:"boxEditMask",staticClass:"box-edit-mask",style:e.getMaskStyle},[n("div")]),e._v(" "),n("div",{ref:"boxEditRotateMask",staticClass:"box-edit-rotate-mask",style:e.getRotateMaskStyle}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexLeftTop)===e.elementResizeBarEnum.vertexLeftTop,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexLeftTop)===elementResizeBarEnum.vertexLeftTop"}],ref:"vertexWestNorth",staticClass:"vertex west-north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexRightTop)===e.elementResizeBarEnum.vertexRightTop,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexRightTop)===elementResizeBarEnum.vertexRightTop"}],ref:"vertexEastNorth",staticClass:"vertex east-north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexRightBottom)===e.elementResizeBarEnum.vertexRightBottom,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexRightBottom)===elementResizeBarEnum.vertexRightBottom"}],ref:"vertexEastSouth",staticClass:"vertex east-south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeWH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.vertexLeftBottom)===e.elementResizeBarEnum.vertexLeftBottom,expression:"dataJson.controlSizeBarVisible && allowResizeWH &&\n            (dataJson.resizeBar|elementResizeBarEnum.vertexLeftBottom)===elementResizeBarEnum.vertexLeftBottom"}],ref:"vertexWestSouth",staticClass:"vertex west-south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineTop)===e.elementResizeBarEnum.lineTop,expression:"dataJson.controlSizeBarVisible && allowResizeH &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineTop)===elementResizeBarEnum.lineTop"}],ref:"sideNorth",staticClass:"side north"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeW&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineRight)===e.elementResizeBarEnum.lineRight,expression:"dataJson.controlSizeBarVisible && allowResizeW &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineRight)===elementResizeBarEnum.lineRight"}],ref:"sideEast",staticClass:"side east"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeH&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineBottom)===e.elementResizeBarEnum.lineBottom,expression:"dataJson.controlSizeBarVisible && allowResizeH &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineBottom)===elementResizeBarEnum.lineBottom"}],ref:"sideSouth",staticClass:"side south"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlSizeBarVisible&&e.allowResizeW&&(e.dataJson.resizeBar|e.elementResizeBarEnum.lineLeft)===e.elementResizeBarEnum.lineLeft,expression:"dataJson.controlSizeBarVisible && allowResizeW &&\n            (dataJson.resizeBar|elementResizeBarEnum.lineLeft)===elementResizeBarEnum.lineLeft"}],ref:"sideWest",staticClass:"side west"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.middleLineVisible,expression:"dataJson.middleLineVisible"}],ref:"middleLine",staticClass:"middle-line"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.controlRotateBarVisible,expression:"dataJson.controlRotateBarVisible"}],ref:"rotate",staticClass:"rotate",style:e.getRotateStyle},[n("i",{staticClass:"icon eqf-flip"}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.rotating,expression:"dataJson.rotating"}],staticClass:"rotate-value",style:e.getRotateValueStyle,domProps:{textContent:e._s(e.dataJson.rotate+"°")}})]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.showThreeDRotate&&e.dataJson.controlSizeBarVisible,expression:"dataJson.showThreeDRotate && dataJson.controlSizeBarVisible"}],ref:"threeD",staticClass:"three-control three-d hint--bottom hint--rounded",attrs:{"data-hint":"长按拖拽变换"}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dataJson.showTwoDRotate&&e.dataJson.controlSizeBarVisible,expression:"dataJson.showTwoDRotate && dataJson.controlSizeBarVisible"}],ref:"elementThreed",staticClass:"three-control element-threed hint--bottom hint--rounded",attrs:{"data-hint":"长按拖拽变换，双击复原"}})]):e._e()};lo._withStripped=!0;const co=A({render:lo,staticRenderFns:[]},void 0,ro,void 0,!1,void 0,!1,void 0,void 0,void 0);function uo(){var e;e=1===Vue.elementBoxEdit.elementList.length?Vue.elementBoxEdit.elementList[0].elementResizeType:Ot.combine;var t=It,n=Nt;(Pt(e)||Mt(e))&&(ho(this.$refs.sideWest,t.lineLeft,n.line),ho(this.$refs.sideEast,t.lineRight,n.line),ho(this.$refs.sideNorth,t.lineTop,n.line),ho(this.$refs.sideSouth,t.lineBottom,n.line)),Jt(e)&&(ho(this.$refs.vertexWestNorth,t.vertexLeftTop,n.vertex),ho(this.$refs.vertexWestSouth,t.vertexLeftBottom,n.vertex),ho(this.$refs.vertexEastNorth,t.vertexRightTop,n.vertex),ho(this.$refs.vertexEastSouth,t.vertexRightBottom,n.vertex))}function ho(e,t,n){e.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault();var i=Vue.guideLine;Vue.elementBoxEdit.setResizebar(t);var o,a=function(){var e=Vue.elementBoxEdit.$vm.$data.dataJson.x-1,t=Vue.elementBoxEdit.$vm.$data.dataJson.y-1,n=Vue.elementBoxEdit.$vm.$data.dataJson.rotate,i=Vue.elementBoxEdit.$vm.$data.dataJson.width+2,o=Vue.elementBoxEdit.$vm.$data.dataJson.height+2,a=null;if(n%90==0&&i===o||n%180==0)a={rotate:0,x:e,y:t,width:i,height:o};else if(90===n||270===n){var s=0,r=0,l=0,c=0;if(i>o){var d=e+(i-o)/2;s=s>d||0===s?d:s;var u=t-(i-o)/2;r=r>u||0===r?u:r;var h=d+o;l=l<h?h:l;var p=u+i;c=c<p?p:c}else if(i<o){var m=e-(o-i)/2;s=s>m||0===s?m:s;var g=t+(o-i)/2;r=r>g||0===r?g:r;var f=m+o;l=l<f?f:l;var v=g+i;c=c<v?v:c}a={rotate:0,x:s,y:r,width:l-s,height:c-r}}else{var y=Vue.elementBoxEdit.$vm.$el.getBoundingClientRect();a={x:"",y:"",width:i,height:o,rotate:n,x1:y.x,y1:y.y,width1:y.width,height1:y.height}}var x=H.getVertex(a);if(90===n)return{lt:x.rt,rt:x.rb,rb:x.lb,lb:x.lt};if(180===n)return{lt:x.rb,rt:x.lb,rb:x.lt,lb:x.rt};if(270===n)return{lt:x.lb,rt:x.lt,rb:x.rt,lb:x.rb};return x}(Vue.elementBoxEdit),s={rotate:Vue.elementBoxEdit.$vm.$data.dataJson.rotate,width:Vue.elementBoxEdit.$vm.$data.dataJson.width,height:Vue.elementBoxEdit.$vm.$data.dataJson.height,x:Vue.elementBoxEdit.$vm.$data.dataJson.x,y:Vue.elementBoxEdit.$vm.$data.dataJson.y},r=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),l=Nt;n===l.line?(o=function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),o=null,a=null,s=null,r=It;switch(t){case r.lineTop:s="left bottom";var l=H.getPointPositionRotateWithCenterPoint(e.lt,e.lb,-n);o=l.x,a=l.y;break;case r.lineRight:case r.lineBottom:s="left top",o=e.lt.x,a=e.lt.y;break;case r.lineLeft:s="right top";var c=H.getPointPositionRotateWithCenterPoint(e.lt,e.rt,-n);o=c.x,a=c.y}n%90!=0?(o=o-i.x+1,a=a-i.y+1):(o+=1,a+=1);return{transformOrigin:s,x:o,y:a}}(a,t,s.rotate),i.startEqualWidthHeight()):o=function(e,t,n){var i=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),o=null,a=null,s=null,r=It;switch(t){case r.vertexLeftTop:s="right bottom";var l=H.getPointPositionRotateWithCenterPoint(e.lt,e.rb,-n);o=l.x,a=l.y;break;case r.vertexLeftBottom:s="right top";var c=H.getPointPositionRotateWithCenterPoint(e.lt,e.rt,-n);o=c.x,a=c.y;break;case r.vertexRightTop:s="left bottom";var d=H.getPointPositionRotateWithCenterPoint(e.lt,e.lb,-n);o=d.x,a=d.y;break;case r.vertexRightBottom:s="left top",o=e.lt.x,a=e.lt.y}n%90!=0?(o=o-i.x+1,a=a-i.y+1):(o+=1,a+=1);return{transformOrigin:s,x:o,y:a}}(a,t,s.rotate);var c=function(){var e=Vue.elementBoxEdit.scale,t=[];return Vue.elementBoxEdit.elementList.forEach((function(n){var i={id:n.elementJson.id,type:n.elementJson.type,x:n.elementJson.css.x*e,y:n.elementJson.css.y*e,width:n.getBoxSize().width*e,height:n.getBoxSize().height*e};[$t.text,$t.date].includes(i.type)&&(i.reverse="vertical-lr"===n.elementJson.css.writingMode),t.push(i),n.resizeInitDataStore(),n.setCssIsUpdate(!1),n.setPropertyIsUpdate(!1)})),t}(),d=function(){var e=Vue.elementBoxEdit.scale,t=[];return Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList).forEach((function(n){var i={id:n.id,x:n.style.x*e,y:n.style.y*e,width:n.style.width*e,height:n.style.height*e,rotate:n.style.rotate};t.push(i)})),t}(),u=!1,h=function(e){u||Vue.elementBoxEdit.updateCss({transformOrigin:o.transformOrigin,x:o.x,y:o.y});var i=function(e){return{x:e.pageX,y:e.pageY}}(e),d=null;if(s.rotate%90!=0){var h=function(e,t,n){var i=It,o=null;switch(t){case i.vertexLeftTop:o=H.calcFootOfPerpendicular(e.rb,e.lb,n);break;case i.vertexLeftBottom:o=H.calcFootOfPerpendicular(e.rt,e.lt,n);break;case i.vertexRightTop:o=H.calcFootOfPerpendicular(e.lb,e.rb,n);break;case i.vertexRightBottom:o=H.calcFootOfPerpendicular(e.lt,e.rt,n);break;case i.lineTop:o=H.calcFootOfPerpendicular(e.lt,e.lb,n);break;case i.lineRight:o=H.calcFootOfPerpendicular(e.lt,e.rt,n);break;case i.lineBottom:o=H.calcFootOfPerpendicular(e.lt,e.lb,n);break;case i.lineLeft:o=H.calcFootOfPerpendicular(e.lt,e.rt,n)}return o}(a,t,i);d=n===l.line?function(e,t,n,i,o){var a=It,s=null,r=null,l=null,c=null,d=null;switch(n){case a.lineTop:c=H.calcHypotenuseLength(i.x-t.lb.x,i.y-t.lb.y),r=t.lb.y-c-o.y-1;break;case a.lineRight:l=H.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y);break;case a.lineBottom:c=H.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y);break;case a.lineLeft:l=H.calcHypotenuseLength(i.x-t.rt.x,i.y-t.rt.y),s=t.rt.x-l-o.x-1}d={rotate:e.rotate},null!==l&&(d.width=l);null!==c&&(d.height=c);null!==s&&(d.x=s);null!==r&&(d.y=r);return d}(s,a,t,h,r):function(e,t,n,i,o){var a=It,s=null,r=null,l=null,c=null,d=null;switch(n){case a.vertexLeftTop:l=H.calcHypotenuseLength(i.x-t.rb.x,i.y-t.rb.y),c=Math.round(l/(e.width/e.height)),s=t.rb.x-l-o.x-1,r=t.rb.y-c-o.y-1;break;case a.vertexLeftBottom:l=H.calcHypotenuseLength(i.x-t.rt.x,i.y-t.rt.y),c=Math.round(l/(e.width/e.height)),s=t.rt.x-l-o.x-1;break;case a.vertexRightTop:l=H.calcHypotenuseLength(i.x-t.lb.x,i.y-t.lb.y),c=Math.round(l/(e.width/e.height)),r=t.lb.y-c-o.y-1;break;case a.vertexRightBottom:l=H.calcHypotenuseLength(i.x-t.lt.x,i.y-t.lt.y),c=Math.round(l/(e.width/e.height))}d={width:l,height:c,rotate:e.rotate},null!==s&&(d.x=s);null!==r&&(d.y=r);return d}(s,a,t,h,r)}else d=n===l.line?function(e,t,n,i,o){var a=It,s=null,r=null,l=null,c=null,d=null;switch(n){case a.lineTop:[0,180].includes(e.rotate)?(c=Math.abs(t.lb.y-(i.y-o.y)),r=t.lb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.lb.x-(i.x-o.x)),r=t.lb.y-c-1);break;case a.lineRight:[0,180].includes(e.rotate)?l=Math.abs(i.x-t.lb.x-o.x):[90,270].includes(e.rotate)&&(l=Math.abs(i.y-t.lb.y-o.y));break;case a.lineBottom:[0,180].includes(e.rotate)?c=Math.abs(i.y-o.y-t.lt.y):[90,270].includes(e.rotate)&&(c=Math.abs(t.lt.x-(i.x-o.x)));break;case a.lineLeft:[0,180].includes(e.rotate)&&(l=Math.abs(i.x-o.x-t.rt.x),s=t.rt.x-l-1),[90,270].includes(e.rotate)&&(l=Math.abs(t.rt.y-(i.y-o.y)),s=t.rt.x-l-1)}d={rotate:e.rotate},null!==l&&(d.width=l);null!==c&&(d.height=c);null!==s&&(d.x=s);null!==r&&(d.y=r);return d}(s,a,t,i,r):function(e,t,n,i,o){var a=It,s=null,r=null,l=null,c=null,d=null;switch(n){case a.vertexLeftTop:[0,180].includes(e.rotate)?(l=Math.abs(t.rt.x-(i.x-o.x)),c=Math.round(l/(e.width/e.height)),s=t.rb.x-l-1,r=t.rb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.lb.x-(i.x-o.x)),l=Math.round(c*(e.width/e.height)),s=t.rb.x-l-1,r=t.rb.y-c-1);break;case a.vertexLeftBottom:[0,180].includes(e.rotate)?(l=Math.abs(t.rt.x-(i.x-o.x)),c=Math.round(l/(e.width/e.height)),s=t.rt.x-l-1):[90,270].includes(e.rotate)&&(c=Math.abs(t.rt.x-(i.x-o.x)),l=Math.round(c*(e.width/e.height)),s=t.rt.x-l-1);break;case a.vertexRightTop:[0,180].includes(e.rotate)?(l=Math.abs(i.x-t.lb.x-o.x),c=Math.round(l/(e.width/e.height)),r=t.lb.y-c-1):[90,270].includes(e.rotate)&&(c=Math.abs(i.x-t.lb.x-o.x),l=Math.round(c*(e.width/e.height)),r=t.lb.y-c-1);break;case a.vertexRightBottom:[0,180].includes(e.rotate)&&(l=Math.abs(i.x-t.lb.x-o.x),c=Math.round(l/(e.width/e.height))),[90,270].includes(e.rotate)&&(c=Math.abs(t.rt.x-(i.x-o.x)),l=Math.round(c*(e.width/e.height)))}d={width:l,height:c,rotate:e.rotate},null!==s&&(d.x=s);null!==r&&(d.y=r);return d}(s,a,t,i,r);!function(e,t,n,i,o){var a=Vue.elementBoxEdit.scale;if(i===Nt.line&&[$t.text,$t.date].includes(e[0].type)){var s,r;if(e[0].reverse){var l=Vue.elementBoxEdit.elementList[0].getResizeMinSize().width;s=l>n.height?l:n.height,r=Vue.elementBoxEdit.elementList[0].getResizeBoxHeight(s)}else{var c=Vue.elementBoxEdit.elementList[0].getResizeMinSize().width;r=c>n.width?c:n.width,s=Vue.elementBoxEdit.elementList[0].getResizeBoxHeight(r)}n.width=r,n.height=s}n.elementWidth=n.width/a,n.elementHeight=n.height/a,Vue.elementBoxEdit.updateCss(n),po(e,t,i,o,!1),Vue.elementBoxEdit.elementList.length>1&&Vue.elementsBoxs.setElementsGroupVisible(!1)}(c,s,d,n,t),u=!0};document.addEventListener("mousemove",h),document.addEventListener("mouseup",(function e(i){u&&setTimeout((function(){h(i),function(e,t,n,i,o){Vue.elementBoxEdit.reset(),po(e,n,i,o,!0),function(e,t,n,i){var o=Vue.elementBoxEdit.scale,a=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),s=Vue.elementBoxEdit.$vm.$refs.boxEditMask.getBoundingClientRect(),r={x:s.x-a.x,y:s.y-a.y,width:s.width,height:s.height};if(Vue.elementBoxEdit.elementList.length>1){var l=Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList);1===l.length&&Vue.elements.getFirstGroupElementCount()===Vue.elementBoxEdit.elementList.length?(l[0].setPosition({x:r.x/o,y:r.y/o}),l[0].setSize({width:r.width/o,height:r.height/o})):l.length>0&&Vue.elements.getFirstGroupElementCount()!==Vue.elementBoxEdit.elementList.length&&l.forEach((function(n){var i=e.filter((function(e){return e.id===n.id}))[0];n.setPosition({x:(r.x+(i.x-t.x)/t.width*r.width)/o,y:(r.y+(i.y-t.y)/t.height*r.height)/o}),n.setSize({width:r.width*(i.width/t.width)/o,height:r.height*(i.height/t.height)/o})})),l.length>0&&Vue.elementsBoxs.setGroupElement(Vue.elementBoxEdit.elementList)}}(t,n),i===Nt.line&&Vue.guideLine.clearEqualWHGuideLine()}(c,d,s,n,t)}),100),Vue.elementBoxEdit.setResizebar(It.noResize),u=!1,Vue.operatRecord.addRecord(),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",e)}))}))}function po(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=Vue.elementBoxEdit.scale,s=Vue.elementBoxEdit.$vm.$el.parentElement.parentElement.getBoundingClientRect(),r=Vue.elementBoxEdit.$vm.$refs.boxEditMask.getBoundingClientRect(),l={x:r.x-s.x,y:r.y-s.y,width:r.width,height:r.height};if(1===Vue.elementBoxEdit.elementList.length){o&&(Vue.elementBoxEdit.elementList[0].setCssIsUpdate(!0),Vue.elementBoxEdit.elementList[0].setPropertyIsUpdate(!0)),Vue.elementBoxEdit.elementList[0].resizeUpdateCss({x:l.x/a,y:l.y/a,width:l.width/a,height:l.height/a},n,o);var c=Nt;if(n===c.line){var d=Vue.elementBoxEdit.elementList[0].$el.getBoundingClientRect(),u=l.width/a,h=l.height/a,p={handle:i,width:u,height:h,top:d.top,left:d.left,bottom:d.bottom,right:d.right,eRotate:Vue.elementBoxEdit.elementList[0].elementJson.css.transform},m=Vue.guideLine;m.setTargetRect(p),m.clearEqualWHGuideLine(),m.showEqualWHGuideLine()}}else Vue.elementBoxEdit.elementList.forEach((function(i){o&&(i.setCssIsUpdate(!0),i.setPropertyIsUpdate(!0));var s=e.filter((function(e){return e.id===i.elementJson.id}))[0];i.resizeUpdateCss({x:(l.x+(s.x-t.x)/t.width*l.width)/a,y:(l.y+(s.y-t.y)/t.height*l.height)/a,width:l.width*(s.width/t.width)/a,height:l.height*(s.height/t.height)/a},n,o)})),Vue.elementBoxHover.show(Vue.elementBoxEdit.elementList)}function mo(){var e=this.$el;this.$refs.rotate.addEventListener("mousedown",(function(t){t.stopPropagation(),t.preventDefault();var n=e.getBoundingClientRect(),i=n.left,o=n.top,a={x:i+n.width/2,y:o+n.height/2},s=0,r=[],l=[];if(1===Vue.elementBoxEdit.elementList.length)s=Vue.elementBoxEdit.elementList[0].elementJson.css.rotate,Vue.elementBoxEdit.elementList[0].setCssIsUpdate(!1),Vue.elementBoxEdit.elementList[0].setPropertyIsUpdate(!1);else if(Vue.elementBoxEdit.elementList.length>1){s=Vue.elementBoxEdit.$vm.$data.dataJson.rotate;var c=Vue.elementBoxEdit.scale;Vue.elementBoxEdit.elementList.forEach((function(e){var t=e.elementJson,n={id:t.id,x:t.css.x*c,y:t.css.y*c,width:e.getBoxSize().width*c,height:e.getBoxSize().height*c,rotate:t.css.rotate};n.centerX=n.x+n.width/2,n.centerY=n.y+n.height/2,r.push(n),e.setCssIsUpdate(!1),e.setPropertyIsUpdate(!1)})),Vue.elements.getElementsGroup(Vue.elementBoxEdit.elementList).forEach((function(e){var t={id:e.id,x:e.style.x*c,y:e.style.y*c,width:e.style.width*c,height:e.style.height*c,rotate:e.style.rotate};t.centerX=t.x+t.width/2,t.centerY=t.y+t.height/2,l.push(t)}))}Vue.elementBoxEdit.showRotate(s);var d=function(e){var t={x:e.pageX,y:e.pageY},n=function(e,t){var n=t.x-e.x,i=t.y-e.y,o=Math.abs(n/i),a=Math.atan(o)/(2*Math.PI)*360;n>0&&i<0||(n>=0&&i>0?a=180-a:n<0&&i>0?a=180+a:n<0&&i<0&&(a=360-a));return Math.floor(a)}(a,t);n=360===n?0:n,Vue.elementBoxEdit.showRotate(n),Vue.elementBoxEdit.setRotate(s,n,r,l),Vue.elementBoxEdit.elementList.length>1&&(Vue.elementsBoxs.setHoverElement(Vue.elementBoxEdit.elementList),Vue.elementsBoxs.setElementsGroupVisible(!1))};document.addEventListener("mousemove",d),document.addEventListener("mouseup",(function e(t){Vue.elementBoxEdit.hideRotate(),Vue.elementBoxEdit.elementList.forEach((function(e){e.setCssIsUpdate(!0),e.setPropertyIsUpdate(!0)})),Vue.elementBoxEdit.elementList.length>1&&Vue.elements.getFirstGroupElementCount()!==Vue.elementBoxEdit.elementList.length&&Vue.elementsBoxs.setGroupElement(Vue.elementBoxEdit.elementList),Vue.operatRecord.addRecord(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e)}))}))}function go(){if(1===Vue.elementBoxEdit.elementList.length){var e=Vue.elementBoxEdit.elementList[0],t=Vue.elementBoxEdit.$vm.$refs.elementThreed;t.addEventListener("dblclick",(function(t){e.updateProperty({rotateX:0,rotateY:0})})),t.addEventListener("mousedown",(function(t){if(t.stopPropagation(),t.preventDefault(),Vue.colorPicker.close(),!e.elementJson.property.lock){var n=t.clientX,i=t.clientY,o=0,a=0,s=e.elementJson.property.rotateX||0,r=e.elementJson.property.rotateY||0,l=function(t){o=t.clientX,a=t.clientY,s-=1*(a-i)%360,r+=1*(o-n)%360,n=o,i=a,e.updateProperty({rotateX:s,rotateY:r})};document.addEventListener("mousemove",l),document.addEventListener("mouseup",(function e(t){document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)}))}}))}}function fo(){if(1===Vue.elementBoxEdit.elementList.length){var t=Vue.elementBoxEdit.elementList[0];Vue.elementBoxEdit.$vm.$refs.threeD.addEventListener("mousedown",(function(n){if(n.stopPropagation(),n.preventDefault(),Vue.colorPicker.close(),!t.elementJson.property.lock){t.$orbitControls.enabled=!0,t.$axesHelper.visible=!0,Vue.elementsBoxs.clearSelected(),t.updateCss({overflow:"visible"});var i=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",!1,!0,window,0,event.screenX,event.screenY,event.clientX,event.clientY,!1,!1,!1,!1,0,null),t.$el.querySelector("canvas").dispatchEvent(i);document.addEventListener("mouseup",(function n(){t.$orbitControls.enabled=!1,t.$axesHelper.visible=!1;var i=Fi.getBoxInfo(t,t.$renderer.getSize(new e.Vector2)),o=i.maxX-i.centerX,a=i.centerX-i.minX,s=i.maxY-i.centerY,r=a-o,l=i.centerY-i.minY-s;t.$el.querySelector("canvas").css({marginLeft:r+"px",marginTop:l+"px"});var c=t.elementJson.css,d=parseFloat(c.x)+parseFloat(c.width)/2,u=parseFloat(c.y)+parseFloat(c.height)/2;t.updateCss({x:d-(i.width+20)/2,y:u-(i.height+20)/2,width:i.width+20,height:i.height+20,overflow:"hidden"}),t.updateProperty({cameraPosition:{fov:t.$camera.fov,x:t.$camera.position.x,y:t.$camera.position.y,z:t.$camera.position.z},canvasStyle:{width:t.$renderer.getSize(new e.Vector2).x,height:t.$renderer.getSize(new e.Vector2).y,marginLeft:r+"px",marginTop:l+"px"}}),Vue.elementsBoxs.setSelectedElement([t]),document.removeEventListener("mouseup",n)}))}}))}}var vo=function(){function e(t){n(this,e);var i=Vue.extend(co);this.$vm=new i({data:{dataJson:{controlSizeBarVisible:!0,controlRotateBarVisible:!0,visible:!1,x:0,y:0,width:0,height:0,elementX:0,elementY:0,elementWidth:0,elementHeight:0,transformOrigin:"center center",rotate:0,rotating:!1,rotateValueLeft:0,rotateValueTop:0,middleLineVisible:!1,moveing:!1,resizeType:0,resizeBar:It.noResize,isGroup:!1,elementCount:0,showTwoDRotate:!1,showThreeDRotate:!1}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementList=null}return o(e,[{key:"updateCss",value:function(e){Object.assign(this.$vm.$data.dataJson,e)}},{key:"setScale",value:function(e){this.scale=e}},{key:"reset",value:function(){if(this.$vm.$refs.boxEditMask&&"center center"!==this.$vm.$data.dataJson.transformOrigin){var e=this.scale,t=this.$vm.$el.parentElement.parentElement.getBoundingClientRect(),n=this.$vm.$refs.boxEditMask.firstChild.getBoundingClientRect(),i=n.x-t.x,o=n.y-t.y;this.updateCss({transformOrigin:"center center",x:i+1,y:o+1,elementX:(i+1)/e,elementY:(o+1)/e,controlSizeBarVisible:!0,controlRotateBarVisible:!0})}}},{key:"remove",value:function(){var e=this;return new Promise((function(t,n){e.elementList=[],e.$vm.$data.dataJson.visible=!1,e.$vm.$nextTick((function(){t()}))}))}},{key:"getPosition",value:function(){return{x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y}}},{key:"move",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t={x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y}),this.$vm.$data.dataJson.x=t.x+e.x,this.$vm.$data.dataJson.y=t.y+e.y,this.$vm.$data.dataJson.elementX=this.$vm.$data.dataJson.x/this.scale,this.$vm.$data.dataJson.elementY=this.$vm.$data.dataJson.y/this.scale}},{key:"show",value:function(e){if(this.elementList=e,0!==e.length){var t="",n="",i="",o="",a=0,s=!1,r=!1;if(this.elementList.length>1&&this.$vm.$data.dataJson.visible&&!this.$vm.$data.dataJson.isGroup&&Vue.elements.getSelected().length===this.elementList.length)t=this.$vm.$data.dataJson.elementX,n=this.$vm.$data.dataJson.elementY,i=t+this.$vm.$data.dataJson.elementWidth,o=n+this.$vm.$data.dataJson.elementHeight,a=this.$vm.$data.dataJson.rotate;else if(1===e.length){var l=e[0],c=l.elementJson.css,d=l.getBoxSize(),u=d.width,h=d.height;t=c.x,n=c.y,i=c.x+u,o=c.y+h,a=c.rotate,s=l.elementJson.type===$t.image,r=l.elementJson.type===$t.textThreeD}else if(e.length>1){var p=Vue.elements.searchGroup(e);if(p&&p.style){var m=p.style,g=m.x,f=m.y,v=m.width,y=m.height;t=g,n=f,i=g+v,o=f+y,a=p.style.rotate}else{var x={};e.forEach((function(e){null!==Vue.elements.getElementTopGroup(e)&&(x[e.elementJson.id]=!0)})),Vue.elements.getElementsGroup(e).forEach((function(e){var a=e.style,s=yo(a.x,a.y,a.width,a.height,a.rotate,t,n,i,o);t=s.minX,n=s.minY,i=s.maxX,o=s.maxY})),e.forEach((function(e){if(!x[e.elementJson.id]){var a=e.elementJson.css,s=a.x,r=a.y,l=a.rotate,c=e.getBoxSize(),d=yo(s,r,c.width,c.height,l,t,n,i,o);t=d.minX,n=d.minY,i=d.maxX,o=d.maxY}})),a=0}}this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.x=t*this.scale,this.$vm.$data.dataJson.y=n*this.scale,this.$vm.$data.dataJson.elementX=t,this.$vm.$data.dataJson.elementY=n,this.$vm.$data.dataJson.width=(i-t)*this.scale,this.$vm.$data.dataJson.height=(o-n)*this.scale,this.$vm.$data.dataJson.elementWidth=i-t,this.$vm.$data.dataJson.elementHeight=o-n,this.$vm.$data.dataJson.rotate=a,this.$vm.$data.dataJson.elementCount=e.length,this.$vm.$data.dataJson.resizeType=function(e){if(1===e.length)return e[0].elementResizeType;return 4}(e),this.$vm.$data.dataJson.showTwoDRotate=s,this.$vm.$data.dataJson.showThreeDRotate=r}}},{key:"bind",value:function(){var e=this.$vm.$data.dataJson.showTwoDRotate,t=this.$vm.$data.dataJson.showThreeDRotate;this.$vm.$nextTick((function(){uo.call(this),mo.call(this),e&&go.call(this),t&&fo.call(this)}))}},{key:"setControlSizeBarVisible",value:function(e){this.$vm.$data.dataJson.controlSizeBarVisible=e}},{key:"setControlRotateBarVisible",value:function(e){this.$vm.$data.dataJson.controlRotateBarVisible=e}},{key:"showRotate",value:function(e){this.setControlSizeBarVisible(!1),this.setRotating(!0),this.$vm.$data.dataJson.rotate=e;var t=function(e){var t=0,n=0;if(0===e)t=-12,n=-35;else if(e>0&&e<90){var i=35*Math.sin(Math.PI/180*e),o=35*Math.cos(Math.PI/180*e);t=-12+i,n=-o}else if(90===e)t=23,n=-3;else if(e>90&&e<180){var a=35*Math.cos(Math.PI/180*(e-90)),s=35*Math.sin(Math.PI/180*(e-90));t=-12+a,n=s}else if(180===e)t=-12,n=35;else if(e>180&&e<270){var r=35*Math.sin(Math.PI/180*(e-180)),l=35*Math.cos(Math.PI/180*(e-180));t=-12-r,n=l}else if(270===e)t=-47,n=-3;else if(e>270&&e<360){var c=35*Math.cos(Math.PI/180*(e-270)),d=35*Math.sin(Math.PI/180*(e-270));t=-12-c,n-=d}return{left:t,top:n}}(e);this.$vm.$data.dataJson.rotateValueLeft=t.left,this.$vm.$data.dataJson.rotateValueTop=t.top}},{key:"hideRotate",value:function(){this.setControlSizeBarVisible(!0),this.setRotating(!1),this.setMiddleLineVisible(!1)}},{key:"setRotate",value:function(e,t,n,i){var o=this.scale;if(this.setMiddleLineVisible(t%45==0),this.elementList.length>1){var a=Vue.elements.getElementsGroup(this.elementList);if(1===a.length&&Vue.elements.getFirstGroupElementCount()===this.elementList.length)a[0].setRotate(t);else if(a.length>0&&Vue.elements.getFirstGroupElementCount()!==this.elementList.length){var s=this.getElementBoxEditInfo();a.forEach((function(n){var a=i.filter((function(e){return n.id===e.id}))[0],r=t-e,l=H.getPointPositionRotateWithCenterPoint({x:a.centerX,y:a.centerY},{x:s.centerX,y:s.centerY},r),c=(a.rotate+r)%360;c=360===c?0:c,n.setRotate(c),n.setPosition({x:l.x/o-a.width/o/2,y:l.y/o-a.height/o/2})}))}}if(1===this.elementList.length)this.elementList[0].updateCss({rotate:t});else{var r=this.getElementBoxEditInfo();this.elementList.forEach((function(i){var a=n.filter((function(e){return i.elementJson.id===e.id}))[0],s=t-e,l=H.getPointPositionRotateWithCenterPoint({x:a.centerX,y:a.centerY},{x:r.centerX,y:r.centerY},s),c=(a.rotate+s)%360;c=360===c?0:c,i.updateCss({x:l.x/o-a.width/o/2,y:l.y/o-a.height/o/2,rotate:c})}))}}},{key:"getElementBoxEditInfo",value:function(){var e={x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y,width:this.$vm.$data.dataJson.width,height:this.$vm.$data.dataJson.height};return e.centerX=e.x+e.width/2,e.centerY=e.y+e.height/2,e}},{key:"setMiddleLineVisible",value:function(e){this.$vm.$data.dataJson.middleLineVisible=e}},{key:"calcPointInElementBoxEdit",value:function(e){return!!this.$vm.$data.dataJson.visible&&H.calcPointInRotateRect({x:this.$vm.$data.dataJson.x,y:this.$vm.$data.dataJson.y,width:this.$vm.$data.dataJson.width,height:this.$vm.$data.dataJson.height,rotate:this.$vm.$data.dataJson.rotate},e)}},{key:"getElementBoxEditVisible",value:function(){return this.$vm.$data.dataJson.visible}},{key:"setMoving",value:function(e){this.$vm.$data.dataJson.moving=e}},{key:"getMoving",value:function(){return this.$vm.$data.dataJson.moving}},{key:"setRotating",value:function(e){this.$vm.$data.dataJson.rotating=e}},{key:"getRotating",value:function(){return this.$vm.$data.dataJson.rotating}},{key:"setResizebar",value:function(e){this.$vm.$data.dataJson.resizeBar=parseInt(e)}},{key:"getResizebar",value:function(){return this.$vm.$data.dataJson.resizeBar}},{key:"getResizing",value:function(){return this.$vm.$data.dataJson.resizeBar!==It.noResize}},{key:"setIsGroup",value:function(e){this.$vm.$data.dataJson.isGroup=e}},{key:"getDataJson",value:function(){return JSON.parse(JSON.stringify(this.$vm.$data.dataJson))}},{key:"setResizing",value:function(e){this.updateCss({transformOrigin:e.transformOrigin,x:e.x,y:e.y})}},{key:"getElementList",value:function(){return this.elementList}}]),e}();function yo(e,t,n,i,o,a,s,r,l){var c=o;if(o%90==0&&n===i||o%180==0)a=""===a||a>e?e:a,s=""===s||s>t?t:s,r=r<e+n?e+n:r,l=l<t+i?t+i:l;else if(90===o||270===o){if(n>i){var d=e+(n-i)/2;a=""===a||a>d?d:a;var u=t-(n-i)/2;s=""===s||s>u?u:s;var h=d+i;r=r<h?h:r;var p=u+n;l=l<p?p:l}else if(n<i){var m=e-(i-n)/2;a=""===a||a>m?m:a;var g=t+(i-n)/2;s=""===s||s>g?g:s;var f=m+i;r=r<f?f:r;var v=g+n;l=l<v?v:l}}else o>0&&o<90||(o>90&&o<180?c=180-o:o>180&&o<270?c=o-180:o>270&&o<360&&(c=360-o));if(o%90!=0){var y=Math.sin(Math.PI/180*c),x=Math.cos(Math.PI/180*c),b=n*x+i*y,w=i*x+n*y,_=e+n/2,k=t+i/2,E=_-b/2,S=k-w/2,C=_+b/2,B=k+w/2;a=""===a||a>E?E:a,s=""===s||s>S?S:s,r=r<C?C:r,l=l<B?B:l}return{minX:a,minY:s,maxX:r,maxY:l}}const xo={methods:{getStyle:function(e){return{width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.x-1,"px"),top:"".concat(e.y-1,"px"),transform:"rotate(".concat(e.rotate,"deg)")}}}};var bo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{staticClass:"eqx-box-hovers"},[e._l(e.dataJson.list,(function(t,i){return[n("div",{key:i,staticClass:"eqx-box-hover",style:e.getStyle(t)})]}))],2):e._e()};bo._withStripped=!0;const wo=A({render:bo,staticRenderFns:[]},void 0,xo,void 0,!1,void 0,!1,void 0,void 0,void 0);var _o=function(){function e(t){n(this,e);var i=Vue.extend(wo);this.$vm=new i({data:{dataJson:{visible:!1,list:[]}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.elementList=[]}return o(e,[{key:"setScale",value:function(e){this.scale=e}},{key:"removeAll",value:function(){this.elementList=[],this.$vm.$data.dataJson.visible=!1,this.$vm.$data.dataJson.list=[]}},{key:"show",value:function(e){var t=this;0!==e.length&&(this.elementList=e,this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.list=[],e.forEach((function(e,n){var i=e.getBoxSize(),o=i.width,a=i.height;t.$vm.$data.dataJson.list.push({x:e.elementJson.css.x*t.scale,y:e.elementJson.css.y*t.scale,width:o*t.scale,height:a*t.scale,rotate:e.elementJson.css.rotate})})))}},{key:"add",value:function(e){var t=e.getBoxSize(),n=t.width,i=t.height;this.elementList.push(e),this.$vm.$data.dataJson.visible=!0,this.$vm.$data.dataJson.list.push({x:e.elementJson.css.x*this.scale,y:e.elementJson.css.y*this.scale,width:n*this.scale,height:i*this.scale,rotate:e.elementJson.css.rotate})}},{key:"remove",value:function(e){for(var t=0;t<this.elementList.length;t++)if(this.elementList[t].elementJson.id===e.elementJson.id){this.elementList.splice(t,1);break}this.elementList.length>0?this.show(this.elementList):this.removeAll()}}]),e}();const ko={methods:{getStyle:function(e){return{width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.x-1,"px"),top:"".concat(e.y-1,"px"),transform:"rotate(".concat(e.rotate,"deg)")}}}};var Eo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dataJson.visible?n("div",{staticClass:"eqx-box-groups"},[e._l(e.dataJson.list,(function(t,i){return[n("div",{key:i,staticClass:"eqx-box-group",style:e.getStyle(t)})]}))],2):e._e()};Eo._withStripped=!0;const So=A({render:Eo,staticRenderFns:[]},void 0,ko,void 0,!1,void 0,!1,void 0,void 0,void 0);var Co=function(){function e(){n(this,e);var t=Vue.extend(So);this.$vm=new t({data:{dataJson:{visible:!1,list:[]}}}).$mount(),this.$el=this.$vm.$el,this.scale=null,this.groupList=[]}return o(e,[{key:"setScale",value:function(e){this.scale=e}},{key:"removeAll",value:function(){this.groupList=[],this.$vm.$data.dataJson.visible=!1,this.$vm.$data.dataJson.list=[]}},{key:"getList",value:function(){return this.groupList}},{key:"show",value:function(e){var t=this;this.groupList=[],this.$vm.$data.dataJson.list=[],Vue.elements.getElementsGroup(e).forEach((function(e){var n={id:e.id,style:e.style};t.groupList.push(n);var i=n.style,o=i.x,a=i.y,s=i.width,r=i.height,l=i.rotate;t.$vm.$data.dataJson.list.push({id:n.id,x:o*t.scale,y:a*t.scale,width:s*t.scale,height:r*t.scale,rotate:l})})),this.setVisble(0!==this.groupList.length)}},{key:"setVisble",value:function(e){this.$vm.$data.dataJson.visible=e}}]),e}(),Bo=function(){function e(t){n(this,e),this.$el=null,this.render(),this.scale=null,this.elementBoxEdit=new vo,this.$el.appendChild(this.elementBoxEdit.$el),this.elementBoxHover=new _o,this.$el.appendChild(this.elementBoxHover.$el),this.elementBoxGroup=new Co,this.$el.appendChild(this.elementBoxGroup.$el),t.isRender||(Vue.elementBoxEdit=Vue.prototype.elementBoxEdit=this.elementBoxEdit,Vue.elementBoxHover=Vue.prototype.elementBoxHover=this.elementBoxHover,Vue.elementBoxGroup=Vue.prototype.elementBoxGroup=this.elementBoxGroup)}return o(e,[{key:"render",value:function(){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-boxs"}),this.$el.css({width:"100%",height:"100%",position:"absolute","z-index":10001,"pointer-events":"none"})}},{key:"setScale",value:function(e,t){this.scale=e,this.elementBoxEdit.setScale(e),this.setSelectedElement(t),this.elementBoxGroup.setScale(e),Vue.elements.getFirstGroupElementCount()!==t.length&&this.setGroupElement(t),this.elementBoxHover.setScale(e),t.length>1&&this.setHoverElement(t)}},{key:"resetBoxEdit",value:function(){this.elementBoxEdit.reset()}},{key:"clearSelected",value:function(){return this.elementBoxEdit.remove()}},{key:"setSelectedElement",value:function(e){this.elementBoxEdit.show(e)}},{key:"setElementBoxEditIsGroup",value:function(e){this.elementBoxEdit.setIsGroup(e)}},{key:"setSelectedElementBoxEditBind",value:function(){this.elementBoxEdit.bind()}},{key:"setSelectedElementControlBarVisible",value:function(e){this.elementBoxEdit.setControlSizeBarVisible(e),this.elementBoxEdit.setControlRotateBarVisible(e)}},{key:"moveSelectedElementBoxEdit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.elementBoxEdit.move(e,t)}},{key:"getSelectedElementBoxEditPosition",value:function(){return this.elementBoxEdit.getPosition()}},{key:"clearGroupElement",value:function(){this.elementBoxGroup.removeAll()}},{key:"setGroupElement",value:function(e){this.elementBoxGroup.show(e)}},{key:"getGroupElement",value:function(){return this.elementBoxGroup.getList()}},{key:"setElementsGroupVisible",value:function(e){return this.elementBoxGroup.setVisble(e)}},{key:"clearHoverElement",value:function(){this.elementBoxHover.removeAll()}},{key:"setHoverElement",value:function(e){this.elementBoxHover.show(e)}},{key:"addHoverElement",value:function(e){this.elementBoxHover.add(e)}},{key:"delHoverElement",value:function(e){this.elementBoxHover.remove(e)}},{key:"moveHoverElement",value:function(e){this.elementBoxHover.move(e)}},{key:"calcPointInElementBoxEdit",value:function(e){var t=this.$el.getBoundingClientRect(),n={x:e.x-t.x,y:e.y-t.y};return this.elementBoxEdit.calcPointInElementBoxEdit(n)}},{key:"getElementBoxEditVisible",value:function(){return this.elementBoxEdit.getElementBoxEditVisible()}},{key:"setElementBoxEditMoving",value:function(e){return this.elementBoxEdit.setMoving(e)}},{key:"getElementBoxEditMoving",value:function(){return this.elementBoxEdit.getMoving()}},{key:"setElementBoxEditRotating",value:function(e){return this.elementBoxEdit.setRotating(e)}},{key:"getElementBoxEditRotating",value:function(){return this.elementBoxEdit.getRotating()}},{key:"getElementBoxEditResizing",value:function(){return this.elementBoxEdit.getResizing()}}]),e}(),Ro=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),(o=t.call(this)).dataJson={offsetX:0,offsetY:0},o.$el=document.createElement("DIV"),o.$el.attr({class:"eqx-drawing-board"}).css({position:"absolute","z-index":0,"margin-top":"0px","margin-left":"0px"}),o.size=e.size,o.scale=e.scale||"auto",o.editorSize=e.editorSize,o.background=new oo,o.$el.appendChild(o.background.$el),o.rangeMask=new so,o.$el.appendChild(o.rangeMask.$el),o.elements=new Mi({size:o.size,scale:1}),o.$el.appendChild(o.elements.$el),e.isRender?o.setScale("1"):(o.elementsBoxs=new Bo({isRender:e.isRender}),o.$el.appendChild(o.elementsBoxs.$el),Vue.elements=Vue.prototype.elements=o.elements,Vue.elementsBoxs=Vue.prototype.elementsBoxs=o.elementsBoxs,o.setScale(o.scale)),o}return o(i,[{key:"setScale",value:function(e){var t=this;return new Promise((function(n,i){var o,a=t.editorSize.width/t.editorSize.height,s=t.size.width/t.size.height;"auto"===e?(a>s?o=(t.editorSize.height-100)*s:o=t.editorSize.width-100,t.scale=o/t.size.width):"1"===e?t.scale=1:"+"===e?t.scale*=1.2:"-"===e&&(t.scale*=.8);var r=t.size.width*t.scale,l=t.size.height*t.scale;t.$el.css({width:"".concat(r,"px"),height:"".concat(l,"px")}),t.elements.setScale(t.scale),t.elementsBoxs&&t.elementsBoxs.setScale(t.scale,t.elements.getSelected()),n(t.scale)}))}},{key:"addElement",value:function(e,t){this.elements.add(e),t||Vue.operatRecord.addRecord()}},{key:"delSelectedElements",value:function(){this.elements.delSelected(),this.elementsBoxs&&this.elementsBoxs.clearSelected(),this.elementsBoxs&&this.elementsBoxs.clearHoverElement(),this.elementsBoxs&&this.elementsBoxs.clearGroupElement(),Vue.operatRecord.addRecord()}},{key:"moveSelectedElements",value:function(e){}},{key:"selectAllElement",value:function(){this.elements.selectAll();var e=this.elements.getAll();this.elementsBoxs&&this.elementsBoxs.setSelectedElement(e),this.elementsBoxs&&this.elementsBoxs.setHoverElement(e)}},{key:"clearElements",value:function(){this.elements.delAll(),this.elementsBoxs&&this.elementsBoxs.clearSelected(),this.elementsBoxs&&this.elementsBoxs.clearGroupElement(),this.elementsBoxs&&this.elementsBoxs.clearHoverElement()}},{key:"setBackground",value:function(e){this.background.setBackground(e)}},{key:"setMove",value:function(e,t){this.dataJson.offsetX=e,this.dataJson.offsetY=t,this.$el.css({"margin-top":"".concat(e,"px"),"margin-left":"".concat(t,"px")})}}]),i}(io),Lo=function(e){s(i,e);var t=u(i);function i(e){var o;return n(this,i),(o=t.call(this)).$el=document.createElement("DIV"),o.$el.css({position:"absolute",background:"rgba(21, 147, 255, 0.1)"}),o}return o(i,[{key:"updateCss",value:function(e){this.$el.css(e)}}]),i}(io),$o=function(){function e(t){n(this,e),this.render(),this.isDraggingRuler=!1}return o(e,[{key:"render",value:function(){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-ruler-bar"}).css({position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"});var e=this.rulerTop=document.createElement("CANVAS");e.attr({class:"top-canvas"}).css({position:"absolute",top:0,"pointer-events":"auto",left:"20px",cursor:"col-resize"});var t=this.rulerLeft=document.createElement("CANVAS");t.attr({class:"left-canvas"}).css({position:"absolute",left:0,"pointer-events":"auto",top:"20px",cursor:"row-resize"});var n=this.square=document.createElement("CANVAS");n.attr({class:"square"}).css({position:"absolute",left:0,top:0,width:"20px",height:"20px","border-right":"1px solid #ccd5db","border-bottom":"1px solid #ccd5db",background:"#f6f9fa","pointer-events":"auto","z-index":1}),n.addEventListener("mousedown",(function(e){e.stopPropagation()}));var i=this.rulerLineY=document.createElement("DIV");i.attr({class:"line y"}).css({position:"absolute",top:0,width:"1px",height:"100%",background:"#53ebef"});var o=this.rulerLineX=document.createElement("DIV");o.attr({class:"line x"}).css({position:"absolute",left:0,height:"1px",width:"100%",background:"#53ebef"});var a=this.tip=document.createElement("DIV");a.attr({class:"tip"}).css({position:"absolute",width:"36px",height:"20px","line-height":"20px","text-align":"center","font-size":"12px",color:"#fff",background:"rgba(0, 0, 0, 0.7)","border-radius":"3px"}),this.$el.appendChild(o),this.$el.appendChild(i),this.$el.appendChild(a),this.$el.appendChild(n),this.$el.appendChild(e),this.$el.appendChild(t),this.renderRulerTop(),this.bindRulerTopEvent(),this.renderRulerLeft(),this.bindRulerLeftEvent()}},{key:"setPointerEvents",value:function(e){this.rulerTop.css({"pointer-events":e}),this.rulerLeft.css({"pointer-events":e})}},{key:"updateTipCss",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.tip.css(e),this.tip.innerHTML=t}},{key:"updateRulerLineYCss",value:function(e){this.rulerLineY.css(e)}},{key:"updateRulerLineXCss",value:function(e){this.rulerLineX.css(e)}},{key:"bindRulerLeftEvent",value:function(){var e=this;this.rulerLeft.addEventListener("mousedown",(function(t){t.stopPropagation(),document.body.css({cursor:"row-resize"}),e.isDraggingRuler=!0,e.rulerTop.css({zIndex:1,pointerEvents:"none"})})),this.rulerLeft.addEventListener("mouseover",(function(t){var n=Vue.editor.$el.getBoundingClientRect(),i=Vue.drawingBoard.$el.getBoundingClientRect();e.updateRulerLineXCss({display:"block"});var o=function(t){e.updateRulerLineXCss({top:"".concat(t.clientY-n.top,"px")}),e.updateTipCss({display:"block",top:e.rulerLineX.offsetTop+10+"px",left:"30px"},Math.round((t.clientY-i.top)/Vue.drawingBoard.scale))},a=function t(){e.isDraggingRuler||(e.updateRulerLineXCss({display:"none"}),e.updateTipCss({display:"none"}),document.removeEventListener("mouseup",s),document.removeEventListener("mousemove",o),e.rulerLeft.removeEventListener("mouseleave",t))},s=function(t){e.addXLine(t),e.isDraggingRuler=!1,document.body.css({cursor:""}),e.rulerTop.css({zIndex:"",pointerEvents:"auto"}),t.target!==e.rulerLeft&&a()};document.addEventListener("mouseup",s),document.addEventListener("mousemove",o),e.rulerLeft.addEventListener("mouseleave",a)}))}},{key:"bindRulerTopEvent",value:function(){var e=this;this.rulerTop.addEventListener("mousedown",(function(t){t.stopPropagation(),e.isDraggingRuler=!0,document.body.css({cursor:"col-resize"}),e.rulerLeft.css({zIndex:1,pointerEvents:"none"})})),this.rulerTop.addEventListener("mouseover",(function(t){var n=Vue.editor.$el.getBoundingClientRect(),i=Vue.drawingBoard.$el.getBoundingClientRect();e.updateRulerLineYCss({display:"block"});var o=function(t){e.updateRulerLineYCss({left:"".concat(t.clientX-n.left,"px")}),e.updateTipCss({display:"block",left:e.rulerLineY.offsetLeft+10+"px",top:"30px"},Math.round((t.clientX-i.left)/Vue.drawingBoard.scale))},a=function t(){e.isDraggingRuler||(e.updateRulerLineYCss({display:"none"}),e.updateTipCss({display:"none"}),document.removeEventListener("mouseup",s),document.removeEventListener("mousemove",o),e.rulerTop.removeEventListener("mouseleave",t))},s=function(t){e.addYLine(t),e.isDraggingRuler=!1,document.body.css({cursor:""}),e.rulerLeft.css({zIndex:"",pointerEvents:"auto"}),t.target!==e.rulerTop&&a()};document.addEventListener("mouseup",s),document.addEventListener("mousemove",o),e.rulerTop.addEventListener("mouseleave",a)}))}},{key:"reDraw",value:function(){this.renderRulerTop(),this.renderRulerLeft()}},{key:"renderRulerTop",value:function(){var e=this,t=this.rulerTop;if(t){var n=Vue.editor.$el.getBoundingClientRect(),i=Vue.drawingBoard.$el.getBoundingClientRect(),o=20*devicePixelRatio,a=n.width*devicePixelRatio-o,s=(i.left-n.left)*devicePixelRatio-o,r=this.initCtx(t,a,o);r.moveTo(0,o-devicePixelRatio+1-this.px1()),r.lineTo(a,o-devicePixelRatio+1-this.px1());for(var l=function(t){var n=Math.round(s+t*e.unitScale());t%10==0?(r.moveTo(n-e.px1(),0),r.lineTo(n-e.px1(),o),r.fillText(t*e.unit()/devicePixelRatio,n+e.fontTop(),e.fontTop(),e.fontWidth())):t%5==0?(r.moveTo(n-e.px1(),.5*o),r.lineTo(n-e.px1(),o)):(r.moveTo(n-e.px1(),.75*o),r.lineTo(n-e.px1(),o))},c=0;c<=(n.right-i.left)*devicePixelRatio/this.unitScale();c++)l(c);for(var d=0;d>=(n.left-i.left)*devicePixelRatio/this.unitScale();d--)l(d);r.stroke()}}},{key:"renderRulerLeft",value:function(){var e=this,t=this.rulerLeft;if(t){var n=Vue.editor.$el.getBoundingClientRect(),i=Vue.drawingBoard.$el.getBoundingClientRect(),o=20*devicePixelRatio,a=n.height*devicePixelRatio-o,s=(i.top-n.top)*devicePixelRatio-o,r=this.initCtx(t,o,a);r.moveTo(o-devicePixelRatio+1-this.px1(),0),r.lineTo(o-devicePixelRatio+1-this.px1(),a);for(var l=function(t){var n=Math.round(s+t*e.unitScale());t%10==0?(r.moveTo(0,n-e.px1()),r.lineTo(o,n-e.px1()),r.save(),r.translate(e.fontTop()-4,n-4+e.fontTop()),r.rotate(Math.PI/180*270),r.translate(-(e.fontTop()-4),-(n-4+e.fontTop())),r.fillText(t*e.unit()/devicePixelRatio,e.fontTop(),n+e.fontTop(),e.fontWidth()),r.restore()):t%5==0?(r.moveTo(.5*o,n-e.px1()),r.lineTo(o,n-e.px1())):(r.moveTo(.75*o,n-e.px1()),r.lineTo(o,n-e.px1()))},c=0;c<=(n.bottom-i.top)*devicePixelRatio/this.unitScale();c++)l(c);for(var d=0;d>=(n.top-i.top)*devicePixelRatio/this.unitScale();d--)l(d);r.stroke()}}},{key:"addYLine",value:function(e){var t=Vue.editor.$el.getBoundingClientRect(),n=Vue.drawingBoard.$el.getBoundingClientRect(),i=e.clientX-n.left;e.clientX>t.left+this.rulerWidth()&&e.clientX<t.right&&Vue.rulerLine.addYLine({yLine:{id:"rule_line_"+Date.now(),left:i/Vue.drawingBoard.scale}})}},{key:"addXLine",value:function(e){var t=Vue.editor.$el.getBoundingClientRect(),n=Vue.drawingBoard.$el.getBoundingClientRect(),i=e.clientY-n.top;e.clientY>t.top+this.rulerWidth()&&e.clientY<t.bottom&&Vue.rulerLine.addXLine({xLine:{id:"rule_line_"+Date.now(),top:i/Vue.drawingBoard.scale}})}},{key:"initCtx",value:function(e,t,n){var i=e.getContext("2d");return e.width=t,e.height=n,Object.assign(e.style,{width:t/devicePixelRatio+"px",height:n/devicePixelRatio+"px"}),i.fillStyle="#F6F9FA",i.fillRect(0,0,t,n),i.font="".concat(this.fontSize(),"px sans-serif"),i.textBaseline="top",i.lineWidth=this.lineWidth(),i.fillStyle="#A3AFB7",i.strokeStyle="#CCD5DB",i}},{key:"getEqxPageBoundingClientRect",value:function(){return Vue.drawingBoard.$el.getBoundingClientRect()}},{key:"px1",value:function(){return 1===devicePixelRatio?.5:0}},{key:"unit",value:function(){var e=Vue.drawingBoard.scale;return 10*(e<.25?8:e<.5?4:e<.75?2:e<1?1:e<2?.5:.25)*devicePixelRatio}},{key:"unitScale",value:function(){return this.unit()*Vue.drawingBoard.scale}},{key:"fontTop",value:function(){return 2*devicePixelRatio}},{key:"fontWidth",value:function(){return 50*devicePixelRatio}},{key:"fontSize",value:function(){return 12*devicePixelRatio}},{key:"lineWidth",value:function(){return 1*devicePixelRatio}},{key:"rulerWidth",value:function(){return 20}}]),e}();const Vo={computed:{ratioPage:function(){return this.maxSizeCover/Math.max(this.drawingBoard.size.width,this.drawingBoard.size.height)},eagleEye:function(){return Vue.store.state.scene.editorConfig.eagleEye}}};var Fo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.eagleEye?n("div",{staticClass:"eqx-overview-map",class:{active:e.showPreview}},[n("div",{ref:"cover",staticClass:"cover",style:{width:e.drawingBoard.size.width*e.ratioPage+"px",height:e.drawingBoard.size.height*e.ratioPage+"px"}}),e._v(" "),n("div",{staticClass:"container"},[n("div",{ref:"box",staticClass:"box",on:{mousedown:e.drag}})])]):e._e()};Fo._withStripped=!0;const To=A({render:Fo,staticRenderFns:[]},void 0,Vo,void 0,!1,void 0,!1,void 0,void 0,void 0);var zo=function(e){s(i,e);var t=u(i);function i(e){var o;n(this,i),o=t.call(this);var a=Vue.extend(To);return o.$vm=new a({data:function(){return{maxSizeCover:150,maxSizeMask:190,showPreview:!1,drawingBoard:Vue.drawingBoard,firstScale:Vue.drawingBoard.scale}},watch:{"drawingBoard.scale":function(){this.setBoxRect()},"drawingBoard.dataJson.offsetX":function(){this.setBoxRect()},"drawingBoard.dataJson.offsetY":function(){this.setBoxRect()}},methods:{setBoxRect:function(){var e=this.drawingBoard.scale,t=this.drawingBoard.dataJson,n=t.offsetX,i=t.offsetY,o=this.drawingBoard.size,a=o.width,s=o.height;if(this.$refs.box.css({width:a*this.ratioPage/e+"px",height:s*this.ratioPage/e+"px",transform:"translate(".concat(-n*this.ratioPage/e,"px, ").concat(-i*this.ratioPage/e,"px)")}),e<=this.firstScale)this.showPreview=!1,this.drawingBoard.setMove(0,0),this.$refs.box.css({transform:""});else{var r=parseFloat(Vue.drawingBoard.$el.style.width),l=parseFloat(Vue.drawingBoard.$el.style.height);this.showPreview=a<r||l<s}},drag:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.drawingBoard.scale,i=this.drawingBoard.dataJson,o=i.offsetX,a=i.offsetY,s=this.drawingBoard.size,r=s.width,l=s.height,c=e.pageX,d=e.pageY,u=300*l/600,h=300*r/600;this.$refs.box.css({cursor:"-webkit-grabbing"});var p=function(e){var i=o-(e.pageX-c)*n/t.ratioPage,s=a-(e.pageY-d)*n/t.ratioPage;s>u*n&&(s=u*n),s<-u*n&&(s=-u*n),i>h*n&&(i=h*n),i<-h*n&&(i=-h*n),t.drawingBoard.setMove(i,s)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",(function e(n){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",e),t.$refs.box.css({cursor:""})}))}}}).$mount(),o.$el=o.$vm.$el,o}return i}(io);const Ho={computed:{isMac:function(){return x.isMac},disableBack:function(){return Vue.store.state.scene.disableBack},disableForward:function(){return Vue.store.state.scene.disableForward},editorConfig:function(){return Vue.store.state.scene.editorConfig},scaleConfig:function(){return Vue.store.state.scene.scale}}};var Do=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.editorConfig.toolBar?n("div",{staticClass:"eqx-tool-bar",on:{mousedown:function(e){e.stopPropagation()}}},[n("div",{staticClass:"info"},[e.showSceneLabel?e._e():n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.dataJson.drawingBoardWidth,expression:"dataJson.drawingBoardWidth",modifiers:{number:!0}}],staticClass:"size",attrs:{readonly:"readonly",type:"number"},domProps:{value:e.dataJson.drawingBoardWidth},on:{input:function(t){t.target.composing||e.$set(e.dataJson,"drawingBoardWidth",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),e.showSceneLabel?e._e():n("i",{staticClass:"link eqf-no"}),e._v(" "),e.showSceneLabel?e._e():n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.dataJson.drawingBoardHeight,expression:"dataJson.drawingBoardHeight",modifiers:{number:!0}}],staticClass:"size",attrs:{readonly:"readonly",type:"number"},domProps:{value:e.dataJson.drawingBoardHeight},on:{input:function(t){t.target.composing||e.$set(e.dataJson,"drawingBoardHeight",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),e.showSceneLabel?e._e():n("span",{staticClass:"unit"},[e._v("像素")])]),e._v(" "),n("div",{staticClass:"title"},[e._v("\n        "+e._s(e.editorConfig.name)+"\n    ")]),e._v(" "),n("div",{staticClass:"scale"},[n("span",{staticClass:"item hint--top hint--rounded",class:{disable:e.disableBack},attrs:{"data-hint":e.isMac?"撤销 ⌘Z":"撤销 Ctrl Z"},on:{click:e.back}},[n("i",{staticClass:"icon eqf-back"})]),e._v(" "),n("span",{staticClass:"item hint--top hint--rounded",class:{disable:e.disableForward},attrs:{"data-hint":e.isMac?"恢复 ⌘Y":"恢复 Ctrl Y"},on:{click:e.forward}},[n("i",{staticClass:"icon eqf-rework"})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":e.isMac?"缩小 ⌘-":"缩小 Ctrl -"}},[n("span",{staticClass:"icon eqf-zoom-in plus",on:{click:function(t){return e.setScale("-")}}})]),e._v(" "),n("span",{staticClass:"icon num"},[e._v(e._s(e.dataJson.scale))]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":e.isMac?"放大 ⌘+":"放大 Ctrl +"}},[n("span",{staticClass:"icon eqf-zoom-out plus",on:{click:function(t){return e.setScale("+")}}})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":"适合画布"}},[n("span",{staticClass:"icon eqf-bigger fit",on:{click:function(t){return e.setScale("auto")}}})]),e._v(" "),n("span",{staticClass:"hint--top hint--rounded",attrs:{"data-hint":"真实尺寸"}},[n("span",{staticClass:"icon real border",on:{click:function(t){return e.setScale("1")}}},[e._v("1:1\n            ")])])])]):e._e()};Do._withStripped=!0;const Ao=A({render:Do,staticRenderFns:[]},void 0,Ho,void 0,!1,void 0,!1,void 0,void 0,void 0);var Oo=function(e){s(i,e);var t=u(i);function i(e){var o;n(this,i),o=t.call(this,e);var a=Vue.extend(Ao),s=c(o);return o.$vm=new a({data:{dataJson:{drawingBoardWidth:Vue.drawingBoard.size.width,drawingBoardHeight:Vue.drawingBoard.size.height,scale:"".concat(parseFloat(100*Vue.drawingBoard.scale).toFixed(0),"%"),title:e.name}},methods:{setScale:function(e){s.setDrawingBoardScale(e)},back:function(){!this.disableBack&&Vue.store.commit("HISTORY_BACK")},forward:function(){!this.disableForward&&Vue.store.commit("HISTORY_FORWORD")}},watch:{scaleConfig:{handler:function(){s.setDrawingBoardScale(this.scaleConfig.code)},deep:!0}}}).$mount(),o.$el=o.$vm.$el,o}return o(i,[{key:"setDrawingBoardScale",value:function(e){var t=this;Ft.call(Vue.editor,event,Vue.editor.$el).then((function(n){var i=p(n,5),o=i[0],a=i[1],s=i[2],r=i[3],l=i[4];Vt.call(Vue.editor,o,a,s,r,l).then((function(n){Vue.drawingBoard.setScale(e).then((function(e){Vue.rulerBar.reDraw(),Vue.rulerLine.reDraw(),t.$vm.$data.dataJson.scale="".concat((100*e).toFixed(0),"%")}))}))}))}}]),i}(io);const Po={props:{model:{type:Object,default:null},modelKey:{type:String,default:null}},data:function(){return{selected:[],showPanel:!1}},computed:{showRadius:function(){var e=this.selected.includes("lt")?"8px":"0px",t=this.selected.includes("rt")?"8px":"0px",n=this.selected.includes("lb")?"8px":"0px",i=this.selected.includes("rb")?"8px":"0px";return"".concat(e," ").concat(t," ").concat(i," ").concat(n)}},watch:{model:function(e){if(e.lt)-1===this.selected.indexOf("lt")&&this.selected.push("lt");else{var t=this.selected.indexOf("lt");t>-1&&this.selected.splice(t,1)}if(e.rt)-1===this.selected.indexOf("rt")&&this.selected.push("rt");else{var n=this.selected.indexOf("rt");n>-1&&this.selected.splice(n,1)}if(e.lb)-1===this.selected.indexOf("lb")&&this.selected.push("lb");else{var i=this.selected.indexOf("lb");i>-1&&this.selected.splice(i,1)}if(e.rb)-1===this.selected.indexOf("rb")&&this.selected.push("rb");else{var o=this.selected.indexOf("rb");o>-1&&this.selected.splice(o,1)}}},mounted:function(){this.model.lt&&this.selected.push("lt"),this.model.rt&&this.selected.push("rt"),this.model.lb&&this.selected.push("lb"),this.model.rb&&this.selected.push("rb")},methods:{setRadius:function(e,t){t.stopPropagation();var n=this.selected.indexOf(e);-1===n?(this.selected.push(e),this.model[e]=!0):(this.selected.splice(n,1),this.model[e]=!1)},showSelectPanel:function(e){e.stopPropagation(),this.showPanel=!this.showPanel},hideSelectPanel:function(){this.showPanel=!1}}};var Mo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-border-radius"},[n("base-input",{attrs:{model:e.model,min:0,max:500,"model-key":e.modelKey}}),e._v(" "),n("div",{staticClass:"current",on:{click:function(t){return e.showSelectPanel(t)}}},[n("div",{staticClass:"current-icon",style:{borderRadius:e.showRadius.replace(/8/g,"6")}}),e._v(" "),n("i",{staticClass:"icon eqf-menu-down",class:{roate:e.showPanel}})]),e._v(" "),e.showPanel?n("div",{staticClass:"select-panel"},[n("div",{staticClass:"inner",style:{borderRadius:e.showRadius}}),e._v(" "),n("div",{staticClass:"left-top",class:{selected:e.selected.includes("lt")},on:{click:function(t){return e.setRadius("lt",t)}}}),e._v(" "),n("div",{staticClass:"right-top",class:{selected:e.selected.includes("rt")},on:{click:function(t){return e.setRadius("rt",t)}}}),e._v(" "),n("div",{staticClass:"left-bottom",class:{selected:e.selected.includes("lb")},on:{click:function(t){return e.setRadius("lb",t)}}}),e._v(" "),n("div",{staticClass:"right-bottom",class:{selected:e.selected.includes("rb")},on:{click:function(t){return e.setRadius("rb",t)}}})]):e._e()],1)};Mo._withStripped=!0;const Jo=A({render:Mo,staticRenderFns:[]},void 0,Po,void 0,!1,void 0,!1,void 0,void 0,void 0);const Io={components:{SettingBorderRadius:Jo},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:255}},computed:{imageOpenHeight:function(){return 255},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.imageOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.imageOpenHeight?this.normalCloseHeight:this.imageOpenHeight,this.$emit("heightChange",this.height)},rotateComp:function(e){var t=this.property;"x"===e?t.rotateY=180===t.rotateY?0:180:"y"===e&&(t.rotateX=180===t.rotateX?0:180)}}};var No=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-image",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("图片")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail",on:{click:function(t){e.$refs.imgRadiusPanel&&e.$refs.imgRadiusPanel.hideSelectPanel()}}},[n("div",{staticClass:"name"},[e._v("\n            圆角\n        ")]),e._v(" "),e.property&&e.property.borderRadius?n("setting-border-radius",{ref:"imgRadiusPanel",attrs:{model:e.property.borderRadius,"model-key":"val"}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            翻转\n        ")]),e._v(" "),n("ul",{staticClass:"rotate"},[n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("x")}}},[n("i",{staticClass:"eqf-flipshuiping"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("水平")])]),e._v(" "),n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("y")}}},[n("i",{staticClass:"eqf-flipchuizhi"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("垂直")])])])],1)])};No._withStripped=!0;const Go=A({render:No,staticRenderFns:[]},void 0,Io,void 0,!1,void 0,!1,void 0,void 0,void 0);const qo={props:{model:{type:Object,default:null},modelKey:{type:String,default:null}},data:function(){return{updownState:!1}},computed:{value:function(){return this.model[this.modelKey]},eqxElementsSelected:function(){return Vue.store.state.scene.eqxElementsSelected[0]}},mounted:function(){this.updownState=this.model.writingMode&&"vertical-lr"===this.model.writingMode},methods:{setAlign:function(e){this.model[this.modelKey]=e,Vue.operatRecord.addRecord()},changeDirection:function(){this.eqxElementsSelected&&[$t.text,$t.date].includes(this.eqxElementsSelected.elementJson.type)&&(this.model.writingMode&&"vertical-lr"===this.model.writingMode?(this.model.writingMode="lr",this.updownState=!1,this.eqxElementsSelected.elementResizeType=Ot.text):(this.model.writingMode="vertical-lr",this.updownState=!0,this.eqxElementsSelected.elementResizeType=Ot.reverseText),Vue.operatRecord.addRecord())}}};var Yo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"eqc-setting-text-align"},[n("li",{staticClass:"icon fl eqf-align-left",class:{active:"left"===e.value,rotateLeft:e.updownState},on:{click:function(t){return e.setAlign("left")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-center",class:{active:"center"===e.value,rotateCenter:e.updownState},on:{click:function(t){return e.setAlign("center")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-right",class:{active:"right"===e.value,rotateRight:e.updownState},on:{click:function(t){return e.setAlign("right")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-align-justify",class:{active:"justify"===e.value,rotateJustify:e.updownState},on:{click:function(t){return e.setAlign("justify")}}}),e._v(" "),n("li",{staticClass:" hint--top hint--rounded icon",attrs:{"data-hint":"文字方向"},on:{click:e.changeDirection}},[n("i",{staticClass:"icon fl eqf-fontway",class:{active:e.updownState}})])])};Yo._withStripped=!0;const jo=A({render:Yo,staticRenderFns:[]},void 0,qo,void 0,!1,void 0,!1,void 0,void 0,void 0);const Wo={props:{model:{type:Object,default:null},textType:{type:Number,default:0}},data:function(){return{isUnderline:!1,isLineThrough:!1}},watch:{model:{handler:function(){this.isUnderline="underline"===this.model.textDecoration,this.isLineThrough="line-through"===this.model.textDecoration},deep:!0}},methods:{setFontWeight:function(){this.model.fontWeight=this.model.fontWeight?"":"bold",Vue.operatRecord.addRecord()},setFontStyle:function(){this.model.fontStyle=this.model.fontStyle?"":"italic",Vue.operatRecord.addRecord()},setTextDecoration:function(e){"underline"===e?(this.isLineThrough=!1,this.isUnderline=!this.isUnderline,this.model.textDecoration=this.isUnderline?"underline":""):"line-through"===e&&(this.isUnderline=!1,this.isLineThrough=!this.isLineThrough,this.model.textDecoration=this.isLineThrough?"line-through":""),Vue.operatRecord.addRecord()}}};var Uo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"eqc-setting-text-style"},[n("li",{staticClass:"icon fl eqf-b",class:{active:"bold"===e.model.fontWeight},on:{click:function(t){return e.setFontWeight()}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-i",class:{active:"italic"===e.model.fontStyle},on:{click:function(t){return e.setFontStyle()}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-u",class:{active:e.isUnderline},on:{click:function(t){return e.setTextDecoration("underline")}}}),e._v(" "),n("li",{staticClass:"icon fl eqf-s",class:{active:e.isLineThrough},on:{click:function(t){return e.setTextDecoration("line-through")}}})])};Uo._withStripped=!0;const Xo=A({render:Uo,staticRenderFns:[]},void 0,Wo,void 0,!1,void 0,!1,void 0,void 0,void 0);const Ko={components:{},props:{model:{type:Object,default:null},modelKey:{type:String,default:null},eqxElement:{type:Object,default:null},showBorder:{type:Boolean,default:!1}},data:function(){return{colors:[{0:"#626262",1:"#000000"},{0:"#FFFFFF",1:"#D9D9D9"},{0:"#FFA449",1:"#FFE623"},{0:"#D8FF00",1:"#5FE793"},{0:"#73E1FF",1:"#1BC7B1"},{0:"#FF3A19",1:"#F47365"},{0:"#FF7896",1:"#FFB243"},{0:"#5D61FF",1:"#FF15F5"},{0:"#FF104F",1:"#FC3CAD"},{0:"#753A16",1:"#5B3D13"},{0:"#1593FF",1:"#5D61FF"},{0:"#ABABF3",1:"#729FE4"},{0:"#FBC1FF",1:"#8D91FF"},{0:"#7762FF",1:"#4B4FFF"},{0:"#B4EC51",1:"#429321"}],backgroundImage:"",selected:[]}},computed:{},watch:{model:{handler:function(e){var t=this.eqxElement.elementJson.property.gradient;t&&(this.backgroundImage="linear-gradient(90deg, ".concat(t.colors[0]," 0%, ").concat(t.colors[1]," 100%)"))},deep:!0}},mounted:function(){var e=this.eqxElement.elementJson.property.gradient;e&&(this.backgroundImage="linear-gradient(90deg, ".concat(e.colors[0]," 0%, ").concat(e.colors[1]," 100%)"))},methods:{selsectColor:function(e){this.backgroundImage="linear-gradient(90deg, ".concat(e[0]," 0%, ").concat(e[1]," 100%)"),this.model[this.modelKey]&&(this.model[this.modelKey].colors=e,this.model[this.modelKey].angle=90,this.model[this.modelKey].enabled=!0)},switchColorDirection:function(){var e=this.eqxElement.elementJson.property.gradient,t=e.angle;(t+=90)>=360&&(t-=360),this.eqxElement.updateProperty({gradient:{enabled:!0,angle:t,colors:e.colors}}),Vue.operatRecord.addRecord()}}};var Zo=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-gradient-color"},[n("div",{staticClass:"current"},[n("div",{staticClass:"color",class:{border:e.showBorder},style:{backgroundImage:e.backgroundImage}}),e._v(" "),n("div",{staticClass:"box"},[n("div",{staticClass:"left"},[n("div",{staticClass:"arrow"}),e._v(" "),n("setting-color",{staticClass:"color-hover",attrs:{model:e.model,"model-key":e.modelKey,"model-key-type":"0"}})],1),e._v(" "),n("div",{staticClass:"dir-btn"},[n("i",{staticClass:"change eqf-refresh-cw",on:{click:e.switchColorDirection}})]),e._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"arrow"}),e._v(" "),n("setting-color",{staticClass:"color-hover",attrs:{model:e.model,"model-key":e.modelKey,"model-key-type":"1"}})],1)])]),e._v(" "),n("div",{staticClass:"contentColor"},e._l(e.colors,(function(t,i){return n("p",{key:i,staticClass:"colors",style:{background:"linear-gradient(90deg, "+t[0]+" 0%, "+t[1]+" 100%)"},on:{click:function(n){return e.selsectColor(t)}}})})),0)])};Zo._withStripped=!0;const Qo=A({render:Zo,staticRenderFns:[]},void 0,Ko,void 0,!1,void 0,!1,void 0,void 0,void 0);const ea={components:{SettingTextAlign:jo,SettingTextStyle:Xo,SettingBorderRadius:Jo,SettingGradient:Qo},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:0,textType:jt}},computed:{scene:function(){return Vue.store.state.scene},eqxElementsSelected:function(){return this.scene.eqxElementsSelected},eqxElement:function(){return this.eqxElementsSelected[0]},textOpenHeight:function(){return this.property.type===jt.gradient?720:this.property.type===jt.shake?735:538},normalCloseHeight:function(){return 40},font:function(){return Vue.store.state.font}},mounted:function(){this.isOpen?this.height=this.textOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.textOpenHeight?this.normalCloseHeight:this.textOpenHeight,this.$emit("heightChange",this.height)},chooseFont:function(){Vue.store.commit("FONT_LAYER",{show:!this.font.layer.show})}}};var ta=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-text",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("文字")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail",on:{click:function(t){e.$refs.textRadiusPanel&&e.$refs.textRadiusPanel.hideSelectPanel()}}},[n("div",{staticClass:"name"},[e._v("\n            字体\n        ")]),e._v(" "),n("div",{staticClass:"font-style-btn",on:{click:function(t){return e.chooseFont()}}},[n("span",[e._v(e._s(e.property.fontFamilyName?e.property.fontFamilyName:"默认字体"))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-right"})]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            文字颜色字号\n        ")]),e._v(" "),e.property.type!==e.textType.gradient?n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("setting-color",{attrs:{model:e.css,"model-key":"color"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"fontSize"}})],1)]):e._e(),e._v(" "),e.property.type===e.textType.gradient?n("setting-gradient",{attrs:{model:e.property,"eqx-element":e.eqxElement,"model-key":"gradient"}}):e._e(),e._v(" "),e.property.type===e.textType.gradient?n("base-input",{staticStyle:{marginTop:"12px"},attrs:{model:e.css,min:0,"model-key":"fontSize"}}):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颤抖颜色\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("setting-color",{attrs:{model:e.property,"model-key":"shake","model-key-type":"0"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("setting-color",{attrs:{model:e.property,"model-key":"shake","model-key-type":"1"}})],1)]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颜色角度\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("base-input",{attrs:{model:e.property,min:0,max:359,"model-key":"angle",unit:"","unit-view":"°"}}):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颜色尺寸\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("base-input",{attrs:{model:e.property,min:0,"model-key":"shake","model-key-type":"size",unit:"","unit-view":""}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            背景颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.css,"model-key":"backgroundColor"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            背景圆角\n        ")]),e._v(" "),e.property&&e.property.borderRadius?n("setting-border-radius",{ref:"textRadiusPanel",attrs:{model:e.property.borderRadius,"model-key":"val"}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            内边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"padding"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[e._m(1),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:100,max:200,"model-key":"lineHeight",unit:"","unit-view":"%"}})],1)]),e._v(" "),n("div",{staticClass:"right"},[e._m(2),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"letterSpacing"}})],1)])]),e._v(" "),n("setting-text-align",{attrs:{model:e.css,"model-key":"textAlign"}}),e._v(" "),n("setting-text-style",{attrs:{model:e.css}})],1)])};ta._withStripped=!0;const na=A({render:ta,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"content"},[t("div",{staticClass:"name left"},[this._v("\n                行间距\n            ")]),this._v(" "),t("div",{staticClass:"name right"},[this._v("\n                字间距\n            ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-linehigh"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-lineshort"})])}]},void 0,ea,void 0,!1,void 0,!1,void 0,void 0,void 0);var ia={"+dd":{format:[{name:"数字",value:"+dd"},{name:"汉字",value:"+zd"}],separator:{}},"+mm":{format:[{name:"数字",value:"+mm"},{name:"汉字",value:"+zm"},{name:"英文小写",value:"+mmmm"},{name:"英文大写",value:"+MMMM"},{name:"首字母大写",value:"+Mmmm"},{name:"英文小写简称",value:"+mmm"},{name:"英文大写简称",value:"+MMM"},{name:"首字母大写简称",value:"+Mmm"}],separator:{}},"+yyyy":{format:[{name:"数字",value:"+yyyy"},{name:"汉字",value:"+zyyy"},{name:"数字后两位",value:"+yy"}],separator:{}},"+zddd":{format:[{name:"汉字",value:"+zddd"},{name:"英文大写",value:"+DDDD"},{name:"英文小写",value:"+dddd"},{name:"首字母大写全称",value:"+Dddd"}],separator:{}},"+mm-+dd":{format:[{name:"数字",value:"+mm-+dd"},{name:"汉字",value:"+zm-+zd"}],separator:{"+mm-+dd":[{name:"'-'分割",value:"+mm-+dd"},{name:"'/'分割",value:"+mm/+dd"},{name:"'.'分割",value:"+mm.+dd"},{name:"'年'、'月'、'日'分割",value:"+mm月+dd日"}],"+zm-+zd":[{name:"'-'分割",value:"+zm-+zd"},{name:"'/'分割",value:"+zm/+zd"},{name:"'.'分割",value:"+zm.+zd"},{name:"'年'、'月'、'日'分割",value:"+zm月+zd日"}]}},"+yyyy-+mm":{format:[{name:"数字",value:"+yyyy-+mm"},{name:"汉字",value:"+zyyy-+zm"}],separator:{"+yyyy-+mm":[{name:"'-'分割",value:"+yyyy-+mm"},{name:"'/'分割",value:"+yyyy/+mm"},{name:"'.'分割",value:"+yyyy.+mm"},{name:"'年'、'月'、'日'分割",value:"+yyyy年+mm月"}],"+zyyy-+zm":[{name:"'-'分割",value:"+zyyy-+zm"},{name:"'/'分割",value:"+zyyy/+zm"},{name:"'.'分割",value:"+zyyy.+zm"},{name:"'年'、'月'、'日'分割",value:"+zyyy年+zm月"}]}},"+yyyy-+mm-+dd":{format:[{name:"数字",value:"+yyyy-+mm-+dd"},{name:"汉字",value:"+zyyy-+zm-+zd"}],separator:{"+yyyy-+mm-+dd":[{name:"'-'分割",value:"+yyyy-+mm-+dd"},{name:"'/'分割",value:"+yyyy/+mm/+dd"},{name:"'.'分割",value:"+yyyy.+mm.+dd"},{name:"'年'、'月'、'日'分割",value:"+yyyy年+mm月+dd日"}],"+zyyy-+zm-+zd":[{name:"'-'分割",value:"+zyyy-+zm-+zd"},{name:"'/'分割",value:"+zyyy/+zm/+zd"},{name:"'.'分割",value:"+zyyy.+zm.+zd"},{name:"'年'、'月'、'日'分割",value:"+zyyy年+zm月+zd日"}]}},"+cy":{format:[],separator:{}},"+cm":{format:[],separator:{}},"+cd":{format:[],separator:{}},"+cy-+cm-+cd":{format:[],separator:{}},"+cy-+cm":{format:[],separator:{}},"+cm-+cd":{format:[],separator:{}}};const oa={props:{model:{type:Object,default:null},modelKey:{type:String,default:null}},data:function(){return{dateType:{list:[{name:"日",value:"+dd"},{name:"月",value:"+mm"},{name:"年",value:"+yyyy"},{name:"星期",value:"+zddd"},{name:"月-日",value:"+mm-+dd"},{name:"年-月",value:"+yyyy-+mm"},{name:"年-月-日",value:"+yyyy-+mm-+dd"},{name:"阴历年",value:"+cy"},{name:"阴历月",value:"+cm"},{name:"阴历日",value:"+cd"},{name:"阴历年-月-日",value:"+cy-+cm-+cd"},{name:"阴历年-月",value:"+cy-+cm"},{name:"阴历月-日",value:"+cm-+cd"}],selectedItem:null,show:!1},dateFormat:{list:[],selectedItem:null,show:!1},dateSeparator:{list:[],selectedItem:null,show:!1},typeVal:"",formatVal:"",separatorVal:""}},computed:{eqxElementsSelected:function(){return Vue.store.state.scene.eqxElementsSelected},eqxElement:function(){return this.eqxElementsSelected[0]}},created:function(){this.initDateList()},methods:{chooseDateType:function(e){this.dateType.selectedItem=e,this.dateType.show=!1,this.typeVal=e.value,this.changeType(),Vue.operatRecord.addRecord()},chooseDateFormat:function(e){this.dateFormat.selectedItem=e,this.dateFormat.show=!1,this.formatVal=e.value,this.changeFormat(),Vue.operatRecord.addRecord()},chooseDateSeparator:function(e){this.dateSeparator.selectedItem=e,this.dateSeparator.show=!1,this.separatorVal=e.value,this.changeSeparator(),Vue.operatRecord.addRecord()},initDateList:function(){this.getDateFormat(),this.setFormatSeparatorList(),this.initSelected()},initSelected:function(){var e=this;this.dateType.list.forEach((function(t,n){t.value===e.typeVal&&(e.dateType.selectedItem=t)})),this.dateFormat.list.forEach((function(t,n){t.value===e.formatVal&&(e.dateFormat.selectedItem=t)})),this.dateSeparator.list.forEach((function(t,n){t.value===e.separatorVal&&(e.dateSeparator.selectedItem=t)}))},updateListHeigth:function(){var e=3;0===this.dateFormat.list.length&&e--,0===this.dateSeparator.list.length&&e--,this.$emit("changeList",{count:e})},setFormatSeparatorList:function(){this.dateFormat.list=ia[this.typeVal].format||[],this.dateSeparator.list=ia[this.typeVal].separator[this.formatVal]||[],this.updateListHeigth()},getDateFormat:function(){var e=this.model[this.modelKey],t=e.replace("年","-").replace("月","-").replace("日","").replace(/\./g,"-").replace(/\//g,"-");t.endsWith("-")&&(t=t.substring(0,t.length-1));var n=t;if("+zddd"!==(t=t.toLowerCase())){t=t.split("");for(var i=0;i<t.length;i++)"z"===t[i]&&(t[i]=t[i+1]);t=t.join("")}"+yy"!==t&&"+zyyy"!==t||(t="+yyyy"),"+zm"!==t&&"+mmm"!==t&&"+mmmm"!==t||(t="+mm"),"+zd"===t&&(t="+dd"),"+dddd"===t&&(t="+zddd"),this.typeVal=t,this.formatVal=n,this.separatorVal=e},changeType:function(){var e=this;return this.dateFormat.list=ia[this.typeVal].format||[],0===this.dateFormat.list.length?(this.dateSeparator.list=[],this.model[this.modelKey]=this.typeVal,this.eqxElement.updateContent(),void this.updateListHeigth()):(this.formatVal=this.dateFormat.list[0].value,this.dateFormat.list.forEach((function(t,n){t.value===e.formatVal&&(e.dateFormat.selectedItem=t)})),this.dateSeparator.list=ia[this.typeVal].separator[this.formatVal]||[],0===this.dateSeparator.list.length?(this.model[this.modelKey]=this.formatVal,this.eqxElement.updateContent(),void this.updateListHeigth()):(this.separatorVal=this.dateSeparator.list[0].value,this.dateSeparator.list.forEach((function(t,n){t.value===e.separatorVal&&(e.dateSeparator.selectedItem=t)})),this.model[this.modelKey]=this.separatorVal,this.eqxElement.updateContent(),void this.updateListHeigth()))},changeFormat:function(){var e=this;if(this.dateSeparator.list=ia[this.typeVal].separator[this.formatVal]||[],0===this.dateSeparator.list.length)return this.model[this.modelKey]=this.formatVal,this.eqxElement.updateContent(),void this.updateListHeigth();this.separatorVal=this.dateSeparator.list[0].value,this.dateSeparator.list.forEach((function(t,n){t.value===e.separatorVal&&(e.dateSeparator.selectedItem=t)})),this.model[this.modelKey]=this.separatorVal,this.eqxElement.updateContent(),this.updateListHeigth()},changeSeparator:function(){this.model[this.modelKey]=this.separatorVal,this.eqxElement.updateContent(),this.updateListHeigth()},showDropdown:function(e){this[e].show=!0},hideDropdown:function(e){this[e].show=!1}}};var aa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-date-style"},[n("div",{staticClass:"name"},[e._v("\n        类型\n    ")]),e._v(" "),n("div",{on:{click:function(t){return e.showDropdown("dateType")},mouseleave:function(t){return e.hideDropdown("dateType")}}},[n("div",{staticClass:"current"},[n("span",[e._v(e._s(e.dateType.selectedItem&&e.dateType.selectedItem.name))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-down"})]),e._v(" "),e.dateType.show?n("base-drop-down",{attrs:{list:e.dateType.list,"selected-item":e.dateType.selectedItem,css:{width:"152px",paddingTop:"8px",fontSize:"14px",zIndex:1},"item-key":"name"},on:{choose:e.chooseDateType}}):e._e()],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dateFormat.list.length>0,expression:"dateFormat.list.length > 0"}],staticClass:"name"},[e._v("\n        形式\n    ")]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dateFormat.list.length>0,expression:"dateFormat.list.length > 0"}],on:{click:function(t){return e.showDropdown("dateFormat")},mouseleave:function(t){return e.hideDropdown("dateFormat")}}},[n("div",{staticClass:"current"},[n("span",[e._v(e._s(e.dateFormat.selectedItem&&e.dateFormat.selectedItem.name))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-down"})]),e._v(" "),e.dateFormat.show?n("base-drop-down",{attrs:{list:e.dateFormat.list,"selected-item":e.dateFormat.selectedItem,css:{width:"152px",paddingTop:"8px",fontSize:"14px",zIndex:1},"item-key":"name"},on:{choose:e.chooseDateFormat}}):e._e()],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dateSeparator.list.length>0,expression:"dateSeparator.list.length > 0"}],staticClass:"name"},[e._v("\n        格式\n    ")]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dateSeparator.list.length>0,expression:"dateSeparator.list.length > 0"}],on:{click:function(t){return e.showDropdown("dateSeparator")},mouseleave:function(t){return e.hideDropdown("dateSeparator")}}},[n("div",{staticClass:"current"},[n("span",[e._v(e._s(e.dateSeparator.selectedItem&&e.dateSeparator.selectedItem.name))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-down"})]),e._v(" "),e.dateSeparator.show?n("base-drop-down",{attrs:{list:e.dateSeparator.list,"selected-item":e.dateSeparator.selectedItem,css:{width:"152px",paddingTop:"8px",fontSize:"14px",zIndex:1},"item-key":"name"},on:{choose:e.chooseDateSeparator}}):e._e()],1)])};aa._withStripped=!0;const sa={components:{SettingTextAlign:jo,SettingTextStyle:Xo,SettingBorderRadius:Jo,SettingGradient:Qo,SettingDateStyle:A({render:aa,staticRenderFns:[]},void 0,oa,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:0,textType:jt,dateListCount:0}},computed:{scene:function(){return Vue.store.state.scene},eqxElementsSelected:function(){return this.scene.eqxElementsSelected},eqxElement:function(){return this.eqxElementsSelected[0]},dateOpenHeight:function(){var e=66*this.dateListCount;return this.property.type===jt.gradient?720+e:this.property.type===jt.shake?735+e:538+e},normalCloseHeight:function(){return 40},font:function(){return Vue.store.state.font}},mounted:function(){this.updateHeight()},methods:{updateHeight:function(){this.isOpen?this.height=this.dateOpenHeight:this.height=this.normalCloseHeight},toggleClick:function(){this.height=this.height===this.dateOpenHeight?this.normalCloseHeight:this.dateOpenHeight,this.$emit("heightChange",this.height)},chooseFont:function(){Vue.store.commit("FONT_LAYER",{show:!this.font.layer.show})},dateListChange:function(e){this.dateListCount=e.count,this.updateHeight(),this.$emit("heightChange",this.height)}}};var ra=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-date",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("日期")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail",on:{click:function(t){e.$refs.dateRadiusPanel&&e.$refs.dateRadiusPanel.hideSelectPanel()}}},[n("setting-date-style",{attrs:{model:e.property,"model-key":"content"},on:{changeList:e.dateListChange}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            字体\n        ")]),e._v(" "),n("div",{staticClass:"font-style-btn",on:{click:function(t){return e.chooseFont()}}},[n("span",[e._v(e._s(e.property.fontFamilyName?e.property.fontFamilyName:"默认字体"))]),e._v(" "),n("i",{staticClass:"icon eqf-menu-right"})]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            文字颜色字号\n        ")]),e._v(" "),e.property.type!==e.textType.gradient?n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("setting-color",{attrs:{model:e.css,"model-key":"color"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"fontSize"}})],1)]):e._e(),e._v(" "),e.property.type===e.textType.gradient?n("setting-gradient",{attrs:{model:e.property,"eqx-element":e.eqxElement,"model-key":"gradient"}}):e._e(),e._v(" "),e.property.type===e.textType.gradient?n("base-input",{staticStyle:{marginTop:"12px"},attrs:{model:e.css,min:0,"model-key":"fontSize"}}):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颤抖颜色\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("setting-color",{attrs:{model:e.property,"model-key":"shake","model-key-type":"0"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("setting-color",{attrs:{model:e.property,"model-key":"shake","model-key-type":"1"}})],1)]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颜色角度\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("base-input",{attrs:{model:e.property,min:0,max:359,"model-key":"angle",unit:"","unit-view":"°"}}):e._e(),e._v(" "),e.property.type===e.textType.shake?n("div",{staticClass:"name"},[e._v("\n            颜色尺寸\n        ")]):e._e(),e._v(" "),e.property.type===e.textType.shake?n("base-input",{attrs:{model:e.property,min:0,"model-key":"shake","model-key-type":"size",unit:"","unit-view":""}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            背景颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.css,"model-key":"backgroundColor"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            背景圆角\n        ")]),e._v(" "),e.property&&e.property.borderRadius?n("setting-border-radius",{ref:"dateRadiusPanel",attrs:{model:e.property.borderRadius,"model-key":"val"}}):e._e(),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            内边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"padding"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[e._m(1),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:100,max:200,"model-key":"lineHeight",unit:"","unit-view":"%"}})],1)]),e._v(" "),n("div",{staticClass:"right"},[e._m(2),e._v(" "),n("div",{staticClass:"input"},[n("base-input",{attrs:{model:e.css,min:0,"model-key":"letterSpacing"}})],1)])]),e._v(" "),n("setting-text-align",{attrs:{model:e.css,"model-key":"textAlign"}}),e._v(" "),n("setting-text-style",{attrs:{model:e.css}})],1)])};ra._withStripped=!0;const la=A({render:ra,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"content"},[t("div",{staticClass:"name left"},[this._v("\n                行间距\n            ")]),this._v(" "),t("div",{staticClass:"name right"},[this._v("\n                字间距\n            ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-linehigh"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"iconbox"},[t("i",{staticClass:"icon eqf-lineshort"})])}]},void 0,sa,void 0,!1,void 0,!1,void 0,void 0,void 0);const ca={props:{tab:{type:String,default:"bottom"},property:{type:Object,default:function(){return{}}}},data:function(){return{customColor:{color:""},hotColors:["#FFFFFF","#FF1900","#F47365","#FFB243","#FFE623","#6EFF2A","#5FE793","#1BC7B1","#00BEFF","#2E81FF","#8D91FF","#5D61FF","#FF89CF","#FC3CAD","#BF3DCE","#8E00A7","#66004A","#A36565","#5D1B1B"],loveColors:[],clientHeight:document.documentElement.clientHeight||document.body.clientHeight}},computed:{background:function(){return this.isBackgroundBottom?this.property.bottom:this.property.top},disableOpacity:function(){return""===this.background.color},isBackgroundBottom:function(){return"bottom"===this.tab}},watch:{"customColor.color":function(e){this.background.color=e},"background.opacity":function(e){this.background.opacity=e}},methods:{chooseColor:function(e){this.background.color=e,this.isBackgroundBottom||(this.background.opacity=.4),this.background.type=0,Vue.operatRecord.addRecord()},showColorPanel:function(e,t){document.addEventListener("mousedown",this.hideColorPanel),this.customColor.color=t;var n=this.clientHeight-338,i=e.pageY;i>=n&&(i=n),this.colorPicker.open(this.customColor,"color",{left:"356px",top:i+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(document.removeEventListener("mousedown",this.hideColorPanel),this.colorPicker.close())}}};var da=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-color-purity"},[n("div",{staticClass:"color-selected"},[n("div",{staticClass:"color-bg"},[n("div",{staticClass:"color",style:{background:e.background.color},on:{click:function(t){return e.showColorPanel(t,e.background.color)}}})]),e._v(" "),"transparent"===e.background.color?n("div",{staticClass:"value"},[e._v("\n            透明\n        ")]):e._e(),e._v(" "),"transparent"!==e.background.color?n("div",{staticClass:"value"},[e._v("\n            "+e._s(e._f("rgb2hex")(e.background.color,!0))+"\n        ")]):e._e()]),e._v(" "),e.isBackgroundBottom?e._e():n("div",{staticClass:"property"},[n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{staticClass:"input",style:{pointerEvents:e.disableOpacity?"none":"",background:e.disableOpacity?"#ECEEF0":""},attrs:{model:e.background,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}})],1),e._v(" "),n("div",{staticClass:"color-name"},[e._v("\n        推荐颜色\n    ")]),e._v(" "),n("ul",{staticClass:"color-list"},e._l(e.hotColors,(function(t,i){return n("li",{key:i,staticClass:"item",class:{clear:0===i},style:{background:0===i?"":t,border:2===i?"1px solid #ccd5db":""},on:{click:function(n){return e.chooseColor(t)}}})})),0)])};da._withStripped=!0;const ua=A({render:da,staticRenderFns:[]},void 0,ca,void 0,!1,void 0,!1,void 0,void 0,void 0);const ha={props:{tab:{type:String,default:"bottom"},property:{type:Object,default:function(){return{}}}},data:function(){return{customColor:{color:""},clientHeight:document.documentElement.clientHeight||document.body.clientHeight,colorIndex:0,hotColors:[["#FFFFFF","#D9D9D9"],["#626262","#000000"],["#FF1919","#960000"],["#FF3A19","#F47365"],["#FF7433","#FFB243"],["#FFA449","#FFF623"],["#D8FF00","#5FE793"],["#73FFB0","#00B644"],["#B4EC51","#429321"],["#00E5FF","#1593FF"],["#1593FF","#5D61FF"],["#1F66E1","#1C1FA3"],["#ABABF3","#729FE4"],["#FBC1FF","#8D91FF"],["#7762FF","#4B4FFF"],["#FF8FE6","#FF52AF"],["#A470E9","#BF3DCE"],["#FF104F","#FC3CAD"],["#7F1862","#3F0D2F"],["#C67D7D","#985353"]],loveColors:[]}},computed:{background:function(){return this.isBackgroundBottom?this.property.bottom:this.property.top},disableOpacity:function(){return this.background.colors[0]+this.background.colors[1]===""},isBackgroundBottom:function(){return"bottom"===this.tab}},watch:{"customColor.color":function(e){var t=this.background.colors.slice();t[this.colorIndex]=e,this.background.colors=t},"background.opacity":function(e){this.background.opacity=e}},methods:{setStyleBackground:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"linear-gradient(".concat(t,"deg, ").concat(e[0]||"transparent"," 0%, ").concat(e[1]||"transparent"," 100%)")},setRotate:function(){var e=this.background.rotate;(e+=90)>=360&&(e-=360),this.background.rotate=e,Vue.operatRecord.addRecord()},chooseColor:function(e){this.background.colors=e,this.isBackgroundBottom||(this.background.opacity=.4),this.background.type=1,Vue.operatRecord.addRecord()},showColorPanel:function(e,t){document.addEventListener("mousedown",this.hideColorPanel),this.customColor.color=this.background.colors[t],this.colorIndex=t;var n=this.clientHeight-338,i=e.pageY;i>=n&&(i=n),this.colorPicker.open(this.customColor,"color",{left:"356px",top:i+"px"})},hideColorPanel:function(){this.colorPicker.getState().isOpenSucker||(document.removeEventListener("mousedown",this.hideColorPanel),this.colorPicker.close())}}};var pa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-color-linear"},[n("div",{staticClass:"color-selected main"},[n("div",{staticClass:"color-bg show"},[n("div",{staticClass:"color",style:{background:e.setStyleBackground(e.background.colors,90)}})])]),e._v(" "),n("div",{staticClass:"color-selected linear"},[n("div",{staticClass:"color-box",style:{background:e.background.colors[0]},on:{click:function(t){return e.showColorPanel(t,0)}}}),e._v(" "),n("div",{staticClass:"rotate-box",on:{click:e.setRotate}},[n("i",{staticClass:"eqf-refresh-cw"})]),e._v(" "),n("div",{staticClass:"color-box",style:{background:e.background.colors[1]},on:{click:function(t){return e.showColorPanel(t,1)}}})]),e._v(" "),e.isBackgroundBottom?e._e():n("div",{staticClass:"property"},[n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{staticClass:"input",style:{pointerEvents:e.disableOpacity?"none":"",background:e.disableOpacity?"#ECEEF0":""},attrs:{model:e.background,min:0,max:100,reverse:!0,"model-key":"opacity",unit:"","unit-view":"%"}})],1),e._v(" "),n("div",{staticClass:"color-name"},[e._v("\n        推荐颜色\n    ")]),e._v(" "),n("ul",{staticClass:"color-list"},e._l(e.hotColors,(function(t,i){return n("li",{key:i,staticClass:"item",class:{clear:0===i},style:{background:0===i?"":e.setStyleBackground(t)},on:{click:function(n){return e.chooseColor(t)}}})})),0)])};pa._withStripped=!0;const ma={components:{ColorPurity:ua,ColorLinear:A({render:pa,staticRenderFns:[]},void 0,ha,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{property:{type:Object,default:function(){return{}}}},data:function(){return{colorTypeList:[{name:"纯色",type:0},{name:"渐变色",type:1}],typeSelected:null}},computed:{background:function(){return this.property.bottom},isPurity:function(){return this.typeSelected===this.colorTypeList[0]}},mounted:function(){this.typeSelected=this.colorTypeList[0]},methods:{selectColorType:function(e){this.typeSelected=e,this.background.type=e.type,Vue.operatRecord.addRecord()},backToPure:function(){this.typeSelected=this.colorTypeList[0]}}};var ga=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-background-basic"},[n("div",{staticClass:"color-type"},e._l(e.colorTypeList,(function(t,i){return n("span",{key:i,staticClass:"type-item",class:{active:e.typeSelected===t},on:{click:function(n){return e.selectColorType(t)}}},[e._v(e._s(t.name))])})),0),e._v(" "),e.isPurity?n("color-purity",{attrs:{tab:"bottom",property:e.property}}):e._e(),e._v(" "),e.isPurity?e._e():n("color-linear",{attrs:{tab:"bottom",property:e.property}})],1)};ga._withStripped=!0;const fa={components:{BackgroundBasic:A({render:ga,staticRenderFns:[]},void 0,ma,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:400,tabList:[{name:"基础",type:"basic"},{name:"高级",type:"high"}],tabSelected:null}},computed:{backgroundOpenHeight:function(){return 400},normalCloseHeight:function(){return 40}},mounted:function(){this.tabSelected=this.tabList[0],this.height=this.backgroundOpenHeight},methods:{toggleClick:function(){},selectTab:function(e){this.tabSelected=e},clearBackground:function(){this.property.clearCount=this.property.clearCount+1}}};var va=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-background",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("背景")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"nav"},[n("div",[n("span",{staticClass:"clear",on:{click:e.clearBackground}},[e._v("清空背景")])])]),e._v(" "),n("background-basic",{directives:[{name:"show",rawName:"v-show",value:e.tabSelected===e.tabList[0],expression:"tabSelected === tabList[0]"}],ref:"basic",attrs:{property:e.property}})],1)])};va._withStripped=!0;const ya=A({render:va,staticRenderFns:[]},void 0,fa,void 0,!1,void 0,!1,void 0,void 0,void 0);const xa={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:326}},computed:{noHeightModify:function(){return this.type===$t.text||this.type===$t.date},positionHeight:function(){return this.type===$t.image?392:(this.type===$t.text||(this.type,$t.date),326)},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.positionHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.normalCloseHeight?this.positionHeight:this.normalCloseHeight,this.$emit("heightChange",this.height)}}};var ba=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-position",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("位置")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            旋转角度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,max:359,"model-key":"rotate",unit:"","unit-view":"°"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            左边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,"model-key":"x"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            上边距\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,"model-key":"y"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            宽度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"width"}}),e._v(" "),e.noHeightModify?e._e():n("div",{staticClass:"name"},[e._v("\n            高度\n        ")]),e._v(" "),e.noHeightModify?e._e():n("base-input",{attrs:{model:e.css,min:0,"model-key":"height"}})],1)])};ba._withStripped=!0;const wa=A({render:ba,staticRenderFns:[]},void 0,xa,void 0,!1,void 0,!1,void 0,void 0,void 0);const _a={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{elementType:$t,height:321}},computed:{shadowOpenHeight:function(){return 321},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.shadowOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.shadowOpenHeight?this.normalCloseHeight:this.shadowOpenHeight,this.$emit("heightChange",this.height)}}};var ka=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-shadow",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("投影")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            投影颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"dropShadow","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:[e.elementType.text,e.elementType.date].includes(e.type)?-100:Number.MIN_SAFE_INTEGER,max:[e.elementType.text,e.elementType.date].includes(e.type)?100:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"x","unit-view":""}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:[e.elementType.text,e.elementType.date].includes(e.type)?-100:Number.MIN_SAFE_INTEGER,max:[e.elementType.text,e.elementType.date].includes(e.type)?100:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"y","unit-view":""}})],1)]),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            模糊\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.property,min:0,max:[e.elementType.text,e.elementType.date].includes(e.type)?10:Number.MAX_SAFE_INTEGER,"model-key":"dropShadow","model-key-type":"blur","unit-view":""}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            透明度\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.property,min:0,max:100,"model-key":"dropShadow","model-key-type":"transparency",unit:"","unit-view":"%"}})],1)])};ka._withStripped=!0;const Ea=A({render:ka,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("横向距离")]),this._v(" "),t("p",[this._v("纵向距离")])])}]},void 0,_a,void 0,!1,void 0,!1,void 0,void 0,void 0);const Sa={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:189}},computed:{strokeOpenHeight:function(){return 189},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.strokeOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.strokeOpenHeight?this.normalCloseHeight:this.strokeOpenHeight,this.$emit("heightChange",this.height)}}};var Ca=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-stroke",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("描边")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            描边颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"stroke","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:0,max:10,"model-key":"stroke","model-key-type":"size"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:0,max:10,"model-key":"stroke","model-key-type":"distance"}})],1)])],1)])};Ca._withStripped=!0;const Ba=A({render:Ca,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("描边尺寸")]),this._v(" "),t("p",[this._v("描边距离")])])}]},void 0,Sa,void 0,!1,void 0,!1,void 0,void 0,void 0);const Ra={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:189}},computed:{cubeOpenHeight:function(){return 189},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.cubeOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.cubeOpenHeight?this.normalCloseHeight:this.cubeOpenHeight,this.$emit("heightChange",this.height)}}};var La=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-cube",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("立体")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            立体颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.property,"model-key":"cube","model-key-type":"color"}}),e._v(" "),e._m(0),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"left"},[n("base-input",{attrs:{model:e.property,min:0,max:20,"model-key":"cube","model-key-type":"size"}})],1),e._v(" "),n("div",{staticClass:"right"},[n("base-input",{attrs:{model:e.property,min:0,max:359,"model-key":"angle",unit:"","unit-view":"°"}})],1)])],1)])};La._withStripped=!0;const $a=A({render:La,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"name"},[t("p",[this._v("尺寸")]),this._v(" "),t("p",[this._v("角度")])])}]},void 0,Ra,void 0,!1,void 0,!1,void 0,void 0,void 0);var Va=null,Fa=null,Ta=null;function za(e){var t=[];return function e(n){var i=getComputedStyle(n),o=i.fontFamily,a=i.backgroundImage,s=n.getAttribute("xlink:href")||n.getAttribute("src");if(o&&(Va[o]=!0),a&&-1!==a.search(/http[^"]*/)&&-1===a.search('^url\\("data:image/(png|jpeg|gif|svg+xmlsvg-xml);base64,(\\w|\\/|\\+|=)*"\\)$')){var r=a.match(/http[^"]*/)[0],l=Vue.store.state.scene.cacheImage[r];l&&null!==l&&l.length>0?Fa[r]=l:Fa[r]=null}if(s&&s.startsWith("http")){var c=s.match(/http[^"]*/)[0],d=Vue.store.state.scene.cacheImage[c];d&&null!==d&&d.length>0?Fa[c]=d:Fa[c]=null}"CANVAS"===n.tagName&&t.push(Ja(n.toDataURL()).then((function(e){e.style.cssText=n.style.cssText,n.parentElement.insertBefore(e,n),n.parentElement.removeChild(n)}))),Array.from(n.children).forEach((function(t){return e(t)}))}(e),Promise.all(t)}function Ha(){var e=[];return Array.from(document.styleSheets).forEach((function(t){"STYLE"===t.ownerNode.tagName&&e.push.apply(e,m(Array.from(t.cssRules)))})),e.forEach((function(e){if(e.type===CSSRule.FONT_FACE_RULE){var t=e.style.getPropertyValue("font-family").replace(/"/g,"");Va[t]&&e.style.getPropertyValue("src")&&(Va[t]=e.style.getPropertyValue("src").match(/http[^"]*/)[0])}})),Promise.resolve()}function Da(){var e=[];for(var t in Va)!0!==Va[t]&&function(t){e.push(Oa(Va[t]).then((function(e){return Ia(e)})).then((function(e){Va[t]=e})))}(t);return Promise.all(e)}function Aa(){var e=[];for(var t in Fa)null===Fa[t]&&function(t){e.push(Oa(t).then((function(e){return Ia(e)})).then((function(e){Vue.store.commit("CACHE_IMAGE",{key:t,value:e}),Fa[t]=e})))}(t);return Promise.all(e)}function Oa(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="blob",i.onload=function(){(i.status>=200&&i.status<300||304===i.status)&&t(i.response)},i.onerror=function(){n()},i.send()}))}function Pa(e){var t=parseFloat(e.style.width),n=parseFloat(e.style.height),i=[],o=(new XMLSerializer).serializeToString(e);for(var a in o=o.replace(/\sbackground-clip/g," -webkit-background-clip"),Fa){var s=a.replace("?","\\?");s=s.replace(new RegExp("\\|","g"),"\\|"),o=new RegExp("&quot;".concat(s,"&quot;"),"g").test(o)?o.replace(new RegExp("&quot;".concat(s,"&quot;"),"g"),"&quot;".concat(Fa[a],"&quot;")):o.replace(new RegExp('"'.concat(s,'"'),"g"),'"'.concat(Fa[a],'"'))}for(var r in Va)"string"==typeof Va[r]&&i.push("@font-face {font-family: ".concat(r,"; src: url(").concat(Va[r],");}"));return o="<style>".concat(i.join(""),"</style>").concat(o),Promise.resolve({html:o,width:t,height:n})}function Ma(e){var t=e.html,n=e.width,i=e.height,o='<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(n,'" height="').concat(i,'"><foreignObject width="100%" height="100%">').concat(t,"</foreignObject></svg>");return Ia(new Blob([o],{type:"image/svg+xml;charset=utf-8"})).then((function(e){return Ja(e)})).then((function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.height=e.height,t.width=e.width,n.drawImage(e,0,0,e.width,e.height,0,0,e.width*Ta.scale,e.height*Ta.scale),t}))}function Ja(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=function(){n()},i.src=e}))}function Ia(e){return new Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(){n()},i.readAsDataURL(e)}))}function Na(e){Vue.store.commit("OPEN_LOADING_CHANGE",!0),e=Object.assign({mutil:1},e);var t=document.createElement("div"),n=document.createElement("div");n.attr({id:"tmp-h2-open-wrapper"}),t.css({width:Vue.drawingBoard.size.width*e.mutil+"px",height:Vue.drawingBoard.size.height*e.mutil+"px",opacity:0,zIndex:-1e3}),n.css({position:"absolute",top:0,left:0,width:Vue.drawingBoard.size.width*e.mutil+"px",height:Vue.drawingBoard.size.height*e.mutil+"px"}),t.appendChild(n),document.body.appendChild(t);var i=new Ro({isRender:!0,scale:"auto",size:{width:Vue.drawingBoard.size.width*e.mutil,height:Vue.drawingBoard.size.height*e.mutil},editorSize:{width:Vue.drawingBoard.size.width*e.mutil,height:Vue.drawingBoard.size.height*e.mutil}});return n.appendChild(i.$el),Vue.elements.elementList.map((function(t){var n=JSON.parse(JSON.stringify(t.elementJson));n.type===$t.text&&(n.svgData.list=null),function(e,t){if(1!==t){var n=e.property,i=["width","height","top","left","bottom","right","fontSize","letterSpacing","borderWidth","padding","x","y"];for(var o in e.css)i.includes(o)&&(e.css[o]=parseFloat(e.css[o])*t);for(var a in e.property)switch(a){case"dropShadow":var s=n.dropShadow;s.x=s.x*t,s.y=s.y*t,s.blur=s.blur*t;break;case"shadow":var r=n.shadow;r.h=r.h*t,r.v=r.v*t,r.blur=r.blur*t;break;case"cube":var l=n.cube;l[0].size=l[0].size*t;break;case"stroke":var c=n.stroke;c.size=c.size*t,c.distance=c.distance*t;break;case"shake":var d=n.shake;d.size=d.size*t;break;case"borderRadius":var u=n.borderRadius;u.val="".concat(parseInt(u.val)*t,"px")}}}(n,e.mutil);var o=new Ai[t.elementJson.type](n,i);i.addElement(o,!0)})),i.setBackground(Vue.drawingBoard.background.property),new Promise((function(o,a){var s;(s=i.elements,new Promise((function(e,t){var n;s.elementList.length>0?n=setInterval((function(){s.elementList.every((function(e){return e.isPrepare}))&&(clearInterval(n),n=null,e())}),100):e()}))).then((function(){i.$el.css({background:"jpeg"===e.fileType?"#fff":"transparent"}),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Va={},Fa={},Ta=Object.assign({backgroundColor:"",scale:1},t),e.style.backgroundColor=Ta.backgroundColor,za(e).then((function(){return Ha()})).then((function(){return Promise.all([Da(),Aa()])})).then((function(){return Pa(e)})).then((function(e){return Ma(e)}))}(n).then((function(e){t.remove(),i=null,e.css({width:"",height:""}),Vue.store.commit("OPEN_LOADING_CHANGE",!1),o(e)})).catch((function(e){return a(e)}))}))}))}var Ga={page2Canvas:Na,downloadFile:function(e){Na(e).then((function(t){var n=document.createElement("a"),i="png";["png","jpeg"].includes(e.fileType)&&(i=e.fileType),n.href=t.toDataURL("image/".concat(i),1),e&&e.fileName?n.download=e.fileName+"."+i:n.download="轻设计编辑器开放平台"+(new Date).getTime()+"."+i;var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(o)}))}};const qa={data:function(){return{btnHover:!1,width:Vue.drawingBoard.size.width,height:Vue.drawingBoard.size.height,sizeList:[{name:"原尺寸",value:1},{name:"2倍图",value:2},{name:"3倍图",value:3},{name:"4倍图",value:4}]}},methods:{download:function(){Ga.downloadFile({mutil:1})},chooseSize:function(e){Ga.downloadFile({mutil:e})}}};var Ya=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"download-setting"},[n("div",{staticClass:"btn",on:{mouseleave:function(t){e.btnHover=!1},mouseover:function(t){e.btnHover=!0}}},[n("span",{on:{click:e.download}},[e._v("下载当前图片")])]),e._v(" "),n("div",{staticClass:"size-panel",style:{height:e.btnHover?"148px":0},on:{mouseleave:function(t){e.btnHover=!1},mouseover:function(t){e.btnHover=!0}}},e._l(e.sizeList,(function(t,i){return n("span",{key:i,staticClass:"item",on:{click:function(n){return e.chooseSize(t.value)}}},[e._v(e._s(t.name+" : "+e.width*t.value+" * "+e.height*t.value+"px"))])})),0)])};Ya._withStripped=!0;const ja=A({render:Ya,staticRenderFns:[]},void 0,qa,void 0,!1,void 0,!1,void 0,void 0,void 0);const Wa={props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:326}},computed:{isText:function(){return this.type===$t.text},borderHeight:function(){return 189},normalCloseHeight:function(){return 40}},mounted:function(){this.isOpen?this.height=this.borderHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.normalCloseHeight?this.borderHeight:this.normalCloseHeight,this.$emit("heightChange",this.height)}}};var Ua=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-position",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.toggleClick}},[n("span",[e._v("边框")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-right":e.height===e.normalCloseHeight,"eqf-down":e.height!==e.normalCloseHeight}})]),e._v(" "),n("div",{staticClass:"detail"},[n("div",{staticClass:"name"},[e._v("\n            大小\n        ")]),e._v(" "),n("base-input",{attrs:{model:e.css,min:0,"model-key":"borderWidth"}}),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            颜色\n        ")]),e._v(" "),n("setting-color",{attrs:{model:e.css,"model-key":"borderColor"}})],1)])};Ua._withStripped=!0;const Xa=A({render:Ua,staticRenderFns:[]},void 0,Wa,void 0,!1,void 0,!1,void 0,void 0,void 0);const Ka={components:{SettingBorderRadius:Jo},props:{type:{type:Number,default:0},property:{type:Object,default:function(){return{}}},css:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{height:255}},computed:{shapeItems:function(){return this.property.items},shapeOpenHeight:function(){var e=this.shapeItems.length>0?199:149,t=66*this.shapeItems.length;return this.heightClose+e+(this.isPrueColorShow?t:169)},normalCloseHeight:function(){return 40}},watch:{shapeItems:{handler:function(e){this.shapeHeight=this.heightShapeOpen,this.$emit("heightChange",this.height)},deep:!0,immediate:!0}},mounted:function(){this.isOpen?this.height=this.shapeOpenHeight:this.height=this.normalCloseHeight},methods:{toggleClick:function(){this.height=this.height===this.shapeOpenHeight?this.normalCloseHeight:this.shapeOpenHeight,this.$emit("heightChange",this.height)},rotateComp:function(e){var t=this.property;"x"===e?t.rotateY=180===t.rotateY?0:180:"y"===e&&(t.rotateX=180===t.rotateX?0:180)}}};var Za=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eqc-setting-shape",style:{height:e.height+"px"}},[n("div",{staticClass:"title",on:{click:e.openShape}},[n("span",[e._v("形状")]),e._v(" "),n("i",{staticClass:"arrow",class:{"eqf-down":e.shapeHeight!==e.heightShapeClose,"eqf-right":e.shapeHeight===e.heightShapeClose}})]),e._v(" "),n("div",{staticClass:"detail",on:{click:function(t){e.$refs.shapeRadiusPanel&&e.$refs.shapeRadiusPanel.hideSelectPanel()}}},[e.property&&e.property.borderRadius?n("div",{staticClass:"name"},[e._v("\n            圆角\n        ")]):e._e(),e._v(" "),e.property&&e.property.borderRadius?n("setting-border-radius",{ref:"shapeRadiusPanel",attrs:{model:e.property.borderRadius,"model-key":"val"}}):e._e(),e._v(" "),e.shapeItems&&e.shapeItems.length>0?n("div",{staticClass:"color-btns"},[n("div",{class:{actived:e.isPrueColorShow},on:{click:function(t){e.isPrueColorShow=!0}}},[e._v("\n                纯色\n            ")]),e._v(" "),e.shapeItems&&1===e.shapeItems.length?n("div",{class:[{actived:!e.isPrueColorShow},{"hint--top":e.isShowComponentTip},{"hint--rounded":e.isShowComponentTip}],attrs:{"data-hint":"APP和小程序暂不支持"},on:{click:function(t){e.isPrueColorShow=!1}}},[e._v("\n                渐变色\n            ")]):e._e()]):e._e(),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isPrueColorShow,expression:"isPrueColorShow"}]},e._l(e.shapeItems,(function(t,i){return n("div",{key:i},[n("div",{staticClass:"name"},[e._v("\n                    颜色"+e._s(i+1)+"\n                ")]),e._v(" "),n("setting-color",{attrs:{model:t,"model-key":"fill"},on:{click:function(t){return e.shapeColorClick(i)}}})],1)})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPrueColorShow,expression:"!isPrueColorShow"}]},[e.shapeItems&&1===e.shapeItems.length?n("setting-gradient-color",{attrs:{model:e.property,"eqx-element":e.eqxElement,"model-key":"gradient"}}):e._e()],1),e._v(" "),n("div",{staticClass:"name"},[e._v("\n            翻转\n        ")]),e._v(" "),n("ul",{staticClass:"rotate"},[n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("rotateY")}}},[n("i",{staticClass:"eqf-flipshuiping"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("水平")])]),e._v(" "),n("li",{staticClass:"item",on:{click:function(t){return e.rotateComp("rotateX")}}},[n("i",{staticClass:"eqf-flipchuizhi"}),e._v(" "),n("span",{staticClass:"tip"},[e._v("垂直")])])])],1)])};Za._withStripped=!0;const Qa={components:{ShadowSetting:Ea,ImageSetting:Go,TextSetting:na,BackgroundSetting:ya,PositionSetting:wa,StrokeSetting:Ba,CubeSetting:$a,DownloadSetting:ja,BorderSetting:Xa,DateSetting:la,ShapeSetting:A({render:Za,staticRenderFns:[]},void 0,Ka,void 0,!1,void 0,!1,void 0,void 0,void 0)},data:function(){return{clearBackgroundCount:0,scroll:{state:!1,scrollY:0,scrollContentY:0},chooseList:[],defaultSetting:["DownloadSetting","BackgroundSetting"],imageSetting:["ImageSetting","ShadowSetting","PositionSetting"],textSetting:["TextSetting","ShadowSetting","StrokeSetting","CubeSetting","PositionSetting"],dateSetting:["DateSetting","ShadowSetting","StrokeSetting","CubeSetting","PositionSetting"],shapeSetting:["ShapeSetting","ShadowSetting","PositionSetting"]}},computed:{eqxElementsSelected:function(){return Vue.store.state.scene.eqxElementsSelected},currentElementType:function(){return this.eqxElementsSelected.length>0?this.elementJson.type:""},elementJson:function(){return this.eqxElementsSelected.length>1?null:1===this.eqxElementsSelected.length?this.eqxElementsSelected[0].elementJson:null},property:function(){return this.elementJson?this.elementJson.property:null},css:function(){return this.elementJson?this.elementJson.css:null},backgroundProperty:function(){return Vue.drawingBoard.background.property}},watch:{eqxElementsSelected:function(){this.getComponentList()},property:{handler:function(e){e&&e.isUpdate&&this.eqxElementsSelected[0].settingUpdateProperty(e)},deep:!0},css:{handler:function(e){e&&e.isUpdate&&this.eqxElementsSelected[0].settingUpdateCss(e)},deep:!0},backgroundProperty:{handler:function(e,t){Vue.drawingBoard.background.setBackground(e),e.clearCount!==this.clearBackgroundCount&&(Vue.drawingBoard.background.clearBackground(),Vue.operatRecord.addRecord())},deep:!0}},mounted:function(){this.getComponentList()},methods:{refreshScrollBar:function(e){var t=this;setTimeout((function(){return t.$refs.listWrapper&&t.$refs.listWrapper.myScroll.refresh()}),300)},getComponentList:function(){this.eqxElementsSelected.length>0?this.currentElementType===$t.image?this.chooseList=this.imageSetting:this.currentElementType===$t.text?this.chooseList=this.textSetting:this.currentElementType===$t.date?this.chooseList=this.dateSetting:this.currentElementType===$t.shape&&(this.chooseList=this.shapeSetting):this.chooseList=this.defaultSetting,this.refreshScrollBar()}}};var es=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"scroll-bar",rawName:"v-scroll-bar"}],ref:"listWrapper",staticClass:"eqx-setting-panel",style:{height:e.height+"px"}},[n("div",{ref:"content",staticClass:"setting-content"},[e._l(e.chooseList,(function(t,i){return[n(t,{key:t,tag:"component",attrs:{type:e.currentElementType,property:"BackgroundSetting"===t?e.backgroundProperty:e.property,css:e.css,"is-open":0==i},on:{heightChange:e.refreshScrollBar}})]}))],2)])};es._withStripped=!0;const ts=A({render:es,staticRenderFns:[]},void 0,Qa,void 0,!1,void 0,!1,void 0,void 0,void 0);var ns=function(e){s(i,e);var t=u(i);function i(e){var o;n(this,i),o=t.call(this);var a=Vue.extend(ts);return o.$vm=new a({data:function(){return{height:e.height}}}).$mount(),o.$el=o.$vm.$el,o}return i}(io),is=function(){function e(){n(this,e),this.records=[],this.currentPosition=-1,this.isFirstPos=!0,this.isLastPos=!0}return o(e,[{key:"addRecord",value:function(){var e=[];Vue.elements.getAll().map((function(t){e.push(t.elementJson)}));var t={elements:e,background:Vue.drawingBoard.background.property,relations:Vue.elements.getRelationship()},n=JSON.stringify(t);n!==this.records[this.currentPosition]&&(this.currentPosition<this.records.length&&(this.records.length=this.currentPosition+1),this.records.push(n),this.currentPosition++,this.setFirstAndLastPos())}},{key:"back",value:function(){return this.currentPosition>=0&&this.currentPosition--,this.setFirstAndLastPos(),JSON.parse(this.records[this.currentPosition])}},{key:"forward",value:function(){return this.currentPosition<=this.records.length-1&&this.currentPosition++,this.setFirstAndLastPos(),JSON.parse(this.records[this.currentPosition])}},{key:"setFirstAndLastPos",value:function(){this.isFirstPos=0===this.currentPosition,this.isLastPos=this.currentPosition===this.records.length-1,Vue.store.commit("HISTORY_SET",{disableBack:this.isFirstPos,disableForward:this.isLastPos})}},{key:"renderDrawBoard",value:function(e){Vue.store.commit("ELEMENT_SELECT",{eqxElements:[]}),Vue.elements.clearSelected(),Vue.elementsBoxs.clearSelected(),Vue.elementsBoxs.clearHoverElement(),Vue.elementsBoxs.clearGroupElement(),Vue.elements.$el.innerHTML="",Vue.elements.delAll();var t=e.elements,n=e.background,i=e.relations;t.map((function(e){var t=new Ai[e.type](e,Vue.drawingBoard);Vue.drawingBoard.addElement(t,!0),t.setSelected(!1)})),i&&Vue.elements.setRelationship(i),Vue.drawingBoard.background.setBackground(n)}}]),e}();function os(){var e=this,t=this.$el;t.addEventListener("mousedown",(function(n){Ft.call(e,n,t)}))}function as(e){var t=this;e.addEventListener("mousedown",(function(e){e.stopPropagation();var n=Vue.drawingBoard.scale,i=Vue.editor.$el.getBoundingClientRect(),o=e.clientY,a=t.xLines,s=a.findIndex((function(t){return t.xLine.id===e.target.id})),r=a[s].xLine.top;document.body.css({cursor:"row-resize"}),Vue.rulerBar.setPointerEvents("none");var l=function(e){var l=e.clientY-o;a[s].xLine.top=r+l/n,document.querySelector("#"+a[s].xLine.id).css({top:a[s].xLine.top*n-1+"px"}),ss.call(t,{display:"block",left:e.clientX-i.left-18+"px",top:e.clientY-i.top-30+"px"},Math.round(a[s].xLine.top))};document.addEventListener("mousemove",l),document.addEventListener("mouseup",(function e(n){(n.clientY<i.top+20||n.clientY>i.bottom)&&t.delXLine(n),ss.call(t,{display:"none"}),document.body.css({cursor:""}),Vue.rulerBar.setPointerEvents("auto"),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)}))}))}function ss(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.tip.css(e),this.tip.innerHTML=t}function rs(e){var t=this;e.addEventListener("mousedown",(function(e){e.stopPropagation();var n=Vue.drawingBoard.scale,i=Vue.editor.$el.getBoundingClientRect(),o=e.clientX,a=t.yLines,s=a.findIndex((function(t){return t.yLine.id===e.target.id})),r=a[s].yLine.left;document.body.css({cursor:"row-resize"}),Vue.rulerBar.setPointerEvents("none");var l=function(e){var l=e.clientX-o;a[s].yLine.left=r+l/n,document.querySelector("#"+a[s].yLine.id).css({left:a[s].yLine.left*n-1+"px"}),ls.call(t,{display:"block",left:e.clientX-i.left+10+"px",top:e.clientY-i.top-10+"px"},Math.round(a[s].yLine.left))};document.addEventListener("mousemove",l),document.addEventListener("mouseup",(function e(n){(n.clientX<i.left+20||n.clientX>i.right)&&t.delYLine(n),ls.call(t,{display:"none"}),document.body.css({cursor:""}),Vue.rulerBar.setPointerEvents("auto"),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)}))}))}function ls(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.tip.css(e),this.tip.innerHTML=t}var cs=function(){function e(t){n(this,e),this.xLines=[],this.yLines=[],this.render()}return o(e,[{key:"render",value:function(){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-ruler-line"}).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center","pointer-events":"none"});var e=this.rulerLine=document.createElement("DIV"),t=Vue.drawingBoard.$el;e.attr({class:"ruler-line"}).css({width:t.offsetWidth+"px",height:t.offsetHeight+"px",transform:"translate(".concat(t.style.marginLeft,", ").concat(t.style.marginTop,")"),position:"absolute"}),this.$el.appendChild(e),this.renderLine(),this.renderTip()}},{key:"reDraw",value:function(){var e=Vue.drawingBoard.$el;this.rulerLine.attr({class:"ruler-line"}).css({width:e.offsetWidth+"px",height:e.offsetHeight+"px",transform:"translate(".concat(e.style.marginLeft,", ").concat(e.style.marginTop,")"),position:"absolute"}),this.renderLine()}},{key:"renderTip",value:function(){var e=this.tip=document.createElement("DIV");e.attr({class:"tip"}).css({position:"absolute",width:"36px",height:"20px","line-height":"20px","text-align":"center","font-size":"12px",color:"#fff",background:"rgba(0, 0, 0, 0.7)","border-radius":"3px",display:"none"}),this.$el.appendChild(e)}},{key:"renderLine",value:function(){var e=this,t=Vue.drawingBoard.scale,n=document.createDocumentFragment();this.xLines.forEach((function(i){var o=document.createElement("DIV");o.attr({class:"lin x",id:i.xLine.id}).css({position:"absolute","pointer-events":"auto",left:"-40000px",width:"100000px",height:"3px",background:"linear-gradient(to bottom, transparent 33.3%, #53ebef 0, #53ebef 66.6%, transparent 0)",cursor:"row-resize",top:"".concat(i.xLine.top*t-1,"px")}),o.addEventListener("dblclick",(function(t){e.delXLine(t)})),as.call(e,o),n.appendChild(o)}));var i=document.createDocumentFragment();this.yLines.forEach((function(n){var o=document.createElement("DIV");o.attr({class:"lin y",id:n.yLine.id}).css({position:"absolute","pointer-events":"auto",top:"-40000px",width:"3px",height:"100000px",background:"linear-gradient(to right, transparent 33.3%, #53ebef 0, #53ebef 66.6%, transparent 0)",cursor:"col-resize",left:"".concat(n.yLine.left*t-1,"px")}),o.addEventListener("dblclick",(function(t){e.delYLine(t)})),rs.call(e,o),i.appendChild(o)})),this.rulerLine.innerHTML="",this.rulerLine.appendChild(i),this.rulerLine.appendChild(n)}},{key:"addYLine",value:function(e){this.yLines.push(e),this.renderLine()}},{key:"delYLine",value:function(e){var t=e.target.id;this.yLines=this.yLines.filter((function(e){return e.yLine.id!==t})),e.target.remove()}},{key:"getYLine",value:function(){return this.yLines}},{key:"addXLine",value:function(e){this.xLines.push(e),this.renderLine()}},{key:"delXLine",value:function(e){var t=e.target.id;this.xLines=this.xLines.filter((function(e){return e.xLine.id!==t})),e.target.remove()}},{key:"getXLine",value:function(){return this.xLines}}]),e}(),ds=function(){function e(t){n(this,e),this.initConfig(),this.render()}return o(e,[{key:"initConfig",value:function(){this.colNum=0,this.rowNum=0,this.visible=!0}},{key:"updateConfig",value:function(e,t,n){this.visible=e,this.colNum=t,this.rowNum=n}},{key:"render",value:function(){this.$el=document.createElement("DIV");var e=Vue.drawingBoard.$el;this.$el.attr({class:"eqx-grid-line"}).css({width:e.offsetWidth+"px",height:e.offsetHeight+"px",transform:"translate(".concat(e.style.marginLeft,", ").concat(e.style.marginTop,")"),position:"absolute","pointer-events":"none"}),this.renderLine()}},{key:"renderLine",value:function(){for(var e=document.createDocumentFragment(),t=1;t<this.colNum;t++){var n=document.createElement("DIV");n.attr({class:"line x"}).css({position:"absolute",left:0,width:"100%",height:0,"border-bottom":"1px dashed #ff2a6a",top:t/this.colNum*100+"%"}),e.appendChild(n)}for(var i=1;i<this.rowNum;i++){var o=document.createElement("DIV");o.attr({class:"line y"}).css({position:"absolute",top:0,width:0,height:"100%","border-right":"1px dashed #ff2a6a",left:i/this.rowNum*100+"%"}),e.appendChild(o)}this.$el.innerHTML="",this.$el.appendChild(e)}}]),e}(),us=function(){function e(t){n(this,e),this.render(),this.threshold=3,this.startBigRect={},this.bigRect={},this.workspaceRect={},this.guideRects=[],this.moveObj={left:0,top:0},this.targetRect={},this.equalWidth=[],this.equalHeight=[],this.spacing=[]}return o(e,[{key:"render",value:function(){this.$el=document.createElement("DIV"),this.$el.attr({class:"eqx-guide-line"}).css({position:"absolute",left:0,top:0,right:0,bottom:0,"pointer-events":"none"});var e={position:"absolute",background:"red",left:0,width:"100%",height:"1px"},t={position:"absolute",background:"red",top:0,width:"1px",height:"100%"},n=document.createDocumentFragment(),i=this.hTopLine=document.createElement("DIV");i.attr({class:"h-top-line"}).css(e);var o=this.hCenterLine=document.createElement("DIV");o.attr({class:"h-center-line"}).css(e);var a=this.hBottomLine=document.createElement("DIV");a.attr({class:"h-bottom-line"}).css(e),n.appendChild(i),n.appendChild(o),n.appendChild(a);var s=this.vLeftLine=document.createElement("DIV");s.attr({class:"v-left-line"}).css(t);var r=this.vCenterLine=document.createElement("DIV");r.attr({class:"v-center-line"}).css(t);var l=this.vRightLine=document.createElement("DIV");l.attr({class:"v-right-line"}).css(t),n.appendChild(s),n.appendChild(r),n.appendChild(l),this.$el.appendChild(n)}},{key:"renderEqual",value:function(){var e=this;!function(t){var n=document.createDocumentFragment();if(e.equalWidth.forEach((function(e){var t=document.createElement("DIV");t.attr({class:"equal-width"}).css({position:"absolute",display:"flex","justify-content":"space-between","align-items":"flex-start",top:e.top,left:e.left});var i=document.createElement("DIV");i.attr({class:"bundle"}).css({width:"1px",height:"9px",background:"#ff2a6a"});var o=document.createElement("DIV");o.attr({class:"bundle"}).css({width:"1px",height:"9px",background:"#ff2a6a"});var a=document.createElement("DIV");a.attr({class:"equal-line"}).css({width:e.width});var s=document.createElement("DIV");s.attr({class:"e-l"}).css({width:"100%",height:"1px",background:"#ff2a6a","margin-top":"4px"});var r=document.createElement("P");r.attr({class:"e-n"}).css({"font-size":"12px",color:"#ff2a6a","text-align":"center",width:"100%","line-height":"14px"}),r.innerText=e.num,t.appendChild(i),a.appendChild(s),a.appendChild(r),t.appendChild(a),t.appendChild(o),n.appendChild(t)})),e.equalWidthContainer&&e.equalWidthContainer.remove(),n.children.length>0){var i=e.equalWidthContainer=document.createElement("DIV").attr({class:"equal-width-container"});i.appendChild(n),e.$el.appendChild(i)}}(),function(t){var n=document.createDocumentFragment();if(e.equalHeight.forEach((function(e){var t=document.createElement("DIV");t.attr({class:"equal-height"}).css({position:"absolute",display:"flex","flex-direction":"column","justify-content":"space-between","align-items":"flex-end",top:e.top,left:e.left});var i=document.createElement("DIV");i.attr({class:"bundle"}).css({width:"9px",height:"1px",background:"#ff2a6a"});var o=document.createElement("DIV");o.attr({class:"bundle"}).css({width:"9px",height:"1px",background:"#ff2a6a"});var a=document.createElement("DIV");a.attr({class:"equal-line"}).css({height:e.height});var s=document.createElement("DIV");s.attr({class:"e-l"}).css({height:"100%",width:"1px",background:"#ff2a6a","margin-right":"4px"});var r=document.createElement("DIV");r.attr({class:"e-n"}).css({"font-size":"12px",color:"#ff2a6a","text-align":"center",position:"absolute",top:"calc(50% - 6px)",right:"8px"}),r.innerText=e.num,t.appendChild(i),a.appendChild(s),a.appendChild(r),t.appendChild(a),t.appendChild(o),n.appendChild(t)})),e.equalHeightContainer&&e.equalHeightContainer.remove(),n.children.length>0){var i=e.equalHeightContainer=document.createElement("DIV").attr({class:"equal-height-container"});i.appendChild(n),e.$el.appendChild(i)}}()}},{key:"renderSpaces",value:function(){var e=document.createDocumentFragment();if(this.spacing.forEach((function(t){var n=document.createElement("DIV");n.attr({class:"equal-space"}).css({position:"absolute",background:"rgba(255, 42, 106, 0.15)",display:"flex","justify-content":"flex-start","align-items":"flex-start",top:t.top,left:t.left,width:t.width,height:t.height});var i=document.createElement("P");i.attr({class:"num"}).css({"font-size":"12px",color:"#ff2a6a","text-align":"center"}),i.innerText=t.num,n.appendChild(i),e.appendChild(n)})),this.spacingDomContainer&&this.spacingDomContainer.remove(),e.children.length>0){var t=this.spacingDomContainer=document.createElement("DIV").attr({class:"spacing-container"});t.appendChild(e),this.$el.appendChild(t)}}},{key:"start",value:function(e){this.moveObj=e,this.workspaceRect=Vue.editor.$el.getBoundingClientRect(),this.startBigRect={left:Number.MAX_SAFE_INTEGER,top:Number.MAX_SAFE_INTEGER,right:Number.MIN_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER,width:0,height:0,centerX:0,centerY:0},this.bigRect={},this.guideRects=[],this.setGuideRects()}},{key:"startEqualWidthHeight",value:function(){this.workspaceRect=Vue.editor.$el.getBoundingClientRect(),this.targetRect={},this.guideRects=[],this.setEqualWHGuideRects()}},{key:"setBigRect",value:function(){var e=this.bigRect,t=this.startBigRect;e.left=t.left+this.moveObj.left,e.top=t.top+this.moveObj.top,e.right=e.left+t.width,e.bottom=e.top+t.height,e.centerX=e.left+t.width/2,e.centerY=e.top+t.height/2,e.width=e.right-e.left,e.height=e.bottom-e.top}},{key:"setBigRectStart",value:function(e){var t=this.startBigRect,n=e.$el.getBoundingClientRect();t.left=Math.min(t.left,n.left),t.top=Math.min(t.top,n.top),t.right=Math.max(t.right,n.left+n.width),t.bottom=Math.max(t.bottom,n.top+n.height),t.width=t.right-t.left,t.height=t.bottom-t.top,t.centerX=t.left+t.width/2,t.centerY=t.top+t.height/2}},{key:"setGuideRects",value:function(){var e=this,t=Vue.gridLine,n=Vue.rulerLine,i=Vue.drawingBoard.$el.getBoundingClientRect();if(this.guideRects.push(i),Vue.elements.getUnSelected().forEach((function(t){var n=t.$el.getBoundingClientRect();e.guideRects.push(n)})),t.visible){for(var o=1;o<t.colNum;o++){if(o===t.colNum/2)return;this.guideRects.push({top:i.top+o/t.colNum*i.height})}for(var a=1;a<t.rowNum;a++){if(a===t.rowNum/2)return;this.guideRects.push({left:i.left+a/t.rowNum*i.width})}}n.getYLine().length>0&&n.getYLine().forEach((function(t){e.guideRects.push({left:i.left+t.yLine.left*Vue.drawingBoard.scale})})),n.getXLine().length>0&&n.getXLine().forEach((function(t){e.guideRects.push({top:i.top+t.xLine.top*Vue.drawingBoard.scale})}))}},{key:"showGuideLine",value:function(){var e=this,t=this.bigRect,n=[];this.guideRects.forEach((function(i){var o=i.left,a=i.top,s=i.right,r=i.bottom,l=i.width,c=i.height,d={};void 0!==a&&(d.top=a),void 0!==r&&(d.bottom=r),void 0!==c&&(d.centerY=a+c/2);var u={};void 0!==o&&(u.left=o),void 0!==s&&(u.right=s),void 0!==l&&(u.centerX=o+l/2);var h={top:t.top,bottom:t.bottom,centerY:t.centerY},p={left:t.left,right:t.right,centerX:t.centerX},m={};void 0!==a&&(m.top=a),void 0!==r&&(m.bottom=r),void 0!==o&&(m.left=o),void 0!==s&&(m.right=s),void 0!==l&&(m.width=l),void 0!==c&&(m.height=c),n.push(m),e.showGuideLinePart("left",u,p),e.showGuideLinePart("top",d,h)}));var i={top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:t.width,height:t.height};this.showSpacing("top",n,i),this.showSpacing("left",n,i)}},{key:"showGuideLinePart",value:function(e,t,n){for(var i in t)for(var o in n)if(Math.abs(t[i]-n[o])<=this.threshold){this.moveObj[e]=t[i]-this.startBigRect[o];var s=a({display:"block"},e,t[i]-this.workspaceRect[e]+"px");switch(o.toUpperCase()){case"TOP":this.hTopLine.css(s);break;case"CENTERY":this.hCenterLine.css(s);break;case"BOTTOM":this.hBottomLine.css(s);break;case"LEFT":this.vLeftLine.css(s);break;case"CENTERX":this.vCenterLine.css(s);break;case"RIGHT":this.vRightLine.css(s)}}}},{key:"clearGuideLine",value:function(){var e={display:"none"};this.hTopLine.css(e),this.hCenterLine.css(e),this.hBottomLine.css(e),this.vLeftLine.css(e),this.vCenterLine.css(e),this.vRightLine.css(e),this.spacing=[],this.renderSpaces()}},{key:"showSpacing",value:function(e,t,n){var i=this.formatListByDirection(e,t,n);this.showSpaceByDirection("left",i.leftList,n),this.showSpaceByDirection("right",i.rightList,n),this.showSpaceByDirection("top",i.topList,n),this.showSpaceByDirection("bottom",i.bottomList,n)}},{key:"formatListByDirection",value:function(e,t,n){var i=[],o=[],a=[],s=[];t.forEach((function(t){"top"===e&&t.right<n.left&&i.push(t),"top"===e&&t.left>n.right&&o.push(t),"left"===e&&t.bottom<n.top&&a.push(t),"left"===e&&t.top>n.bottom&&s.push(t)}));var r="top"===e?"left":"top";return i.sort((function(e,t){return t[r]-e[r]})),a.sort((function(e,t){return t[r]-e[r]})),o.sort((function(e,t){return e[r]-t[r]})),s.sort((function(e,t){return e[r]-t[r]})),{leftList:i,rightList:o,topList:a,bottomList:s}}},{key:"showSpaceByDirection",value:function(e,t,n){for(var i=this,o=[],a=n,s=null,r=function(n){var r=t[n],l=0,c=0,d=0,u=0,h=0,p=null;"left"===e?l=a.left-r.right:"right"===e?l=r.left-a.right:"top"===e?l=a.top-r.bottom:"bottom"===e&&(l=r.top-a.bottom),"left"===e||"right"===e?(h=Math.max(a.bottom,r.bottom)-Math.min(a.top,r.top),c=Math.min(a.top,r.top)-i.workspaceRect.top,u=l,d=("left"===e?r.right:a.right)-i.workspaceRect.left,p={"border-bottom":"1px solid #ff2a6a","line-height":"14px",width:"100%"}):"top"!==e&&"bottom"!==e||(u=Math.max(a.right,r.right)-Math.min(a.left,r.left),d=Math.min(a.left,r.left)-i.workspaceRect.left,h=l,c=("top"===e?r.bottom:a.bottom)-i.workspaceRect.top,p={"border-right":"1px solid #ff2a6a","line-height":l+"px",height:"100%","padding-right":"2px"});var m={id:"space_"+n,top:c+"px",left:d+"px",width:u+"px",height:h+"px",num:parseInt(l/Vue.drawingBoard.scale),numCss:p};if(0===o.length&&null===s)s=m;else if(Math.abs(s.num-m.num)<i.threshold){s.num=m.num,o.push(s);var g=o.findIndex((function(e){return e.id===m.id}));-1===g?o.push(m):o.splice(g,1,m)}a=r},l=0;l<t.length;l++)r(l);o.map((function(e){e.num=o[0].num})),o.map((function(e){var t=i.spacing.findIndex((function(t){return t.id===e.id}));-1===t?i.spacing.push(e):i.spacing.splice(t,1,e)})),this.renderSpaces()}},{key:"setEqualWHGuideRects",value:function(){var e=this;Vue.elements.getUnSelected().forEach((function(t){var n=t.$el.getBoundingClientRect(),i=n.top,o=n.left,a=n.right,s=n.bottom,r=parseInt(t.elementJson.css.width),l=parseInt(t.elementJson.css.height);[$t.text,$t.date].includes(t.elementJson.type)&&(r=parseInt(t.elementJson.css.width)+parseInt(t.elementJson.css.padding)+4,l=parseInt(t.elementJson.css.height)+parseInt(t.elementJson.css.padding)+10);var c=t.elementJson.css.transform;c.match(/\d+/g).includes("0")&&e.guideRects.push({top:i,left:o,right:a,bottom:s,width:r,height:l,eRotate:c})}))}},{key:"showEqualWHGuideLine",value:function(){if(this.targetRect.handle){var e=It;[e.lineLeft,e.lineRight].includes(this.targetRect.handle)&&this.showEquaLine("width"),[e.lineTop,e.lineBottom].includes(this.targetRect.handle)&&this.showEquaLine("height")}}},{key:"showEquaLine",value:function(e){for(var t=this,n=[],i=this.targetRect,o=this.guideRects,s=0;s<o.length;s++){var r=o[s],l=i.eRotate.match(/\d+/g);l&&Math.abs(r[e]-i[e])<this.threshold&&l.includes("0")&&function(){var i,o=(a(i={id:"equal_line"+s,top:r.top+("width"===e?r.height*Vue.drawingBoard.scale:0)-t.workspaceRect.top+"px",left:r.left-("width"===e?0:10)-t.workspaceRect.left+"px"},e,r[e]*Vue.drawingBoard.scale+"px"),a(i,"num",parseInt(r[e])),a(i,"rotate",r.eRotate),i),l=n.findIndex((function(e){return e.id===o.id}));-1===l?n.push(o):n.splice(l,1,o)}()}if(n.length>0){var c,d=(a(c={id:"equal_line_target",top:i.top+("width"===e?i.height*Vue.drawingBoard.scale:0)-this.workspaceRect.top+"px",left:i.left-("width"===e?0:10)-this.workspaceRect.left+"px"},e,i[e]*Vue.drawingBoard.scale+"px"),a(c,"num",n[0].num),a(c,"rotate",i.eRotate),c);n.unshift(d)}n.map((function(e){e.num=n[0].num})),"WIDTH"===e.toUpperCase()?n.map((function(e){var n=t.equalWidth.findIndex((function(t){return t.id===e.id}));-1===n?t.equalWidth.push(e):t.equalWidth.splice(n,1,e)})):"HEIGHT"===e.toUpperCase()&&n.map((function(e){var n=t.equalHeight.findIndex((function(t){return t.id===e.id}));-1===n?t.equalHeight.push(e):t.equalHeight.splice(n,1,e)})),this.renderEqual()}},{key:"setTargetRect",value:function(e){this.targetRect=e}},{key:"clearEqualWHGuideLine",value:function(){this.equalHeight=[],this.equalWidth=[],this.renderEqual()}}]),e}();return{Editor:function(e){s(i,e);var t=u(i);function i(e){var o;n(this,i),e=Object.assign({},e),o=t.call(this,e);var a=new Vue({store:qi,el:"#".concat(e.target),render:function(e){return e(to)}});if(o.$vm=a,o.$el=o.$vm.$children[0].$refs.editor,o.$el.focus(),o.$eqxCenterEl=o.$vm.$children[0].$refs.eqxCenter,o.$rightEl=o.$vm.$children[0].$refs.eqxRight,o.drawingBoard=new Ro({scale:"auto",size:{width:e.drawingBoard.width,height:e.drawingBoard.height},editorSize:{width:o.$el.offsetWidth,height:o.$el.offsetHeight}}),o.$el.appendChild(o.drawingBoard.$el),Vue.drawingBoard=Vue.prototype.drawingBoard=o.drawingBoard,o.selectBox=new Lo,o.$el.appendChild(o.selectBox.$el),o.overViewMap=new zo,o.$el.appendChild(o.overViewMap.$el),o.toolBar=new Oo({name:e.name}),o.$eqxCenterEl.appendChild(o.toolBar.$el),o.settingPanel=new ns({height:o.$rightEl.offsetHeight}),o.$rightEl.appendChild(o.settingPanel.$el),o.operatRecord=new is,Vue.operatRecord=Vue.prototype.operatRecord=o.operatRecord,o.$vm.$nextTick((function(){os.call(c(o))})),Vue.editor=Vue.prototype.editor=c(o),o.gridLine=new ds,o.$el.appendChild(o.gridLine.$el),Vue.gridLine=Vue.prototype.gridLine=o.gridLine,o.rulerLine=new cs,o.$el.appendChild(o.rulerLine.$el),Vue.rulerLine=Vue.prototype.rulerLine=o.rulerLine,o.guideLine=new us,o.$el.appendChild(o.guideLine.$el),Vue.guideLine=Vue.prototype.guideLine=o.guideLine,o.rulerBar=new $o,o.$el.appendChild(o.rulerBar.$el),Vue.rulerBar=Vue.prototype.rulerBar=o.rulerBar,e.fonts){for(var s=[],r=0;r<e.fonts.length;r++){var l=e.fonts[r];Object.prototype.hasOwnProperty.call(l,"name")&&Object.prototype.hasOwnProperty.call(l,"fontFamily")&&""!==l.name&&""!==l.fontFamily&&s.push(l)}Vue.store.commit("FONT_LIST_INIT",s)}return Vue.store.commit("EDITOR_CONFIG_CHANGE",e),o}return o(i,[{key:"addElement",value:function(e){this.drawingBoard.addElement(e)}},{key:"clearElements",value:function(){this.drawingBoard.clearElements()}},{key:"clearBackground",value:function(){this.drawingBoard.background.clearBackground()}},{key:"setBackgroundColor",value:function(e){this.drawingBoard.background.setBackgroundColor(e)}},{key:"exportImg",value:function(e){return 1===(e=Object.assign({type:1},e)).type?Ga.downloadFile(e):Ga.page2Canvas(e)}}]),i}(no),H2Image:Ut,H2Text:Wt,H2Date:ln,H2TextThreeD:Di}}));
